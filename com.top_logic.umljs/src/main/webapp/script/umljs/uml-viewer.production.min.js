!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).UmlJS=e()}(this,function(){"use strict";function t(t,e){return e.forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})}),Object.freeze(t)}const e=Object.prototype.toString,n=Object.prototype.hasOwnProperty;function r(t,e){return n.call(t,e)}function o(t,n){let o,a;if(void 0===t)return;const c=function(t){return"[object Array]"===e.call(t)}(t)?s:i;for(let e in t)if(r(t,e)&&(o=t[e],a=n(o,c(e)),!1===a))return o}function i(t){return t}function s(t){return Number(t)}const a=Object.prototype.toString;function c(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function u(t,e,n){var r=n?t:t.parentNode;return r&&"function"==typeof r.closest&&r.closest(e)||null}c.prototype.add=function(t){return this.list.add(t),this},c.prototype.remove=function(t){return"[object RegExp]"==a.call(t)?this.removeMatching(t):(this.list.remove(t),this)},c.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},c.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},c.prototype.array=function(){return Array.from(this.list)},c.prototype.has=c.prototype.contains=function(t){return this.list.contains(t)};var l,h,f,p={};function d(){l=window.addEventListener?"addEventListener":"attachEvent",h=window.removeEventListener?"removeEventListener":"detachEvent",f="addEventListener"!==l?"on":""}var y,v=t({__proto__:null,bind:p.bind=function(t,e,n,r){return l||d(),t[l](f+e,n,r||!1),n},unbind:p.unbind=function(t,e,n,r){return h||d(),t[h](f+e,n,r||!1),n},default:p},[p]),m=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r){return(o=e.createElement("html")).innerHTML=t,o.removeChild(o.lastChild)}var o,i=Object.prototype.hasOwnProperty.call(_,r)?_[r]:_._default,s=i[0],a=i[1],c=i[2];(o=e.createElement("div")).innerHTML=a+t+c;for(;s--;)o=o.lastChild;if(o.firstChild==o.lastChild)return o.removeChild(o.firstChild);var u=e.createDocumentFragment();for(;o.firstChild;)u.appendChild(o.removeChild(o.firstChild));return u},g=!1;"undefined"!=typeof document&&((y=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',g=!y.getElementsByTagName("link").length,y=void 0);var _={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:g?[1,"X<div>","</div>"]:[0,"",""]};_.td=_.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],_.option=_.optgroup=[1,'<select multiple="multiple">',"</select>"],_.thead=_.tbody=_.colgroup=_.caption=_.tfoot=[1,"<table>","</table>"],_.polyline=_.ellipse=_.polygon=_.circle=_.text=_.line=_.path=_.rect=_.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var x=m;function w(t,e){return(e=e||document).querySelector(t)}function b(t,e){return{x:t.x-e.x,y:t.y-e.y}}function k(t){return Math.log(t)/Math.log(10)}function E(t,e){var n=k(t.min),r=k(t.max);return(Math.abs(n)+Math.abs(r))/e}const j=Object.prototype.toString,C=Object.prototype.hasOwnProperty;function M(t){return"[object Array]"===j.call(t)}function R(t){return"[object Number]"===j.call(t)}function O(t){const e=j.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e||"[object GeneratorFunction]"===e||"[object AsyncGeneratorFunction]"===e||"[object Proxy]"===e}function S(t,e){return!(null==t)&&C.call(t,e)}function L(t,e){const n=function(t){return O(t)?t:e=>e===t}(e);let r;return B(t,function(t,e){if(n(t,e))return r=t,!1}),r}function B(t,e){let n,r;if(void 0===t)return;const o=M(t)?T:N;for(let i in t)if(S(t,i)&&(n=t[i],r=e(n,o(i)),!1===r))return n}function P(t,e,n){return B(t,function(t,r){n=e(n,t,r)}),n}function N(t){return t}function T(t){return Number(t)}function A(t,e){return t.bind(e)}function D(t,...e){return Object.assign(t,...e)}var z=Math.sign||function(t){return t>=0?1:-1},G={min:.2,max:4};function F(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=A(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var r=this;e.on("canvas.init",function(e){r._init(!1!==t.enabled)})}F.$inject=["config.zoomScroll","eventBus","canvas"],F.prototype.scroll=function(t){this._canvas.scroll(t)},F.prototype.reset=function(){this._canvas.zoom("fit-viewport")},F.prototype.zoom=function(t,e){var n=E(G,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},F.prototype._handleWheel=function(t){if(!u(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,r=t.ctrlKey||/mac/i.test(navigator.platform)&&t.metaKey,o=t.shiftKey,i=-1*this._scale;if(i*=r?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,r){var s=e.getBoundingClientRect(),a={x:t.clientX-s.left,y:t.clientY-s.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*z(t.deltaY)*i,this.zoom(n,a)}else n=o?{dx:i*t.deltaY,dy:0}:{dx:i*t.deltaX,dy:i*t.deltaY},this.scroll(n)}},F.prototype.stepZoom=function(t,e){var n=E(G,10);this._zoom(t,e,n)},F.prototype._zoom=function(t,e,n){var r=this._canvas,o=t>0?1:-1,i=k(r.zoom()),s=Math.round(i/n)*n;s+=n*o;var a,c,u=Math.pow(10,s);r.zoom((a=G,c=u,Math.max(a.min,Math.min(a.max,c))),e)},F.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,r=this._enabled;return void 0===t&&(t=!r),r!==t&&v[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},F.prototype._init=function(t){this.toggle(t)};var V={__init__:["zoomScroll"],zoomScroll:["type",F]},$=/^djs-cursor-.*$/;function I(t){var e=new c(document.body);e.removeMatching($),t&&e.add("djs-cursor-"+t)}function Y(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function H(t,e){var n;function r(r){var o,i=n.start,s=n.button,a=Y(r),c=b(a,i);(!n.dragging&&(o=c,Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))>15)&&(n.dragging=!0,0===s&&function(t,e){function n(){return!1}e=e||"element.click",t.once(e,5e3,n)}(t),I("grab")),n.dragging)&&(c=b(a,n.last||n.start),e.scroll({dx:c.x,dy:c.y}),n.last=a);r.preventDefault()}function o(t){v.unbind(document,"mousemove",r),v.unbind(document,"mouseup",o),n=null,I(null)}t.on("element.mousedown",500,function(t){return function(t){if(u(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:Y(t)},v.bind(document,"mousemove",r),v.bind(document,"mouseup",o),!0}(t.originalEvent)}),this.isActive=function(){return!!n}}H.$inject=["eventBus","canvas"];var q={__init__:["moveCanvas"],moveCanvas:["type",H]};function W(t,e){var n=this;e=e||1e3,t.on(["render.shape","render.connection"],e,function(t,e){var r=t.type,o=e.element,i=e.gfx,s=e.attrs;if(n.canRender(o))return"render.shape"===r?n.drawShape(i,o,s):n.drawConnection(i,o,s)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)})}function Z(t,e){return function(t,e){e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}(e,t),t}W.prototype.canRender=function(t){},W.prototype.drawShape=function(t,e){},W.prototype.drawConnection=function(t,e){},W.prototype.getShapePath=function(t){},W.prototype.getConnectionPath=function(t){};var K={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function X(t,e,n){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=K[r];o?(2===o&&"number"==typeof n&&(n=String(n)+"px"),t.style[r]=n):t.setAttributeNS(null,e,n)}function J(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return K[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);X(t,e,n)}else!function(t,e){var n,r,o=Object.keys(e);for(n=0;r=o[n];n++)X(t,r,e[r])}(t,e);return t}const U=Object.prototype.toString;function Q(t){return new tt(t)}function tt(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}tt.prototype.add=function(t){return this.list.add(t),this},tt.prototype.remove=function(t){return"[object RegExp]"==U.call(t)?this.removeMatching(t):(this.list.remove(t),this)},tt.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},tt.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},tt.prototype.array=function(){return Array.from(this.list)},tt.prototype.has=tt.prototype.contains=function(t){return this.list.contains(t)};var et="http://www.w3.org/2000/svg",nt='<svg xmlns="'+et+'"';function rt(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(et)&&(t=nt+t.substring(4)):(t=nt+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var r=document.createDocumentFragment(),o=n.firstChild;o.firstChild;)r.appendChild(o.firstChild);return r}function ot(t,e){var n;return"<"===(t=t.trim()).charAt(0)?(n=rt(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(et,t),e&&J(n,e),n}var it=null;function st(){return null===it&&(it=ot("svg")),it}function at(t,e){var n,r,o=Object.keys(e);for(n=0;r=o[n];n++)t[r]=e[r];return t}function ct(t){var e=t.parentNode;return e&&e.removeChild(t),t}function ut(t,e){return e instanceof SVGMatrix?t.createSVGTransformFromMatrix(e):e}function lt(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,r;for(t.clear(),n=0;r=e[n];n++)t.appendItem(ut(t,r))}(n,e)),n.consolidate()}function ht(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function ft(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function pt(t){return["L",t.x,t.y]}function dt(t,e,n){return["C",t.x,t.y,e.x,e.y,n.x,n.y]}function yt(t,e){const n=t.length,r=[(o=t[0],["M",o.x,o.y])];var o;for(let o=1;o<n;o++){const n=t[o-1],i=t[o],s=t[o+1];if(!s||!e){r.push(pt(i));continue}const a=Math.min(e,mt(i.x-n.x,i.y-n.y),mt(s.x-i.x,s.y-i.y));if(!a){r.push(pt(i));continue}const c=vt(i,n,a),u=vt(i,n,.5*a),l=vt(i,s,a),h=vt(i,s,.5*a);r.push(pt(c)),r.push(dt(u,h,l))}return r}function vt(t,e,n){const r=e.x-t.x,o=e.y-t.y,i=n/mt(r,o);return{x:t.x+r*i,y:t.y+o*i}}function mt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function gt(t,e,n){R(e)&&(n=e,e=null),e||(e={});const r=ot("path",e);return R(n)&&(r.dataset.cornerRadius=String(n)),function(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return J(t,{d:ft(yt(e,n))}),t}(r,t)}function _t(t,e,n,r){var o=r.createText(e,n);return Q(o).add("djs-label"),Z(t,o),o}function xt(t,e,n,r){var o=function(t,e,n){var r=ot("rect");return function(t,e,n){J(t,{width:e,height:n})}(r,t,e),Et(r,n),r}(e,n,r);return Z(t,o),o}function wt(t,e,n){var r=kt(e),o=function(t){var e=kt(t);return bt(e,{stroke:"white","stroke-width":10})}(function(t){var e=t.length,n=t.slice();e>=2&&(n[0]=ht(t[0],t[1],.1),n[e-1]=ht(t[e-2],t[e-1],.9));return n}(e)),i=function(t){var e=ot("g");return Q(e).add("djs-visual"),t.forEach(function(t){Z(e,t)}),e}([o,bt(r,n)]);return Z(t,i),i}function bt(t,e){var n=ot("path");return function(t,e){J(t,{d:e})}(n,t),function(t,e){"markerEnd"in e&&J(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&J(t,{"marker-start":"url(#"+e.markerStart+")"})}(n,e),function(t,e){"transform"in e&&J(t,{transform:e.transform})}(n,e),Et(n,e),n}function kt(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function Et(t,e){"stroke"in e&&J(t,{stroke:e.stroke}),"stroke-width"in e&&J(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&J(t,{fill:e.fill}),"stroke-dasharray"in e&&J(t,{"stroke-dasharray":e["stroke-dasharray"]})}function jt(t){t.style.removeProperty("opacity")}function Ct(t,e){var n=t.closest(".djs-group");e.parent&&e.parent.isVisible?e.isVisible?jt(n):function(t){t.style.setProperty("opacity",.3)}(n):jt(n)}function Mt(t,e,n){e.businessObject;var r=xt(t,e.width,e.height,{fill:"none",stroke:"black"}),o=function(t){return D({dy:".75em"},{x:t.width/2,"text-anchor":"middle"})}(e);if(o.y=5,"stereotypes"in e&&e.stereotypes.forEach(function(e){var r=_t(t,"<<"+e+">>",o,n);o.y+=r.getBBox().height}),"name"in e){var i=_t(t,e.name,o,n);o.y+=i.getBBox().height}return e.labels.some(function(t){return"property"===t.labelType||"classifier"===t.labelType})&&"name"in e&&function(t,e,n){(function(t,e,n){var r=ot("line");J(r,{x1:e.x,y1:e.y,x2:n.x,y2:n.y,stroke:"black"}),Z(t,r)})(t,{x:0,y:n},{x:e,y:n})}(t,e.width,o.y),Ct(t,e),r}function Rt(t,e,n){var r=_t(t,e.businessObject+"",{dy:".75em"},n);return Ct(t,e),r}function Ot(t,e){return Tt(t,e,{stroke:"black",markerEnd:"association-marker"})}function St(t,e){return Tt(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function Lt(t,e){return Tt(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function Bt(t,e){return Tt(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function Pt(t,e){return Tt(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function Nt(t,e){return Tt(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function Tt(t,e,n){var r=wt(t,e.waypoints,n);return Ct(t,e),r}var At=[{name:"association-marker",element:bt("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:bt("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:bt("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:bt("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:bt("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:bt("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function Dt(t,e,n,r){var o=ot("marker");Z(o,n),J(o,{id:e,viewBox:"0 0 10 10",refX:zt(r),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),Z(t,o)}function zt(t){return t?0:10}function Gt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ft,Vt={exports:{}},$t={exports:{}};try{var It=require("util");if("function"!=typeof It.inherits)throw"";Vt.exports=It.inherits}catch(ge){Vt.exports=(Ft||(Ft=1,"function"==typeof Object.create?$t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:$t.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),$t.exports)}var Yt=Gt(Vt.exports);function Ht(t,e,n,r){W.call(this,t),this.textRenderer=n,this._layouter=r,this.drawShapeHandlers={class:Mt,label:Rt},this.drawConnectionHandlers={association:Ot,inheritance:St,realization:Lt,dependency:Bt,aggregation:Pt,composition:Nt},function(t){var e=w("defs",t._svg);e||(e=ot("defs"),Z(t._svg,e)),At.forEach(function(t){var n=t.element.cloneNode(!0);Dt(e,t.name,t.element,!1),Dt(e,t.name+"-reversed",n,!0)})}(e)}function qt(){this._style={fontFamily:"DroidSansMono",fontSize:12}}Yt(Ht,W),Ht.$inject=["eventBus","canvas","textRenderer","layouter"],Ht.prototype.canRender=function(t){return!0},Ht.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},Ht.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},Ht.prototype.getShapePath=function(t){return n=(e=t).x,r=e.y,o=e.width,ft([["M",n,r],["l",o,0],["l",0,e.height],["l",-o,0],["z"]]);var e,n,r,o},qt.prototype.createText=function(t,e){var n=ot("text");return n.textContent=t,J(n,e=D(e,this._style)),n},qt.prototype.getDimensions=function(t,e){var n=ot("text");J(n,this._style),Z(function(){var t=document.getElementById("helper-svg");if(!t)return function(){var t=ot("svg");return J(t,{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(t),t}();return t}(),n),n.textContent=t;var r=n.getBBox();return ct(n),r},qt.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},qt.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var Wt={__init__:["umlRenderer"],umlRenderer:["type",Ht],textRenderer:["type",qt]};function Zt(t,e,n,r){if(void 0===r&&(r=5),!t||!e||!n)return!1;var o,i,s=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),a=(i=e,(o=t)&&i?Math.sqrt(Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)):-1);return Math.abs(s/a)<=r}function Kt(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Xt(t,e,n){var r;r=n=n||0,"[object Object]"!==j.call(r)&&(n={x:n,y:n});var o=Kt(t),i=Kt(e),s=o.bottom+n.y<=i.top,a=o.left-n.x>=i.right,c=o.top-n.y>=i.bottom,u=s?"top":c?"bottom":null,l=o.right+n.x<=i.left?"left":a?"right":null;return l&&u?u+"-"+l:l||u||"intersect"}var Jt=Math.round;function Ut(t,e,n){var r,o,i,s=Xt(e,t,5),a=n.split(":")[0],c=Jt((e.x-t.x)/2+t.x),u=Jt((e.y-t.y)/2+t.y),l=(i=s,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[a].test(i)),h=/h|r|l/.test(a),f=!1,p=!1;return l?(r=h?{x:c,y:t.y}:{x:t.x,y:u},o=h?"h:h":"v:v"):(f=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(s,a),o=h?"h:v":"v:h",f?h?(p=u===t.y,r={x:t.x+20*(/l/.test(a)?-1:1),y:p?u+20:u}):r={x:(p=c===t.x)?c+20:c,y:t.y+20*(/t/.test(a)?-1:1)}:r={x:c,y:u}),{waypoints:te(t,r,o).concat(r),directions:o,turnNextDirections:p}}function Qt(t){return t.split(":").reverse().join(":")}function te(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(function(t){return t&&/t|r|b|l/.test(t)}(n)){var r=function(t,e,n){return Ut(t,e,n)}(t,e,n),o=function(t,e,n){var r=Ut(e,t,Qt(n));return{waypoints:r.waypoints.slice().reverse(),directions:Qt(r.directions),turnNextDirections:r.turnNextDirections}}(t,e,n),i=function(t,e){var n=t.directions.split(":")[1],r=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(r="h"==r?"v":"h");var o=n+":"+r;return{waypoints:te(t.waypoints[t.waypoints.length-1],e.waypoints[0],o),directions:o}}(r,o);return[].concat(r.waypoints,i.waypoints,o.waypoints)}return function(t,e,n){var r=Jt((e.x-t.x)/2+t.x),o=Jt((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:r,y:t.y},{x:r,y:e.y}];if("v:v"===n)return[{x:t.x,y:o},{x:e.x,y:o}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function ee(t){return t.reduce(function(e,n,r){return Zt(e[e.length-1],t[r+1],n,0)||e.push(n),e},[])}function ne(t,e,n,r,o,i){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=r,this.layouter=o,this.commandStack=i}function re(t,e,n,r,o,i,s){return delete r.id,s.createClass(r,e)}function oe(t,e,n){t in e&&(n[t]=e[t])}function ie(t,e){var n,r,o,i,s;return"waypoints"in t?n=ee(t.waypoints):(r=se(e.get(t.source)),o=se(e.get(t.target)),(s=te(r,o,i)).unshift(r),s.push(o),n=ee(s)),function(t){return t.forEach(function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)}),t}(n)}function se(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}ne.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],ne.prototype.import=function(t){var e=this.textRenderer,n=this.elementFactory,r=this.canvas,o=this.modeling;this.layouter;this.commandStack;var i=n.createRoot();r.setRootElement(i);var s=function(t,e,n,r,o,i){return new Map(t.map(function(t){var s=t.businessObject||{};return[t.id,re(n,o,e,t,s,r,i)]}))}(t.graph.nodes,n,r,e,i,o);!function(t,e,n,r,o,i,s,a){t.forEach(function(t){var n={connectionType:t.type,waypoints:ie(t,e)};D(n,function(t){var e={};return oe("sourceName",t,e),oe("targetName",t,e),oe("sourceCardinality",t,e),oe("targetCardinality",t,e),e}(t)),a.createConnection(e.get(t.source),e.get(t.target),n,i)})}(t.graph.edges,s,0,0,0,i,0,o)};var ae={__depends__:[Wt,{umlImporter:["type",ne]}]};const ce=/^class[ {]/;function ue(t){return Array.isArray(t)}function le(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function he(...t){1===t.length&&ue(t[0])&&(t=t[0]);const e=(t=[...t]).pop();return e.$inject=t,e}const fe=/constructor\s*[^(]*\(\s*([^)]*)\)/m,pe=/^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m,de=/\/\*([^*]*)\*\//m;function ye(t){if("function"!=typeof t)throw new Error(`Cannot annotate "${t}". Expected a function!`);const e=t.toString().match(function(t){return ce.test(t.toString())}(t)?fe:pe);if(!e)return[];const n=e[1]||e[2];return n&&n.split(",").map(t=>{const e=t.match(de);return(e&&e[1]||t).trim()})||[]}function ve(t,e){e=e||{get:function(t,e){if(n.push(t),!1===e)return null;throw s(`No provider for "${t}"!`)}};const n=[],r=this._providers=Object.create(e._providers||null),o=this._instances=Object.create(null),i=o.injector=this,s=function(t){const e=n.join(" -> ");return n.length=0,new Error(e?`${t} (Resolving: ${e})`:t)};function a(t,i){if(!r[t]&&-1!==t.indexOf(".")){const e=t.split(".");let n=a(e.shift());for(;e.length;)n=n[e.shift()];return n}if(le(o,t))return o[t];if(le(r,t)){if(-1!==n.indexOf(t))throw n.push(t),s("Cannot resolve circular dependency!");return n.push(t),o[t]=r[t][0](r[t][1]),n.pop(),o[t]}return e.get(t,i)}function c(t,e){if(void 0===e&&(e={}),"function"!=typeof t){if(!ue(t))throw s(`Cannot invoke "${t}". Expected a function!`);t=he(t.slice())}return{fn:t,dependencies:(t.$inject||ye(t)).map(t=>le(e,t)?e[t]:a(t))}}function u(t){const{fn:e,dependencies:n}=c(t);return new(Function.prototype.bind.apply(e,[null].concat(n)))}function l(t,e,n){const{fn:r,dependencies:o}=c(t,n);return r.apply(e,o)}function h(t){return he(e=>t.get(e))}function f(t,e){if(e&&e.length){const n=Object.create(null),o=Object.create(null),i=[],s=[],a=[];let c,u,l,f;for(let t in r)c=r[t],-1!==e.indexOf(t)&&("private"===c[2]?(u=i.indexOf(c[3]),-1===u?(l=c[3].createChild([],e),f=h(l),i.push(c[3]),s.push(l),a.push(f),n[t]=[f,t,"private",l]):n[t]=[a[u],t,"private",s[u]]):n[t]=[c[2],c[1]],o[t]=!0),"factory"!==c[2]&&"type"!==c[2]||!c[1].$scope||e.forEach(e=>{-1!==c[1].$scope.indexOf(e)&&(n[t]=[c[2],c[1]],o[e]=!0)});e.forEach(t=>{if(!o[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')}),t.unshift(n)}return new ve(t,i)}const p={factory:l,type:u,value:function(t){return t}};function d(t,e){const n=t.__init__||[];return function(){n.forEach(t=>{"string"==typeof t?e.get(t):e.invoke(t)})}}function y(t){const e=t.__exports__;if(e){const n=t.__modules__,o=Object.keys(t).reduce((e,n)=>("__exports__"!==n&&"__modules__"!==n&&"__init__"!==n&&"__depends__"!==n&&(e[n]=t[n]),e),Object.create(null)),i=f((n||[]).concat(o)),s=he(function(t){return i.get(t)});e.forEach(function(t){r[t]=[s,t,"private",i]});const a=(t.__init__||[]).slice();return a.unshift(function(){i.init()}),d(t=Object.assign({},t,{__init__:a}),i)}return Object.keys(t).forEach(function(e){if("__init__"===e||"__depends__"===e)return;if("private"===t[e][2])return void(r[e]=t[e]);const n=t[e][0],o=t[e][1];r[e]=[p[n],me(n,o),n]}),d(t,i)}function v(t,e){return-1!==t.indexOf(e)||-1!==(t=(e.__depends__||[]).reduce(v,t)).indexOf(e)?t:t.concat(e)}this.get=a,this.invoke=l,this.instantiate=u,this.createChild=f,this.init=function(t){const e=t.reduce(v,[]).map(y);let n=!1;return function(){n||(n=!0,e.forEach(t=>t()))}}(t)}function me(t,e){return"value"!==t&&ue(e)&&(e=he(e.slice())),e}function ge(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}function _e(t,e){var n,r,o,i;return e=!!e,M(t)||(t=[t]),B(t,function(t){var s=t;t.waypoints&&!e&&(s=_e(t.waypoints,!0));var a=s.x,c=s.y,u=s.height||0,l=s.width||0;(a<n||void 0===n)&&(n=a),(c<r||void 0===r)&&(r=c),(a+l>o||void 0===o)&&(o=a+l),(c+u>i||void 0===i)&&(i=c+u)}),{x:n,y:r,height:i-r,width:o-n}}function xe(t){return!(!t||!t.isFrame)}function we(t,e){W.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}ge(we,W),we.prototype.canRender=function(){return!0},we.prototype.drawShape=function(t,e,n){var r=ot("rect");return J(r,{x:0,y:0,width:e.width||0,height:e.height||0}),xe(e)?J(r,D({},this.FRAME_STYLE,n||{})):J(r,D({},this.SHAPE_STYLE,n||{})),Z(t,r),r},we.prototype.drawConnection=function(t,e,n){var r=gt(e.waypoints,D({},this.CONNECTION_STYLE,n||{}));return Z(t,r),r},we.prototype.getShapePath=function(t){var e=t.x,n=t.y,r=t.width;return ft([["M",e,n],["l",r,0],["l",0,t.height],["l",-r,0],["z"]])},we.prototype.getConnectionPath=function(t){var e,n,r=t.waypoints,o=[];for(e=0;n=r[e];e++)n=n.original||n,o.push([0===e?"M":"L",n.x,n.y]);return ft(o)},we.$inject=["eventBus","styles"];var be={__init__:["defaultRenderer"],defaultRenderer:["type",we],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){return D(this.style(e,n),{class:t})},this.style=function(e,n){M(e)||n||(n=e,e=[]);var r=P(e,function(e,n){return D(e,t[n]||{})},{});return n?D(r,n):r},this.computeStyle=function(t,n,r){return M(n)||(r=n,n=[]),e.style(n||[],D({},r,t||{}))}}]};function ke(t,e){return Math.round(t*e)/e}function Ee(t){return R(t)?t+"px":t}function je(t){const e=(t=D({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),function(t,...e){const n=t.style;o(e,function(t){t&&o(t,function(t,e){n[e]=t})})}(n,{position:"relative",overflow:"hidden",width:Ee(t.width),height:Ee(t.height)}),e.appendChild(n),n}function Ce(t,e,n){const r=ot("g");Q(r).add(e);const o=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(r,t.childNodes[o]||null),r}const Me={shape:["x","y","width","height"],connection:["waypoints"]};function Re(t,e,n,r){this._eventBus=e,this._elementRegistry=r,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function Oe(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}Re.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Re.prototype._init=function(t){const e=this._eventBus,n=this._container=je(t),r=this._svg=ot("svg");J(r,{width:"100%",height:"100%"}),Z(n,r);const o=this._viewport=Ce(r,"viewport");t.deferUpdate&&(this._viewboxChanged=function(t,e){let n,r,o,i;function s(n){let s=Date.now(),u=n?0:i+e-s;if(u>0)return a(u);t.apply(o,r),c()}function a(t){n=setTimeout(s,t)}function c(){n&&clearTimeout(n),n=i=r=o=void 0}function u(...t){i=Date.now(),r=t,o=this,n||a(e)}return u.flush=function(){n&&s(!0),c()},u.cancel=c,u}(A(this._viewboxChanged,this),300)),e.on("diagram.init",()=>{e.fire("canvas.init",{svg:r,viewport:o})}),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],()=>{delete this._cachedViewbox}),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},Re.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},Re.prototype._clear=function(){this._elementRegistry.getAll().forEach(t=>{const e=function(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)}),this._planes=[],this._rootElement=null,delete this._cachedViewbox},Re.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Re.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},Re.prototype._getChildIndex=function(t){return P(this._layers,function(e,n){return n.visible&&t>=n.index&&e++,e},0)},Re.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:Ce(this._viewport,"layer-"+t,n),index:e,visible:!0}},Re.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,r=e.group,o=e.index;if(e.visible)return r;const i=this._getChildIndex(o);return n.insertBefore(r,n.childNodes[i]||null),e.visible=!0,r},Re.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(ct(n),e.visible=!1,n):n},Re.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],ct(e.group))},Re.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},Re.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},Re.prototype.getRootElements=function(){return this._planes.map(function(t){return t.rootElement})},Re.prototype._findPlaneForRoot=function(t){return L(this._planes,function(e){return e.rootElement===t})},Re.prototype.getContainer=function(){return this._container},Re.prototype._updateMarker=function(t,e,n){let r;t.id||(t=this._elementRegistry.get(t)),r=this._elementRegistry._elements[t.id],r&&(B([r.gfx,r.secondaryGfx],function(t){t&&(n?Q(t).add(e):Q(t).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:r.gfx,marker:e,add:!!n}))},Re.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},Re.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},Re.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));return Q(this.getGraphics(t)).has(e)},Re.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},Re.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},Re.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const r=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,r),this._planes.push({rootElement:t,layer:r}),t},Re.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter(function(e){return e.rootElement!==t}),this._rootElement===t&&(this._rootElement=null),t},Re.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},Re.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},Re.prototype._addRoot=function(t,e){const n=this._elementRegistry,r=this._eventBus;r.fire("root.add",{element:t}),n.add(t,e),r.fire("root.added",{element:t,gfx:e})},Re.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},Re.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=Me[t],r=function(t,e){return!!P(t,function(t,n,r){return t&&e(n,r)},!0)}(n,function(t){return void 0!==e[t]});if(!r)throw new Error("must supply { "+n.join(", ")+" } with "+t)},Re.prototype._setParent=function(t,e,n){!function(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var r=t.indexOf(e);if(-1!==r){if(r===n)return;if(-1===n)return;t.splice(r,1)}-1!==n?t.splice(n,0,e):t.push(e)}}(e.children,t,n),t.parent=e},Re.prototype._addElement=function(t,e,n,r){n=n||this.getRootElement();const o=this._eventBus,i=this._graphicsFactory;this._ensureValid(t,e),o.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,r);const s=i.create(t,e,r);return this._elementRegistry.add(e,s),i.update(t,e,s),o.fire(t+".added",{element:e,gfx:s}),e},Re.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},Re.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},Re.prototype._removeElement=function(t,e){const n=this._elementRegistry,r=this._graphicsFactory,o=this._eventBus;if(t=n.get(t.id||t))return o.fire(e+".remove",{element:t}),r.remove(t),function(t,e){if(!t||!e)return-1;var n=t.indexOf(e);-1!==n&&t.splice(n,1)}(t.parent&&t.parent.children,t),t.parent=null,o.fire(e+".removed",{element:t}),n.remove(t),t},Re.prototype.removeShape=function(t){return this._removeElement(t,"shape")},Re.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},Re.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},Re.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Re.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Re.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let r,o,i,s,a,c,u;return t?(this._changeViewbox(function(){a=Math.min(n.width/t.width,n.height/t.height);const r=this._svg.createSVGMatrix().scale(a).translate(-t.x,-t.y);lt(e,r)}),t):(i=this._rootElement?this.getActiveLayer():null,r=i&&i.getBBox()||{},s=lt(e),o=s?s.matrix:function(t,e,n,r,o,i){var s=st().createSVGMatrix();switch(arguments.length){case 0:return s;case 1:return at(s,t);case 6:return at(s,{a:t,b:e,c:n,d:r,e:o,f:i})}}(),a=ke(o.a,1e3),c=ke(-o.e||0,1e3),u=ke(-o.f||0,1e3),t=this._cachedViewbox={x:c?c/a:0,y:u?u/a:0,width:n.width/a,height:n.height/a,scale:a,inner:{width:r.width||0,height:r.height||0,x:r.x||0,y:r.y||0},outer:n})},Re.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox(function(){t=D({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),Oe(e,n)}),{x:n.e,y:n.f}},Re.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const r=this.findRoot(t);if(r!==this.getRootElement()&&this.setRootElement(r),r===t)return;e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const o=_e(t),i=Kt(o),s=this.viewbox(),a=this.zoom();let c,u;s.y+=e.top/a,s.x+=e.left/a,s.width-=(e.right+e.left)/a,s.height-=(e.bottom+e.top)/a;const l=Kt(s);if(o.width<s.width&&o.height<s.height){const t=Math.max(0,i.right-l.right),e=Math.min(0,i.left-l.left),n=Math.max(0,i.bottom-l.bottom),r=Math.min(0,i.top-l.top);c=t||e,u=n||r}else c=o.x-s.x,u=o.y-s.y;this.scroll({dx:-c*a,dy:-u*a})},Re.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,r;return this._changeViewbox(function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),r=this._setZoom(t,e)}),ke(r.a,1e3)},Re.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,r=e.inner;let o,i;return r.x>=0&&r.y>=0&&r.x+r.width<=n.width&&r.y+r.height<=n.height&&!t?i={x:0,y:0,width:Math.max(r.width+r.x,n.width),height:Math.max(r.height+r.y,n.height)}:(o=Math.min(1,n.width/r.width,n.height/r.height),i={x:r.x+(t?r.width/2-n.width/o/2:0),y:r.y+(t?r.height/2-n.height/o/2:0),width:n.width/o,height:n.height/o}),this.viewbox(i),this.viewbox(!1).scale},Re.prototype._setZoom=function(t,e){const n=this._svg,r=this._viewport,o=n.createSVGMatrix(),i=n.createSVGPoint();let s,a,c,u,l;c=r.getCTM();const h=c.a;return e?(s=D(i,e),a=s.matrixTransform(c.inverse()),u=o.translate(a.x,a.y).scale(1/h*t).translate(-a.x,-a.y),l=c.multiply(u)):l=o.scale(t),Oe(this._viewport,l),l},Re.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Re.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},Re.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Se="data-element-id";function Le(t){this._elements={},this._eventBus=t}Le.$inject=["eventBus"],Le.prototype.add=function(t,e,n){var r=t.id;this._validateId(r),J(e,Se,r),n&&J(n,Se,r),this._elements[r]={element:t,gfx:e,secondaryGfx:n}},Le.prototype.remove=function(t){var e=this._elements,n=t.id||t,r=n&&e[n];r&&(J(r.gfx,Se,""),r.secondaryGfx&&J(r.secondaryGfx,Se,""),delete e[n])},Le.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),r=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,r)},Le.prototype.updateGraphics=function(t,e,n){var r=t.id||t,o=this._elements[r];return n?o.secondaryGfx=e:o.gfx=e,e&&J(e,Se,r),e},Le.prototype.get=function(t){var e;e="string"==typeof t?t:t&&J(t,Se);var n=this._elements[e];return n&&n.element},Le.prototype.filter=function(t){var e=[];return this.forEach(function(n,r){t(n,r)&&e.push(n)}),e},Le.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),r=0;r<n.length;r++){var o=e[n[r]],i=o.element;if(t(i,o.gfx))return i}},Le.prototype.getAll=function(){return this.filter(function(t){return t})},Le.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach(function(n){var r=e[n],o=r.element,i=r.gfx;return t(o,i)})},Le.prototype.getGraphics=function(t,e){var n=t.id||t,r=this._elements[n];return r&&(e?r.secondaryGfx:r.gfx)},Le.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var Be={exports:{}},Pe={};Pe.extend=function(t,e,n,r){var o=n.inverse;return Object.defineProperty(t,"remove",{value:function(t){var n=this.indexOf(t);return-1!==n&&(this.splice(n,1),e.unset(t,o,r)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,n){var i=this.indexOf(t);if(void 0===n){if(-1!==i)return;n=this.length}-1!==i&&this.splice(i,1),this.splice(n,0,t),-1===i&&e.set(t,o,r)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},Pe.isExtended=function(t){return!0===t.__refs_collection};var Ne=Pe;function Te(t,e,n){var r=Ne.extend(n[e.name]||[],t,e,n);Object.defineProperty(n,e.name,{enumerable:e.enumerable,value:r}),r.length&&r.forEach(function(r){t.set(r,e.inverse,n)})}function Ae(t,e){if(!(this instanceof Ae))return new Ae(t,e);t.inverse=e,e.inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}Ae.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}e.collection?Te(this,e,t):function(t,e,n){var r=e.inverse,o=n[e.name];Object.defineProperty(n,e.name,{configurable:e.configurable,enumerable:e.enumerable,get:function(){return o},set:function(e){if(e!==o){var i=o;o=null,i&&t.unset(i,r,n),o=e,t.set(o,r,n)}}})}(this,e,t)},Ae.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return Ne.isExtended(n)||Te(this,e,t),n},Ae.prototype.ensureBound=function(t,e){(function(t,e){return Object.prototype.hasOwnProperty.call(t,e.name||e)})(t,e)||this.bind(t,e)},Ae.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},Ae.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var De=Ae;Be.exports=De,Be.exports.Collection=Pe;var ze=Gt(Be.exports),Ge=new ze({name:"children",enumerable:!0,collection:!0},{name:"parent"}),Fe=new ze({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),Ve=new ze({name:"attachers",collection:!0},{name:"host"}),$e=new ze({name:"outgoing",collection:!0},{name:"source"}),Ie=new ze({name:"incoming",collection:!0},{name:"target"});function Ye(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),Ge.bind(this,"parent"),Fe.bind(this,"labels"),$e.bind(this,"outgoing"),Ie.bind(this,"incoming")}function He(){Ye.call(this),Ge.bind(this,"children"),Ve.bind(this,"host"),Ve.bind(this,"attachers")}function qe(){Ye.call(this),Ge.bind(this,"children")}function We(){He.call(this),Fe.bind(this,"labelTarget")}function Ze(){Ye.call(this),$e.bind(this,"source"),Ie.bind(this,"target")}ge(He,Ye),ge(qe,He),ge(We,He),ge(Ze,Ye);var Ke={connection:Ze,shape:He,label:We,root:qe};function Xe(){this._uid=12}Xe.prototype.createRoot=function(t){return this.create("root",t)},Xe.prototype.createLabel=function(t){return this.create("label",t)},Xe.prototype.createShape=function(t){return this.create("shape",t)},Xe.prototype.createConnection=function(t){return this.create("connection",t)},Xe.prototype.create=function(t,e){return(e=D({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=Ke[t];if(!n)throw new Error("unknown type: <"+t+">");return D(new n,e)}(t,e)};var Je="__fn",Ue=Array.prototype.slice;function Qe(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function tn(){}function en(t,e,n){var r,o=r?st().createSVGTransformFromMatrix(r):st().createSVGTransform();o.setTranslate(e,n),lt(t,o)}function nn(t,e){this._eventBus=t,this._elementRegistry=e}function rn(t,e,n){var r=n||e.firstChild;t!==r&&e.insertBefore(t,r)}Qe.prototype.on=function(t,e,n,r){if(t=M(t)?t:[t],O(e)&&(r=n,n=e,e=1e3),!R(e))throw new Error("priority must be a number");var o=n;r&&((o=A(n,r))[Je]=n[Je]||n);var i=this;t.forEach(function(t){i._addListener(t,{priority:e,callback:o,next:null})})},Qe.prototype.once=function(t,e,n,r){var o=this;if(O(e)&&(r=n,n=e,e=1e3),!R(e))throw new Error("priority must be a number");function i(){i.__isTomb=!0;var e=n.apply(r,arguments);return o.off(t,i),e}i[Je]=n,this.on(t,e,i)},Qe.prototype.off=function(t,e){t=M(t)?t:[t];var n=this;t.forEach(function(t){n._removeListener(t,e)})},Qe.prototype.createEvent=function(t){var e=new tn;return e.init(t),e},Qe.prototype.fire=function(t,e){var n,r,o,i;if(i=Ue.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(r=this._listeners[t]){n=e instanceof tn?e:this.createEvent(e),i[0]=n;var s=n.type;t!==s&&(n.type=t);try{o=this._invokeListeners(n,i,r)}finally{t!==s&&(n.type=s)}return void 0===o&&n.defaultPrevented&&(o=!1),o}},Qe.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},Qe.prototype._destroy=function(){this._listeners={}},Qe.prototype._invokeListeners=function(t,e,n){for(var r;n&&!t.cancelBubble;)r=this._invokeListener(t,e,n),n=n.next;return r},Qe.prototype._invokeListener=function(t,e,n){var r;if(n.callback.__isTomb)return r;try{r=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==r&&(t.returnValue=r,t.stopPropagation()),!1===r&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener",t),t}return r},Qe.prototype._addListener=function(t,e){var n,r=this._getListeners(t);if(r){for(;r;){if(r.priority<e.priority)return e.next=r,void(n?n.next=e:this._setListeners(t,e));n=r,r=r.next}n.next=e}else this._setListeners(t,e)},Qe.prototype._getListeners=function(t){return this._listeners[t]},Qe.prototype._setListeners=function(t,e){this._listeners[t]=e},Qe.prototype._removeListener=function(t,e){var n,r,o,i=this._getListeners(t);if(e)for(;i;)n=i.next,(o=i.callback)!==e&&o[Je]!==e||(r?r.next=n:this._setListeners(t,n)),r=i,i=n;else this._setListeners(t,null)},tn.prototype.stopPropagation=function(){this.cancelBubble=!0},tn.prototype.preventDefault=function(){this.defaultPrevented=!0},tn.prototype.init=function(t){D(this,t||{})},nn.$inject=["eventBus","elementRegistry"],nn.prototype._getChildrenContainer=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(n),e||(Q(e=ot("g")).add("djs-children"),Z(n.parentNode,e))):e=n,e},nn.prototype._clear=function(t){var e=function(t){return t.childNodes[0]}(t);return function(t){for(var e;e=t.firstChild;)t.removeChild(e)}(e),e},nn.prototype._createContainer=function(t,e,n,r){var o=ot("g");Q(o).add("djs-group"),void 0!==n?rn(o,e,e.childNodes[n]):Z(e,o);var i=ot("g");Q(i).add("djs-element"),Q(i).add("djs-"+t),r&&Q(i).add("djs-frame"),Z(o,i);var s=ot("g");return Q(s).add("djs-visual"),Z(i,s),i},nn.prototype.create=function(t,e,n){var r=this._getChildrenContainer(e.parent);return this._createContainer(t,r,n,xe(e))},nn.prototype.updateContainments=function(t){var e,n=this,r=this._elementRegistry;e=P(t,function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t},{}),B(e,function(t){var e=t.children;if(e){var o=n._getChildrenContainer(t);B(e.slice().reverse(),function(t){rn(r.getGraphics(t).parentNode,o)})}})},nn.prototype.drawShape=function(t,e,n={}){return this._eventBus.fire("render.shape",{gfx:t,element:e,attrs:n})},nn.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},nn.prototype.drawConnection=function(t,e,n={}){return this._eventBus.fire("render.connection",{gfx:t,element:e,attrs:n})},nn.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},nn.prototype.update=function(t,e,n){if(e.parent){var r=this._clear(n);if("shape"===t)this.drawShape(r,e),en(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(r,e)}e.hidden?J(n,"display","none"):J(n,"display","block")}},nn.prototype.remove=function(t){ct(this._elementRegistry.getGraphics(t).parentNode)};var on={__depends__:[be],__init__:["canvas"],canvas:["type",Re],elementRegistry:["type",Le],elementFactory:["type",Xe],eventBus:["type",Qe],graphicsFactory:["type",nn]};function sn(t){return function(t){var e=new ve(t);return e.init(),e}([{config:["value",t=t||{}]},on].concat(t.modules||[]))}function an(t,e){this._injector=e=e||sn(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function cn(t){this._container=this._createContainer(t),this._init(this._container,t)}return an.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},an.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},Yt(cn,an),cn.prototype._coreModules=[ae],cn.prototype._viewModules=[V,q],cn.prototype._modules=[].concat(cn.prototype._coreModules,cn.prototype._viewModules),cn.prototype.importJSON=function(t){this.get("umlImporter").import(t)},cn.prototype._createContainer=function(t){var e;return D((e=x("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},cn.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};an.call(this,n),e&&e.parent&&this.attachTo(e.parent)},cn.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=w(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},cn.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},cn.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},cn});
