<?xml version="1.0" encoding="utf-8" ?>

<config:template-call
	xmlns:config="http://www.top-logic.com/ns/config/6.0"
	template="tl-graphic-blocks-server/flowChart.template.xml"
>
	<arguments>
		<name key="dynamic.d4066e09-7e0b-46d1-b6ee-75ed80cd16b6">
			<en>Flowchart</en>
			<de>Flussdiagramm</de>
		</name>
		<modelBuilder class="com.top_logic.graphic.flow.server.ui.ScriptFlowChartBuilder">
			<create-chart><![CDATA[model -> flowChart(
    flowPadding(all: 20, content: 
        flowVertical(gap: 20, contents: all(`test.flowchart:FlowNode`).map(n -> 
            flowAlign(hAlign: "CENTER",  content: 
                flowVertical([
                    {
                        marker = $n.get(`test.flowchart:FlowNode#marker`);
                        $marker ? flowAlign(hAlign: "CENTER", content: 
                            flowBorder(stroke: "red", dashes: [5, 5], content: 
                                flowPadding(all: 4, content: 
                                    flowText($marker))
                            )
                        ) : null
                    },
                    flowAlign(hAlign: "CENTER", content: 
                        flowPadding(all: 4, content: 
                            flowText($n.get(`test.flowchart:FlowNode#name`))
                    )),
                    flowGrid(gapY: -1, contents: 
                        $n.get(`test.flowchart:FlowNode#locations`).map(l -> 
                            [
                                {
                                    count = $l.get(`test.flowchart:Location#count`);
                                    $count != null ? 
                                        flowBorder(right: false,  content: 
                                            flowText($count)) : null
                                },
                                flowBorder(content:
                                    flowFill(fill: $l.get(`test.flowchart:Location#part`).get(`test.flowchart:Part#color`), content: 
                                        flowText($l.get(`test.flowchart:Location#part`))
                                    )
                                ),
                                {
                                    usages = $l.get(`test.flowchart:Location#usages`);
                                    $usages ? 
                                        flowAlign(content: 
                                            flowBorder(left: false, content: 
                                                flowText($usages))) : null
                                }
                            ]
                        )
                    )
                ]))
            )
        )
    )
)]]></create-chart>
		</modelBuilder>
	</arguments>
</config:template-call>