!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).UmlJS=e()}(this,(function(){"use strict";function t(t){return Array.prototype.concat.apply([],t)}const e=Object.prototype.toString,n=Object.prototype.hasOwnProperty;function o(t){return void 0===t}function i(t){return void 0!==t}function r(t){return"[object Array]"===e.call(t)}function a(t){return"[object Object]"===e.call(t)}function c(t){return"[object Number]"===e.call(t)}function s(t){const n=e.call(t);return"[object Function]"===n||"[object AsyncFunction]"===n||"[object GeneratorFunction]"===n||"[object AsyncGeneratorFunction]"===n||"[object Proxy]"===n}function u(t){return"[object String]"===e.call(t)}function l(t,e){return n.call(t,e)}function h(t,e){const n=S(e);let o;return p(t,(function(t,e){if(n(t,e))return o=t,!1})),o}function d(t,e){const n=S(e);let o=[];return p(t,(function(t,e){n(t,e)&&o.push(t)})),o}function p(t,e){let n,i;if(o(t))return;const a=r(t)?M:j;for(let o in t)if(l(t,o)&&(n=t[o],i=e(n,a(o)),!1===i))return n}function f(t,e){if(o(t))return[];!function(t){if(!r(t))throw new Error("must supply array")}(t);const n=S(e);return t.filter((function(t,e){return!n(t,e)}))}function y(t,e,n){return p(t,(function(t,o){n=e(n,t,o)})),n}function v(t,e){return!!y(t,(function(t,n,o){return t&&e(n,o)}),!0)}function g(t,e){return!!h(t,e)}function m(t,e){let n=[];return p(t,(function(t,o){n.push(e(t,o))})),n}function x(t){return function(t){return t&&Object.keys(t)||[]}(t).length}function _(t){return m(t,(t=>t))}function w(t,e,n={}){return e=C(e),p(t,(function(t){let o=e(t)||"_",i=n[o];i||(i=n[o]=[]),i.push(t)})),n}function b(t,...e){t=C(t);let n={};return p(e,(e=>w(e,t,n))),m(n,(function(t,e){return t[0]}))}function E(t,e){e=C(e);let n=[];return p(t,(function(t,o){let i=e(t,o),r={d:i,v:t};for(var a=0;a<n.length;a++){let{d:t}=n[a];if(i<t)return void n.splice(a,0,r)}n.push(r)})),m(n,(t=>t.v))}function k(t){return function(e){return v(t,(function(t,n){return e[n]===t}))}}function C(t){return s(t)?t:e=>e[t]}function S(t){return s(t)?t:e=>e===t}function j(t){return t}function M(t){return Number(t)}function P(t,e){return t.bind(e)}function R(t,...e){return Object.assign(t,...e)}function O(t,e){let n={},o=Object(t);return p(e,(function(e){e in o&&(n[e]=t[e])})),n}function B(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}const T=Object.prototype.toString,z=Object.prototype.hasOwnProperty;function A(t,e){return z.call(t,e)}function L(t,e){let n,o;if(void 0===t)return;const i=function(t){return"[object Array]"===T.call(t)}(t)?I:D;for(let r in t)if(A(t,r)&&(n=t[r],o=e(n,i(r)),!1===o))return n}function D(t){return t}function I(t){return Number(t)}function $(t,...e){const n=t.style;return L(e,(function(t){t&&L(t,(function(t,e){n[e]=t}))})),t}function N(t,e,n){return 2==arguments.length?t.getAttribute(e):null===n?t.removeAttribute(e):(t.setAttribute(e,n),t)}const H=Object.prototype.toString;function V(t){return new G(t)}function G(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function F(t){for(var e;t.childNodes.length;)e=t.childNodes[0],t.removeChild(e);return t}function W(t,e){return t&&"function"==typeof t.matches&&t.matches(e)}function q(t,e,n){for(var o=n?t:t.parentNode;o&&o.nodeType!==document.DOCUMENT_NODE&&o.nodeType!==document.DOCUMENT_FRAGMENT_NODE;){if(W(o,e))return o;o=o.parentNode}return W(o,e)?o:null}G.prototype.add=function(t){return this.list.add(t),this},G.prototype.remove=function(t){return"[object RegExp]"==H.call(t)?this.removeMatching(t):(this.list.remove(t),this)},G.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},G.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},G.prototype.array=function(){return Array.from(this.list)},G.prototype.has=G.prototype.contains=function(t){return this.list.contains(t)};var U,Y,K,X={};function Z(){U=window.addEventListener?"addEventListener":"attachEvent",Y=window.removeEventListener?"removeEventListener":"detachEvent",K="addEventListener"!==U?"on":""}var J=B({__proto__:null,bind:X.bind=function(t,e,n,o){return U||Z(),t[U](K+e,n,o||!1),n},unbind:X.unbind=function(t,e,n,o){return Y||Z(),t[Y](K+e,n,o||!1),n},default:X},[X]),Q=["focus","blur"];var tt,et={bind:function(t,e,n,o,i){return-1!==Q.indexOf(n)&&(i=!0),J.bind(t,n,(function(n){var i=n.target||n.srcElement;n.delegateTarget=q(i,e,!0),n.delegateTarget&&o.call(t,n)}),i)},unbind:function(t,e,n,o){return-1!==Q.indexOf(e)&&(o=!0),J.unbind(t,e,n,o)}},nt=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var o=n[1];if("body"==o){return(i=e.createElement("html")).innerHTML=t,i.removeChild(i.lastChild)}var i,r=Object.prototype.hasOwnProperty.call(it,o)?it[o]:it._default,a=r[0],c=r[1],s=r[2];(i=e.createElement("div")).innerHTML=c+t+s;for(;a--;)i=i.lastChild;if(i.firstChild==i.lastChild)return i.removeChild(i.firstChild);var u=e.createDocumentFragment();for(;i.firstChild;)u.appendChild(i.removeChild(i.firstChild));return u},ot=!1;"undefined"!=typeof document&&((tt=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',ot=!tt.getElementsByTagName("link").length,tt=void 0);var it={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:ot?[1,"X<div>","</div>"]:[0,"",""]};it.td=it.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],it.option=it.optgroup=[1,'<select multiple="multiple">',"</select>"],it.thead=it.tbody=it.colgroup=it.caption=it.tfoot=[1,"<table>","</table>"],it.polyline=it.ellipse=it.polygon=it.circle=it.text=it.line=it.path=it.rect=it.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var rt=nt;function at(t,e){return(e=e||document).querySelector(t)}function ct(t,e){return(e=e||document).querySelectorAll(t)}function st(t){t.parentNode&&t.parentNode.removeChild(t)}function ut(t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation()}function lt(t){return t.originalEvent||t.srcEvent}function ht(t){ut(t),ut(lt(t))}function dt(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function pt(t,e){return(lt(t)||t).button===e}function ft(t){return pt(t,0)}function yt(t){var e=lt(t)||t;return!!ft(t)&&(/mac/i.test(navigator.platform)?e.metaKey:e.ctrlKey)}function vt(t){var e=lt(t)||t;return ft(t)&&e.shiftKey}function gt(t,e){return e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}function mt(t,e){return gt(e,t),t}var xt=2,_t={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":xt,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":xt,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function wt(t,e,n){var o=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=_t[o];i?(i===xt&&"number"==typeof n&&(n=String(n)+"px"),t.style[o]=n):t.setAttributeNS(null,e,n)}function bt(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return _t[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);wt(t,e,n)}else!function(t,e){var n,o,i=Object.keys(e);for(n=0;o=i[n];n++)wt(t,o,e[o])}(t,e);return t}const Et=Object.prototype.toString;function kt(t){return new Ct(t)}function Ct(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function St(t){var e=t.parentNode;return e&&e.removeChild(t),t}function jt(t){for(var e;e=t.firstChild;)St(e);return t}function Mt(t){return t.cloneNode(!0)}Ct.prototype.add=function(t){return this.list.add(t),this},Ct.prototype.remove=function(t){return"[object RegExp]"==Et.call(t)?this.removeMatching(t):(this.list.remove(t),this)},Ct.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},Ct.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},Ct.prototype.array=function(){return Array.from(this.list)},Ct.prototype.has=Ct.prototype.contains=function(t){return this.list.contains(t)};var Pt={svg:"http://www.w3.org/2000/svg"},Rt='<svg xmlns="'+Pt.svg+'"';function Ot(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(Pt.svg)&&(t=Rt+t.substring(4)):(t=Rt+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var o=document.createDocumentFragment(),i=n.firstChild;i.firstChild;)o.appendChild(i.firstChild);return o}function Bt(t,e){var n;return"<"===t.charAt(0)?(n=Ot(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(Pt.svg,t),e&&bt(n,e),n}var Tt=null;function zt(){return null===Tt&&(Tt=Bt("svg")),Tt}function At(t,e){var n,o,i=Object.keys(e);for(n=0;o=i[n];n++)t[o]=e[o];return t}function Lt(t){return t?zt().createSVGTransformFromMatrix(t):zt().createSVGTransform()}var Dt=/([&<>]{1})/g,It=/([\n\r"]{1})/g,$t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function Nt(t,e){return t.replace(e,(function(t,e){return $t[e]||e}))}function Ht(t,e){var n,o,i,r,a;switch(t.nodeType){case 3:e.push(Nt(t.textContent,Dt));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(n=0,o=(i=t.attributes).length;n<o;++n)r=i.item(n),e.push(" ",r.name,'="',Nt(r.value,It),'"');if(t.hasChildNodes()){for(e.push(">"),n=0,o=(a=t.childNodes).length;n<o;++n)Ht(a.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("\x3c!--",Nt(t.nodeValue,Dt),"--\x3e");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function Vt(t,e){var n=Ot(e);if(jt(t),e){(function(t){return"#document-fragment"===t.nodeName})(n)||(n=n.documentElement);for(var o,i=(o=n.childNodes,Array.prototype.slice.call(o)),r=0;r<i.length;r++)gt(i[r],t)}}function Gt(t,e){if(void 0!==e){try{Vt(t,e)}catch(t){throw new Error("error parsing SVG: "+t.message)}return t}return function(t){for(var e=t.firstChild,n=[];e;)Ht(e,n),e=e.nextSibling;return n.join("")}(t)}function Ft(t,e){return e instanceof SVGMatrix?t.createSVGTransformFromMatrix(e):e}function Wt(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,o;for(t.clear(),n=0;o=e[n];n++)t.appendItem(Ft(t,o))}(n,e)),n.consolidate()}function qt(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function Ut(t){return["L",t.x,t.y]}function Yt(t,e){const n=t.length,o=[(i=t[0],["M",i.x,i.y])];var i,r,a,c;for(let i=1;i<n;i++){const n=t[i-1],s=t[i],u=t[i+1];if(!u||!e){o.push(Ut(s));continue}const l=Math.min(e,Xt(s.x-n.x,s.y-n.y),Xt(u.x-s.x,u.y-s.y));if(!l){o.push(Ut(s));continue}const h=Kt(s,n,l),d=Kt(s,n,.5*l),p=Kt(s,u,l),f=Kt(s,u,.5*l);o.push(Ut(h)),o.push((a=f,c=p,["C",(r=d).x,r.y,a.x,a.y,c.x,c.y]))}return o}function Kt(t,e,n){const o=e.x-t.x,i=e.y-t.y,r=n/Xt(o,i);return{x:t.x+o*r,y:t.y+i*r}}function Xt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Zt(t,e,n){c(e)&&(n=e,e=null),e||(e={});const o=Bt("path",e);return c(n)&&(o.dataset.cornerRadius=String(n)),Jt(o,t)}function Jt(t,e){return bt(t,{d:qt(Yt(e,parseInt(t.dataset.cornerRadius,10)||0))}),t}function Qt(t){return!0}function te(t){return ft(t)||function(t){return pt(t,1)}(t)}function ee(t,e,n){var o=this;function i(n,o,i){var r,a;(function(t,e){var n=s[t]||ft;return!n(e)})(n,o)||(i?a=e.getGraphics(i):(r=o.delegateTarget||o.target)&&(a=r,i=e.get(a)),a&&i&&!1===t.fire(n,{element:i,gfx:a,originalEvent:o})&&(o.stopPropagation(),o.preventDefault()))}var r={};function a(t){return r[t]}var c={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},s={"element.contextmenu":Qt,"element.mousedown":te,"element.mouseup":te,"element.click":te,"element.dblclick":te};var u="svg, .djs-element";function l(t,e,n,o){var a=r[n]=function(t){i(n,t)};o&&(s[n]=o),a.$delegate=et.bind(t,u,e,a)}function h(t,e,n){var o=a(n);o&&et.unbind(t,e,o.$delegate)}t.on("canvas.destroy",(function(t){var e;e=t.svg,p(c,(function(t,n){h(e,n,t)}))})),t.on("canvas.init",(function(t){var e;e=t.svg,p(c,(function(t,n){l(e,n,t)}))})),t.on(["shape.added","connection.added"],(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.createHit",{element:n,gfx:o})})),t.on(["shape.changed","connection.changed"],500,(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.updateHit",{element:n,gfx:o})})),t.on("interactionEvents.createHit",500,(function(t){var e=t.element,n=t.gfx;o.createDefaultHit(e,n)})),t.on("interactionEvents.updateHit",(function(t){var e=t.element,n=t.gfx;o.updateDefaultHit(e,n)}));var d=v("djs-hit djs-hit-stroke"),f=v("djs-hit djs-hit-click-stroke"),y={all:v("djs-hit djs-hit-all"),"click-stroke":f,stroke:d,"no-move":v("djs-hit djs-hit-no-move")};function v(t,e){return e=R({stroke:"white",strokeWidth:15},e||{}),n.cls(t,["no-fill","no-border"],e)}function g(t,e){var n=y[e];if(!n)throw new Error("invalid hit type <"+e+">");return bt(t,n),t}function m(t,e){mt(t,e)}this.removeHits=function(t){p(ct(".djs-hit",t),St)},this.createDefaultHit=function(t,e){var n,o=t.waypoints,i=t.isFrame;return o?this.createWaypointsHit(e,o):(n=i?"stroke":"all",this.createBoxHit(e,n,{width:t.width,height:t.height}))},this.createWaypointsHit=function(t,e){var n=Zt(e);return g(n,"stroke"),m(t,n),n},this.createBoxHit=function(t,e,n){n=R({x:0,y:0},n);var o=Bt("rect");return g(o,e),bt(o,n),m(t,o),o},this.updateDefaultHit=function(t,e){var n=at(".djs-hit",e);if(n)return t.waypoints?Jt(n,t.waypoints):bt(n,{width:t.width,height:t.height}),n},this.fire=i,this.triggerMouseEvent=function(t,e,n){var o=c[t];if(!o)throw new Error("unmapped DOM event name <"+t+">");return i(o,e,n)},this.mouseHandler=a,this.registerEvent=l,this.unregisterEvent=h}ee.$inject=["eventBus","elementRegistry","styles"];var ne={__init__:["interactionEvents"],interactionEvents:["type",ee]};function oe(t){return d(t,(function(e){return!h(t,(function(t){return t!==e&&ie(e,t)}))}))}function ie(t,e){if(e){if(t===e)return e;if(t.parent)return ie(t.parent,e)}}function re(t,e,n){var o=!n||-1===t.indexOf(e);return o&&t.push(e),o}function ae(t,e,n){n=n||0,r(t)||(t=[t]),p(t,(function(t,o){var i=e(t,o,n);r(i)&&i.length&&ae(i,e,n+1)}))}function ce(t,e){return function(t,e,n){var o=[],i=[];return ae(t,(function(t,r,a){re(o,t,e);var c=t.children;if((-1===n||a<n)&&c&&re(i,c,e))return c})),o}(t,!e,-1)}function se(t,e){var n,o,i,a;return e=!!e,r(t)||(t=[t]),p(t,(function(t){var r=t;t.waypoints&&!e&&(r=se(t.waypoints,!0));var c=r.x,s=r.y,u=r.height||0,l=r.width||0;(c<n||void 0===n)&&(n=c),(s<o||void 0===o)&&(o=s),(c+l>i||void 0===i)&&(i=c+l),(s+u>a||void 0===a)&&(a=s+u)})),{x:n,y:o,height:a-o,width:i-n}}function ue(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function le(t){return!(!t||!t.isFrame)}function he(t,e){return R({},t||{},e||{})}function de(t,e){this.offset=6;var n=e.cls("djs-outline",["no-fill"]),o=this;function i(t,e){var o=Bt("rect");return bt(o,R({x:10,y:10,rx:4,width:100,height:100},n)),mt(t,o),o}t.on(["shape.added","shape.changed"],500,(function(t){var e=t.element,n=t.gfx,r=at(".djs-outline",n);r||(r=i(n)),o.updateShapeOutline(r,e)})),t.on(["connection.added","connection.changed"],(function(t){var e=t.element,n=t.gfx,r=at(".djs-outline",n);r||(r=i(n)),o.updateConnectionOutline(r,e)}))}de.prototype.updateShapeOutline=function(t,e){bt(t,{x:-this.offset,y:-this.offset,width:e.width+2*this.offset,height:e.height+2*this.offset})},de.prototype.updateConnectionOutline=function(t,e){var n=se(e);bt(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},de.$inject=["eventBus","styles","elementRegistry"];var pe={__init__:["outline"],outline:["type",de]};function fe(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],(function(t){var e=t.element;n.deselect(e)})),t.on(["diagram.clear","root.set"],(function(t){n.select(null)}))}fe.$inject=["eventBus","canvas"],fe.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(-1!==n){var o=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:e})}},fe.prototype.get=function(){return this._selectedElements},fe.prototype.isSelected=function(t){return-1!==this._selectedElements.indexOf(t)},fe.prototype.select=function(t,e){var n=this._selectedElements,o=n.slice();r(t)||(t=t?[t]:[]);var i=this._canvas,a=i.getRootElement();t=t.filter((function(t){var e=i.findRoot(t);return a===e})),e?p(t,(function(t){-1===n.indexOf(t)&&n.push(t)})):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:n})};var ye="hover",ve="selected";function ge(t,e,n){this._canvas=t;var o=this;function i(e,n){t.addMarker(e,n)}function r(e,n){t.removeMarker(e,n)}this._multiSelectionBox=null,e.on("element.hover",(function(t){i(t.element,ye)})),e.on("element.out",(function(t){r(t.element,ye)})),e.on("selection.changed",(function(t){var e=t.oldSelection,n=t.newSelection;p(e,(function(t){-1===n.indexOf(t)&&r(t,ve)})),p(n,(function(t){-1===e.indexOf(t)&&i(t,ve)})),o._updateSelectionOutline(n)})),e.on("element.changed",(function(t){n.isSelected(t.element)&&o._updateSelectionOutline(n.get())}))}function me(t,e,n,o){t.on("create.end",500,(function(t){var n=t.context,o=n.canExecute,i=n.elements,a=(n.hints||{}).autoSelect;if(o){if(!1===a)return;r(a)?e.select(a):e.select(i.filter(xe))}})),t.on("connect.end",500,(function(t){var n=t.context.connection;n&&e.select(n)})),t.on("shape.move.end",500,(function(t){var n=t.previousSelection||[],i=o.get(t.context.shape.id);h(n,(function(t){return i.id===t.id}))||e.select(i)})),t.on("element.click",(function(t){if(ft(t)){var o=t.element;o===n.getRootElement()&&(o=null);var i=e.isSelected(o),r=e.get().length>1,a=yt(t)||vt(t);if(i&&r)return a?e.deselect(o):e.select(o);i?e.deselect(o):e.select(o,a)}}))}function xe(t){return!t.hidden}ge.$inject=["canvas","eventBus","selection"],ge.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");jt(e);var n=t.length>1;if(kt(this._canvas.getContainer())[n?"add":"remove"]("djs-multi-select"),n){var o=function(t){return{x:t.x-6,y:t.y-6,width:t.width+12,height:t.height+12}}(se(t)),i=Bt("rect");bt(i,R({rx:3},o)),kt(i).add("djs-selection-outline"),mt(e,i)}},me.$inject=["eventBus","selection","canvas","elementRegistry"];var _e={__init__:["selectionVisuals","selectionBehavior"],__depends__:[ne,pe],selection:["type",fe],selectionVisuals:["type",ge],selectionBehavior:["type",me]};function we(t){this._commandStack=t.get("commandStack",!1)}we.$inject=["injector"],we.prototype.allowed=function(t,e){var n=!0,o=this._commandStack;return o&&(n=o.canExecute(t,e)),void 0===n||n};var be={__init__:["rules"],rules:["type",we]};function Ee(t,e,n){var o,i,r=this,a=n.get("dragging",!1);a&&e.on("drag.start",(function(n){e.once("drag.move",1500,(function(e){!function(e){if(!e.hover){var n=e.originalEvent,o=r._findTargetGfx(n),i=o&&t.get(o);o&&i&&(e.stopPropagation(),a.hover({element:i,gfx:o}),a.move(n))}}(e)}))})),e.on("element.hover",(function(t){o=t.gfx,i=t.element})),e.on("element.hover",1500,(function(t){i&&e.fire("element.out",{element:i,gfx:o})})),e.on("element.out",(function(){o=null,i=null})),this._findTargetGfx=function(t){var e;if(t instanceof MouseEvent)return e=dt(t),function(t){return q(t,"svg, .djs-element",!0)}(document.elementFromPoint(e.x,e.y))}}Ee.$inject=["elementRegistry","eventBus","injector"];var ke={__init__:["hoverFix"],hoverFix:["type",Ee]},Ce=/^djs-cursor-.*$/;function Se(t){var e=V(document.body);e.removeMatching(Ce),t&&e.add("djs-cursor-"+t)}function je(){Se(null)}var Me=5e3;function Pe(t,e){function n(){return!1}return e=e||"element.click",t.once(e,Me,n),function(){t.off(e,n)}}function Re(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Oe(t,e){return{x:t.x-e.x,y:t.y-e.y}}var Be=Math.round,Te="djs-drag-active";function ze(t){t.preventDefault()}function Ae(t,e,n,o){var i,a={threshold:5,trapClick:!0};function c(t){var n=e.viewbox(),o=e._container.getBoundingClientRect();return{x:n.x+(t.x-o.left)/n.scale,y:n.y+(t.y-o.top)/n.scale}}function s(e,n){n=n||i;var o=t.createEvent(R({},n.payload,n.data,{isTouch:n.isTouch}));return!1!==t.fire("drag."+e,o)&&t.fire(n.prefix+"."+e,o)}function u(t,o){var r,a=i.payload,u=i.displacement,l=i.globalStart,h=dt(t),d=Oe(h,l),p=i.localStart,f=c(h),y=Oe(f,p);if(!i.active&&(o||(r=d,Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))>i.threshold))){if(R(a,{x:Be(p.x+u.x),y:Be(p.y+u.y),dx:0,dy:0},{originalEvent:t}),!1===s("start"))return v();i.active=!0,i.keepSelection||(a.previousSelection=n.get(),n.select(null)),i.cursor&&Se(i.cursor),e.addMarker(e.getRootElement(),Te)}ht(t),i.active&&(R(a,{x:Be(f.x+u.x),y:Be(f.y+u.y),dx:Be(y.x),dy:Be(y.y)},{originalEvent:t}),s("move"))}function l(t){var e=!0;i.active&&(t&&(i.payload.originalEvent=t,ht(t)),e=s("end")),!1===e&&s("rejected"),s("ended",g(!0!==e))}function h(t){(function(t,e){return-1!==(t=r(t)?t:[t]).indexOf(e.key)||-1!==t.indexOf(e.code)})("Escape",t)&&(ze(t),v())}function d(e){var n;i.active&&(n=Pe(t),setTimeout(n,400),ze(e)),l(e)}function p(t){u(t)}function f(t){var e=i.payload;e.hoverGfx=t.gfx,e.hover=t.element,s("hover")}function y(t){s("out");var e=i.payload;e.hoverGfx=null,e.hover=null}function v(t){var e;if(i){var n=i.active;n&&s("cancel"),e=g(t),n&&s("canceled",e)}}function g(r){var a,c;s("cleanup"),je(),c=i.trapClick?d:l,J.unbind(document,"mousemove",u),J.unbind(document,"dragstart",ze),J.unbind(document,"selectstart",ze),J.unbind(document,"mousedown",c,!0),J.unbind(document,"mouseup",c,!0),J.unbind(document,"keyup",h),J.unbind(document,"touchstart",p,!0),J.unbind(document,"touchcancel",v,!0),J.unbind(document,"touchmove",u,!0),J.unbind(document,"touchend",l,!0),t.off("element.hover",f),t.off("element.out",y),e.removeMarker(e.getRootElement(),Te);var g=i.payload.previousSelection;return!1!==r&&g&&!n.get().length&&function(t){var e=t.filter((function(t){return o.get(t.id)}));e.length&&n.select(e)}(g),a=i,i=null,a}t.on("diagram.destroy",v),this.init=function(e,n,o,r){i&&v(!1),"string"==typeof n&&(r=o,o=n,n=null);var g,m,x,_,w,b=(r=R({},a,r||{})).data||{};_=r.trapClick?d:l,e?(g=lt(e)||e,m=dt(e),ht(e),"dragstart"===g.type&&ze(g)):(g=null,m={x:0,y:0}),x=c(m),n||(n=x),w=function(t){return"undefined"!=typeof TouchEvent&&t instanceof TouchEvent}(g),i=R({prefix:o,data:b,payload:{},globalStart:m,displacement:Oe(n,x),localStart:x,isTouch:w},r),r.manual||(w?(J.bind(document,"touchstart",p,!0),J.bind(document,"touchcancel",v,!0),J.bind(document,"touchmove",u,!0),J.bind(document,"touchend",l,!0)):(J.bind(document,"mousemove",u),J.bind(document,"dragstart",ze),J.bind(document,"selectstart",ze),J.bind(document,"mousedown",_,!0),J.bind(document,"mouseup",_,!0)),J.bind(document,"keyup",h),t.on("element.hover",f),t.on("element.out",y)),s("init"),r.autoActivate&&u(e,!0)},this.move=u,this.hover=f,this.out=y,this.end=l,this.cancel=v,this.context=function(){return i},this.setOptions=function(t){R(a,t)}}Ae.$inject=["eventBus","canvas","selection","elementRegistry"];var Le={__depends__:[ke,_e],dragging:["type",Ae]};function De(t){return t.childNodes[0]}var Ie=["marker-start","marker-mid","marker-end"],$e=["circle","ellipse","line","path","polygon","polyline","path","rect"];function Ne(t,e,n,o){this._elementRegistry=t,this._canvas=n,this._styles=o,this._clonedMarkers={};var i=this;e.on("drag.cleanup",(function(){p(i._clonedMarkers,(function(t){St(t)})),i._clonedMarkers={}}))}Ne.$inject=["elementRegistry","eventBus","canvas","styles"],Ne.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)},Ne.prototype.addDragger=function(t,e,n){var o=Mt(n=n||this.getGfx(t)),i=n.getBoundingClientRect();return this._cloneMarkers(De(o)),bt(o,this._styles.cls("djs-dragger",[],{x:i.top,y:i.left})),mt(e,o),o},Ne.prototype.addFrame=function(t,e){var n=Bt("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return mt(e,n),n},Ne.prototype._cloneMarkers=function(t){var e=this;if(t.childNodes)for(var n=0;n<t.childNodes.length;n++)e._cloneMarkers(t.childNodes[n]);(function(t){return-1!==$e.indexOf(t.nodeName)})(t)&&Ie.forEach((function(n){if(bt(t,n)){var o=function(t,e,n){var o=(i=bt(t,e),i.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]);var i;return at("marker#"+o,n||document)}(t,n,e._canvas.getContainer());e._cloneMarker(t,o,n)}}))},Ne.prototype._cloneMarker=function(t,e,n){var o=e.id,i=this._clonedMarkers[o];if(!i){var r=o+"-clone";(i=Mt(e)).id=r,kt(i).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[o]=i;var a=at("defs",this._canvas._svg);a||(a=Bt("defs"),mt(this._canvas._svg,a)),mt(a,i)}bt(t,n,"url(#"+this._clonedMarkers[o].id+")")};var He={__init__:["previewSupport"],previewSupport:["type",Ne]},Ve=Math.round;function Ge(t,e,n,o,i){function r(t,e,n,o){return i.allowed("elements.move",{shapes:t,delta:e,position:n,target:o})}function c(t,n,o,i){if(a(o)&&(i=o,o=!1),!n.waypoints&&n.parent&&!kt(t.target).has("djs-hit-no-move")){var r=function(t){return{x:t.x+Ve(t.width/2),y:t.y+Ve(t.height/2)}}(n);return e.init(t,r,"shape.move",{cursor:"grabbing",autoActivate:o,data:{shape:n,context:i||{}}}),!0}}t.on("shape.move.start",1500,(function(t){var e=t.context,n=t.shape,i=o.get().slice();-1===i.indexOf(n)&&(i=[n]),i=function(t){var e=w(t,"id");return d(t,(function(t){for(;t=t.parent;)if(e[t.id])return!1;return!0}))}(i),R(e,{shapes:i,validatedShapes:i,shape:n})})),t.on("shape.move.start",1250,(function(t){var e=t.context,n=e.validatedShapes;if(!(e.canExecute=r(n)))return!1})),t.on("shape.move.move",500,(function(t){var e,n=t.context,o=n.validatedShapes,i=t.hover,a={x:t.dx,y:t.dy};e=r(o,a,{x:t.x,y:t.y},i),n.delta=a,n.canExecute=e,n.target=null!==e?i:null})),t.on("shape.move.end",(function(t){var e=t.context,o=e.delta,i=e.canExecute,r="attach"===i,a=e.shapes;if(!1===i)return!1;o.x=Ve(o.x),o.y=Ve(o.y),0===o.x&&0===o.y||n.moveElements(a,o,e.target,{primaryShape:e.shape,attach:r})})),t.on("element.mousedown",(function(t){if(ft(t)){var e=lt(t);if(!e)throw new Error("must supply DOM mousedown event");return c(e,t.element)}})),this.start=c}function Fe(t,e,n){var o=Lt();o.setTranslate(e,n),Wt(t,o)}function We(t){return a(t)&&l(t,"waypoints")}function qe(t){return a(t)&&l(t,"labelTarget")}Ge.$inject=["eventBus","dragging","modeling","selection","rules"];var Ue="djs-dragging",Ye="drop-ok",Ke="drop-not-ok",Xe="new-parent",Ze="attach-ok";function Je(e,n,o,i){function r(t){var e=function(t){var e=d(t,(function(e){return!We(e)||h(t,k({id:e.source.id}))&&h(t,k({id:e.target.id}))}));return e}(a(t));return e}function a(e){var n=ce(e,!0),o=m(n,(function(t){return(t.incoming||[]).concat(t.outgoing||[])}));return t(n.concat(o))}function c(t,e){[Ze,Ye,Ke,Xe].forEach((function(o){o===e?n.addMarker(t,o):n.removeMarker(t,o)}))}e.on("shape.move.start",499,(function(e){var c=e.context,s=c.shapes,u=c.allDraggedElements,l=r(s);if(!c.dragGroup){var h=Bt("g");bt(h,o.cls("djs-drag-group",["no-events"])),mt(n.getActiveLayer(),h),c.dragGroup=h}l.forEach((function(t){i.addDragger(t,c.dragGroup)})),p(u=u?t([u,a(s)]):a(s),(function(t){n.addMarker(t,Ue)})),c.allDraggedElements=u,c.differentParents=1!==x(w(s,(function(t){return t.parent&&t.parent.id})))})),e.on("shape.move.move",499,(function(t){var e=t.context,n=e.dragGroup,o=e.target,i=e.shape.parent,r=e.canExecute;o&&("attach"===r?c(o,Ze):e.canExecute&&o&&o.id!==i.id?c(o,Xe):c(o,e.canExecute?Ye:Ke)),Fe(n,t.dx,t.dy)})),e.on(["shape.move.out","shape.move.cleanup"],(function(t){var e=t.context.target;e&&c(e,null)})),e.on("shape.move.cleanup",(function(t){var e=t.context,o=e.allDraggedElements,i=e.dragGroup;p(o,(function(t){n.removeMarker(t,Ue)})),i&&St(i)})),this.makeDraggable=function(t,e,o){i.addDragger(e,t.dragGroup),o&&n.addMarker(e,Ue),t.allDraggedElements?t.allDraggedElements.push(e):t.allDraggedElements=[e]}}Je.$inject=["eventBus","canvas","styles","previewSupport"];var Qe={__depends__:[ne,_e,pe,be,Le,He],__init__:["move","movePreview"],move:["type",Ge],movePreview:["type",Je]};function tn(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}tn.$inject=["eventBus","dragging"],tn.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error('A tool has to be registered with it\'s "events"');n.push(t),this.bindEvents(t,e)},tn.prototype.isActive=function(t){return t&&this._active===t},tn.prototype.length=function(t){return this._tools.length},tn.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))},tn.prototype.bindEvents=function(t,e){var n=this._eventBus,o=this._dragging,i=[];n.on(e.tool+".init",(function(e){if(!e.context.reactivate&&this.isActive(t))return this.setActive(null),void o.cancel();this.setActive(t)}),this),p(e,(function(t){i.push(t+".ended"),i.push(t+".canceled")})),n.on(i,250,(function(t){this._active&&(function(t){var e=t.originalEvent&&t.originalEvent.target;return e&&q(e,'.group[data-group="tools"]')}(t)||this.setActive(null))}),this)};var en={__depends__:[Le],__init__:["toolManager"],toolManager:["type",tn]};function nn(t){var e=this;function n(t){e._lastMoveEvent=t}this._lastMoveEvent=null,t.on("canvas.init",(function(t){(e._svg=t.svg).addEventListener("mousemove",n)})),t.on("canvas.destroy",(function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)}))}nn.$inject=["eventBus"],nn.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||function(t,e){var n=document.createEvent("MouseEvent"),o=t,i=e,r=t,a=e;n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,o,i,r,a,!1,!1,!1,!1,0,null);return n}(0,0)};var on={__init__:["mouse"],mouse:["type",nn]},rn="crosshair";function an(t,e,n,o,i,r,a){this._selection=i,this._dragging=n,this._mouse=a;var c=this,s=function(t){var n,o=e.getActiveLayer();bt(n=t.frame=Bt("rect"),{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),mt(o,n)},u=function(t){var e=t.frame,n=t.bbox;bt(e,{x:n.x,y:n.y,width:n.width,height:n.height})},l=function(t){t.frame&&St(t.frame)};r.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",(function(e){var n=e.originalEvent.target;(e.hover||n instanceof SVGElement)&&t.once("lasso.selection.ended",(function(){c.activateLasso(e.originalEvent,!0)}))})),t.on("lasso.end",(function(t){var e=cn(t),n=o.filter((function(t){return t}));c.select(n,e)})),t.on("lasso.start",(function(t){var e=t.context;e.bbox=cn(t),s(e)})),t.on("lasso.move",(function(t){var e=t.context;e.bbox=cn(t),u(e)})),t.on("lasso.cleanup",(function(t){var e=t.context;l(e)})),t.on("element.mousedown",1500,(function(t){if(vt(t))return c.activateLasso(t.originalEvent),!0}))}function cn(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y};return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?{x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?{x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?{x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:{x:n.x,y:n.y,width:0,height:0}}an.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],an.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:rn,data:{context:{}}})},an.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:rn,data:{context:{}}})},an.prototype.select=function(t,e){var n=function(t,e){var n={};return p(t,(function(t){var o=t;o.waypoints&&(o=se(o)),!c(e.y)&&o.x>e.x&&(n[t.id]=t),!c(e.x)&&o.y>e.y&&(n[t.id]=t),o.x>e.x&&o.y>e.y&&(c(e.width)&&c(e.height)&&o.width+o.x<e.width+e.x&&o.height+o.y<e.height+e.y?n[t.id]=t:c(e.width)&&c(e.height)||(n[t.id]=t))})),n}(t,e);this._selection.select(_(n))},an.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},an.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};var sn={__depends__:[en,on],__init__:["lassoTool"],lassoTool:["type",an]};function un(t){return CSS.escape(t)}var ln=".djs-palette-toggle",hn=".entry",dn=ln+", "+hn,pn="djs-palette-",fn="open",yn="two-column";function vn(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",(function(t){var e=t.tool;n.updateToolHighlight(e)})),t.on("i18n.changed",(function(){n._update()})),t.on("diagram.init",(function(){n._diagramInitialized=!0,n._rebuild()}))}function gn(t,e){var n=e.getPaletteEntries();return s(n)?n(t):(p(n,(function(e,n){t[n]=e})),t)}vn.$inject=["eventBus","canvas"],vn.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("palette.getProviders",t,(function(t){t.providers.push(e)})),this._rebuild()},vn.prototype.getEntries=function(){return this._getProviders().reduce(gn,{})},vn.prototype._rebuild=function(){this._diagramInitialized&&(this._getProviders().length&&(this._container||this._init(),this._update()))},vn.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),o=this._container=rt(vn.HTML_MARKUP);n.appendChild(o),V(n).add(pn+"shown"),et.bind(o,dn,"click",(function(e){if(W(e.delegateTarget,ln))return t.toggle();t.trigger("click",e)})),J.bind(o,"mousedown",(function(t){t.stopPropagation()})),et.bind(o,hn,"dragstart",(function(e){t.trigger("dragstart",e)})),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:o})},vn.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},vn.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),o=this._container,i=this._eventBus,r=V(o),a=V(n);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),r.toggle(yn,e),a.toggle(pn+yn,e),"open"in t&&(r.toggle(fn,t.open),a.toggle(pn+fn,t.open)),i.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},vn.prototype._update=function(){var t=at(".djs-palette-entries",this._container),e=this._entries=this.getEntries();F(t),p(e,(function(e,n){var o=e.group||"default",i=at("[data-group="+un(o)+"]",t);i||(N(i=rt('<div class="group"></div>'),"data-group",o),t.appendChild(i));var a=e.html||(e.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),c=rt(a);if(i.appendChild(c),!e.separator&&(N(c,"data-action",n),e.title&&N(c,"title",e.title),e.className&&function(t,e){var n=V(t);(r(e)?e:e.split(/\s+/g)).forEach((function(t){n.add(t)}))}(c,e.className),e.imageUrl)){var s=rt("<img>");N(s,"src",e.imageUrl),c.appendChild(s)}})),this.open()},vn.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=N(r,"data-action"),i=e.originalEvent||e,this.triggerEntry(o,t,i,n)):e.preventDefault()},vn.prototype.triggerEntry=function(t,e,n,o){var i,r;if((i=this._entries[t])&&(r=i.action,!1!==this._eventBus.fire("palette.trigger",{entry:i,event:n}))){if(s(r)){if("click"===e)return r(n,o)}else if(r[e])return r[e](n,o);n.preventDefault()}},vn.prototype._layoutChanged=function(){this._toggleState({})},vn.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},vn.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},vn.prototype.open=function(){this._toggleState({open:!0})},vn.prototype.toggle=function(){this.isOpen()?this.close():this.open()},vn.prototype.isActiveTool=function(t){return t&&this._activeTool===t},vn.prototype.updateToolHighlight=function(t){var e;this._toolsContainer||(e=at(".djs-palette-entries",this._container),this._toolsContainer=at("[data-group=tools]",e)),p(this._toolsContainer.children,(function(e){var n=e.getAttribute("data-action");if(n){var o=V(e);n=n.replace("-tool",""),o.contains("entry")&&n===t?o.add("highlighted-entry"):o.remove("highlighted-entry")}}))},vn.prototype.isOpen=function(){return V(this._container).has(fn)},vn.prototype._getParentContainer=function(){return this._canvas.getContainer()},vn.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';var mn={__init__:["palette"],palette:["type",vn]},xn="drop-ok",_n="drop-not-ok",wn="attach-ok",bn="new-parent",En="create";function kn(t,e,n,o,i){function a(e,n){[wn,xn,_n,bn].forEach((function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)}))}function s(){var t=e.context();t&&t.prefix===En&&e.cancel()}n.on(["create.move","create.hover"],(function(t){var e=t.context,n=e.elements,o=t.hover,r=e.source,c=e.hints||{};if(!o)return e.canExecute=!1,void(e.target=null);Cn(t);var s={x:t.x,y:t.y},u=e.canExecute=o&&function(t,e,n,o,r){if(!e)return!1;var a=h(t=d(t,(function(e){var n=e.labelTarget;return!(e.parent||qe(e)&&-1!==t.indexOf(n))})),(function(t){return!We(t)})),c=!1,s=!1,u=!1;Sn(t)&&(c=i.allowed("shape.attach",{position:n,shape:a,target:e})),c||(u=Sn(t)?i.allowed("shape.create",{position:n,shape:a,source:o,target:e}):i.allowed("elements.create",{elements:t,position:n,target:e}));var l=r.connectionTarget;return u||c?(a&&o&&(s=i.allowed("connection.create",{source:l===o?a:o,target:l===o?o:a,hints:{targetParent:e,targetAttach:c}})),{attach:c,connect:s}):(null===u||null===c)&&null}(n,o,s,r,c);o&&null!==u&&(e.target=o,u&&u.attach?a(o,wn):a(o,u?bn:_n))})),n.on(["create.end","create.out","create.cleanup"],(function(t){var e=t.hover;e&&a(e,null)})),n.on("create.end",(function(t){var e=t.context,n=e.source,i=e.shape,r=e.elements,a=e.target,c=e.canExecute,s=c&&c.attach,u=c&&c.connect,l=e.hints||{};if(!1===c||!a)return!1;Cn(t);var d={x:t.x,y:t.y};i=u?o.appendShape(n,i,d,a,{attach:s,connection:!0===u?{}:u,connectionTarget:l.connectionTarget}):h(r=o.createElements(r,d,a,R({},l,{attach:s})),(function(t){return!We(t)})),R(e,{elements:r,shape:i}),R(t,{elements:r,shape:i})})),n.on("create.init",(function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],2e3,(function(){n.off("elements.changed",s)}))})),this.start=function(t,n,o){r(n)||(n=[n]);var i=h(n,(function(t){return!We(t)}));if(i){o=R({elements:n,hints:{},shape:i},o||{}),p(n,(function(t){c(t.x)||(t.x=0),c(t.y)||(t.y=0)}));var a=se(d(n,(function(t){return!t.hidden})));p(n,(function(t){We(t)&&(t.waypoints=m(t.waypoints,(function(t){return{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2}}))),R(t,{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2})})),e.init(t,En,{cursor:"grabbing",autoActivate:!0,data:{shape:i,elements:n,context:o}})}}}function Cn(t){var e=t.context.createConstraints;e&&(e.left&&(t.x=Math.max(t.x,e.left)),e.right&&(t.x=Math.min(t.x,e.right)),e.top&&(t.y=Math.max(t.y,e.top)),e.bottom&&(t.y=Math.min(t.y,e.bottom)))}function Sn(t){return t&&1===t.length&&!We(t[0])}kn.$inject=["canvas","dragging","eventBus","modeling","rules"];function jn(t,e,n,o,i){e.on("create.move",750,(function(e){var r=e.hover,a=e.context,c=a.elements,s=a.dragGroup;s||(s=a.dragGroup=function(t){var e=Bt("g");bt(e,i.cls("djs-drag-group",["no-events"]));var r=Bt("g");return t.forEach((function(t){var i;t.hidden||(t.waypoints?(i=n._createContainer("connection",r),n.drawConnection(De(i),t)):(i=n._createContainer("shape",r),n.drawShape(De(i),t),Fe(i,t.x,t.y)),o.addDragger(t,e,i))})),e}(c)),r?(s.parentNode||mt(t.getActiveLayer(),s),Fe(s,e.x,e.y)):St(s)})),e.on("create.cleanup",(function(t){var e=t.context.dragGroup;e&&St(e)}))}jn.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];var Mn={__depends__:[Le,He,be,_e],__init__:["create","createPreview"],create:["type",kn],createPreview:["type",jn]};function Pn(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}Pn.prototype.next=function(){return this._prefix+ ++this._counter};var Rn=new Pn("ov");function On(t,e,n,o){var i,r;this._eventBus=e,this._canvas=n,this._elementRegistry=o,this._ids=Rn,this._overlayDefaults=R({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(i=n.getContainer(),$(r=rt('<div class="djs-overlay-container" />'),{position:"absolute",width:0,height:0}),i.insertBefore(r,i.firstChild),r),this._init()}function Bn(t,e,n){$(t,{left:e+"px",top:n+"px"})}function Tn(t,e){t.style.display=!1===e?"none":""}function zn(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(n){t.style[n+"transform"]=e}))}On.$inject=["config.overlays","eventBus","canvas","elementRegistry"],On.prototype.get=function(t){if(u(t)&&(t={id:t}),u(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?d(e.overlays,k({type:t.type})):e.overlays.slice():[]}return t.type?d(this._overlays,k({type:t.type})):t.id?this._overlays[t.id]:null},On.prototype.add=function(t,e,n){if(a(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var o=this._ids.next();return n=R({},this._overlayDefaults,n,{id:o,type:e,element:t,html:n.html}),this._addOverlay(n),o},On.prototype.remove=function(t){var e=this.get(t)||[];r(e)||(e=[e]);var n=this;p(e,(function(t){var e=n._getOverlayContainer(t.element,!0);if(t&&(st(t.html),st(t.htmlContainer),delete t.htmlContainer,delete t.element,delete n._overlays[t.id]),e){var o=e.overlays.indexOf(t);-1!==o&&e.overlays.splice(o,1)}}))},On.prototype.isShown=function(){return"none"!==this._overlayRoot.style.display},On.prototype.show=function(){Tn(this._overlayRoot)},On.prototype.hide=function(){Tn(this._overlayRoot,!1)},On.prototype.clear=function(){this._overlays={},this._overlayContainers=[],F(this._overlayRoot)},On.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,o=e.x,i=e.y;if(e.waypoints){var r=se(e);o=r.x,i=r.y}Bn(n,o,i),N(t.html,"data-container-id",e.id)},On.prototype._updateOverlay=function(t){var e,n,o=t.position,i=t.htmlContainer,r=t.element,a=o.left,c=o.top;void 0!==o.right&&(e=r.waypoints?se(r).width:r.width,a=-1*o.right+e);void 0!==o.bottom&&(n=r.waypoints?se(r).height:r.height,c=-1*o.bottom+n);Bn(i,a||0,c||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())},On.prototype._createOverlayContainer=function(t){var e=rt('<div class="djs-overlays" />');$(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},On.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";zn(this._overlayRoot,n)},On.prototype._getOverlayContainer=function(t,e){var n=h(this._overlayContainers,(function(e){return e.element===t}));return n||e?n:this._createOverlayContainer(t)},On.prototype._addOverlay=function(t){var e,n,o=t.id,i=t.element,r=t.html;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),u(r)&&(r=rt(r)),n=this._getOverlayContainer(i),$(e=rt('<div class="djs-overlay" data-overlay-id="'+o+'">'),{position:"absolute"}),e.appendChild(r),t.type&&V(e).add("djs-overlay-"+t.type),Tn(e,this._canvas.findRoot(i)===this._canvas.getRootElement()),t.htmlContainer=e,n.overlays.push(t),n.html.appendChild(e),this._overlays[o]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())},On.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,o=this._canvas.findRoot(t.element),r=n&&n.minZoom,a=n&&n.maxZoom,c=t.htmlContainer,s=!0;(o!==this._canvas.getRootElement()||n&&(i(r)&&r>e.scale||i(a)&&a<e.scale))&&(s=!1),Tn(c,s),this._updateOverlayScale(t,e)},On.prototype._updateOverlayScale=function(t,e){var n,o,r,a=t.scale,c=t.htmlContainer,s="";!0!==a&&(!1===a?(n=1,o=1):(n=a.min,o=a.max),i(n)&&e.scale<n&&(r=(1/e.scale||1)*n),i(o)&&e.scale>o&&(r=(1/e.scale||1)*o)),i(r)&&(s="scale("+r+","+r+")"),zn(c,s)},On.prototype._updateOverlaysVisibilty=function(t){var e=this;p(this._overlays,(function(n){e._updateOverlayVisibilty(n,t)}))},On.prototype._init=function(){var t=this._eventBus,e=this;t.on("canvas.viewbox.changing",(function(t){e.hide()})),t.on("canvas.viewbox.changed",(function(t){var n;n=t.viewbox,e._updateRoot(n),e._updateOverlaysVisibilty(n),e.show()})),t.on(["shape.remove","connection.remove"],(function(t){var n=t.element;p(e.get({element:n}),(function(t){e.remove(t.id)}));var o=e._getOverlayContainer(n);if(o){st(o.html);var i=e._overlayContainers.indexOf(o);-1!==i&&e._overlayContainers.splice(i,1)}})),t.on("element.changed",500,(function(t){var n=t.element,o=e._getOverlayContainer(n,!0);o&&(p(o.overlays,(function(t){e._updateOverlay(t)})),e._updateOverlayContainer(o))})),t.on("element.marker.update",(function(t){var n=e._getOverlayContainer(t.element,!0);n&&V(n.html)[t.add?"add":"remove"](t.marker)})),t.on("root.set",(function(){e._updateOverlaysVisibilty(e._canvas.viewbox())})),t.on("diagram.clear",this.clear,this)};var An={__init__:["overlays"],overlays:["type",On]},Ln=".entry";function Dn(t,e,n,o){this._canvas=t,this._eventBus=n,this._overlays=o;var r=i(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:r},this._current=null,this._init()}function In(t,e){return-1!==t.indexOf(e)}Dn.$inject=["canvas","config.contextPad","eventBus","overlays"],Dn.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",(function(e){var n=e.newSelection,o=n.length?1===n.length?n[0]:n:null;o?t.open(o,!0):t.close()})),this._eventBus.on("elements.changed",(function(e){var n=e.elements,o=t._current;if(o){var i=o.target;g(r(i)?i:[i],(function(t){return In(n,t)}))&&t.open(i,!0)}}))},Dn.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("contextPad.getProviders",t,(function(t){t.providers.push(e)}))},Dn.prototype.getEntries=function(t){var e=this._getProviders(),n=r(t)?"getMultiElementContextPadEntries":"getContextPadEntries",o={};return p(e,(function(e){if(s(e[n])){var i=e[n](t);s(i)?o=i(o):p(i,(function(t,e){o[e]=t}))}})),o},Dn.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=N(r,"data-action"),i=e.originalEvent||e,this.triggerEntry(o,t,i,n)):e.preventDefault()},Dn.prototype.triggerEntry=function(t,e,n,o){if(this.isShown()){var i=this._current.target,r=this._current.entries[t];if(r){var a=r.action;if(!1!==this._eventBus.fire("contextPad.trigger",{entry:r,event:n})){if(s(a)){if("click"===e)return a(n,i,o)}else if(a[e])return a[e](n,i,o);n.preventDefault()}}}},Dn.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))},Dn.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},Dn.prototype._updateAndOpen=function(t){var e,n=this.getEntries(t),o=this.getPad(t),i=o.html;p(n,(function(t,n){var o,a=t.group||"default",c=rt(t.html||'<div class="entry" draggable="true"></div>');N(c,"data-action",n),(o=at("[data-group="+un(a)+"]",i))||(N(o=rt('<div class="group"></div>'),"data-group",a),i.appendChild(o)),o.appendChild(c),t.className&&function(t,e){var n=V(t);(e=r(e)?e:e.split(/\s+/g)).forEach((function(t){n.add(t)}))}(c,t.className),t.title&&N(c,"title",t.title),t.imageUrl&&(N(e=rt("<img>"),"src",t.imageUrl),e.style.width="100%",e.style.height="100%",c.appendChild(e))})),V(i).add("open"),this._current={target:t,entries:n,pad:o},this._eventBus.fire("contextPad.open",{current:this._current})},Dn.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,o=rt('<div class="djs-context-pad"></div>'),i=this._getPosition(t),r=R({html:o},this._overlaysConfig,i);et.bind(o,Ln,"click",(function(t){e.trigger("click",t)})),et.bind(o,Ln,"dragstart",(function(t){e.trigger("dragstart",t)})),J.bind(o,"mousedown",(function(t){t.stopPropagation()}));var a=this._canvas.getRootElement();this._overlayId=n.add(a,"context-pad",r);var c=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:c}),c},Dn.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},Dn.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return r(t)===r(n)&&(r(t)?t.length===n.length&&v(t,(function(t){return In(n,t)})):n===t)},Dn.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()},Dn.prototype._getPosition=function(t){var e=se(r(t)?t:[t]);return{position:{left:e.x+e.width+12,top:e.y-6}}};var $n={__depends__:[ne,An],contextPad:["type",Dn]};function Nn(t,e){return t&&e?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):-1}function Hn(t,e,n,o){if(void 0===o&&(o=5),!t||!e||!n)return!1;var i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),r=Nn(t,e);return Math.abs(i/r)<=o}var Vn=2;function Gn(t,e){var n=Array.from(arguments).flat();const o={x:"v",y:"h"};for(const[t,e]of Object.entries(o))if(Fn(t,n))return e;return!1}function Fn(t,e){const n=e[0];return v(e,(function(e){return Math.abs(n[t]-e[t])<=Vn}))}function Wn(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function qn(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function Un(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/**
   * This file contains source code adapted from Snap.svg (licensed Apache-2.0).
   *
   * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js
   */var Yn=/,?([a-z]),?/gi,Kn=parseFloat,Xn=Math,Zn=Xn.PI,Jn=Xn.min,Qn=Xn.max,to=Xn.pow,eo=Xn.abs,no=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,oo=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi,io=Array.isArray||function(t){return t instanceof Array};function ro(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ao(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)ro(t,n)&&(e[n]=ao(t[n]));return e}function co(t){var e=co.ps=co.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var n in e)ro(e,n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])})),e[t]}function so(t,e,n,o){return 1===arguments.length&&(e=t.y,n=t.width,o=t.height,t=t.x),{x:t,y:e,width:n,height:o,x2:t+n,y2:e+o}}function uo(){return this.join(",").replace(Yn,"$1")}function lo(t){var e=ao(t);return e.toString=uo,e}function ho(t,e,n,o,i,r,a,c,s){var u=1-s,l=to(u,3),h=to(u,2),d=s*s*s,p=l*e+3*h*s*o+3*u*s*s*r+d*c;return{x:mo(l*t+3*h*s*n+3*u*s*s*i+d*a),y:mo(p)}}function po(t){var e=Co.apply(null,t);return so(e.x0,e.y0,e.x1-e.x0,e.y1-e.y0)}function fo(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function yo(t,e,n,o,i){return t*(t*(-3*e+9*n-9*o+3*i)+6*e-12*n+6*o)-3*e+3*n}function vo(t,e,n,o,i,r,a,c,s){null==s&&(s=1);for(var u=(s=s>1?1:s<0?0:s)/2,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,p=0;p<12;p++){var f=u*l[p]+u,y=yo(f,t,n,i,a),v=yo(f,e,o,r,c),g=y*y+v*v;d+=h[p]*Xn.sqrt(g)}return u*d}function go(t,e,n,o,i,r,a,c){if(!(Qn(t,n)<Jn(i,a)||Jn(t,n)>Qn(i,a)||Qn(e,o)<Jn(r,c)||Jn(e,o)>Qn(r,c))){var s=(t*o-e*n)*(r-c)-(e-o)*(i*c-r*a),u=(t-n)*(r-c)-(e-o)*(i-a);if(u){var l=mo(((t*o-e*n)*(i-a)-(t-n)*(i*c-r*a))/u),h=mo(s/u),d=+l.toFixed(2),p=+h.toFixed(2);if(!(d<+Jn(t,n).toFixed(2)||d>+Qn(t,n).toFixed(2)||d<+Jn(i,a).toFixed(2)||d>+Qn(i,a).toFixed(2)||p<+Jn(e,o).toFixed(2)||p>+Qn(e,o).toFixed(2)||p<+Jn(r,c).toFixed(2)||p>+Qn(r,c).toFixed(2)))return{x:l,y:h}}}}function mo(t){return Math.round(1e11*t)/1e11}function xo(t,e,n){if(!function(t,e){return t=so(t),fo(e=so(e),t.x,t.y)||fo(e,t.x2,t.y)||fo(e,t.x,t.y2)||fo(e,t.x2,t.y2)||fo(t,e.x,e.y)||fo(t,e.x2,e.y)||fo(t,e.x,e.y2)||fo(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}(po(t),po(e)))return n?0:[];for(var o=vo.apply(0,t),i=vo.apply(0,e),r=wo(t)?1:~~(o/5)||1,a=wo(e)?1:~~(i/5)||1,c=[],s=[],u={},l=n?0:[],h=0;h<r+1;h++){var d=ho.apply(0,t.concat(h/r));c.push({x:d.x,y:d.y,t:h/r})}for(h=0;h<a+1;h++)d=ho.apply(0,e.concat(h/a)),s.push({x:d.x,y:d.y,t:h/a});for(h=0;h<r;h++)for(var p=0;p<a;p++){var f,y=c[h],v=c[h+1],g=s[p],m=s[p+1],x=eo(v.x-y.x)<.01?"y":"x",_=eo(m.x-g.x)<.01?"y":"x",w=go(y.x,y.y,v.x,v.y,g.x,g.y,m.x,m.y);if(w){if(u[f=w.x.toFixed(9)+"#"+w.y.toFixed(9)])continue;u[f]=!0;var b=y.t+eo((w[x]-y[x])/(v[x]-y[x]))*(v.t-y.t),E=g.t+eo((w[_]-g[_])/(m[_]-g[_]))*(m.t-g.t);b>=0&&b<=1&&E>=0&&E<=1&&(n?l++:l.push({x:w.x,y:w.y,t1:b,t2:E}))}}return l}function _o(t){var e=co(t);if(e.abs)return lo(e.abs);if(io(t)&&io(t&&t[0])||(t=function(t){if(!t)return null;var e=co(t);if(e.arr)return ao(e.arr);var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},o=[];return io(t)&&io(t[0])&&(o=ao(t)),o.length||String(t).replace(no,(function(t,e,i){var r=[],a=e.toLowerCase();for(i.replace(oo,(function(t,e){e&&r.push(+e)})),"m"==a&&r.length>2&&(o.push([e].concat(r.splice(0,2))),a="l",e="m"==e?"l":"L");r.length>=n[a]&&(o.push([e].concat(r.splice(0,n[a]))),n[a]););})),o.toString=co.toString,e.arr=ao(o),o}(t)),!t||!t.length)return[["M",0,0]];var n,o=[],i=0,r=0,a=0,c=0,s=0;"M"==t[0][0]&&(a=i=+t[0][1],c=r=+t[0][2],s++,o[0]=["M",i,r]);for(var u,l,h=s,d=t.length;h<d;h++){if(o.push(u=[]),(n=(l=t[h])[0])!=n.toUpperCase())switch(u[0]=n.toUpperCase(),u[0]){case"A":u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=+l[6]+i,u[7]=+l[7]+r;break;case"V":u[1]=+l[1]+r;break;case"H":u[1]=+l[1]+i;break;case"M":a=+l[1]+i,c=+l[2]+r;default:for(var p=1,f=l.length;p<f;p++)u[p]=+l[p]+(p%2?i:r)}else for(var y=0,v=l.length;y<v;y++)u[y]=l[y];switch(n=n.toUpperCase(),u[0]){case"Z":i=+a,r=+c;break;case"H":i=u[1];break;case"V":r=u[1];break;case"M":a=u[u.length-2],c=u[u.length-1];default:i=u[u.length-2],r=u[u.length-1]}}return o.toString=uo,e.abs=lo(o),o}function wo(t){return t[0]===t[2]&&t[1]===t[3]&&t[4]===t[6]&&t[5]===t[7]}function bo(t,e,n,o){return[t,e,n,o,n,o]}function Eo(t,e,n,o,i,r){var a=1/3,c=2/3;return[a*t+c*n,a*e+c*o,a*i+c*n,a*r+c*o,i,r]}function ko(t,e,n,o,i,r,a,c,s,u){var l,h,d=120*Zn/180,p=Zn/180*(+i||0),f=[],y=(h=function(t,e,n){return{x:t*Xn.cos(n)-e*Xn.sin(n),y:t*Xn.sin(n)+e*Xn.cos(n)}},function t(){var e=Array.prototype.slice.call(arguments,0),n=e.join("␀"),o=t.cache=t.cache||{},i=t.count=t.count||[];return ro(o,n)?(function(t,e){for(var n=0,o=t.length;n<o;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}(i,n),o[n]):(i.length>=1e3&&delete o[i.shift()],i.push(n),o[n]=h.apply(0,e),o[n])});if(u)k=u[0],C=u[1],b=u[2],E=u[3];else{t=(l=y(t,e,-p)).x,e=l.y;var v=(t-(c=(l=y(c,s,-p)).x))/2,g=(e-(s=l.y))/2,m=v*v/(n*n)+g*g/(o*o);m>1&&(n*=m=Xn.sqrt(m),o*=m);var x=n*n,_=o*o,w=(r==a?-1:1)*Xn.sqrt(eo((x*_-x*g*g-_*v*v)/(x*g*g+_*v*v))),b=w*n*g/o+(t+c)/2,E=w*-o*v/n+(e+s)/2,k=Xn.asin(((e-E)/o).toFixed(9)),C=Xn.asin(((s-E)/o).toFixed(9));(k=t<b?Zn-k:k)<0&&(k=2*Zn+k),(C=c<b?Zn-C:C)<0&&(C=2*Zn+C),a&&k>C&&(k-=2*Zn),!a&&C>k&&(C-=2*Zn)}var S=C-k;if(eo(S)>d){var j=C,M=c,P=s;C=k+d*(a&&C>k?1:-1),f=ko(c=b+n*Xn.cos(C),s=E+o*Xn.sin(C),n,o,i,0,a,M,P,[C,j,b,E])}S=C-k;var R=Xn.cos(k),O=Xn.sin(k),B=Xn.cos(C),T=Xn.sin(C),z=Xn.tan(S/4),A=4/3*n*z,L=4/3*o*z,D=[t,e],I=[t+A*O,e-L*R],$=[c+A*T,s-L*B],N=[c,s];if(I[0]=2*D[0]-I[0],I[1]=2*D[1]-I[1],u)return[I,$,N].concat(f);for(var H=[],V=0,G=(f=[I,$,N].concat(f).join().split(",")).length;V<G;V++)H[V]=V%2?y(f[V-1],f[V],p).y:y(f[V],f[V+1],p).x;return H}function Co(t,e,n,o,i,r,a,c){for(var s,u,l,h,d,p,f,y,v=[],g=[[],[]],m=0;m<2;++m)if(0==m?(u=6*t-12*n+6*i,s=-3*t+9*n-9*i+3*a,l=3*n-3*t):(u=6*e-12*o+6*r,s=-3*e+9*o-9*r+3*c,l=3*o-3*e),eo(s)<1e-12){if(eo(u)<1e-12)continue;0<(h=-l/u)&&h<1&&v.push(h)}else f=u*u-4*l*s,y=Xn.sqrt(f),f<0||(0<(d=(-u+y)/(2*s))&&d<1&&v.push(d),0<(p=(-u-y)/(2*s))&&p<1&&v.push(p));for(var x,_=v.length,w=_;_--;)x=1-(h=v[_]),g[0][_]=x*x*x*t+3*x*x*h*n+3*x*h*h*i+h*h*h*a,g[1][_]=x*x*x*e+3*x*x*h*o+3*x*h*h*r+h*h*h*c;return g[0][w]=t,g[1][w]=e,g[0][w+1]=a,g[1][w+1]=c,g[0].length=g[1].length=w+2,{x0:Jn.apply(0,g[0]),y0:Jn.apply(0,g[1]),x1:Qn.apply(0,g[0]),y1:Qn.apply(0,g[1])}}function So(t){var e=co(t);if(e.curve)return lo(e.curve);for(var n=_o(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i=function(t,e,n){var o,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(ko.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==n||"S"==n?(o=2*e.x-e.bx,i=2*e.y-e.by):(o=e.x,i=e.y),t=["C",o,i].concat(t.slice(1));break;case"T":"Q"==n||"T"==n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(Eo(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(Eo(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(bo(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(bo(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(bo(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(bo(e.x,e.y,e.X,e.Y))}return t},r=function(t,e){if(t[e].length>7){t[e].shift();for(var o=t[e];o.length;)a[e]="A",t.splice(e++,0,["C"].concat(o.splice(0,6)));t.splice(e,1),l=n.length}},a=[],c="",s="",u=0,l=n.length;u<l;u++){n[u]&&(c=n[u][0]),"C"!=c&&(a[u]=c,u&&(s=a[u-1])),n[u]=i(n[u],o,s),"A"!=a[u]&&"C"==c&&(a[u]="C"),r(n,u);var h=n[u],d=h.length;o.x=h[d-2],o.y=h[d-1],o.bx=Kn(h[d-4])||o.x,o.by=Kn(h[d-3])||o.y}return e.curve=lo(n),n}var jo=Un((function(t,e,n){t=So(t),e=So(e);for(var o,i,r,a,c,s,u,l,h,d,p=n?0:[],f=0,y=t.length;f<y;f++){var v=t[f];if("M"==v[0])o=c=v[1],i=s=v[2];else{"C"==v[0]?(h=[o,i].concat(v.slice(1)),o=h[6],i=h[7]):(h=[o,i,o,i,c,s,c,s],o=c,i=s);for(var g=0,m=e.length;g<m;g++){var x=e[g];if("M"==x[0])r=u=x[1],a=l=x[2];else{"C"==x[0]?(d=[r,a].concat(x.slice(1)),r=d[6],a=d[7]):(d=[r,a,r,a,u,l,u,l],r=u,a=l);var _=xo(h,d,n);if(n)p+=_;else{for(var w=0,b=_.length;w<b;w++)_[w].segment1=f,_[w].segment2=g,_[w].bez1=h,_[w].bez2=d;p=p.concat(_)}}}}}return p})),Mo=Math.round,Po=Math.max;var Ro=10;function Oo(t,e){return function(t,e){var n,o;for(n=0;o=t[n];n++)if(Nn(o,e)<=Ro)return{point:t[n],bendpoint:!0,index:n};return null}(t,e)||function(t,e){var n,o,i=jo(function(t,e){return[["M",t.x,t.y],["m",0,-e],["a",e,e,0,1,1,0,2*e],["a",e,e,0,1,1,0,-2*e],["z"]]}(e,Ro),(n=[],t.forEach((function(t,e){n.push([0===e?"M":"L",t.x,t.y])})),n)),r=i[0],a=i[i.length-1];return r?r!==a?r.segment2!==a.segment2?{point:t[o=Po(r.segment2,a.segment2)-1],bendpoint:!0,index:o}:{point:{x:Mo(r.x+a.x)/2,y:Mo(r.y+a.y)/2},index:r.segment2}:{point:{x:Mo(r.x),y:Mo(r.y)},index:r.segment2}:null}(t,e)}function Bo(t,e){var n=e[0],o=e[1],i={x:o.x-n.x,y:o.y-n.y},r=function(t,e,n){var o=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}];return-(o[0].n*e[0]+o[1].n*e[1])/(o[0].lambda*e[0]+o[1].lambda*e[1])}([n.x,n.y],[i.x,i.y],[t.x,t.y]);return{x:n.x+r*i.x,y:n.y+r*i.y}}function To(t,e){var n,o=Bo(t,e),i={x:o.x-t.x,y:o.y-t.y};return n=i,Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))}var zo="djs-bendpoint",Ao="djs-segment-dragger";function Lo(t,e,n){var o=function(t,e){var n,o=dt(e),i=t._container.getBoundingClientRect();n={x:i.left,y:i.top};var r=t.viewbox();return{x:r.x+(o.x-n.x)/r.scale,y:r.y+(o.y-n.y)/r.scale}}(t,n);return Oo(e,o)}function Do(t,e){var n=Bt("g");kt(n).add(zo),mt(t,n);var o=Bt("circle");bt(o,{cx:0,cy:0,r:4}),kt(o).add("djs-visual"),mt(n,o);var i=Bt("circle");return bt(i,{cx:0,cy:0,r:10}),kt(i).add("djs-hit"),mt(n,i),e&&kt(n).add(e),n}function Io(t,e,n,o){var i=Bt("g");mt(t,i);var r=function(t,e,n){var o=e.x-t.x,i=e.y-t.y;return No("h"===n?o:i)}(e,n,o),a=Bt("rect");bt(a,{x:-9,y:-3,width:18,height:6}),kt(a).add("djs-visual"),mt(i,a);var c=Bt("rect");return bt(c,{x:-r/2,y:-8.5,width:r,height:17}),kt(c).add("djs-hit"),mt(i,c),function(t,e){var n=Lt();n.setRotate(e,0,0),Wt(t,n)}(i,"v"===o?90:0),i}function $o(t,e,n){var o=Bt("g"),i=qn(e,n),r=Gn(e,n);return mt(t,o),Io(o,e,n,r),kt(o).add(Ao),kt(o).add("h"===r?"horizontal":"vertical"),Fe(o,i.x,i.y),o}function No(t){return Math.abs(Math.round(2*t/3))}function Ho(t,e){var n=function(t,e){for(var n,o=e.waypoints,i=1/0,r=0;r<o.length-1;r++){var a=To(t,[o[r],o[r+1]]);a<i&&(i=a,n=r)}return[o[n],o[n+1]]}(t,e);return Bo(t,n)}function Vo(t,e,n,o,i){function r(t,n){var r,a=n.waypoints,c=Lo(e,a,t);if(c)return r=function(t,e){var n,o,i=t.waypoints;return e.index<=0||e.bendpoint?null:(o=Gn((n={start:i[e.index-1],end:i[e.index]}).start,n.end))?No("h"===o?n.end.x-n.start.x:n.end.y-n.start.y)/2:null}(n,c),!function(t,e,n){var o,i,r,a,c,s,u=t.index,l=t.point;return!(u<=0||t.bendpoint)&&(r=qn(o=e[u-1],i=e[u]),a=Gn(o,i),c=Math.abs(l.x-r.x),s=Math.abs(l.y-r.y),a&&c<=n&&s<=n)}(c,a,r)?o.start(t,n,c.index,!c.bendpoint):i.start(t,n,c.index),!0}function a(t,e,o){J.bind(t,e,(function(t){n.triggerMouseEvent(e,t,o),t.stopPropagation()}))}function c(t,n){var o=e.getLayer("overlays"),i=at('.djs-bendpoints[data-element-id="'+un(t.id)+'"]',o);return!i&&n&&(bt(i=Bt("g"),{"data-element-id":t.id}),kt(i).add("djs-bendpoints"),mt(o,i),a(i,"mousedown",t),a(i,"click",t),a(i,"dblclick",t)),i}function s(t,e){return at('.djs-segment-dragger[data-segment-idx="'+t+'"]',e)}function u(t,e){e.waypoints.forEach((function(e,n){var o=Do(t);mt(t,o),Fe(o,e.x,e.y)})),Do(t,"floating")}function l(t,e){for(var n,o,i,r=e.waypoints,c=1;c<r.length;c++)Gn(n=r[c-1],o=r[c])&&(bt(i=$o(t,n,o),{"data-segment-idx":c}),a(i,"mousemove",e))}function h(t){var e=c(t);return e||(u(e=c(t,!0),t),l(e,t)),e}function d(t){var e=c(t);e&&(!function(t){p(ct("."+Ao,t),(function(t){St(t)}))}(e),function(t){p(ct("."+zo,t),(function(t){St(t)}))}(e),l(e,t),u(e,t))}function f(t,e,n){var o,i,r=s(e.index,t),a=n[e.index-1],c=n[e.index],u=e.point,l=qn(a,c),h=Gn(a,c);r&&(o=function(t){return at(".djs-visual",t)}(r),i={x:u.x-l.x,y:u.y-l.y},"v"===h&&(i={x:i.y,y:i.x}),Fe(o,i.x,i.y))}t.on("connection.changed",(function(t){d(t.element)})),t.on("connection.remove",(function(t){var e=c(t.element);e&&St(e)})),t.on("element.marker.update",(function(t){var e,n=t.element;n.waypoints&&(e=h(n),t.add?kt(e).add(t.marker):kt(e).remove(t.marker))})),t.on("element.mousemove",(function(t){var n,o,i=t.element,r=i.waypoints;if(r){if(n=c(i,!0),!(o=Lo(e,r,t.originalEvent)))return;!function(t,e){var n=at(".floating",t),o=e.point;n&&Fe(n,o.x,o.y)}(n,o),o.bendpoint||f(n,o,r)}})),t.on("element.mousedown",(function(t){if(ft(t)){var e=t.originalEvent,n=t.element;if(n.waypoints)return r(e,n)}})),t.on("selection.changed",(function(t){var e=t.newSelection[0];e&&e.waypoints&&h(e)})),t.on("element.hover",(function(t){var e=t.element;e.waypoints&&(h(e),n.registerEvent(t.gfx,"mousemove","element.mousemove"))})),t.on("element.out",(function(t){n.unregisterEvent(t.gfx,"mousemove","element.mousemove")})),t.on("element.updateId",(function(t){var e=t.element,n=t.newId;if(e.waypoints){var o=c(e);o&&bt(o,{"data-element-id":n})}})),this.addHandles=h,this.updateHandles=d,this.getBendpointsContainer=c,this.getSegmentDragger=s}function Go(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function Fo(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Wo(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function qo(t){for(var e=t.waypoints,n=e.reduce((function(t,n,o){var i,r,a=e[o-1];if(a){var c=t[t.length-1],s=c&&c.endLength||0,u=(i=a,r=n,Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)));t.push({start:a,end:n,startLength:s,endLength:s+u,length:u})}return t}),[]),o=n.reduce((function(t,e){return t+e.length}),0),i=o/2,r=0,a=n[r];a.endLength<i;)a=n[++r];var c=(i-a.startLength)/a.length;return{x:a.start.x+(a.end.x-a.start.x)*c,y:a.start.y+(a.end.y-a.start.y)*c}}function Uo(t){return We(t)?qo(t):Go({x:(e=t).x+(e.width||0)/2,y:e.y+(e.height||0)/2});var e}function Yo(t,e,n){a(n=n||0)||(n={x:n,y:n});var o=Fo(t),i=Fo(e),r=o.bottom+n.y<=i.top,c=o.left-n.x>=i.right,s=o.top-n.y>=i.bottom,u=r?"top":s?"bottom":null,l=o.right+n.x<=i.left?"left":c?"right":null;return l&&u?u+"-"+l:l||u||"intersect"}function Ko(t,e,n){var o=jo(t,e);return 1===o.length||2===o.length&&Nn(o[0],o[1])<1?Go(o[0]):o.length>1?(o=E(o,(function(t){var e=Math.floor(100*t.t2)||1;return e=((e=100-e)<10?"0":"")+e,t.segment2+"#"+e})),Go(o[n?0:o.length-1])):null}Vo.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var Xo=Math.round,Zo="reconnectStart",Jo="reconnectEnd",Qo="updateWaypoints";function ti(t,e,n,o,i,r){this._injector=t,this.start=function(t,e,r,a){var c,s=n.getGraphics(e),u=e.source,l=e.target,h=e.waypoints,d=(c=a||0!==r?a||r!==h.length-1?Qo:Jo:Zo)===Qo?"connection.updateWaypoints":"connection.reconnect",p=i.allowed(d,{connection:e,source:u,target:l});!1===p&&(p=i.allowed(d,{connection:e,source:l,target:u})),!1!==p&&o.init(t,"bendpoint.move",{data:{connection:e,connectionGfx:s,context:{allowed:p,bendpointIndex:r,connection:e,source:u,target:l,insert:a,type:c}}})},e.on("bendpoint.move.hover",(function(t){var e,n=t.context,o=n.connection,r=o.source,a=o.target,c=t.hover,s=n.type;if(n.hover=c,c){var u=s===Qo?"connection.updateWaypoints":"connection.reconnect";if(e=n.allowed=i.allowed(u,{connection:o,source:s===Zo?c:r,target:s===Jo?c:a}))return n.source=s===Zo?c:r,void(n.target=s===Jo?c:a);!1===e&&(e=n.allowed=i.allowed(u,{connection:o,source:s===Jo?c:a,target:s===Zo?c:r})),e&&(n.source=s===Jo?c:a,n.target=s===Zo?c:r)}})),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],(function(t){var e=t.context,n=e.type;e.hover=null,e.source=null,e.target=null,n!==Qo&&(e.allowed=!1)})),e.on("bendpoint.move.end",(function(t){var e=t.context,n=e.allowed,o=e.bendpointIndex,i=e.connection,a=e.insert,c=i.waypoints.slice(),s=e.source,u=e.target,l=e.type,h=e.hints||{},d={x:Xo(t.x),y:Xo(t.y)};if(!n)return!1;l===Qo?(a?c.splice(o,0,d):c[o]=d,h.bendpointMove={insert:a,bendpointIndex:o},c=this.cropWaypoints(i,c),r.updateWaypoints(i,function(t){t=t.slice();for(var e,n,o,i=0;t[i];)e=t[i],n=t[i-1],0===Nn(e,o=t[i+1])||Hn(n,o,e)?t.splice(i,1):i++;return t}(c),h)):(l===Zo?(h.docking="source",ei(e)&&(h.docking="target",h.newWaypoints=c.reverse())):l===Jo&&(h.docking="target",ei(e)&&(h.docking="source",h.newWaypoints=c.reverse())),r.reconnect(i,s,u,d,h))}),this)}function ei(t){var e=t.hover,n=t.source,o=t.target,i=t.type;return i===Zo?e&&o&&e===o&&n!==o:i===Jo?e&&n&&e===n&&n!==o:void 0}ti.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],ti.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var o=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=o,e};var ni="updateWaypoints",oi="connect-ok",ii="connect-not-ok",ri="connect-hover",ai="djs-updating",ci="djs-element-hidden";function si(t,e,n,o){this._injector=e;var i=e.get("connectionPreview",!1);n.on("bendpoint.move.start",(function(t){var e=t.context,n=e.bendpointIndex,i=e.connection,r=e.insert,a=i.waypoints,c=a.slice();e.waypoints=a,r&&c.splice(n,0,{x:t.x,y:t.y}),i.waypoints=c,kt(e.draggerGfx=Do(o.getLayer("overlays"))).add("djs-dragging"),o.addMarker(i,ci),o.addMarker(i,ai)})),n.on("bendpoint.move.hover",(function(t){var e=t.context,n=e.allowed,i=e.hover,r=e.type;if(i){if(o.addMarker(i,ri),r===ni)return;n?(o.removeMarker(i,ii),o.addMarker(i,oi)):!1===n&&(o.removeMarker(i,oi),o.addMarker(i,ii))}})),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,(function(t){var e=t.context,n=e.hover,i=e.target;n&&(o.removeMarker(n,ri),o.removeMarker(n,i?oi:ii))})),n.on("bendpoint.move.move",(function(e){var n=e.context,o=n.allowed,r=n.bendpointIndex,a=n.draggerGfx,c=n.hover,s=n.type,u=n.connection,l=u.source,h=u.target,d=u.waypoints.slice(),p={x:e.x,y:e.y},f=n.hints||{},y={};i&&(f.connectionStart&&(y.connectionStart=f.connectionStart),f.connectionEnd&&(y.connectionEnd=f.connectionEnd),"reconnectStart"===s?ei(n)?(y.connectionEnd=y.connectionEnd||p,y.source=h,y.target=c||l,d=d.reverse()):(y.connectionStart=y.connectionStart||p,y.source=c||l,y.target=h):"reconnectEnd"===s?ei(n)?(y.connectionStart=y.connectionStart||p,y.source=c||h,y.target=l,d=d.reverse()):(y.connectionEnd=y.connectionEnd||p,y.source=l,y.target=c||h):(y.noCropping=!0,y.noLayout=!0,d[r]=p),s===ni&&(d=t.cropWaypoints(u,d)),y.waypoints=d,i.drawPreview(n,o,y)),Fe(a,e.x,e.y)}),this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,(function(t){var e=t.context,n=e.connection,r=e.draggerGfx,a=e.hover,c=e.target,s=e.waypoints;n.waypoints=s,St(r),o.removeMarker(n,ai),o.removeMarker(n,ci),a&&(o.removeMarker(a,oi),o.removeMarker(a,c?oi:ii)),i&&i.cleanUp(e)}))}si.$inject=["bendpointMove","injector","eventBus","canvas"];var ui="connect-hover",li="djs-updating";function hi(t,e,n){return di(t,e,t[e]+n)}function di(t,e,n){return{x:"x"===e?n:t.x,y:"y"===e?n:t.y}}function pi(t){return"x"===t?"y":"x"}function fi(t,e,n){var o,i;return t.original?t.original:(o=Uo(e),di(t,i=pi(n),o[i]))}function yi(t,e,n,o,i,r){var a=t.get("connectionDocking",!1);function c(t,e){if(!a)return e;var n,o=t.waypoints;return t.waypoints=e,n=a.getCroppedWaypoints(t),t.waypoints=o,n}function s(t){i.update("connection",t.connection,t.connectionGfx)}function u(t,e,n){var o=t.newWaypoints,i=function(t,e,n,o){var i=Math.max(e[o],n[o]),r=Math.min(e[o],n[o]);return di(e,o,Math.min(Math.max(r+20,t[o]),i-20))}(n,o[t.segmentStartIndex+e],o[t.segmentEndIndex+e],pi(t.axis));Fe(t.draggerGfx,i.x,i.y)}this.start=function(t,e,i){var r,a,c,s,u=n.getGraphics(e),l=i-1,h=i,d=e.waypoints,p=d[l],f=d[h],y=Lo(n,d,t);(a=Gn(p,f))&&(c="v"===a?"x":"y",0===l&&(p=fi(p,e.source,c)),h===d.length-1&&(f=fi(f,e.target,c)),r={connection:e,segmentStartIndex:l,segmentEndIndex:h,segmentStart:p,segmentEnd:f,axis:c,dragPosition:s=y?y.point:{x:(p.x+f.x)/2,y:(p.y+f.y)/2}},o.init(t,s,"connectionSegment.move",{cursor:"x"===c?"resize-ew":"resize-ns",data:{connection:e,connectionGfx:u,context:r}}))},e.on("connectionSegment.move.start",(function(t){var e=t.context,o=t.connection,i=n.getLayer("overlays");e.originalWaypoints=o.waypoints.slice(),e.draggerGfx=$o(i,e.segmentStart,e.segmentEnd),kt(e.draggerGfx).add("djs-dragging"),n.addMarker(o,li)})),e.on("connectionSegment.move.move",(function(t){var e,n,o=t.context,i=o.connection,r=o.segmentStartIndex,a=o.segmentEndIndex,l=o.segmentStart,h=o.segmentEnd,d=o.axis,p=o.originalWaypoints.slice(),f=hi(l,d,t["d"+d]),y=hi(h,d,t["d"+d]),v=p.length,g=0;p[r]=f,p[a]=y,r<2&&(e=Yo(i.source,f),1===r?"intersect"===e&&(p.shift(),p[0]=f,g--):"intersect"!==e&&(p.unshift(l),g++)),a>v-3&&(n=Yo(i.target,y),a===v-2?"intersect"===n&&(p.pop(),p[p.length-1]=y):"intersect"!==n&&p.push(h)),o.newWaypoints=i.waypoints=c(i,p),u(o,g,t),o.newSegmentStartIndex=r+g,s(t)})),e.on("connectionSegment.move.hover",(function(t){t.context.hover=t.hover,n.addMarker(t.hover,ui)})),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],(function(t){var e=t.context.hover;e&&n.removeMarker(e,ui)})),e.on("connectionSegment.move.cleanup",(function(t){var e=t.context,o=e.connection;e.draggerGfx&&St(e.draggerGfx),n.removeMarker(o,li)})),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],(function(t){var e=t.context;e.connection.waypoints=e.originalWaypoints,s(t)})),e.on("connectionSegment.move.end",(function(t){var e=t.context,n=e.connection,o=e.newWaypoints,i=e.newSegmentStartIndex,a=function(t,e){var n=0;return{waypoints:t.filter((function(o,i){return!Hn(t[i-1],t[i+1],o)||(n=i<=e?n-1:n,!1)})),segmentOffset:n}}(o=o.map((function(t){return{original:t.original,x:Math.round(t.x),y:Math.round(t.y)}})),i),s=c(n,a.waypoints),u=a.segmentOffset,l={segmentMove:{segmentStartIndex:e.segmentStartIndex,newSegmentStartIndex:i+u}};r.updateWaypoints(n,s,l)}))}function vi(t,e,n){if("string"!=typeof e)throw new Error("axis must be in [x, y]");if("number"!=typeof n&&!1!==n)throw new Error("value must be Number or false");var o,i=t[e],r=t.snapped=t.snapped||{};return!1===n?r[e]=!1:(r[e]=!0,o=n-i,t[e]+=o,t["d"+e]+=o),i}yi.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var gi=Math.abs,mi=Math.round;function xi(t){function e(t,e){if(r(t)){for(var n=t.length;n--;)if(gi(t[n]-e)<=10)return t[n]}else{var o=e%(t=+t);if(o<10)return e-o;if(o>t-10)return e-o+t}return e}function n(t,e){return t.waypoints?Ho(e,t):t.width?{x:mi(t.width/2+t.x),y:mi(t.height/2+t.y)}:void 0}t.on("connectionSegment.move.move",1500,(function(t){var o,i,r=function(t){var e=t.context,o=e.snapPoints,i=e.connection,r=i.waypoints,a=e.segmentStart,c=e.segmentStartIndex,s=e.segmentEnd,u=e.segmentEndIndex,l=e.axis;if(o)return o;var h=[r[c-1],a,s,r[u+1]];return c<2&&h.unshift(n(i.source,t)),u>r.length-3&&h.unshift(n(i.target,t)),e.snapPoints=o={horizontal:[],vertical:[]},p(h,(function(t){t&&(t=t.original||t,"y"===l&&o.horizontal.push(t.y),"x"===l&&o.vertical.push(t.x))})),o}(t),a=t.x,c=t.y;if(r){var s=a-(o=e(r.vertical,a)),u=c-(i=e(r.horizontal,c));R(t,{dx:t.dx-s,dy:t.dy-u,x:o,y:i}),(s||-1!==r.vertical.indexOf(a))&&vi(t,"x",o),(u||-1!==r.horizontal.indexOf(c))&&vi(t,"y",i)}})),t.on(["connect.hover","connect.move","connect.end"],1500,(function(t){var e=t.context.hover,o=e&&n(e,t);We(e)&&o&&o.x&&o.y&&(vi(t,"x",o.x),vi(t,"y",o.y))})),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,(function(t){var o,i,r=t.context,a=function(t){var e=t.snapPoints,n=t.connection.waypoints,o=t.bendpointIndex;if(e)return e;var i=[n[o-1],n[o+1]];return t.snapPoints=e={horizontal:[],vertical:[]},p(i,(function(t){t&&(t=t.original||t,e.horizontal.push(t.y),e.vertical.push(t.x))})),e}(r),c=r.hover,s=c&&n(c,t),u=t.x,l=t.y;if(a){var h=u-(o=e(s?a.vertical.concat([s.x]):a.vertical,u)),d=l-(i=e(s?a.horizontal.concat([s.y]):a.horizontal,l));R(t,{dx:t.dx-h,dy:t.dy-d,x:t.x-h,y:t.y-d}),(h||-1!==a.vertical.indexOf(u))&&vi(t,"x",o),(d||-1!==a.horizontal.indexOf(l))&&vi(t,"y",i)}}))}xi.$inject=["eventBus"];var _i={__depends__:[Le,be],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",Vo],bendpointMove:["type",ti],bendpointMovePreview:["type",si],connectionSegmentMove:["type",yi],bendpointSnapping:["type",xi]};function wi(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}function bi(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n}function Ei(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var o=t.indexOf(e);if(-1!==o){if(o===n)return;if(-1===n)return;t.splice(o,1)}-1!==n?t.splice(n,0,e):t.push(e)}}function ki(t,e){return t&&e?t.indexOf(e):-1}function Ci(t,e){if("function"!=typeof e)throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function Si(t){this._eventBus=t}function ji(t){return function(e,n,o,i,r){(s(e)||c(e))&&(r=i,i=o,o=n,n=e,e=null),this.on(e,t,n,o,i,r)}}Si.$inject=["eventBus"],Si.prototype.on=function(t,e,n,o,i,u){if((s(e)||c(e))&&(u=i,i=o,o=n,n=e,e=null),s(n)&&(u=i,i=o,o=n,n=1e3),a(i)&&(u=i,i=!1),!s(o))throw new Error("handlerFn must be a function");r(t)||(t=[t]);var l=this._eventBus;p(t,(function(t){var r=["commandStack",t,e].filter((function(t){return t})).join(".");l.on(r,n,i?function(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}(o,u):o,u)}))},Si.prototype.canExecute=ji("canExecute"),Si.prototype.preExecute=ji("preExecute"),Si.prototype.preExecuted=ji("preExecuted"),Si.prototype.execute=ji("execute"),Si.prototype.executed=ji("executed"),Si.prototype.postExecute=ji("postExecute"),Si.prototype.postExecuted=ji("postExecuted"),Si.prototype.revert=ji("revert"),Si.prototype.reverted=ji("reverted");function Mi(t,e,n){Si.call(this,e);var o=t.get("movePreview",!1);e.on("shape.move.start",1400,(function(t){var e=t.context,n=e.shapes,o=e.validatedShapes;e.shapes=Pi(n),e.validatedShapes=Pi(o)})),o&&e.on("shape.move.start",250,(function(t){var e=t.context,n=e.shapes,i=[];p(n,(function(t){p(t.labels,(function(n){n.hidden||-1!==e.shapes.indexOf(n)||i.push(n),t.labelTarget&&i.push(t)}))})),p(i,(function(t){o.makeDraggable(e,t,!0)}))})),this.preExecuted("elements.move",1400,(function(t){var e=t.context.closure,n=e.enclosedElements,o=[];p(n,(function(t){p(t.labels,(function(t){n[t.id]||o.push(t)}))})),e.addAll(o)})),this.preExecute(["connection.delete","shape.delete"],(function(t){var e=t.context;Ci((e.connection||e.shape).labels,(function(t){n.removeShape(t,{nested:!0})}))})),this.execute("shape.delete",(function(t){var e=t.context,n=e.shape,o=n.labelTarget;o&&(e.labelTargetIndex=ki(o.labels,n),e.labelTarget=o,n.labelTarget=null)})),this.revert("shape.delete",(function(t){var e=t.context,n=e.shape,o=e.labelTarget,i=e.labelTargetIndex;o&&(Ei(o.labels,n,i),n.labelTarget=o)}))}function Pi(t){return d(t,(function(e){return-1===t.indexOf(e.labelTarget)}))}wi(Mi,Si),Mi.$inject=["injector","eventBus","modeling"];var Ri={__init__:["labelSupport"],labelSupport:["type",Mi]};function Oi(t,e,n,o){t.on("element.changed",(function(o){var i=o.element;(i.parent||i===e.getRootElement())&&(o.gfx=n.getGraphics(i)),o.gfx&&t.fire(ue(i)+".changed",o)})),t.on("elements.changed",(function(e){var n=e.elements;n.forEach((function(e){t.fire("element.changed",{element:e})})),o.updateContainments(n)})),t.on("shape.changed",(function(t){o.update("shape",t.element,t.gfx)})),t.on("connection.changed",(function(t){o.update("connection",t.element,t.gfx)}))}Oi.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];var Bi={__init__:["changeSupport"],changeSupport:["type",Oi]},Ti=Math.max,zi=Math.min,Ai=20;function Li(t,e,n){var o=e[t],i=n.min&&n.min[t],r=n.max&&n.max[t];return c(i)&&(o=(/top|left/.test(t)?zi:Ti)(o,i)),c(r)&&(o=(/top|left/.test(t)?Ti:zi)(o,r)),o}function Di(t,e){return void 0!==t?t:Ai}function Ii(t){return!t.waypoints&&"label"!==t.type}function $i(t,e){var n;if((n=void 0===t.length?d(t.children,Ii):t).length)return function(t,e){var n,o,i,r;return"object"==typeof e?(n=Di(e.left),o=Di(e.right),i=Di(e.top),r=Di(e.bottom)):n=o=i=r=Di(e),{x:t.x-n,y:t.y-i,width:t.width+n+o,height:t.height+i+r}}(se(n),e)}function Ni(t,e,n,o){this._dragging=o,this._rules=e;var i=this;function r(t,e){var n,o=t.shape,r=t.direction,a=t.resizeConstraints;t.delta=e,n=function(t,e,n){var o=n.x,i=n.y,r={x:t.x,y:t.y,width:t.width,height:t.height};return-1!==e.indexOf("n")?(r.y=t.y+i,r.height=t.height-i):-1!==e.indexOf("s")&&(r.height=t.height+i),-1!==e.indexOf("e")?r.width=t.width+o:-1!==e.indexOf("w")&&(r.x=t.x+o,r.width=t.width-o),r}(o,r,e),t.newBounds=function(t,e){if(!e)return t;var n=Fo(t);return Wo({top:Li("top",n,e),right:Li("right",n,e),bottom:Li("bottom",n,e),left:Li("left",n,e)})}(n,a),t.canExecute=i.canResize(t)}function a(t){var e,o=t.shape,i=t.canExecute,r=t.newBounds;if(i){if(e=r,!function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(o,r={x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}))return;n.resizeShape(o,r)}}t.on("resize.start",(function(t){var e,n,o;e=t.context,n=e.resizeConstraints,o=e.minBounds,void 0===n&&(void 0===o&&(o=i.computeMinResizeBox(e)),e.resizeConstraints={min:Fo(o)})})),t.on("resize.move",(function(t){var e={x:t.dx,y:t.dy};r(t.context,e)})),t.on("resize.end",(function(t){a(t.context)}))}function Hi(t,e){var n=Uo(t),o=Fo(t),i={x:n.x,y:n.y};return-1!==e.indexOf("n")?i.y=o.top:-1!==e.indexOf("s")&&(i.y=o.bottom),-1!==e.indexOf("e")?i.x=o.right:-1!==e.indexOf("w")&&(i.x=o.left),i}function Vi(t){var e="resize-";return"n"===t||"s"===t?e+"ns":"e"===t||"w"===t?e+"ew":"nw"===t||"se"===t?e+"nwse":e+"nesw"}Ni.prototype.canResize=function(t){var e=this._rules,n=O(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)},Ni.prototype.activate=function(t,e,n){var o,i,r=this._dragging;if("string"==typeof n&&(n={direction:n}),!(i=(o=R({shape:e},n)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");r.init(t,Hi(e,i),"resize",{autoActivate:!0,cursor:Vi(i),data:{shape:e,context:o}})},Ni.prototype.computeMinResizeBox=function(t){var e=t.shape;return function(t,e,n,o){var i=Fo(e),r={top:/n/.test(t)?i.bottom-n.height:i.top,left:/w/.test(t)?i.right-n.width:i.left,bottom:/s/.test(t)?i.top+n.height:i.bottom,right:/e/.test(t)?i.left+n.width:i.right},a=o?Fo(o):r;return Wo({top:zi(r.top,a.top),left:zi(r.left,a.left),bottom:Ti(r.bottom,a.bottom),right:Ti(r.right,a.right)})}(t.direction,e,t.minDimensions||{width:10,height:10},$i(e,t.childrenBoxPadding))},Ni.$inject=["eventBus","rules","modeling","dragging"];var Gi="djs-resizing",Fi="resize-not-ok";function Wi(t,e,n){t.on("resize.move",500,(function(t){var o,i,r,a;o=t.context,i=o.shape,r=o.newBounds,(a=o.frame)||(a=o.frame=n.addFrame(i,e.getActiveLayer()),e.addMarker(i,Gi)),r.width>5&&bt(a,{x:r.x,width:r.width}),r.height>5&&bt(a,{y:r.y,height:r.height}),o.canExecute?kt(a).remove(Fi):kt(a).add(Fi)})),t.on("resize.cleanup",(function(t){var n,o;n=t.context,o=n.shape,n.frame&&St(n.frame),e.removeMarker(o,Gi)}))}Wi.$inject=["eventBus","canvas","previewSupport"];var qi=-6,Ui="djs-resizer",Yi=["n","w","s","e","nw","ne","se","sw"];function Ki(t,e,n,o){this._resize=o,this._canvas=e;var i=this;t.on("selection.changed",(function(t){var e=t.newSelection;i.removeResizers(),1===e.length&&p(e,P(i.addResizer,i))})),t.on("shape.changed",(function(t){var e=t.element;n.isSelected(e)&&(i.removeResizers(),i.addResizer(e))}))}Ki.prototype.makeDraggable=function(t,e,n){var o=this._resize;function i(e){ft(e)&&o.activate(e,t,n)}J.bind(e,"mousedown",i),J.bind(e,"touchstart",i)},Ki.prototype._createResizer=function(t,e,n,o){var i=this._getResizersParent(),r=function(t){var e={x:0,y:0};-1!==t.indexOf("e")?e.x=6:-1!==t.indexOf("w")&&(e.x=qi);-1!==t.indexOf("s")?e.y=6:-1!==t.indexOf("n")&&(e.y=qi);return e}(o),a=Bt("g");kt(a).add(Ui),kt(a).add(Ui+"-"+t.id),kt(a).add(Ui+"-"+o),mt(i,a);var c=Bt("rect");bt(c,{x:-4+r.x,y:-4+r.y,width:8,height:8}),kt(c).add(Ui+"-visual"),mt(a,c);var s=Bt("rect");return bt(s,{x:-10+r.x,y:-10+r.y,width:20,height:20}),kt(s).add(Ui+"-hit"),mt(a,s),function(t,e,n,o,i){var r=Lt();r.setTranslate(e,n);var a=Lt();a.setRotate(o||0,0,0);var c=Lt();c.setScale(i||1,i||1),Wt(t,[r,a,c])}(a,e,n),a},Ki.prototype.createResizer=function(t,e){var n=Hi(t,e),o=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,o,e)},Ki.prototype.addResizer=function(t){var e=this;!We(t)&&this._resize.canResize({shape:t})&&p(Yi,(function(n){e.createResizer(t,n)}))},Ki.prototype.removeResizers=function(){jt(this._getResizersParent())},Ki.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},Ki.$inject=["eventBus","canvas","selection","resize"];var Xi={__depends__:[be,Le,He],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Ni],resizePreview:["type",Wi],resizeHandles:["type",Ki]},Zi=Math.min,Ji=Math.max;function Qi(t){t.preventDefault()}function tr(t){t.stopPropagation()}function er(t){this.container=t.container,this.parent=rt('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=at("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=P(this.autoResize,this),this.handlePaste=P(this.handlePaste,this)}function nr(t,e){this._eventBus=t,this._providers=[],this._textbox=new er({container:e.getContainer(),keyHandler:P(this._handleKey,this),resizeHandler:P(this._handleResize,this)})}er.prototype.create=function(t,e,n,o){var i=this.parent,r=this.content,a=this.container;o=this.options=o||{};var c=O(e=this.style=e||{},["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);R(i.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var s=O(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return R(r.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},s),o.centerVertically&&R(r.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},s),r.innerText=n,J.bind(r,"keydown",this.keyHandler),J.bind(r,"mousedown",tr),J.bind(r,"paste",this.handlePaste),o.autoResize&&J.bind(r,"input",this.autoResize),o.resizable&&this.resizable(e),a.appendChild(i),this.setSelection(r.lastChild,r.lastChild&&r.lastChild.length),i},er.prototype.handlePaste=function(t){var e,n=this.options,o=this.style;if(t.preventDefault(),e=t.clipboardData?t.clipboardData.getData("text/plain"):window.clipboardData.getData("Text"),this.insertText(e),n.autoResize){var i=this.autoResize(o);i&&this.resizeHandler(i)}},er.prototype.insertText=function(t){t=t.replace(/\r\n|\r|\n/g,"\n"),document.execCommand("insertText",!1,t)||this._insertTextIE(t)},er.prototype._insertTextIE=function(t){var e,n,o,i=this.getSelection(),r=i.startContainer,a=i.endContainer,c=i.startOffset,s=i.endOffset,u=i.commonAncestorContainer,l=(e=u.childNodes,[].slice.call(e));if(function(t){return t.nodeType===Node.TEXT_NODE}(u)){var h=r.textContent;r.textContent=h.substring(0,c)+t+h.substring(s),n=r,o=c+t.length}else if(r===this.content&&a===this.content){var d=document.createTextNode(t);this.content.insertBefore(d,l[c]),n=d,o=d.textContent.length}else{var p=l.indexOf(r),f=l.indexOf(a);l.forEach((function(e,n){n===p?e.textContent=r.textContent.substring(0,c)+t+a.textContent.substring(s):n>p&&n<=f&&st(e)})),n=r,o=c+t.length}n&&void 0!==o&&setTimeout((function(){self.setSelection(n,o)}))},er.prototype.autoResize=function(){var t=this.parent,e=this.content,n=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-n){var o=t.getBoundingClientRect(),i=e.scrollHeight;t.style.height=i+"px",this.resizeHandler({width:o.width,height:o.height,dx:0,dy:i-o.height})}},er.prototype.resizable=function(){var t=this,e=this.parent,n=this.resizeHandle,o=parseInt(this.style.minWidth)||0,i=parseInt(this.style.minHeight)||0,r=parseInt(this.style.maxWidth)||1/0,a=parseInt(this.style.maxHeight)||1/0;if(!n){var c,s,u,l;n=this.resizeHandle=rt('<div class="djs-direct-editing-resize-handle"></div>');var h=function(n){Qi(n),tr(n);var h=Zi(Ji(u+n.clientX-c,o),r),d=Zi(Ji(l+n.clientY-s,i),a);e.style.width=h+"px",e.style.height=d+"px",t.resizeHandler({width:u,height:l,dx:n.clientX-c,dy:n.clientY-s})},d=function(t){Qi(t),tr(t),J.unbind(document,"mousemove",h,!1),J.unbind(document,"mouseup",d,!1)};J.bind(n,"mousedown",(function(t){Qi(t),tr(t),c=t.clientX,s=t.clientY;var n=e.getBoundingClientRect();u=n.width,l=n.height,J.bind(document,"mousemove",h),J.bind(document,"mouseup",d)}))}R(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),e.appendChild(n)},er.prototype.destroy=function(){var t=this.parent,e=this.content,n=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),J.unbind(e,"keydown",this.keyHandler),J.unbind(e,"mousedown",tr),J.unbind(e,"input",this.autoResize),J.unbind(e,"paste",this.handlePaste),n&&(n.removeAttribute("style"),st(n)),st(t)},er.prototype.getValue=function(){return this.content.innerText.trim()},er.prototype.getSelection=function(){return window.getSelection().getRangeAt(0)},er.prototype.setSelection=function(t,e){var n=document.createRange();null===t?n.selectNodeContents(this.content):(n.setStart(t,e),n.setEnd(t,e));var o=window.getSelection();o.removeAllRanges(),o.addRange(n)},nr.$inject=["eventBus","canvas"],nr.prototype.registerProvider=function(t){this._providers.push(t)},nr.prototype.isActive=function(t){return!(!this._active||t&&this._active.element!==t)},nr.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},nr.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})},nr.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0},nr.prototype.complete=function(){var t=this._active;if(t){var e,n=t.context.bounds,o=this.$textbox.getBoundingClientRect(),i=this.getValue();i===t.context.text&&o.height===n.height&&o.width===n.width||(e=this._textbox.container.getBoundingClientRect(),t.provider.update(t.element,i,t.context.text,{x:o.left-e.left,y:o.top-e.top,width:o.width,height:o.height})),this._fire("complete"),this.close()}},nr.prototype.getValue=function(){return this._textbox.getValue()},nr.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;return 27===e?(t.preventDefault(),this.cancel()):13!==e||t.shiftKey?void 0:(t.preventDefault(),this.complete())},nr.prototype._handleResize=function(t){this._fire("resize",t)},nr.prototype.activate=function(t){var e;this.isActive()&&this.cancel();var n=h(this._providers,(function(n){return(e=n.activate(t))?n:null}));return e&&(this.$textbox=this._textbox.create(e.bounds,e.style,e.text,e.options),this._active={element:t,context:e,provider:n},e.options&&e.options.resizable&&(this.resizable=!0),this._fire("activate")),!!e};var or={__depends__:[ne],__init__:["directEditing"],directEditing:["type",nr]},ir="connect-ok",rr="connect-not-ok";function ar(t,e,n,o,i,r){t.on("connect.move",(function(t){var e,n=t.context,o=n.source,i=n.target,a=n.visual;e=function(t,e,n,o){var i=r.getShapePath(n),a=o&&r.getShapePath(o),c=r.getConnectionPath({waypoints:[t,e]});return[t=Ko(i,c,!0)||t,e=o&&Ko(a,c,!1)||e]}(n.sourcePosition,{x:t.x,y:t.y},o,i),bt(a,{points:[e[0].x,e[0].y,e[1].x,e[1].y]})})),t.on("connect.hover",(function(t){var e=t.context;e.source;var n,o=t.hover;null!==(n=e.canExecute=!0)&&(e.target=o,i.addMarker(o,n?ir:rr))})),t.on(["connect.out","connect.cleanup"],(function(t){var e=t.context;e.target&&i.removeMarker(e.target,e.canExecute?ir:rr),e.target=null,e.canExecute=!1})),t.on("connect.cleanup",(function(t){var e=t.context;e.visual&&St(e.visual)})),t.on("connect.start",(function(t){var e,n=t.context;bt(e=Bt("polyline"),{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),mt(i.getDefaultLayer(),e),n.visual=e})),t.on("connect.end",(function(t){var e=t.context;if(e.source,e.type,e.sourcePosition,e.target,t.x,t.y,!(e.canExecute||!0))return!1})),this.start=function(t,n,o,i,r){"object"!=typeof i&&(r=i,i=Uo(n)),e.init(t,"connect",{autoActivate:r,data:{shape:n,context:{type:o,source:n,sourcePosition:i}}})}}ar.$inject=["eventBus","dragging","modeling","rules","canvas","graphicsFactory"];var cr={__depends__:[_e,be,Le],connect:["type",ar]};function sr(t,e,n,o){this._canvas=e,this._graphicsFactory=n,this._elementFactory=o,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}sr.$inject=["injector","canvas","graphicsFactory","elementFactory"],sr.prototype.drawPreview=function(t,e,n){n=n||{};var o,i,r,a=t.connectionPreviewGfx,c=t.getConnection,s=n.source,u=n.target,l=n.waypoints,h=n.connectionStart,d=n.connectionEnd,p=n.noLayout,f=n.noCropping,y=n.noNoop,v=this;a||(a=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),jt(a),c||(c=t.getConnection=(i=function(t,e,n){return v.getConnection(t,e,n)},r={},function(t){var e=JSON.stringify(t),n=r[e];return n||(n=r[e]=i.apply(null,arguments)),n})),e&&(o=c(e,s,u)),o?(t.connection&&(o.connectionType=t.connection.connectionType),o.waypoints=l||[],this._layouter&&!p&&(o.waypoints=this._layouter.layoutConnection(o,{source:s,target:u,connectionStart:h,connectionEnd:d,waypoints:n.waypoints||o.waypoints})),o.waypoints&&o.waypoints.length||(o.waypoints=[s?Uo(s):h,u?Uo(u):d]),this._connectionDocking&&(s||u)&&!f&&(o.waypoints=this._connectionDocking.getCroppedWaypoints(o,s,u)),this._graphicsFactory.drawConnection(a,o)):!y&&this.drawNoopPreview(a,n)},sr.prototype.drawNoopPreview=function(t,e){var n=e.source,o=e.target,i=e.connectionStart||Uo(n),r=e.connectionEnd||Uo(o),a=this.cropWaypoints(i,r,n,o);mt(t,this.createNoopConnection(a[0],a[1]))},sr.prototype.cropWaypoints=function(t,e,n,o){var i=this._graphicsFactory,r=n&&i.getShapePath(n),a=o&&i.getShapePath(o),c=i.getConnectionPath({waypoints:[t,e]});return[t=n&&Ko(r,c,!0)||t,e=o&&Ko(a,c,!1)||e]},sr.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&St(t.connectionPreviewGfx)},sr.prototype.getConnection=function(t){var e=function(t){return a(t)?t:{}}(t);return this._elementFactory.createConnection(e)},sr.prototype.createConnectionPreviewGfx=function(){var t=Bt("g");return bt(t,{pointerEvents:"none"}),kt(t).add("djs-connection").add("djs-connection-preview"),mt(this._canvas.getActiveLayer(),t),t},sr.prototype.createNoopConnection=function(t,e){return Zt([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};var ur={__init__:["connectionPreview"],connectionPreview:["type",sr]};function lr(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}lr.$inject=["eventBus","injector"],lr.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()},lr.prototype.canExecute=function(t,e){const n={command:t,context:e},o=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(void 0===i){if(!o)return!1;o.canExecute&&(i=o.canExecute(e))}return i},lr.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,!1!==t&&this._fire("changed",{trigger:"clear"})},lr.prototype.undo=function(){let t,e=this._getUndoAction();if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),t&&t.id===e.id);)e=t;this._popAction()}},lr.prototype.redo=function(){let t,e=this._getRedoAction();if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),t&&t.id===e.id);)e=t;this._popAction()}},lr.prototype.register=function(t,e){this._setHandler(t,e)},lr.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)},lr.prototype.canUndo=function(){return!!this._getUndoAction()},lr.prototype.canRedo=function(){return!!this._getRedoAction()},lr.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},lr.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},lr.prototype._internalUndo=function(t){const e=t.command,n=t.context,o=this._getHandler(e);this._atomicDo((()=>{this._fire(e,"revert",t),o.revert&&this._markDirty(o.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)}))},lr.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const o=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const t of o)if(i=this._eventBus.fire("commandStack."+t,n),n.cancelBubble)break;return i},lr.prototype._createId=function(){return this._uid++},lr.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}},lr.prototype._internalExecute=function(t,e){const n=t.command,o=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(o),this._fire(n,"preExecuted",t)),this._atomicDo((()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(o)),this._executedAction(t,e),this._fire(n,"executed",t)})),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(o),this._fire(n,"postExecuted",t)),this._popAction()},lr.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,o=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=o&&o.id||this._createId()),n.push(t)},lr.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,o=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:b("id",o.reverse())}),o.length=0,this._fire("changed",{trigger:e}),t.trigger=null)},lr.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=r(t)?t:[t],e.dirty=e.dirty.concat(t))},lr.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)},lr.prototype._revertedAction=function(t){this._stackIdx--},lr.prototype._getHandler=function(t){return this._handlerMap[t]},lr.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};var hr={commandStack:["type",lr]};function dr(t){return R({original:t.point.original||t.point},t.actual)}function pr(t,e){this._elementRegistry=t,this._graphicsFactory=e}pr.$inject=["elementRegistry","graphicsFactory"],pr.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var o=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),r=t.waypoints.slice(o.idx+1,i.idx);return r.unshift(dr(o)),r.push(dr(i)),r},pr.prototype.getDockingPoint=function(t,e,n){var o,i,r=t.waypoints;return{point:i=r[o=n?0:r.length-1],actual:this._getIntersection(e,t,n)||i,idx:o}},pr.prototype._getIntersection=function(t,e,n){return Ko(this._getShapePath(t),this._getConnectionPath(e),n)},pr.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)},pr.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)},pr.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var fr={exports:{}},yr={};yr.extend=function(t,e,n,o){var i=n.inverse;return Object.defineProperty(t,"remove",{value:function(t){var n=this.indexOf(t);return-1!==n&&(this.splice(n,1),e.unset(t,i,o)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,n){var r=this.indexOf(t);if(void 0===n){if(-1!==r)return;n=this.length}-1!==r&&this.splice(r,1),this.splice(n,0,t),-1===r&&e.set(t,i,o)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},yr.isExtended=function(t){return!0===t.__refs_collection};var vr=yr;function gr(t,e,n){var o=vr.extend(n[e.name]||[],t,e,n);Object.defineProperty(n,e.name,{enumerable:e.enumerable,value:o}),o.length&&o.forEach((function(o){t.set(o,e.inverse,n)}))}function mr(t,e){if(!(this instanceof mr))return new mr(t,e);t.inverse=e,e.inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}mr.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}e.collection?gr(this,e,t):function(t,e,n){var o=e.inverse,i=n[e.name];Object.defineProperty(n,e.name,{configurable:e.configurable,enumerable:e.enumerable,get:function(){return i},set:function(e){if(e!==i){var r=i;i=null,r&&t.unset(r,o,n),i=e,t.set(i,o,n)}}})}(this,e,t)},mr.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return vr.isExtended(n)||gr(this,e,t),n},mr.prototype.ensureBound=function(t,e){(function(t,e){return Object.prototype.hasOwnProperty.call(t,e.name||e)})(t,e)||this.bind(t,e)},mr.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},mr.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var xr=mr;fr.exports=xr,fr.exports.Collection=yr;var _r=Un(fr.exports),wr=new _r({name:"children",enumerable:!0,collection:!0},{name:"parent"}),br=new _r({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),Er=new _r({name:"attachers",collection:!0},{name:"host"}),kr=new _r({name:"outgoing",collection:!0},{name:"source"}),Cr=new _r({name:"incoming",collection:!0},{name:"target"});function Sr(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),wr.bind(this,"parent"),br.bind(this,"labels"),kr.bind(this,"outgoing"),Cr.bind(this,"incoming")}function jr(){Sr.call(this),wr.bind(this,"children"),Er.bind(this,"host"),Er.bind(this,"attachers")}function Mr(){Sr.call(this),wr.bind(this,"children")}function Pr(){jr.call(this),br.bind(this,"labelTarget")}function Rr(){Sr.call(this),kr.bind(this,"source"),Cr.bind(this,"target")}wi(jr,Sr),wi(Mr,jr),wi(Pr,jr),wi(Rr,Sr);var Or={connection:Rr,shape:jr,label:Pr,root:Mr};function Br(){this._uid=12}Br.prototype.createRoot=function(t){return this.create("root",t)},Br.prototype.createLabel=function(t){return this.create("label",t)},Br.prototype.createShape=function(t){return this.create("shape",t)},Br.prototype.createConnection=function(t){return this.create("connection",t)},Br.prototype.create=function(t,e){return(e=R({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=Or[t];if(!n)throw new Error("unknown type: <"+t+">");return R(new n,e)}(t,e)};var Tr,zr={exports:{}},Ar={exports:{}};try{var Lr=require("util");if("function"!=typeof Lr.inherits)throw"";zr.exports=Lr.inherits}catch(wi){zr.exports=(Tr||(Tr=1,"function"==typeof Object.create?Ar.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Ar.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),Ar.exports)}var Dr=Un(zr.exports);function Ir(){Br.call(this)}function $r(){}Dr(Ir,Br),Ir.prototype.createEnumeration=function(t){var e={shapeType:"enumeration",businessObject:{}};return R(e,t),this.createShape(e)},Ir.prototype.createClass=function(t){var e={shapeType:"class",businessObject:{}};return R(e,t),this.createShape(e)},Ir.prototype.createUmlLabel=function(t){var e={shapeType:"label"};return R(e,t),this.createLabel(e)},Ir.prototype.createInheritance=function(t){var e={connectionType:"inheritance"};return R(e,t),this.createConnection(e)},Ir.prototype.createAssociation=function(t){var e={connectionType:"association"};return R(e,t),this.createConnection(e)},Ir.prototype.createAggregation=function(t){var e={connectionType:"aggregation"};return R(e,t),this.createConnection(e)},Ir.prototype.createComposition=function(t){var e={connectionType:"composition"};return R(e,t),this.createConnection(e)},Ir.prototype.createDependency=function(t){var e={connectionType:"dependency"};return R(e,t),this.createConnection(e)},Ir.prototype.createRealization=function(t){var e={connectionType:"realization"};return R(e,t),this.createConnection(e)},$r.prototype.layoutConnection=function(t,e){return[(e=e||{}).connectionStart||Uo(e.source||t.source),e.connectionEnd||Uo(e.target||t.target)]};var Nr=20,Hr=5,Vr=Math.round,Gr=20,Fr={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Wr(t,e,n){var o,i,r,a=Yo(e,t,Hr),c=n.split(":")[0],s=Vr((e.x-t.x)/2+t.x),u=Vr((e.y-t.y)/2+t.y),l=(r=a,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[c].test(r)),h=/h|r|l/.test(c),d=!1,p=!1;return l?(o=h?{x:s,y:t.y}:{x:t.x,y:u},i=h?"h:h":"v:v"):(d=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(a,c),i=h?"h:v":"v:h",d?h?(p=u===t.y,o={x:t.x+Nr*(/l/.test(c)?-1:1),y:p?u+Nr:u}):o={x:(p=s===t.x)?s+Nr:s,y:t.y+Nr*(/t/.test(c)?-1:1)}:o={x:s,y:u}),{waypoints:Ur(t,o,i).concat(o),directions:i,turnNextDirections:p}}function qr(t){return t.split(":").reverse().join(":")}function Ur(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(Qr(n)){var o=function(t,e,n){return Wr(t,e,n)}(t,e,n),i=function(t,e,n){var o=Wr(e,t,qr(n));return{waypoints:o.waypoints.slice().reverse(),directions:qr(o.directions),turnNextDirections:o.turnNextDirections}}(t,e,n),r=function(t,e){var n=t.directions.split(":")[1],o=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(o="h"==o?"v":"h");var i=n+":"+o;return{waypoints:Ur(t.waypoints[t.waypoints.length-1],e.waypoints[0],i),directions:i}}(o,i);return[].concat(o.waypoints,r.waypoints,i.waypoints)}return function(t,e,n){var o=Vr((e.x-t.x)/2+t.x),i=Vr((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:o,y:t.y},{x:o,y:e.y}];if("v:v"===n)return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function Yr(t,e,n){var o=Ur(t,e,n);return o.unshift(t),o.push(e),ea(o)}function Kr(t,e,n,o,i){var r=f(i&&i.preferredLayouts||[],"straight")[0]||"h:h",a=Yo(t,e,Fr[r]||0),c=function(t,e){if(Qr(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}(a,r);n=n||Uo(t),o=o||Uo(e);var s=c.split(":"),u=ta(n,t,s[0],function(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}(a));return Yr(u,ta(o,e,s[1],a),c)}function Xr(t,e,n,o,i,a){var c;return r(n)&&(i=n,a=o,n=Uo(t),o=Uo(e)),i=i||[],c=-1!==(a=R({preferredLayouts:[]},a)).preferredLayouts.indexOf("straight")&&function(t,e,n,o,i){var r,a,c={};if(a=Yo(t,e),!/^(top|bottom|left|right)$/.test(a))return null;/top|bottom/.test(a)&&(r="x");/left|right/.test(a)&&(r="y");return"target"===i.preserveDocking?Zr(r,o,t)?(c[r]=o[r],[{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y,original:{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y}},{x:o.x,y:o.y}]):null:Zr(r,n,e)?(c[r]=n[r],[{x:n.x,y:n.y},{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y,original:{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y}}]):null}(t,e,n,o,a),c||(c=a.connectionEnd&&function(t,e,n,o){var i=o.slice().reverse();return i=Jr(t,e,n,i),i?i.reverse():null}(e,t,o,i),c||((c=a.connectionStart&&Jr(t,e,n,i))||(!a.connectionStart&&!a.connectionEnd&&i&&i.length?i:Kr(t,e,n,o,a))))}function Zr(t,e,n){return function(t,e,n){return t>=e&&t<=n}(e[t],n[t],n[t]+n[{x:"width",y:"height"}[t]])}function Jr(t,e,n,o){if(function(t){return t.length<3||!(t.length>4)&&!!h(t,(function(e,n){var o=t[n-1];return o&&Nn(e,o)<3}))}(o))return null;var i,r=o[0],a=o.slice();return a[0]=n,a[1]=function(t,e,n){switch(Gn(e,t)){case"v":return{x:n.x,y:t.y};case"h":return{x:t.x,y:n.y}}return{x:t.x,y:t.y}}(a[1],r,n),i=function(t,e,n){var o;for(o=t.length-2;0!==o;o--)if(Wn(t[o],e,Gr)||Wn(t[o],n,Gr))return t.slice(o);return t}(a,t,e),i!==a&&(a=Jr(t,e,n,i)),a&&Gn(a)?null:a}function Qr(t){return t&&/t|r|b|l/.test(t)}function ta(t,e,n,o){if("h"===n&&(n=/left/.test(o)?"l":"r"),"v"===n&&(n=/top/.test(o)?"t":"b"),"t"===n)return{original:t,x:t.x,y:e.y};if("r"===n)return{original:t,x:e.x+e.width,y:t.y};if("b"===n)return{original:t,x:t.x,y:e.y+e.height};if("l"===n)return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function ea(t){return t.reduce((function(e,n,o){return Hn(e[e.length-1],t[o+1],n,0)||e.push(n),e}),[])}function na(){}function oa(t){return a(t)&&l(t,"children")&&!We(t)}function ia(t,e,n){Si.call(this,t),this.executed(["connection.layout","connection.create","connection.reconnectEnd","connection.reconnectStart"],(function(t){var n,o=t.context;o.cropped||((n=o.connection).waypoints=e.getCroppedWaypoints(n),o.cropped=!0)})),this.postExecuted(["connection.layout","connection.reconnectEnd","connection.reconnectStart","connection.updateWaypoints","connection.move"],(function(t){n.execute("layout.connection.labels",t.context)})),this.reverted(["connection.layout"],(function(t){delete t.context.cropped})),t.on("element.hover",1500,(function(t){if(qe(t.element)&&"classifier"===t.element.labelType)return!1}));t.on(["element.click","element.mousedown","element.mouseup","element.contextmenu","element.dblclick"],1500,(function(e){qe(e.element)&&"classifier"===e.element.labelType&&(e.stopPropagation(),t.fire(e.type,{element:e.element.parent,originalEvent:e.originalEvent,srcEvent:e.srcEvent}))}))}function ra(t,e){this._modeling=t,this._textRenderer=e}function aa(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function ca(t,e,n){var o=function(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}(t,e);return aa(t,e,n/o)}function sa(t){this._modeling=t}function ua(t,e,n,o,i){this._eventBus=t,this._graphicsFactory=o,this._selection=n,this._layouter=i,this._elementRegistry=e}function la(t,e){this._modeling=t,this._canvas=e}function ha(t){this._modeling=t}function da(t,e){this._canvas=t,this._layouter=e}Dr(na,$r),na.prototype.layoutConnection=function(t,e){e=e||{};var n=t.source,o=t.target,i=t.waypoints,r=e.connectionStart,a=e.connectionEnd,c=e;return R(c,{preferredLayouts:["v:v"]}),ea(Xr(n,o,r,a,i,c))},Dr(ia,Si),ia.$inject=["eventBus","connectionDocking","commandStack"],ra.$inject=["modeling","textRenderer"],ra.prototype.postExecute=function(t){var e=t.newLabel,n=t.element,o=this._textRenderer.getDimensions(e,{});"class"==n.type?n.businessObject.name=e:(n.businessObject=e,n.width=o.width,n.height=o.height),this._modeling.resizeShape(n,{x:n.x,y:n.y,width:Math.max(n.width,10),height:Math.max(n.height,10)})},sa.$inject=["modeling"],sa.prototype.preExecute=function(t){var e,n=this._modeling;function o(t,e,n){t.moveShape(e,{x:n.x-e.x,y:n.y-e.y})}function i(t,e,n){"left"===t?e.x-=n.width:"top"===t&&(e.y-=n.height)}function r(t,e,n){"left"===t?e.x-=5:"right"===t?e.x+=n.width+5:"top"===t?e.y-=5:"bottom"===t&&(e.y+=n.height+5)}function a(t,e,n,o){var i=ca(t,e,function(t){return t?15:5}(o));return!function(t){return"right"===t||"left"===t}(n)?i.x+=5:i.y+=5,i}function c(t,e){var n=t.connectionType;return"source"===e?"aggregation"===n||"composition"===n:"association"===n||"inheritance"===n}function s(t,e){return t.y===e.y?function(t,e){return t.x<e.x?"right":"left"}(t,e):function(t,e){return t.y<e.y?"bottom":"top"}(t,e)}e=t.connection,function(t,e){for(var n=function(t){var e=t.labels.filter((function(t){return"sourceCard"===t.labelType||"sourceName"===t.labelType}));return e.sort((function(t,e){return t.labelType.localeCompare(e.labelType)}))}(e),u=c(e,"source"),l=e.waypoints[0],h=e.waypoints[1],d=s(l,h),p=a(l,h,d,u),f=0;f<n.length;f++){var y=n[f];i(d,p,y),o(t,y,p),r(d,p,y)}}(n,e),function(t,e){for(var n=function(t){var e=t.labels.filter((function(t){return"targetCard"===t.labelType||"targetName"===t.labelType}));return e.sort((function(t,e){return t.labelType.localeCompare(e.labelType)}))}(e),u=c(e,"target"),l=e.waypoints[e.waypoints.length-1],h=e.waypoints[e.waypoints.length-2],d=s(l,h),p=a(l,h,d,u),f=0;f<n.length;f++){var y=n[f];i(d,p,y),o(t,y,p),r(d,p,y)}}(n,e)},ua.$inject=["eventBus","elementRegistry","selection","graphicsFactory","layouter"],ua.prototype.execute=function(t){var e=t.element,n=t.visibility;this.visibilityContext={elements:[],visibility:n},n&&this.showHiddenParents(e),this.setVisibility(e,n),We(e)&&n&&(this._setVisibility(e.source,!0),this.updateGraphics(e.source,!0),this._setVisibility(e.target,!0),this.updateGraphics(e.target,!0)),this.visibilityContext.elements.forEach((t=>{t.hidden&&this._selection.deselect(t)})),this._eventBus.fire("elements.visibility",this.visibilityContext)},ua.prototype.showHiddenParents=function(t){var e=t.parent;e.isVisible||(We(e)&&(this._setVisibility(e.source,!0),this.updateGraphics(e.source,!0),this._setVisibility(e.target,!0),this.updateGraphics(e.target,!0)),this._setVisibility(e,!0),this.updateGraphics(e,!0))},ua.prototype.setVisibility=function(t,e){this._setVisibility(t,e),t.hidden=!e&&!this._layouter.showHiddenElements,oa(t)?qe(t)?this.setLabelVisibility(t,e):this.setShapeVisibility(t,e):this.setConnectionVisibility(t,e)},ua.prototype._setVisibility=function(t,e){t.isVisible!==e&&(this.visibilityContext.elements.includes(t)||this.visibilityContext.elements.push(t),t.isVisible=e)},ua.prototype.setLabelVisibility=function(t,e){this.setChildrenVisibility(t,e),this.updateGraphics(t,!1)},ua.prototype.setConnectionVisibility=function(t,e){this.setChildrenVisibility(t,e),this.updateGraphics(t,!1)},ua.prototype.setShapeVisibility=function(t,e){this.setAttachedEdgesVisibility(t,e),this.setChildrenVisibility(t,e),this.updateGraphics(t,!1)},ua.prototype.setAttachedEdgesVisibility=function(t,e){this.setIncomingAttachedEdgesVisibility(t,e),this.setOutgoingAttachedEdgesVisibility(t,e)},ua.prototype.setIncomingAttachedEdgesVisibility=function(t,e){var n=this;"incoming"in t&&t.incoming.forEach((function(t){e?t.source.isVisible&&n.setVisibility(t,e):n.setVisibility(t,e)}))},ua.prototype.setOutgoingAttachedEdgesVisibility=function(t,e){var n=this;"outgoing"in t&&t.outgoing.forEach((function(t){e?t.target.isVisible&&n.setVisibility(t,e):n.setVisibility(t,e)}))},ua.prototype.setChildrenVisibility=function(t,e){var n=this;"children"in t&&t.children.forEach((function(t){n.setVisibility(t,e)}))},ua.prototype.updateGraphics=function(t,e){We(t)?this.updateGfx(t,"connection"):this.updateGfx(t,"shape"),e&&this.updateGraphicChildren(t)},ua.prototype.updateGraphicChildren=function(t){var e=this;"children"in t&&t.children.forEach((function(t){e.updateGraphics(t,!1)}))},ua.prototype.updateGfx=function(t,e){var n=this._elementRegistry.getGraphics(t,!1);this._graphicsFactory.update(e,t,n)},la.$inject=["modeling","canvas"],la.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,o=t.alignment;p(n,(function(t){var n={x:0,y:0};i(o.left)?n.x=o.left-t.x:i(o.right)?n.x=o.right-t.width-t.x:i(o.center)?n.x=o.center-Math.round(t.width/2)-t.x:i(o.top)?n.y=o.top-t.y:i(o.bottom)?n.y=o.bottom-t.height-t.y:i(o.middle)&&(n.y=o.middle-Math.round(t.height/2)-t.y),e.moveElements([t],n,t.parent)}))},la.prototype.postExecute=function(t){},ha.$inject=["modeling"],ha.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,o=t.shape,i=t.hints||{};o=t.shape=this._modeling.createShape(o,t.position,n,{attach:i.attach}),t.shape=o},ha.prototype.postExecute=function(t){var e,n,o=t.hints||{};e=t.source,n=t.shape,g(e.outgoing,(function(t){return t.target===n}))||(o.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))},da.$inject=["canvas","layouter"],da.prototype.execute=function(t){var e=t.connection,n=t.source,o=t.target,i=t.parent,r=t.parentIndex,a=t.hints;if(!n||!o)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=o,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,i,r),e},da.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var pa=Math.round;function fa(t){this._modeling=t}fa.$inject=["modeling"],fa.prototype.preExecute=function(t){var e=t.elements,n=t.parent,o=t.parentIndex,i=t.position,r=t.hints,a=this._modeling;p(e,(function(t){c(t.x)||(t.x=0),c(t.y)||(t.y=0)}));var s=se(d(e,(function(t){return!t.hidden})));p(e,(function(t){We(t)&&(t.waypoints=m(t.waypoints,(function(t){return{x:pa(t.x-s.x-s.width/2+i.x),y:pa(t.y-s.y-s.height/2+i.y)}}))),R(t,{x:pa(t.x-s.x-s.width/2+i.x),y:pa(t.y-s.y-s.height/2+i.y)})}));var u=oe(e),l={};p(e,(function(t){if(We(t))l[t.id]=c(o)?a.createConnection(l[t.source.id],l[t.target.id],o,t,t.parent||n,r):a.createConnection(l[t.source.id],l[t.target.id],t,t.parent||n,r);else{var e=R({},r);-1===u.indexOf(t)&&(e.autoResize=!1),qe(t)&&(e=function(t,e){let n={};return p(Object(t),(function(t,o){-1===e.indexOf(o)&&(n[o]=t)})),n}(e,["attach"])),l[t.id]=c(o)?a.createShape(t,O(t,["x","y","width","height"]),t.parent||n,o,e):a.createShape(t,O(t,["x","y","width","height"]),t.parent||n,e)}})),t.elements=_(l)};var ya=Math.round;function va(t){this._canvas=t}function ga(t){va.call(this,t)}va.$inject=["canvas"],va.prototype.execute=function(t){var e=t.shape,n=t.position,o=t.parent,i=t.parentIndex;if(!o)throw new Error("parent required");if(!n)throw new Error("position required");return void 0!==n.width?R(e,n):R(e,{x:n.x-ya(e.width/2),y:n.y-ya(e.height/2)}),this._canvas.addShape(e,o,i),e},va.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e},wi(ga,va),ga.$inject=["canvas"];var ma=va.prototype.execute;ga.prototype.execute=function(t){var e=t.shape;return function(t){["width","height"].forEach((function(e){void 0===t[e]&&(t[e]=0)}))}(e),e.labelTarget=t.labelTarget,ma.call(this,t)};var xa=va.prototype.revert;function _a(t,e){this._canvas=t,this._modeling=e}function wa(t,e){this._modeling=t,this._elementRegistry=e}function ba(t,e){this._canvas=t,this._modeling=e}function Ea(t){this._modeling=t}ga.prototype.revert=function(t){return t.shape.labelTarget=null,xa.call(this,t)},_a.$inject=["canvas","modeling"],_a.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;Ci(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),Ci(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})}))},_a.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=ki(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e},_a.prototype.revert=function(t){var e=t.connection,n=t.parent,o=t.parentIndex;return e.source=t.source,e.target=t.target,Ei(n.children,e,o),this._canvas.addConnection(e,n),e},wa.$inject=["modeling","elementRegistry"],wa.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry;p(t.elements,(function(t){n.get(t.id)&&(t.waypoints?e.removeConnection(t):e.removeShape(t))}))},ba.$inject=["canvas","modeling"],ba.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;Ci(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),Ci(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})})),Ci(n.children,(function(t){We(t)?e.removeConnection(t,{nested:!0}):e.removeShape(t,{nested:!0})}))},ba.prototype.execute=function(t){var e=this._canvas,n=t.shape,o=n.parent;return t.oldParent=o,t.oldParentIndex=ki(o.children,n),e.removeShape(n),n},ba.prototype.revert=function(t){var e=this._canvas,n=t.shape,o=t.oldParent,i=t.oldParentIndex;return Ei(o.children,n,i),e.addShape(n,o),n},Ea.$inject=["modeling"];var ka={x:"y",y:"x"};function Ca(t,e){this._layouter=t,this._canvas=e}function Sa(){}function ja(t,e,n){var o=Re(e),i=Re(n),r=Oe(t,o),a=r.x*(n.width/e.width),c=r.y*(n.height/e.height);return Go({x:i.x+a,y:i.y+c})}function Ma(t,e,n){var o=Ta(t),i=za(o,e),r=o[0];return i.length?i[i.length-1]:ja(r.original||r,n,e)}function Pa(t,e,n){var o=Ta(t),i=za(o,e),r=o[o.length-1];return i.length?i[0]:ja(r.original||r,n,e)}function Ra(t,e,n){var o=Ta(t),i=Ba(e,n),r=o[0];return ja(r.original||r,i,e)}function Oa(t,e,n){var o=Ta(t),i=Ba(e,n),r=o[o.length-1];return ja(r.original||r,i,e)}function Ba(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function Ta(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function za(t,e){return d(m(t,Aa),(function(t){return function(t,e){return"intersect"===Yo(e,t,1)}(t,e)}))}function Aa(t){return t.original||t}function La(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function Da(t){this._modeling=t}function Ia(t){this._helper=new Da(t)}function $a(t){this._modeling=t,this._helper=new Da(t)}function Na(t){this._modeling=t}function Ha(t){return t.original||t}function Va(t,e){this._modeling=t,this._rules=e}function Ga(t){this._modeling=t}function Fa(t,e){return-1!==t.indexOf(e)}function Wa(t){this._modeling=t}function qa(t){return R({},t)}function Ua(t){switch(t){case"n":case"s":return"y";case"w":case"e":return"x"}}function Ya(t,e,n){var o=Ua(n);return/e|s/.test(n)?t[o]>e:/n|w/.test(n)?t[o]<e:void 0}function Ka(t,e){return-1!==t.indexOf(e)}function Xa(t){this._modeling=t}function Za(t){var e={};return p(t,(function(t){e[t.id]=t.hidden,t.children&&(e=R({},e,Za(t.children)))})),e}function Ja(t,e){var n=[];return p(t,(function(t){t.hidden=e,n=n.concat(t),t.children&&(n=n.concat(Ja(t.children,t.collapsed||e)))})),n}function Qa(t,e){var n=[];return p(t,(function(t){t.hidden=e[t.id],n=n.concat(t),t.children&&(n=n.concat(Qa(t.children,e)))})),n}function tc(t){this._modeling=t}function ec(t,e){return bi(t&&t.attachers,e)}function nc(t,e,n){if(t){var o=t.attachers;o||(t.attachers=o=[]),Ei(o,e,n)}}function oc(){}function ic(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var o=this;t.on("diagram.init",(function(){o.registerHandlers(n)}))}function rc(t,e,n,o,i,r,a,c,s){this.canvas=r,this._textRenderer=i,this._graphicsFactory=c,this._elementRegistry=n,this._selection=a,this._layouter=s,ic.call(this,t,e,o)}Ea.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,o=t.axis,i=t.dimension;function r(t,e){t.range.min=Math.min(e[o],t.range.min),t.range.max=Math.max(e[o]+e[i],t.range.max)}function a(t){return t[o]+t[i]/2}function c(t){return t.length-1}function s(t){return t.max-t.min}var u,l,h=n[0],d=c(n),f=n[d],y=0;p(n,(function(t,u){var l,h,f;t.elements.length<2?u&&u!==n.length-1&&(r(t,t.elements[0]),y+=s(t.range)):(h=(l=E(t.elements,o))[0],u===d&&(h=l[c(l)]),f=a(h),t.range=null,p(l,(function(n){!function(t,n){var i={y:0};i[o]=t-a(n),i[o]&&(i[ka[o]]=0,e.moveElements([n],i,n.parent))}(f,n),null!==t.range?r(t,n):t.range={min:n[o],max:n[o]+n[i]}})),u&&u!==n.length-1&&(y+=s(t.range)))})),l=Math.abs(f.range.min-h.range.max),(u=Math.round((l-y)/(n.length-1)))<n.length-1||p(n,(function(t,r){var a,c={};t!==h&&t!==f&&(a=n[r-1],t.range.max=0,p(t.elements,(function(n,r){c[ka[o]]=0,c[o]=a.range.max-n[o]+u,t.range.min!==n[o]&&(c[o]+=n[o]-t.range.min),c[o]&&e.moveElements([n],c,n.parent),t.range.max=Math.max(n[o]+n[i],r?t.range.max:0)})))}))},Ea.prototype.postExecute=function(t){},Ca.$inject=["layouter","canvas"],Ca.prototype.execute=function(t){var e=t.connection;return R(t,{oldWaypoints:e.waypoints}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e},Ca.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e},Sa.prototype.execute=function(t){var e=t.connection,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldParent=r,t.oldParentIndex=bi(r.children,e),Ei(o.children,e,i),e.parent=o,p(e.waypoints,(function(t){t.x+=n.x,t.y+=n.y,t.original&&(t.original.x+=n.x,t.original.y+=n.y)})),e},Sa.prototype.revert=function(t){var e=t.connection,n=e.parent,o=t.oldParent,i=t.oldParentIndex,r=t.delta;return bi(n.children,e),Ei(o.children,e,i),e.parent=o,p(e.waypoints,(function(t){t.x-=r.x,t.y-=r.y,t.original&&(t.original.x-=r.x,t.original.y-=r.y)})),e},La.prototype.add=function(t,e){return this.addAll([t],e)},La.prototype.addAll=function(t,e){var n=function(t,e,n){o(e)&&(e=!0),a(e)&&(n=e,e=!0);var i=he((n=n||{}).allShapes),r=he(n.allConnections),c=he(n.enclosedElements),s=he(n.enclosedConnections),u=he(n.topLevel,e&&w(t,(function(t){return t.id})));function l(t){u[t.source.id]&&u[t.target.id]&&(u[t.id]=[t]),i[t.source.id]&&i[t.target.id]&&(s[t.id]=c[t.id]=t),r[t.id]=t}return ae(t,(function(t){if(c[t.id]=t,!t.waypoints)return i[t.id]=t,p(t.incoming,l),p(t.outgoing,l),t.children;s[t.id]=r[t.id]=t})),{allShapes:i,allConnections:r,topLevel:u,enclosedConnections:s,enclosedElements:c}}(t,!!e,this);return R(this,n),this},Da.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]},Da.prototype.moveClosure=function(t,e,n,o,i){var r=this._modeling,a=t.allShapes,c=t.allConnections,s=t.enclosedConnections,u=t.topLevel,l=!1;i&&i.parent===n&&(l=!0),p(a,(function(t){r.moveShape(t,e,u[t.id]&&!l&&n,{recurse:!1,layout:!1})})),p(c,(function(t){var o=!!a[t.source.id],i=!!a[t.target.id];s[t.id]&&o&&i?r.moveConnection(t,e,u[t.id]&&!l&&n):r.layoutConnection(t,{connectionStart:o&&Ra(t,t.source,e),connectionEnd:i&&Oa(t,t.target,e)})}))},Da.prototype.getClosure=function(t){return(new La).addAll(t,!0)},Ia.$inject=["modeling"],Ia.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)},Ia.prototype.postExecute=function(t){var e,n=t.hints;n&&n.primaryShape&&(e=n.primaryShape,n.oldParent=e.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,e)},$a.$inject=["modeling"],$a.prototype.execute=function(t){var e=t.shape,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldBounds=O(e,["x","y","width","height"]),t.oldParent=r,t.oldParentIndex=bi(r.children,e),Ei(o.children,e,i),R(e,{parent:o,x:e.x+n.x,y:e.y+n.y}),e},$a.prototype.postExecute=function(t){var e=t.shape,n=t.delta,o=t.hints,i=this._modeling;!1!==o.layout&&(p(e.incoming,(function(t){i.layoutConnection(t,{connectionEnd:Oa(t,e,n)})})),p(e.outgoing,(function(t){i.layoutConnection(t,{connectionStart:Ra(t,e,n)})}))),!1!==o.recurse&&this.moveChildren(t)},$a.prototype.revert=function(t){var e=t.shape,n=t.oldParent,o=t.oldParentIndex,i=t.delta;return Ei(n.children,e,o),R(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e},$a.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)},$a.prototype.getNewParent=function(t){return t.newParent||t.shape.parent},Na.$inject=["modeling"],Na.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,o=t.connection,i=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return r(i)&&(t.oldWaypoints=o.waypoints,o.waypoints=i),e&&(t.oldSource=o.source,o.source=e),n&&(t.oldTarget=o.target,o.target=n),o},Na.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,o=t.newTarget,i=t.dockingOrPoints,a=t.hints||{},c={};a.connectionStart&&(c.connectionStart=a.connectionStart),a.connectionEnd&&(c.connectionEnd=a.connectionEnd),!1!==a.layoutConnection&&(!n||o&&"source"!==a.docking||(c.connectionStart=c.connectionStart||Ha(r(i)?i[0]:i)),!o||n&&"target"!==a.docking||(c.connectionEnd=c.connectionEnd||Ha(r(i)?i[i.length-1]:i)),a.newWaypoints&&(c.waypoints=a.newWaypoints),this._modeling.layoutConnection(e,c))},Na.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,o=t.oldWaypoints,i=t.connection;return e&&(i.source=e),n&&(i.target=n),o&&(i.waypoints=o),i},Va.$inject=["modeling","rules"],Va.prototype.preExecute=function(t){var e,n=this,o=this._modeling,i=this._rules,r=t.oldShape,a=t.newData,c=t.hints||{};function s(t,e,n){return i.allowed("connection.reconnect",{connection:n,source:t,target:e})}var u,l={x:a.x,y:a.y},h={x:r.x,y:r.y,width:r.width,height:r.height};e=t.newShape=t.newShape||n.createShape(a,l,r.parent,c),r.host&&o.updateAttachment(e,r.host),!1!==c.moveChildren&&(u=r.children.slice(),o.moveElements(u,{x:0,y:0},e,c));var d=r.incoming.slice(),f=r.outgoing.slice();p(d,(function(t){s(t.source,e,t)&&n.reconnectEnd(t,e,Pa(t,e,h),c)})),p(f,(function(t){var o=t.target;s(e,o,t)&&n.reconnectStart(t,e,Ma(t,e,h),c)}))},Va.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)},Va.prototype.execute=function(t){},Va.prototype.revert=function(t){},Va.prototype.createShape=function(t,e,n,o){return this._modeling.createShape(t,e,n,o)},Va.prototype.reconnectStart=function(t,e,n,o){this._modeling.reconnectStart(t,e,n,o)},Va.prototype.reconnectEnd=function(t,e,n,o){this._modeling.reconnectEnd(t,e,n,o)},Ga.$inject=["modeling"],Ga.prototype.execute=function(t){var e=t.shape,n=t.newBounds,o=t.minBounds;if(void 0===n.x||void 0===n.y||void 0===n.width||void 0===n.height)throw new Error("newBounds must have {x, y, width, height} properties");if(o&&(n.width<o.width||n.height<o.height))throw new Error("width and height cannot be less than minimum height and width");if(!o&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},R(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Ga.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,o=t.oldBounds;!1!==(t.hints||{}).layout&&(p(n.incoming,(function(t){e.layoutConnection(t,{connectionEnd:Pa(t,n,o)})})),p(n.outgoing,(function(t){e.layoutConnection(t,{connectionStart:Ma(t,n,o)})})))},Ga.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return R(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Wa.$inject=["modeling"],Wa.prototype.preExecute=function(t){var e=t.delta,n=t.direction,o=t.movingShapes,i=t.resizingShapes,r=t.start,a={};this.moveShapes(o,e),p(i,(function(t){a[t.id]=function(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}(t)})),this.resizeShapes(i,e,n),this.updateConnectionWaypoints(function(t,e){var n=[];return p(t.concat(e),(function(o){var i=o.incoming,r=o.outgoing;p(i.concat(r),(function(o){var i=o.source,r=o.target;(Fa(t,i)||Fa(t,r)||Fa(e,i)||Fa(e,r))&&(Fa(n,o)||n.push(o))}))})),n}(o,i),e,n,r,o,i,a)},Wa.prototype.execute=function(){},Wa.prototype.revert=function(){},Wa.prototype.moveShapes=function(t,e){var n=this;p(t,(function(t){n._modeling.moveShape(t,e,null,{autoResize:!1,layout:!1,recurse:!1})}))},Wa.prototype.resizeShapes=function(t,e,n){var o=this;p(t,(function(t){var i=function(t,e,n){var o=t.x,i=t.y,r=t.width,a=t.height,c=n.x,s=n.y;switch(e){case"n":return{x:o,y:i+s,width:r,height:a-s};case"s":return{x:o,y:i,width:r,height:a+s};case"w":return{x:o+c,y:i,width:r-c,height:a};case"e":return{x:o,y:i,width:r+c,height:a};default:throw new Error("unknown direction: "+e)}}(t,n,e);o._modeling.resizeShape(t,i,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},Wa.prototype.updateConnectionWaypoints=function(t,e,n,o,i,r,a){var c=this,s=i.concat(r);p(t,(function(t){var u=t.source,l=t.target,h=function(t){return m(t.waypoints,(function(t){return(t=qa(t)).original&&(t.original=qa(t.original)),t}))}(t),d=Ua(n),p={};Ka(s,u)&&Ka(s,l)?(h=m(h,(function(t){return Ya(t,o,n)&&(t[d]=t[d]+e[d]),t.original&&Ya(t.original,o,n)&&(t.original[d]=t.original[d]+e[d]),t})),c._modeling.updateWaypoints(t,h,{labelBehavior:!1})):(Ka(s,u)||Ka(s,l))&&(Ka(i,u)?p.connectionStart=Ra(t,u,e):Ka(i,l)?p.connectionEnd=Oa(t,l,e):Ka(r,u)?p.connectionStart=Ma(t,u,a[u.id]):Ka(r,l)&&(p.connectionEnd=Pa(t,l,a[l.id])),c._modeling.layoutConnection(t,p))}))},Xa.$inject=["modeling"],Xa.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=Za(n),e.collapsed=!e.collapsed;var o=Ja(n,e.collapsed);return[e].concat(o)},Xa.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,o=Qa(e.children,n);return e.collapsed=!e.collapsed,[e].concat(o)},tc.$inject=["modeling"],tc.prototype.execute=function(t){var e=t.shape,n=t.newHost,o=e.host;return t.oldHost=o,t.attacherIdx=ec(o,e),nc(n,e),e.host=n,e},tc.prototype.revert=function(t){var e=t.shape,n=t.newHost,o=t.oldHost,i=t.attacherIdx;return e.host=o,ec(n,e),nc(o,e,i),e},oc.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e},oc.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e},ic.$inject=["eventBus","elementFactory","commandStack"],ic.prototype.getHandlers=function(){return{"shape.append":ha,"shape.create":va,"shape.delete":ba,"shape.move":$a,"shape.resize":Ga,"shape.replace":Va,"shape.toggleCollapse":Xa,spaceTool:Wa,"label.create":ga,"connection.create":da,"connection.delete":_a,"connection.move":Sa,"connection.layout":Ca,"connection.updateWaypoints":oc,"connection.reconnect":Na,"elements.create":fa,"elements.move":Ia,"elements.delete":wa,"elements.distribute":Ea,"elements.align":la,"element.updateAttachment":tc}},ic.prototype.registerHandlers=function(t){p(this.getHandlers(),(function(e,n){t.registerHandler(n,e)}))},ic.prototype.moveShape=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=null);var r={shape:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("shape.move",r)},ic.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)},ic.prototype.moveElements=function(t,e,n,o){var i,r=(o=o||{}).attach,a=n;!0===r?(i=n,a=n.parent):!1===r&&(i=null);var c={shapes:t,delta:e,newParent:a,newHost:i,hints:o};this._commandStack.execute("elements.move",c)},ic.prototype.moveConnection=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=void 0);var r={connection:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("connection.move",r)},ic.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)},ic.prototype.createConnection=function(t,e,n,o,i,r){"object"==typeof n&&(r=i,i=o,o=n,n=void 0);var a={source:t,target:e,parent:i,parentIndex:n,connection:o=this._create("connection",o),hints:r};return this._commandStack.execute("connection.create",a),a.connection},ic.prototype.createShape=function(t,e,n,o,i){"number"!=typeof o&&(i=o,o=void 0);var r,a,c=(i=i||{}).attach;t=this._create("shape",t),c?(r=n.parent,a=n):r=n;var s={position:e,shape:t,parent:r,parentIndex:o,host:a,hints:i};return this._commandStack.execute("shape.create",s),s.shape},ic.prototype.createElements=function(t,e,n,o,i){r(t)||(t=[t]),"number"!=typeof o&&(i=o,o=void 0);var a={position:e,elements:t,parent:n,parentIndex:o,hints:i=i||{}};return this._commandStack.execute("elements.create",a),a.elements},ic.prototype.createLabel=function(t,e,n,o){n=this._create("label",n);var i={labelTarget:t,position:e,parent:o||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape},ic.prototype.appendShape=function(t,e,n,o,i){i=i||{};var r={source:t,position:n,target:o,shape:e=this._create("shape",e),connection:i.connection,connectionParent:i.connectionParent,hints:i};return this._commandStack.execute("shape.append",r),r.shape},ic.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)},ic.prototype.distributeElements=function(t,e,n){var o={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",o)},ic.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)},ic.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)},ic.prototype.replaceShape=function(t,e,n){var o={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",o),o.newShape},ic.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)},ic.prototype.resizeShape=function(t,e,n,o){var i={shape:t,newBounds:e,minBounds:n,hints:o};this._commandStack.execute("shape.resize",i)},ic.prototype.createSpace=function(t,e,n,o,i){var r={delta:n,direction:o,movingShapes:t,resizingShapes:e,start:i};this._commandStack.execute("spaceTool",r)},ic.prototype.updateWaypoints=function(t,e,n){var o={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",o)},ic.prototype.reconnect=function(t,e,n,o,i){var r={connection:t,newSource:e,newTarget:n,dockingOrPoints:o,hints:i||{}};this._commandStack.execute("connection.reconnect",r)},ic.prototype.reconnectStart=function(t,e,n,o){o||(o={}),this.reconnect(t,e,t.target,n,R(o,{docking:"source"}))},ic.prototype.reconnectEnd=function(t,e,n,o){o||(o={}),this.reconnect(t,t.source,e,n,R(o,{docking:"target"}))},ic.prototype.connect=function(t,e,n,o){return this.createConnection(t,e,n||{},t.parent,o)},ic.prototype._create=function(t,e){return e instanceof Sr?e:this._elementFactory.create(t,e)},ic.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)},Dr(rc,ic),rc.$inject=["eventBus","elementFactory","elementRegistry","commandStack","textRenderer","canvas","selection","graphicsFactory","layouter"],rc.prototype.getHandlers=function(){var t=ic.prototype.getHandlers.call(this);return t["element.updateLabel"]=ra,t["layout.connection.labels"]=sa,t["element.visibility"]=ua,t},rc.prototype.updateLabel=function(t,e){this._commandStack.execute("element.updateLabel",{element:t,newLabel:e})},rc.prototype.connect=function(t,e,n,o,i){return this.createConnection(t,e,R({connectionType:n},o),t.parent)},rc.prototype.setVisibility=function(t,e){this._commandStack.execute("element.visibility",{element:t,visibility:e})};var ac={__init__:["umlUpdater","modeling"],__depends__:[hr],connectionDocking:["type",pr],elementFactory:["type",Ir],modeling:["type",rc],umlUpdater:["type",ia],layouter:["type",na]},cc="drop-ok",sc="drop-not-ok",uc="attach-ok",lc="new-parent",hc="create";function dc(t,e,n,o,i){function a(e,n){[uc,cc,sc,lc].forEach((function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)}))}function s(){var t=e.context();t&&t.prefix===hc&&e.cancel()}n.on(["create.move","create.hover"],(function(t){var e=t.context;e.elements;var n=t.hover;if(e.source,e.hints,!n)return e.canExecute=!1,void(e.target=null);!function(t){var e=t.context,n=e.createConstraints;if(!n)return;n.left&&(t.x=Math.max(t.x,n.left));n.right&&(t.x=Math.min(t.x,n.right));n.top&&(t.y=Math.max(t.y,n.top));n.bottom&&(t.y=Math.min(t.y,n.bottom))}(t),t.x,t.y;var o=e.canExecute=n;n&&null!==o&&(e.target=n,o&&o.attach?a(n,uc):a(n,o?lc:sc))})),n.on(["create.end","create.out","create.cleanup"],(function(t){var e=t.hover;e&&a(e,null)})),n.on("create.ended",(function(t){n.fire("create."+t.context.type,{context:{bounds:{x:t.x,y:t.y,width:t.shape.width,height:t.shape.height}}})})),n.on("create.end",(function(t){return!0})),n.on("create.init",(function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],2e3,(function(){n.off("elements.changed",s)}))})),this.start=function(t,n,o){r(n)||(n=[n]);var i=h(n,(function(t){return!We(t)}));if(i){o=R({elements:n,hints:{},shape:i},o||{}),p(n,(function(t){c(t.x)||(t.x=0),c(t.y)||(t.y=0)}));var a=se(d(n,(function(t){return!t.hidden})));p(n,(function(t){We(t)&&(t.waypoints=m(t.waypoints,(function(t){return{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2}}))),R(t,{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2})})),e.init(t,hc,{cursor:"grabbing",autoActivate:!0,data:{shape:i,elements:n,context:o}})}}}dc.$inject=["canvas","dragging","eventBus","modeling","rules"];var pc={__depends__:[Le],create:["type",dc]};function fc(t,e,n,o,i,r){this._create=t,this._elementFactory=e,this._lassoTool=n,this._palette=o,this._textRenderer=i,this._eventBus=r,o.registerProvider(this)}fc.$inject=["create","elementFactory","lassoTool","palette","textRenderer","eventBus"],fc.prototype.getPaletteEntries=function(){var t=this._create,e=this._elementFactory,n=this._lassoTool;function o(n,o,i,r){function a(o){var i=e.createClass({width:200,height:100,name:"Name"}),r={type:n};t.start(o,i,r)}return{group:o,className:i,title:r,action:{dragstart:a,click:a}}}return this._textRenderer,this._eventBus,{"lasso-tool":{group:"tools",className:"palette-icon-lasso-tool",title:"Activate Lasso Tool",action:{click:function(t){n.activateSelection(t)}}},"tool-separator":{group:"tools",separator:!0},"create-class":o("class","create","palette-icon-create-class","Create Class"),"create-enumeration":o("enumeration","create","palette-icon-create-enumeration","Create Enumeration")}};var yc={__depends__:[pc,mn,sn],__init__:["paletteProvider"],paletteProvider:["type",fc]},vc={__depends__:[hr,Bi,_e,be],__init__:["modeling"],modeling:["type",ic],layouter:["type",$r]};function gc(t,e,n,o){this._connect=t,this._modeling=n,this._eventBus=o,this._contextPad=e,e.registerProvider(this)}gc.$inject=["connect","contextPad","modeling","eventBus"],gc.prototype.getContextPadEntries=function(t){var e=this._modeling,n=this._connect,o=this._eventBus,i=this._contextPad;function r(t,e){o.fire("delete.element",{context:{element:e}})}function a(t,e,o){n.start(t,e,o)}function c(t,e){R(t,{context:{shape:e}}),o.fire("create.class.property",t)}function s(t,e){return{group:"add",className:"context-pad-icon-"+t,title:e,action:{click:function(e,n){a(e,n,t)},dragstart:function(e,n){a(e,n,t)}}}}var u={delete:{group:"admin",className:"context-pad-icon-delete",title:"Remove",action:{click:r,dragstart:r}},visibility:function(t){return t.isVisible?{group:"admin",className:"context-pad-icon-hide",title:"Hide Part",action:{click:function(t,n){i.close(),e.setVisibility(n,!1)}}}:{group:"admin",className:"context-pad-icon-show",title:"Show Part",action:{click:function(t,n){i.close(),e.setVisibility(n,!0)}}}}(t)};return oa(t)&&!qe(t)&&("stereotypes"in t&&-1!=t.stereotypes.indexOf("enumeration")||R(u,{"inheritance-connection":s("inheritance","Inheritance Connection"),"composition-connection":s("composition","Composition Connection"),"association-connection":s("association","Association Connection"),"create-property":{group:"add",className:"context-pad-icon-create-property",title:"Create Property",action:{click:c}}}),t.isImported&&R(u,{goto:{group:"admin",className:"context-pad-icon-goto",title:"Go to",action:{click:function(t,e){o.fire("element.goto",{context:{element:e}})}}}})),u};var mc={__depends__:[$n,cr,vc],__init__:["contextPadProvider"],contextPadProvider:["type",gc]};function xc(t){Si.call(this,t),this.init()}function _c(t){xc.call(this,t)}xc.$inject=["eventBus"],wi(xc,Si),xc.prototype.addRule=function(t,e,n){var o=this;"string"==typeof t&&(t=[t]),t.forEach((function(t){o.canExecute(t,e,(function(t,e,o){return n(t)}),!0)}))},xc.prototype.init=function(){},Dr(_c,xc),_c.$inject=["eventBus"],_c.prototype.init=function(){this.addRule("shape.resize",(function(t){var e=t.shape;return oa(e)&&!qe(e)})),this.addRule("elements.move",(function(t){var e;return!t.shapes.some((function(t){return qe(t)}))&&!(qe(t.target)||oa(t.target)&&(e=t.target,!a(e)||null!=e.parent))}))};var wc={__depends__:[be],__init__:["umlRulesProvider"],umlRulesProvider:["type",_c]};function bc(t){return Math.log(t)/Math.log(10)}function Ec(t,e){var n=bc(t.min),o=bc(t.max);return(Math.abs(n)+Math.abs(o))/e}var kc=Math.sign||function(t){return t>=0?1:-1},Cc={min:.2,max:4};function Sc(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=P(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var o=this;e.on("canvas.init",(function(e){o._init(!1!==t.enabled)}))}Sc.$inject=["config.zoomScroll","eventBus","canvas"],Sc.prototype.scroll=function(t){this._canvas.scroll(t)},Sc.prototype.reset=function(){this._canvas.zoom("fit-viewport")},Sc.prototype.zoom=function(t,e){var n=Ec(Cc,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},Sc.prototype._handleWheel=function(t){if(!q(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,o=t.ctrlKey,i=t.shiftKey,r=-1*this._scale;if(r*=o?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,o){var a=e.getBoundingClientRect(),c={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*kc(t.deltaY)*r,this.zoom(n,c)}else n=i?{dx:r*t.deltaY,dy:0}:{dx:r*t.deltaX,dy:r*t.deltaY},this.scroll(n)}},Sc.prototype.stepZoom=function(t,e){var n=Ec(Cc,10);this._zoom(t,e,n)},Sc.prototype._zoom=function(t,e,n){var o=this._canvas,i=t>0?1:-1,r=bc(o.zoom()),a=Math.round(r/n)*n;a+=n*i;var c,s,u=Math.pow(10,a);o.zoom((c=Cc,s=u,Math.max(c.min,Math.min(c.max,s))),e)},Sc.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,o=this._enabled;return void 0===t&&(t=!o),o!==t&&J[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},Sc.prototype._init=function(t){this.toggle(t)};var jc={__init__:["zoomScroll"],zoomScroll:["type",Sc]};function Mc(t,e){var n;function o(o){var i,r=n.start,a=n.button,c=dt(o),s=Oe(c,r);(!n.dragging&&(i=s,Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))>15)&&(n.dragging=!0,0===a&&Pe(t),Se("grab")),n.dragging)&&(s=Oe(c,n.last||n.start),e.scroll({dx:s.x,dy:s.y}),n.last=c);o.preventDefault()}function i(t){J.unbind(document,"mousemove",o),J.unbind(document,"mouseup",i),n=null,je()}t.on("element.mousedown",500,(function(t){return function(t){if(q(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:dt(t)},J.bind(document,"mousemove",o),J.bind(document,"mouseup",i),!0}(t.originalEvent)})),this.isActive=function(){return!!n}}Mc.$inject=["eventBus","canvas"];var Pc={__init__:["moveCanvas"],moveCanvas:["type",Mc]},Rc=1e3;function Oc(t,e){var n=this;e=e||Rc,t.on(["render.shape","render.connection"],e,(function(t,e){var o=t.type,i=e.element,r=e.gfx,a=e.attrs;if(n.canRender(i))return"render.shape"===o?n.drawShape(r,i,a):n.drawConnection(r,i,a)})),t.on(["render.getShapePath","render.getConnectionPath"],e,(function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)}))}function Bc(t,e,n,o){var i=o.createText(e,n);return kt(i).add("djs-label"),mt(t,i),i}function Tc(t,e,n,o){var i=function(t,e,n){var o=Bt("rect");return function(t,e,n){bt(t,{width:e,height:n})}(o,t,e),Dc(o,n),o}(e,n,o);return mt(t,i),i}function zc(t,e,n){var o=Lc(e),i=function(t){var e=Lc(t);return Ac(e,{stroke:"white","stroke-width":10})}(function(t){var e=t.length,n=t.slice();e>=2&&(n[0]=aa(t[0],t[1],.1),n[e-1]=aa(t[e-2],t[e-1],.9));return n}(e)),r=function(t){var e=Bt("g");return kt(e).add("djs-visual"),t.forEach((function(t){mt(e,t)})),e}([i,Ac(o,n)]);return mt(t,r),r}function Ac(t,e){var n=Bt("path");return function(t,e){bt(t,{d:e})}(n,t),function(t,e){"markerEnd"in e&&bt(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&bt(t,{"marker-start":"url(#"+e.markerStart+")"})}(n,e),function(t,e){"transform"in e&&bt(t,{transform:e.transform})}(n,e),Dc(n,e),n}function Lc(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function Dc(t,e){"stroke"in e&&bt(t,{stroke:e.stroke}),"stroke-width"in e&&bt(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&bt(t,{fill:e.fill}),"stroke-dasharray"in e&&bt(t,{"stroke-dasharray":e["stroke-dasharray"]})}function Ic(t){t.style.removeProperty("opacity")}function $c(t,e){var n=t.closest(".djs-group");e.parent&&e.parent.isVisible?e.isVisible?Ic(n):function(t){t.style.setProperty("opacity",.3)}(n):Ic(n)}function Nc(t,e,n){e.businessObject;var o=Tc(t,e.width,e.height,{fill:"none",stroke:"black"}),i=function(t){return R({dy:".75em"},{x:t.width/2,"text-anchor":"middle"})}(e);if(i.y=5,"stereotypes"in e&&e.stereotypes.forEach((function(e){var o=Bc(t,"&lt;&lt;"+e+"&gt;&gt;",i,n);i.y+=o.getBBox().height})),"name"in e){var r=Bc(t,e.name,i,n);i.y+=r.getBBox().height}return e.labels.some((function(t){return"property"===t.labelType||"classifier"===t.labelType}))&&"name"in e&&function(t,e,n){(function(t,e,n){var o=Bt("line");bt(o,{x1:e.x,y1:e.y,x2:n.x,y2:n.y,stroke:"black"}),mt(t,o)})(t,{x:0,y:n},{x:e,y:n})}(t,e.width,i.y),$c(t,e),o}function Hc(t,e,n){var o=Bc(t,e.businessObject+"",{dy:".75em"},n);return $c(t,e),o}function Vc(t,e){return Yc(t,e,{stroke:"black",markerEnd:"association-marker"})}function Gc(t,e){return Yc(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function Fc(t,e){return Yc(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function Wc(t,e){return Yc(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function qc(t,e){return Yc(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function Uc(t,e){return Yc(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function Yc(t,e,n){var o=zc(t,e.waypoints,n);return $c(t,e),o}Oc.prototype.canRender=function(t){},Oc.prototype.drawShape=function(t,e){},Oc.prototype.drawConnection=function(t,e){},Oc.prototype.getShapePath=function(t){},Oc.prototype.getConnectionPath=function(t){};var Kc=[{name:"association-marker",element:Ac("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:Ac("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:Ac("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:Ac("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:Ac("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:Ac("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function Xc(t,e,n,o){var i=Bt("marker");mt(i,n),bt(i,{id:e,viewBox:"0 0 10 10",refX:Zc(o),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),mt(t,i)}function Zc(t){return t?0:10}function Jc(t,e,n,o){Oc.call(this,t),this.textRenderer=n,this._layouter=o,this.drawShapeHandlers={class:Nc,label:Hc},this.drawConnectionHandlers={association:Vc,inheritance:Gc,realization:Fc,dependency:Wc,aggregation:qc,composition:Uc},function(t){var e=at("defs",t._svg);e||(e=Bt("defs"),mt(t._svg,e)),Kc.forEach((function(t){var n=t.element.cloneNode(!0);Xc(e,t.name,t.element,!1),Xc(e,t.name+"-reversed",n,!0)}))}(e)}function Qc(){this._style={fontFamily:"DroidSansMono",fontSize:12}}Dr(Jc,Oc),Jc.$inject=["eventBus","canvas","textRenderer","layouter"],Jc.prototype.canRender=function(t){return!0},Jc.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},Jc.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},Jc.prototype.getShapePath=function(t){return n=(e=t).x,o=e.y,i=e.width,qt([["M",n,o],["l",i,0],["l",0,e.height],["l",-i,0],["z"]]);var e,n,o,i},Qc.prototype.createText=function(t,e){var n=Bt("text");return bt(n,e=R(e,this._style)),Gt(n,t),n},Qc.prototype.getDimensions=function(t,e){var n=Bt("text");bt(n,this._style),mt(function(){var t=document.getElementById("helper-svg");if(!t)return function(){var t=Bt("svg");return bt(t,{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(t),t}();return t}(),n),n.textContent=t;var o=n.getBBox();return St(n),o},Qc.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},Qc.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var ts={__init__:["umlRenderer"],umlRenderer:["type",Jc],textRenderer:["type",Qc]};function es(t,e,n,o,i,r){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=o,this.layouter=i,this.commandStack=r}function ns(t,e,n,o,i,r,a){return delete o.id,a.createClass(o,e)}function os(t,e,n){t in e&&(n[t]=e[t])}function is(t,e){var n,o;return n="waypoints"in t?ea(t.waypoints):Yr(rs(e.get(t.source)),rs(e.get(t.target))),(o=n).forEach((function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)})),o}function rs(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}es.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],es.prototype.import=function(t){var e=this.textRenderer,n=this.elementFactory,o=this.canvas,i=this.modeling;this.layouter;this.commandStack;var r=n.createRoot();o.setRootElement(r);var a=function(t,e,n,o,i,r){return new Map(t.map((function(t){var a=t.businessObject||{};return[t.id,ns(n,i,e,t,a,o,r)]})))}(t.graph.nodes,n,o,e,r,i);!function(t,e,n,o,i,r,a,c){t.forEach((function(t){var n={connectionType:t.type,waypoints:is(t,e)};R(n,function(t){var e={};return os("sourceName",t,e),os("targetName",t,e),os("sourceCardinality",t,e),os("targetCardinality",t,e),e}(t)),c.createConnection(e.get(t.source),e.get(t.target),n,r)}))}(t.graph.edges,a,0,0,0,r,0,i)};var as={__depends__:[ts,{umlImporter:["type",es]}]};const cs=/^class[ {]/;function ss(t){return Array.isArray(t)}function us(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ls(...t){1===t.length&&ss(t[0])&&(t=t[0]);const e=(t=[...t]).pop();return e.$inject=t,e}const hs=/constructor\s*[^(]*\(\s*([^)]*)\)/m,ds=/^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m,ps=/\/\*([^*]*)\*\//m;function fs(t){if("function"!=typeof t)throw new Error(`Cannot annotate "${t}". Expected a function!`);const e=t.toString().match(function(t){return cs.test(t.toString())}(t)?hs:ds);if(!e)return[];const n=e[1]||e[2];return n&&n.split(",").map((t=>{const e=t.match(ps);return(e&&e[1]||t).trim()}))||[]}function ys(t,e){e=e||{get:function(t,e){if(n.push(t),!1===e)return null;throw a(`No provider for "${t}"!`)}};const n=[],o=this._providers=Object.create(e._providers||null),i=this._instances=Object.create(null),r=i.injector=this,a=function(t){const e=n.join(" -> ");return n.length=0,new Error(e?`${t} (Resolving: ${e})`:t)};function c(t,r){if(!o[t]&&-1!==t.indexOf(".")){const e=t.split(".");let n=c(e.shift());for(;e.length;)n=n[e.shift()];return n}if(us(i,t))return i[t];if(us(o,t)){if(-1!==n.indexOf(t))throw n.push(t),a("Cannot resolve circular dependency!");return n.push(t),i[t]=o[t][0](o[t][1]),n.pop(),i[t]}return e.get(t,r)}function s(t,e){if(void 0===e&&(e={}),"function"!=typeof t){if(!ss(t))throw a(`Cannot invoke "${t}". Expected a function!`);t=ls(t.slice())}return{fn:t,dependencies:(t.$inject||fs(t)).map((t=>us(e,t)?e[t]:c(t)))}}function u(t){const{fn:e,dependencies:n}=s(t);return new(Function.prototype.bind.apply(e,[null].concat(n)))}function l(t,e,n){const{fn:o,dependencies:i}=s(t,n);return o.apply(e,i)}function h(t){return ls((e=>t.get(e)))}function d(t,e){if(e&&e.length){const n=Object.create(null),i=Object.create(null),r=[],a=[],c=[];let s,u,l,d;for(let t in o)s=o[t],-1!==e.indexOf(t)&&("private"===s[2]?(u=r.indexOf(s[3]),-1===u?(l=s[3].createChild([],e),d=h(l),r.push(s[3]),a.push(l),c.push(d),n[t]=[d,t,"private",l]):n[t]=[c[u],t,"private",a[u]]):n[t]=[s[2],s[1]],i[t]=!0),"factory"!==s[2]&&"type"!==s[2]||!s[1].$scope||e.forEach((e=>{-1!==s[1].$scope.indexOf(e)&&(n[t]=[s[2],s[1]],i[e]=!0)}));e.forEach((t=>{if(!i[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')})),t.unshift(n)}return new ys(t,r)}const p={factory:l,type:u,value:function(t){return t}};function f(t,e){const n=t.__init__||[];return function(){n.forEach((t=>{"string"==typeof t?e.get(t):e.invoke(t)}))}}function y(t){const e=t.__exports__;if(e){const n=t.__modules__,i=Object.keys(t).reduce(((e,n)=>("__exports__"!==n&&"__modules__"!==n&&"__init__"!==n&&"__depends__"!==n&&(e[n]=t[n]),e)),Object.create(null)),r=d((n||[]).concat(i)),a=ls((function(t){return r.get(t)}));e.forEach((function(t){o[t]=[a,t,"private",r]}));const c=(t.__init__||[]).slice();return c.unshift((function(){r.init()})),f(t=Object.assign({},t,{__init__:c}),r)}return Object.keys(t).forEach((function(e){if("__init__"===e||"__depends__"===e)return;if("private"===t[e][2])return void(o[e]=t[e]);const n=t[e][0],i=t[e][1];o[e]=[p[n],vs(n,i),n]})),f(t,r)}function v(t,e){return-1!==t.indexOf(e)||-1!==(t=(e.__depends__||[]).reduce(v,t)).indexOf(e)?t:t.concat(e)}this.get=c,this.invoke=l,this.instantiate=u,this.createChild=d,this.init=function(t){const e=t.reduce(v,[]).map(y);let n=!1;return function(){n||(n=!0,e.forEach((t=>t())))}}(t)}function vs(t,e){return"value"!==t&&ss(e)&&(e=ls(e.slice())),e}function gs(t,e){Oc.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}wi(gs,Oc),gs.prototype.canRender=function(){return!0},gs.prototype.drawShape=function(t,e,n){var o=Bt("rect");return bt(o,{x:0,y:0,width:e.width||0,height:e.height||0}),le(e)?bt(o,R({},this.FRAME_STYLE,n||{})):bt(o,R({},this.SHAPE_STYLE,n||{})),mt(t,o),o},gs.prototype.drawConnection=function(t,e,n){var o=Zt(e.waypoints,R({},this.CONNECTION_STYLE,n||{}));return mt(t,o),o},gs.prototype.getShapePath=function(t){var e=t.x,n=t.y,o=t.width;return qt([["M",e,n],["l",o,0],["l",0,t.height],["l",-o,0],["z"]])},gs.prototype.getConnectionPath=function(t){var e,n,o=t.waypoints,i=[];for(e=0;n=o[e];e++)n=n.original||n,i.push([0===e?"M":"L",n.x,n.y]);return qt(i)},gs.$inject=["eventBus","styles"];var ms={__init__:["defaultRenderer"],defaultRenderer:["type",gs],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){return R(this.style(e,n),{class:t})},this.style=function(e,n){r(e)||n||(n=e,e=[]);var o=y(e,(function(e,n){return R(e,t[n]||{})}),{});return n?R(o,n):o},this.computeStyle=function(t,n,o){return r(n)||(o=n,n=[]),e.style(n||[],R({},o,t||{}))}}]};function xs(t,e){return Math.round(t*e)/e}function _s(t){return c(t)?t+"px":t}function ws(t,e,n){const o=Bt("g");kt(o).add(e);const i=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(o,t.childNodes[i]||null),o}const bs={shape:["x","y","width","height"],connection:["waypoints"]};function Es(t,e,n,o){this._eventBus=e,this._elementRegistry=o,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function ks(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}Es.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Es.prototype._init=function(t){const e=this._eventBus,n=this._container=function(t){const e=(t=R({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),$(n,{position:"relative",overflow:"hidden",width:_s(t.width),height:_s(t.height)}),e.appendChild(n),n}(t),o=this._svg=Bt("svg");bt(o,{width:"100%",height:"100%"}),mt(n,o);const i=this._viewport=ws(o,"viewport");t.deferUpdate&&(this._viewboxChanged=function(t,e){let n,o,i,r;function a(n){let a=Date.now(),u=n?0:r+e-a;if(u>0)return c(u);t.apply(i,o),s()}function c(t){n=setTimeout(a,t)}function s(){n&&clearTimeout(n),n=r=o=i=void 0}function u(...t){r=Date.now(),o=t,i=this,n||c(e)}return u.flush=function(){n&&a(!0),s()},u.cancel=s,u}(P(this._viewboxChanged,this),300)),e.on("diagram.init",(()=>{e.fire("canvas.init",{svg:o,viewport:i})})),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],(()=>{delete this._cachedViewbox})),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},Es.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},Es.prototype._clear=function(){this._elementRegistry.getAll().forEach((t=>{const e=ue(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},Es.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Es.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},Es.prototype._getChildIndex=function(t){return y(this._layers,(function(e,n){return n.visible&&t>=n.index&&e++,e}),0)},Es.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:ws(this._viewport,"layer-"+t,n),index:e,visible:!0}},Es.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,o=e.group,i=e.index;if(e.visible)return o;const r=this._getChildIndex(i);return n.insertBefore(o,n.childNodes[r]||null),e.visible=!0,o},Es.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(St(n),e.visible=!1,n):n},Es.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],St(e.group))},Es.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},Es.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},Es.prototype.getRootElements=function(){return this._planes.map((function(t){return t.rootElement}))},Es.prototype._findPlaneForRoot=function(t){return h(this._planes,(function(e){return e.rootElement===t}))},Es.prototype.getContainer=function(){return this._container},Es.prototype._updateMarker=function(t,e,n){let o;t.id||(t=this._elementRegistry.get(t)),o=this._elementRegistry._elements[t.id],o&&(p([o.gfx,o.secondaryGfx],(function(t){t&&(n?kt(t).add(e):kt(t).remove(e))})),this._eventBus.fire("element.marker.update",{element:t,gfx:o.gfx,marker:e,add:!!n}))},Es.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},Es.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},Es.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));return kt(this.getGraphics(t)).has(e)},Es.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},Es.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},Es.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const o=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,o),this._planes.push({rootElement:t,layer:o}),t},Es.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter((function(e){return e.rootElement!==t})),this._rootElement===t&&(this._rootElement=null),t},Es.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},Es.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},Es.prototype._addRoot=function(t,e){const n=this._elementRegistry,o=this._eventBus;o.fire("root.add",{element:t}),n.add(t,e),o.fire("root.added",{element:t,gfx:e})},Es.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},Es.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=bs[t],o=v(n,(function(t){return void 0!==e[t]}));if(!o)throw new Error("must supply { "+n.join(", ")+" } with "+t)},Es.prototype._setParent=function(t,e,n){Ei(e.children,t,n),t.parent=e},Es.prototype._addElement=function(t,e,n,o){n=n||this.getRootElement();const i=this._eventBus,r=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,o);const a=r.create(t,e,o);return this._elementRegistry.add(e,a),r.update(t,e,a),i.fire(t+".added",{element:e,gfx:a}),e},Es.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},Es.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},Es.prototype._removeElement=function(t,e){const n=this._elementRegistry,o=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t))return i.fire(e+".remove",{element:t}),o.remove(t),bi(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t},Es.prototype.removeShape=function(t){return this._removeElement(t,"shape")},Es.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},Es.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},Es.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Es.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Es.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let o,i,r,a,c,s,u;return t?(this._changeViewbox((function(){c=Math.min(n.width/t.width,n.height/t.height);const o=this._svg.createSVGMatrix().scale(c).translate(-t.x,-t.y);Wt(e,o)})),t):(r=this._rootElement?this.getActiveLayer():null,o=r&&r.getBBox()||{},a=Wt(e),i=a?a.matrix:function(t,e,n,o,i,r){var a=zt().createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return At(a,t);case 6:return At(a,{a:t,b:e,c:n,d:o,e:i,f:r})}}(),c=xs(i.a,1e3),s=xs(-i.e||0,1e3),u=xs(-i.f||0,1e3),t=this._cachedViewbox={x:s?s/c:0,y:u?u/c:0,width:n.width/c,height:n.height/c,scale:c,inner:{width:o.width||0,height:o.height||0,x:o.x||0,y:o.y||0},outer:n})},Es.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox((function(){t=R({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),ks(e,n)})),{x:n.e,y:n.f}},Es.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const o=this.findRoot(t);if(o!==this.getRootElement()&&this.setRootElement(o),o===t)return;e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const i=se(t),r=Fo(i),a=this.viewbox(),c=this.zoom();let s,u;a.y+=e.top/c,a.x+=e.left/c,a.width-=(e.right+e.left)/c,a.height-=(e.bottom+e.top)/c;const l=Fo(a);if(i.width<a.width&&i.height<a.height){const t=Math.max(0,r.right-l.right),e=Math.min(0,r.left-l.left),n=Math.max(0,r.bottom-l.bottom),o=Math.min(0,r.top-l.top);s=t||e,u=n||o}else s=i.x-a.x,u=i.y-a.y;this.scroll({dx:-s*c,dy:-u*c})},Es.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,o;return this._changeViewbox((function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),o=this._setZoom(t,e)})),xs(o.a,1e3)},Es.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,o=e.inner;let i,r;return o.x>=0&&o.y>=0&&o.x+o.width<=n.width&&o.y+o.height<=n.height&&!t?r={x:0,y:0,width:Math.max(o.width+o.x,n.width),height:Math.max(o.height+o.y,n.height)}:(i=Math.min(1,n.width/o.width,n.height/o.height),r={x:o.x+(t?o.width/2-n.width/i/2:0),y:o.y+(t?o.height/2-n.height/i/2:0),width:n.width/i,height:n.height/i}),this.viewbox(r),this.viewbox(!1).scale},Es.prototype._setZoom=function(t,e){const n=this._svg,o=this._viewport,i=n.createSVGMatrix(),r=n.createSVGPoint();let a,c,s,u,l;s=o.getCTM();const h=s.a;return e?(a=R(r,e),c=a.matrixTransform(s.inverse()),u=i.translate(c.x,c.y).scale(1/h*t).translate(-c.x,-c.y),l=s.multiply(u)):l=i.scale(t),ks(this._viewport,l),l},Es.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Es.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},Es.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Cs="data-element-id";function Ss(t){this._elements={},this._eventBus=t}Ss.$inject=["eventBus"],Ss.prototype.add=function(t,e,n){var o=t.id;this._validateId(o),bt(e,Cs,o),n&&bt(n,Cs,o),this._elements[o]={element:t,gfx:e,secondaryGfx:n}},Ss.prototype.remove=function(t){var e=this._elements,n=t.id||t,o=n&&e[n];o&&(bt(o.gfx,Cs,""),o.secondaryGfx&&bt(o.secondaryGfx,Cs,""),delete e[n])},Ss.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),o=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,o)},Ss.prototype.updateGraphics=function(t,e,n){var o=t.id||t,i=this._elements[o];return n?i.secondaryGfx=e:i.gfx=e,e&&bt(e,Cs,o),e},Ss.prototype.get=function(t){var e;e="string"==typeof t?t:t&&bt(t,Cs);var n=this._elements[e];return n&&n.element},Ss.prototype.filter=function(t){var e=[];return this.forEach((function(n,o){t(n,o)&&e.push(n)})),e},Ss.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),o=0;o<n.length;o++){var i=e[n[o]],r=i.element;if(t(r,i.gfx))return r}},Ss.prototype.getAll=function(){return this.filter((function(t){return t}))},Ss.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach((function(n){var o=e[n],i=o.element,r=o.gfx;return t(i,r)}))},Ss.prototype.getGraphics=function(t,e){var n=t.id||t,o=this._elements[n];return o&&(e?o.secondaryGfx:o.gfx)},Ss.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var js="__fn",Ms=Array.prototype.slice;function Ps(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function Rs(){}function Os(t,e){this._eventBus=t,this._elementRegistry=e}function Bs(t,e,n){var o=n||e.firstChild;t!==o&&e.insertBefore(t,o)}Ps.prototype.on=function(t,e,n,o){if(t=r(t)?t:[t],s(e)&&(o=n,n=e,e=1e3),!c(e))throw new Error("priority must be a number");var i=n;o&&((i=P(n,o))[js]=n[js]||n);var a=this;t.forEach((function(t){a._addListener(t,{priority:e,callback:i,next:null})}))},Ps.prototype.once=function(t,e,n,o){var i=this;if(s(e)&&(o=n,n=e,e=1e3),!c(e))throw new Error("priority must be a number");function r(){r.__isTomb=!0;var e=n.apply(o,arguments);return i.off(t,r),e}r[js]=n,this.on(t,e,r)},Ps.prototype.off=function(t,e){t=r(t)?t:[t];var n=this;t.forEach((function(t){n._removeListener(t,e)}))},Ps.prototype.createEvent=function(t){var e=new Rs;return e.init(t),e},Ps.prototype.fire=function(t,e){var n,o,i,r;if(r=Ms.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(o=this._listeners[t]){n=e instanceof Rs?e:this.createEvent(e),r[0]=n;var a=n.type;t!==a&&(n.type=t);try{i=this._invokeListeners(n,r,o)}finally{t!==a&&(n.type=a)}return void 0===i&&n.defaultPrevented&&(i=!1),i}},Ps.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},Ps.prototype._destroy=function(){this._listeners={}},Ps.prototype._invokeListeners=function(t,e,n){for(var o;n&&!t.cancelBubble;)o=this._invokeListener(t,e,n),n=n.next;return o},Ps.prototype._invokeListener=function(t,e,n){var o;if(n.callback.__isTomb)return o;try{o=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==o&&(t.returnValue=o,t.stopPropagation()),!1===o&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener",t),t}return o},Ps.prototype._addListener=function(t,e){var n,o=this._getListeners(t);if(o){for(;o;){if(o.priority<e.priority)return e.next=o,void(n?n.next=e:this._setListeners(t,e));n=o,o=o.next}n.next=e}else this._setListeners(t,e)},Ps.prototype._getListeners=function(t){return this._listeners[t]},Ps.prototype._setListeners=function(t,e){this._listeners[t]=e},Ps.prototype._removeListener=function(t,e){var n,o,i,r=this._getListeners(t);if(e)for(;r;)n=r.next,(i=r.callback)!==e&&i[js]!==e||(o?o.next=n:this._setListeners(t,n)),o=r,r=n;else this._setListeners(t,null)},Rs.prototype.stopPropagation=function(){this.cancelBubble=!0},Rs.prototype.preventDefault=function(){this.defaultPrevented=!0},Rs.prototype.init=function(t){R(this,t||{})},Os.$inject=["eventBus","elementRegistry"],Os.prototype._getChildrenContainer=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(n),e||(kt(e=Bt("g")).add("djs-children"),mt(n.parentNode,e))):e=n,e},Os.prototype._clear=function(t){var e=De(t);return F(e),e},Os.prototype._createContainer=function(t,e,n,o){var i=Bt("g");kt(i).add("djs-group"),void 0!==n?Bs(i,e,e.childNodes[n]):mt(e,i);var r=Bt("g");kt(r).add("djs-element"),kt(r).add("djs-"+t),o&&kt(r).add("djs-frame"),mt(i,r);var a=Bt("g");return kt(a).add("djs-visual"),mt(r,a),r},Os.prototype.create=function(t,e,n){var o=this._getChildrenContainer(e.parent);return this._createContainer(t,o,n,le(e))},Os.prototype.updateContainments=function(t){var e,n=this,o=this._elementRegistry;e=y(t,(function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t}),{}),p(e,(function(t){var e=t.children;if(e){var i=n._getChildrenContainer(t);p(e.slice().reverse(),(function(t){Bs(o.getGraphics(t).parentNode,i)}))}}))},Os.prototype.drawShape=function(t,e){return this._eventBus.fire("render.shape",{gfx:t,element:e})},Os.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},Os.prototype.drawConnection=function(t,e){return this._eventBus.fire("render.connection",{gfx:t,element:e})},Os.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},Os.prototype.update=function(t,e,n){if(e.parent){var o=this._clear(n);if("shape"===t)this.drawShape(o,e),Fe(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(o,e)}e.hidden?bt(n,"display","none"):bt(n,"display","block")}},Os.prototype.remove=function(t){St(this._elementRegistry.getGraphics(t).parentNode)};var Ts={__depends__:[ms],__init__:["canvas"],canvas:["type",Es],elementRegistry:["type",Ss],elementFactory:["type",Br],eventBus:["type",Ps],graphicsFactory:["type",Os]};function zs(t){return function(t){var e=new ys(t);return e.init(),e}([{config:["value",t=t||{}]},Ts].concat(t.modules||[]))}function As(t,e){this._injector=e=e||zs(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function Ls(t){this._container=this._createContainer(t),this._init(this._container,t)}function Ds(t){Ls.call(this,t)}return As.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},As.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},Dr(Ls,As),Ls.prototype._coreModules=[as],Ls.prototype._viewModules=[jc,Pc],Ls.prototype._modules=[].concat(Ls.prototype._coreModules,Ls.prototype._viewModules),Ls.prototype.importJSON=function(t){this.get("umlImporter").import(t)},Ls.prototype._createContainer=function(t){var e;return R((e=rt("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},Ls.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};As.call(this,n),e&&e.parent&&this.attachTo(e.parent)},Ls.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=at(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},Ls.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},Ls.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},Dr(Ds,Ls),Ds.prototype._modelingModules=[_e,Qe,pe,sn,mn,Mn,$n,cr,be,yc,mc,wc,ac,Ri,Bi,Xi,or,ur,_i],Ds.prototype._modules=[].concat(Ds.prototype._modules,Ds.prototype._modelingModules),Ds}));
