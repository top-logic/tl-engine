!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).UmlJS=e()}(this,function(){"use strict";function t(t){return Array.prototype.concat.apply([],t)}const e=Object.prototype.toString,n=Object.prototype.hasOwnProperty;function o(t){return void 0===t}function i(t){return void 0!==t}function r(t){return null==t}function a(t){return"[object Array]"===e.call(t)}function c(t){return"[object Object]"===e.call(t)}function s(t){return"[object Number]"===e.call(t)}function u(t){const n=e.call(t);return"[object Function]"===n||"[object AsyncFunction]"===n||"[object GeneratorFunction]"===n||"[object AsyncGeneratorFunction]"===n||"[object Proxy]"===n}function l(t){return"[object String]"===e.call(t)}function h(t,e){return!r(t)&&n.call(t,e)}function p(t,e){const n=j(e);let o;return f(t,function(t,e){if(n(t,e))return o=t,!1}),o}function d(t,e){const n=j(e);let o=[];return f(t,function(t,e){n(t,e)&&o.push(t)}),o}function f(t,e){let n,i;if(o(t))return;const r=a(t)?P:M;for(let o in t)if(h(t,o)&&(n=t[o],i=e(n,r(o)),!1===i))return n}function v(t,e){if(o(t))return[];!function(t){if(!a(t))throw new Error("must supply array")}(t);const n=j(e);return t.filter(function(t,e){return!n(t,e)})}function y(t,e,n){return f(t,function(t,o){n=e(n,t,o)}),n}function g(t,e){return!!y(t,function(t,n,o){return t&&e(n,o)},!0)}function m(t,e){return!!p(t,e)}function x(t,e){let n=[];return f(t,function(t,o){n.push(e(t,o))}),n}function _(t){return function(t){return t&&Object.keys(t)||[]}(t).length}function w(t){return x(t,t=>t)}function b(t,e,n={}){return e=S(e),f(t,function(t){let o=e(t)||"_",i=n[o];i||(i=n[o]=[]),i.push(t)}),n}function E(t,...e){t=S(t);let n={};return f(e,e=>b(e,t,n)),x(n,function(t,e){return t[0]})}function k(t,e){e=S(e);let n=[];return f(t,function(t,o){let i=e(t,o),r={d:i,v:t};for(var a=0;a<n.length;a++){let{d:t}=n[a];if(i<t)return void n.splice(a,0,r)}n.push(r)}),x(n,t=>t.v)}function C(t){return function(e){return g(t,function(t,n){return e[n]===t})}}function S(t){return u(t)?t:e=>e[t]}function j(t){return u(t)?t:e=>e===t}function M(t){return t}function P(t){return Number(t)}function R(t,e){return t.bind(e)}function O(t,...e){return Object.assign(t,...e)}function B(t,e){let n={},o=Object(t);return f(e,function(e){e in o&&(n[e]=t[e])}),n}function z(t,e){return e.forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(n){if("default"!==n&&!(n in t)){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})}),Object.freeze(t)}const T=Object.prototype.toString,A=Object.prototype.hasOwnProperty;function L(t,e){return A.call(t,e)}function D(t,e){let n,o;if(void 0===t)return;const i=function(t){return"[object Array]"===T.call(t)}(t)?$:I;for(let r in t)if(L(t,r)&&(n=t[r],o=e(n,i(r)),!1===o))return n}function I(t){return t}function $(t){return Number(t)}function H(t,...e){const n=t.style;return D(e,function(t){t&&D(t,function(t,e){n[e]=t})}),t}function V(t,e,n){return 2==arguments.length?t.getAttribute(e):null===n?t.removeAttribute(e):(t.setAttribute(e,n),t)}const G=Object.prototype.toString;function N(t){return new F(t)}function F(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function W(t){for(var e;e=t.firstChild;)t.removeChild(e);return t}function q(t,e,n){var o=n?t:t.parentNode;return o&&"function"==typeof o.closest&&o.closest(e)||null}F.prototype.add=function(t){return this.list.add(t),this},F.prototype.remove=function(t){return"[object RegExp]"==G.call(t)?this.removeMatching(t):(this.list.remove(t),this)},F.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},F.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},F.prototype.array=function(){return Array.from(this.list)},F.prototype.has=F.prototype.contains=function(t){return this.list.contains(t)};var U,Y,K,X={};function Z(){U=window.addEventListener?"addEventListener":"attachEvent",Y=window.removeEventListener?"removeEventListener":"detachEvent",K="addEventListener"!==U?"on":""}var J=z({__proto__:null,bind:X.bind=function(t,e,n,o){return U||Z(),t[U](K+e,n,o||!1),n},unbind:X.unbind=function(t,e,n,o){return Y||Z(),t[Y](K+e,n,o||!1),n},default:X},[X]),Q=["focus","blur"];var tt,et={bind:function(t,e,n,o,i){return-1!==Q.indexOf(n)&&(i=!0),J.bind(t,n,function(n){var i=n.target||n.srcElement;n.delegateTarget=q(i,e,!0),n.delegateTarget&&o.call(t,n)},i)},unbind:function(t,e,n,o){return-1!==Q.indexOf(e)&&(o=!0),J.unbind(t,e,n,o)}},nt=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var o=n[1];if("body"==o){return(i=e.createElement("html")).innerHTML=t,i.removeChild(i.lastChild)}var i,r=Object.prototype.hasOwnProperty.call(it,o)?it[o]:it._default,a=r[0],c=r[1],s=r[2];(i=e.createElement("div")).innerHTML=c+t+s;for(;a--;)i=i.lastChild;if(i.firstChild==i.lastChild)return i.removeChild(i.firstChild);var u=e.createDocumentFragment();for(;i.firstChild;)u.appendChild(i.removeChild(i.firstChild));return u},ot=!1;"undefined"!=typeof document&&((tt=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',ot=!tt.getElementsByTagName("link").length,tt=void 0);var it={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:ot?[1,"X<div>","</div>"]:[0,"",""]};it.td=it.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],it.option=it.optgroup=[1,'<select multiple="multiple">',"</select>"],it.thead=it.tbody=it.colgroup=it.caption=it.tfoot=[1,"<table>","</table>"],it.polyline=it.ellipse=it.polygon=it.circle=it.text=it.line=it.path=it.rect=it.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var rt=nt;function at(t,e){return(e=e||document).querySelector(t)}function ct(t,e){return(e=e||document).querySelectorAll(t)}function st(t){t.parentNode&&t.parentNode.removeChild(t)}function ut(t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation()}function lt(t){return t.originalEvent||t.srcEvent}function ht(t){ut(t),ut(lt(t))}function pt(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function dt(){return/mac/i.test(navigator.platform)}function ft(t,e){return(lt(t)||t).button===e}function vt(t){return ft(t,0)}function yt(t){var e=lt(t)||t;return vt(t)&&e.shiftKey}function gt(t,e){return e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}function mt(t,e){return gt(e,t),t}var xt={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function _t(t,e,n){var o=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=xt[o];i?(2===i&&"number"==typeof n&&(n=String(n)+"px"),t.style[o]=n):t.setAttributeNS(null,e,n)}function wt(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return xt[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);_t(t,e,n)}else!function(t,e){var n,o,i=Object.keys(e);for(n=0;o=i[n];n++)_t(t,o,e[o])}(t,e);return t}const bt=Object.prototype.toString;function Et(t){return new kt(t)}function kt(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function Ct(t){for(var e;e=t.firstChild;)t.removeChild(e);return t}function St(t){return t.cloneNode(!0)}kt.prototype.add=function(t){return this.list.add(t),this},kt.prototype.remove=function(t){return"[object RegExp]"==bt.call(t)?this.removeMatching(t):(this.list.remove(t),this)},kt.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},kt.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},kt.prototype.array=function(){return Array.from(this.list)},kt.prototype.has=kt.prototype.contains=function(t){return this.list.contains(t)};var jt="http://www.w3.org/2000/svg",Mt='<svg xmlns="'+jt+'"';function Pt(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(jt)&&(t=Mt+t.substring(4)):(t=Mt+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var o=document.createDocumentFragment(),i=n.firstChild;i.firstChild;)o.appendChild(i.firstChild);return o}function Rt(t,e){var n;return"<"===(t=t.trim()).charAt(0)?(n=Pt(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(jt,t),e&&wt(n,e),n}var Ot=null;function Bt(){return null===Ot&&(Ot=Rt("svg")),Ot}function zt(t,e){var n,o,i=Object.keys(e);for(n=0;o=i[n];n++)t[o]=e[o];return t}function Tt(t){return t?Bt().createSVGTransformFromMatrix(t):Bt().createSVGTransform()}var At=/([&<>]{1})/g,Lt=/([&<>\n\r"]{1})/g,Dt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function It(t,e){return t.replace(e,function(t,e){return Dt[e]||e})}function $t(t,e){var n,o,i,r,a;switch(t.nodeType){case 3:e.push(It(t.textContent,At));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(n=0,o=(i=t.attributes).length;n<o;++n)r=i.item(n),e.push(" ",r.name,'="',It(r.value,Lt),'"');if(t.hasChildNodes()){for(e.push(">"),n=0,o=(a=t.childNodes).length;n<o;++n)$t(a.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("\x3c!--",It(t.nodeValue,At),"--\x3e");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function Ht(t,e){var n=Pt(e);if(Ct(t),e){(function(t){return"#document-fragment"===t.nodeName})(n)||(n=n.documentElement);for(var o,i=(o=n.childNodes,Array.prototype.slice.call(o)),r=0;r<i.length;r++)gt(i[r],t)}}function Vt(t,e){if(void 0!==e){try{Ht(t,e)}catch(t){throw new Error("error parsing SVG: "+t.message)}return t}return function(t){for(var e=t.firstChild,n=[];e;)$t(e,n),e=e.nextSibling;return n.join("")}(t)}function Gt(t){var e=t.parentNode;return e&&e.removeChild(t),t}function Nt(t,e){return e instanceof SVGMatrix?t.createSVGTransformFromMatrix(e):e}function Ft(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,o;for(t.clear(),n=0;o=e[n];n++)t.appendItem(Nt(t,o))}(n,e)),n.consolidate()}function Wt(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function qt(t){return["L",t.x,t.y]}function Ut(t,e,n){return["C",t.x,t.y,e.x,e.y,n.x,n.y]}function Yt(t,e){const n=t.length,o=[(i=t[0],["M",i.x,i.y])];var i;for(let i=1;i<n;i++){const n=t[i-1],r=t[i],a=t[i+1];if(!a||!e){o.push(qt(r));continue}const c=Math.min(e,Xt(r.x-n.x,r.y-n.y),Xt(a.x-r.x,a.y-r.y));if(!c){o.push(qt(r));continue}const s=Kt(r,n,c),u=Kt(r,n,.5*c),l=Kt(r,a,c),h=Kt(r,a,.5*c);o.push(qt(s)),o.push(Ut(u,h,l))}return o}function Kt(t,e,n){const o=e.x-t.x,i=e.y-t.y,r=n/Xt(o,i);return{x:t.x+o*r,y:t.y+i*r}}function Xt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Zt(t,e,n){s(e)&&(n=e,e=null),e||(e={});const o=Rt("path",e);return s(n)&&(o.dataset.cornerRadius=String(n)),Jt(o,t)}function Jt(t,e){return wt(t,{d:Wt(Yt(e,parseInt(t.dataset.cornerRadius,10)||0))}),t}function Qt(t){return!0}function te(t){return vt(t)||function(t){return ft(t,1)}(t)}function ee(t,e,n){var o=this;function i(n,o,i){var r,a;(function(t,e){var n=s[t]||vt;return!n(e)})(n,o)||(i?a=e.getGraphics(i):(r=o.delegateTarget||o.target)&&(a=r,i=e.get(a)),a&&i&&!1===t.fire(n,{element:i,gfx:a,originalEvent:o})&&(o.stopPropagation(),o.preventDefault()))}var r={};function a(t){return r[t]}var c={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},s={"element.contextmenu":Qt,"element.mousedown":te,"element.mouseup":te,"element.click":te,"element.dblclick":te};function u(t,e,n,o){var a=r[n]=function(t){i(n,t)};o&&(s[n]=o),a.$delegate=et.bind(t,"svg, .djs-element",e,a)}function l(t,e,n){var o=a(n);o&&et.unbind(t,e,o.$delegate)}t.on("canvas.destroy",function(t){var e;e=t.svg,f(c,function(t,n){l(e,n,t)})}),t.on("canvas.init",function(t){var e;e=t.svg,f(c,function(t,n){u(e,n,t)})}),t.on(["shape.added","connection.added"],function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.createHit",{element:n,gfx:o})}),t.on(["shape.changed","connection.changed"],500,function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.updateHit",{element:n,gfx:o})}),t.on("interactionEvents.createHit",500,function(t){var e=t.element,n=t.gfx;o.createDefaultHit(e,n)}),t.on("interactionEvents.updateHit",function(t){var e=t.element,n=t.gfx;o.updateDefaultHit(e,n)});var h=v("djs-hit djs-hit-stroke"),p=v("djs-hit djs-hit-click-stroke"),d={all:v("djs-hit djs-hit-all"),"click-stroke":p,stroke:h,"no-move":v("djs-hit djs-hit-no-move")};function v(t,e){return e=O({stroke:"white",strokeWidth:15},e||{}),n.cls(t,["no-fill","no-border"],e)}function y(t,e){var n=d[e];if(!n)throw new Error("invalid hit type <"+e+">");return wt(t,n),t}function g(t,e){mt(t,e)}this.removeHits=function(t){f(ct(".djs-hit",t),Gt)},this.createDefaultHit=function(t,e){var n,o=t.waypoints,i=t.isFrame;return o?this.createWaypointsHit(e,o):(n=i?"stroke":"all",this.createBoxHit(e,n,{width:t.width,height:t.height}))},this.createWaypointsHit=function(t,e){var n=Zt(e);return y(n,"stroke"),g(t,n),n},this.createBoxHit=function(t,e,n){n=O({x:0,y:0},n);var o=Rt("rect");return y(o,e),wt(o,n),g(t,o),o},this.updateDefaultHit=function(t,e){var n=at(".djs-hit",e);if(n)return t.waypoints?Jt(n,t.waypoints):wt(n,{width:t.width,height:t.height}),n},this.fire=i,this.triggerMouseEvent=function(t,e,n){var o=c[t];if(!o)throw new Error("unmapped DOM event name <"+t+">");return i(o,e,n)},this.mouseHandler=a,this.registerEvent=u,this.unregisterEvent=l}ee.$inject=["eventBus","elementRegistry","styles"];var ne={__init__:["interactionEvents"],interactionEvents:["type",ee]};function oe(t){return d(t,function(e){return!p(t,function(t){return t!==e&&ie(e,t)})})}function ie(t,e){if(e){if(t===e)return e;if(t.parent)return ie(t.parent,e)}}function re(t,e,n){var o=!n||-1===t.indexOf(e);return o&&t.push(e),o}function ae(t,e,n){n=n||0,a(t)||(t=[t]),f(t,function(t,o){var i=e(t,o,n);a(i)&&i.length&&ae(i,e,n+1)})}function ce(t,e){return function(t,e,n){var o=[],i=[];return ae(t,function(t,r,a){re(o,t,e);var c=t.children;if((-1===n||a<n)&&c&&re(i,c,e))return c}),o}(t,!e,-1)}function se(t,e){var n,o,i,r;return e=!!e,a(t)||(t=[t]),f(t,function(t){var a=t;t.waypoints&&!e&&(a=se(t.waypoints,!0));var c=a.x,s=a.y,u=a.height||0,l=a.width||0;(c<n||void 0===n)&&(n=c),(s<o||void 0===o)&&(o=s),(c+l>i||void 0===i)&&(i=c+l),(s+u>r||void 0===r)&&(r=s+u)}),{x:n,y:o,height:r-o,width:i-n}}function ue(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function le(t){return!(!t||!t.isFrame)}function he(t,e){return O({},t||{},e||{})}function pe(t,e){this._eventBus=t,this.offset=5;var n=e.cls("djs-outline",["no-fill"]),o=this;function i(t){var e=Rt("rect");return wt(e,O({x:0,y:0,rx:4,width:100,height:100},n)),e}t.on(["shape.added","shape.changed"],500,function(t){var e=t.element,n=t.gfx,r=at(".djs-outline",n);r||mt(n,r=o.getOutline(e)||i()),o.updateShapeOutline(r,e)}),t.on(["connection.added","connection.changed"],function(t){var e=t.element,n=t.gfx,r=at(".djs-outline",n);r||mt(n,r=i()),o.updateConnectionOutline(r,e)})}pe.prototype.updateShapeOutline=function(t,e){var n=!1,o=this._getProviders();o.length&&f(o,function(o){n=n||o.updateOutline(e,t)}),n||wt(t,{x:-this.offset,y:-this.offset,width:e.width+2*this.offset,height:e.height+2*this.offset})},pe.prototype.updateConnectionOutline=function(t,e){var n=se(e);wt(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},pe.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("outline.getProviders",t,function(t){t.providers.push(e)})},pe.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"outline.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},pe.prototype.getOutline=function(t){var e;return f(this._getProviders(),function(n){u(n.getOutline)&&(e=e||n.getOutline(t))}),e},pe.$inject=["eventBus","styles","elementRegistry"];var de={__init__:["outline"],outline:["type",pe]};function fe(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],function(t){var e=t.element;n.deselect(e)}),t.on(["diagram.clear","root.set"],function(t){n.select(null)})}fe.$inject=["eventBus","canvas"],fe.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(-1!==n){var o=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:e})}},fe.prototype.get=function(){return this._selectedElements},fe.prototype.isSelected=function(t){return-1!==this._selectedElements.indexOf(t)},fe.prototype.select=function(t,e){var n=this._selectedElements,o=n.slice();a(t)||(t=t?[t]:[]);var i=this._canvas,r=i.getRootElement();t=t.filter(function(t){var e=i.findRoot(t);return r===e}),e?f(t,function(t){-1===n.indexOf(t)&&n.push(t)}):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:n})};var ve="hover",ye="selected";function ge(t,e,n){this._canvas=t;var o=this;function i(e,n){t.addMarker(e,n)}function r(e,n){t.removeMarker(e,n)}this._multiSelectionBox=null,e.on("element.hover",function(t){i(t.element,ve)}),e.on("element.out",function(t){r(t.element,ve)}),e.on("selection.changed",function(t){var e=t.oldSelection,n=t.newSelection;f(e,function(t){-1===n.indexOf(t)&&r(t,ye)}),f(n,function(t){-1===e.indexOf(t)&&i(t,ye)}),o._updateSelectionOutline(n)}),e.on("element.changed",function(t){n.isSelected(t.element)&&o._updateSelectionOutline(n.get())})}function me(t,e,n,o){t.on("create.end",500,function(t){var n=t.context,o=n.canExecute,i=n.elements,r=(n.hints||{}).autoSelect;if(o){if(!1===r)return;a(r)?e.select(r):e.select(i.filter(xe))}}),t.on("connect.end",500,function(t){var n=t.context.connection;n&&e.select(n)}),t.on("shape.move.end",500,function(t){var n=t.previousSelection||[],i=o.get(t.context.shape.id);p(n,function(t){return i.id===t.id})||e.select(i)}),t.on("element.click",function(t){if(vt(t)){var o=t.element;o===n.getRootElement()&&(o=null);var i=e.isSelected(o),r=e.get().length>1,a=function(t){var e=lt(t)||t;return!!vt(t)&&(dt()?e.metaKey:e.ctrlKey)}(t)||yt(t);if(i&&r)return a?e.deselect(o):e.select(o);i?e.deselect(o):e.select(o,a)}})}function xe(t){return!t.hidden}ge.$inject=["canvas","eventBus","selection"],ge.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");Ct(e);var n=t.length>1;if(Et(this._canvas.getContainer())[n?"add":"remove"]("djs-multi-select"),n){var o=function(t){return{x:t.x-6,y:t.y-6,width:t.width+12,height:t.height+12}}(se(t)),i=Rt("rect");wt(i,O({rx:3},o)),Et(i).add("djs-selection-outline"),mt(e,i)}},me.$inject=["eventBus","selection","canvas","elementRegistry"];var _e={__init__:["selectionVisuals","selectionBehavior"],__depends__:[ne,de],selection:["type",fe],selectionVisuals:["type",ge],selectionBehavior:["type",me]};function we(t){this._commandStack=t.get("commandStack",!1)}we.$inject=["injector"],we.prototype.allowed=function(t,e){var n=!0,o=this._commandStack;return o&&(n=o.canExecute(t,e)),void 0===n||n};var be={__init__:["rules"],rules:["type",we]};function Ee(t,e,n){var o,i,r=this,a=n.get("dragging",!1);a&&e.on("drag.start",function(n){e.once("drag.move",1500,function(e){!function(e){if(!e.hover){var n=e.originalEvent,o=r._findTargetGfx(n),i=o&&t.get(o);o&&i&&(e.stopPropagation(),a.hover({element:i,gfx:o}),a.move(n))}}(e)})}),e.on("element.hover",function(t){o=t.gfx,i=t.element}),e.on("element.hover",1500,function(t){i&&e.fire("element.out",{element:i,gfx:o})}),e.on("element.out",function(){o=null,i=null}),this._findTargetGfx=function(t){var e;if(t instanceof MouseEvent)return e=pt(t),function(t){return q(t,"svg, .djs-element",!0)}(document.elementFromPoint(e.x,e.y))}}Ee.$inject=["elementRegistry","eventBus","injector"];var ke={__init__:["hoverFix"],hoverFix:["type",Ee]},Ce=/^djs-cursor-.*$/;function Se(t){var e=N(document.body);e.removeMatching(Ce),t&&e.add("djs-cursor-"+t)}function je(){Se(null)}function Me(t,e){function n(){return!1}return e=e||"element.click",t.once(e,5e3,n),function(){t.off(e,n)}}function Pe(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Re(t,e){return{x:t.x-e.x,y:t.y-e.y}}var Oe=Math.round,Be="djs-drag-active";function ze(t){t.preventDefault()}function Te(t,e,n,o){var i,r={threshold:5,trapClick:!0};function c(t){var n=e.viewbox(),o=e._container.getBoundingClientRect();return{x:n.x+(t.x-o.left)/n.scale,y:n.y+(t.y-o.top)/n.scale}}function s(e,n){n=n||i;var o=t.createEvent(O({},n.payload,n.data,{isTouch:n.isTouch}));return!1!==t.fire("drag."+e,o)&&t.fire(n.prefix+"."+e,o)}function u(t,o){var r,a=i.payload,u=i.displacement,l=i.globalStart,h=pt(t),p=Re(h,l),d=i.localStart,f=c(h),v=Re(f,d);if(!i.active&&(o||(r=p,Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))>i.threshold))){if(O(a,{x:Oe(d.x+u.x),y:Oe(d.y+u.y),dx:0,dy:0},{originalEvent:t}),!1===s("start"))return y();i.active=!0,i.keepSelection||(a.previousSelection=n.get(),n.select(null)),i.cursor&&Se(i.cursor),e.addMarker(e.getRootElement(),Be)}ht(t),i.active&&(O(a,{x:Oe(f.x+u.x),y:Oe(f.y+u.y),dx:Oe(v.x),dy:Oe(v.y)},{originalEvent:t}),s("move"))}function l(t){var e=!0;i.active&&(t&&(i.payload.originalEvent=t,ht(t)),e=s("end")),!1===e&&s("rejected"),s("ended",g(!0!==e))}function h(t){(function(t,e){return-1!==(t=a(t)?t:[t]).indexOf(e.key)||-1!==t.indexOf(e.code)})("Escape",t)&&(ze(t),y())}function p(e){var n;i.active&&(n=Me(t),setTimeout(n,400),ze(e)),l(e)}function d(t){u(t)}function f(t){var e=i.payload;e.hoverGfx=t.gfx,e.hover=t.element,s("hover")}function v(t){s("out");var e=i.payload;e.hoverGfx=null,e.hover=null}function y(t){var e;if(i){var n=i.active;n&&s("cancel"),e=g(t),n&&s("canceled",e)}}function g(r){var a,c;s("cleanup"),je(),c=i.trapClick?p:l,J.unbind(document,"mousemove",u),J.unbind(document,"dragstart",ze),J.unbind(document,"selectstart",ze),J.unbind(document,"mousedown",c,!0),J.unbind(document,"mouseup",c,!0),J.unbind(document,"keyup",h),J.unbind(document,"touchstart",d,!0),J.unbind(document,"touchcancel",y,!0),J.unbind(document,"touchmove",u,!0),J.unbind(document,"touchend",l,!0),t.off("element.hover",f),t.off("element.out",v),e.removeMarker(e.getRootElement(),Be);var g=i.payload.previousSelection;return!1!==r&&g&&!n.get().length&&function(t){var e=t.filter(function(t){return o.get(t.id)});e.length&&n.select(e)}(g),a=i,i=null,a}t.on("diagram.destroy",y),this.init=function(e,n,o,a){i&&y(!1),"string"==typeof n&&(a=o,o=n,n=null);var g,m,x,_,w,b=(a=O({},r,a||{})).data||{};_=a.trapClick?p:l,e?(g=lt(e)||e,m=pt(e),ht(e),"dragstart"===g.type&&ze(g)):(g=null,m={x:0,y:0}),x=c(m),n||(n=x),w=function(t){return"undefined"!=typeof TouchEvent&&t instanceof TouchEvent}(g),i=O({prefix:o,data:b,payload:{},globalStart:m,displacement:Re(n,x),localStart:x,isTouch:w},a),a.manual||(w?(J.bind(document,"touchstart",d,!0),J.bind(document,"touchcancel",y,!0),J.bind(document,"touchmove",u,!0),J.bind(document,"touchend",l,!0)):(J.bind(document,"mousemove",u),J.bind(document,"dragstart",ze),J.bind(document,"selectstart",ze),J.bind(document,"mousedown",_,!0),J.bind(document,"mouseup",_,!0)),J.bind(document,"keyup",h),t.on("element.hover",f),t.on("element.out",v)),s("init"),a.autoActivate&&u(e,!0)},this.move=u,this.hover=f,this.out=v,this.end=l,this.cancel=y,this.context=function(){return i},this.setOptions=function(t){O(r,t)}}Te.$inject=["eventBus","canvas","selection","elementRegistry"];var Ae={__depends__:[ke,_e],dragging:["type",Te]};function Le(t){return t.childNodes[0]}var De=["marker-start","marker-mid","marker-end"],Ie=["circle","ellipse","line","path","polygon","polyline","path","rect"];function $e(t,e,n,o){this._elementRegistry=t,this._canvas=n,this._styles=o,this._clonedMarkers={};var i=this;e.on("drag.cleanup",function(){i.cleanUp()})}$e.$inject=["elementRegistry","eventBus","canvas","styles"],$e.prototype.cleanUp=function(){f(this._clonedMarkers,function(t){Gt(t)}),this._clonedMarkers={}},$e.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)},$e.prototype.addDragger=function(t,e,n,o="djs-dragger"){var i=St(n=n||this.getGfx(t)),r=n.getBoundingClientRect();return this._cloneMarkers(Le(i),o),wt(i,this._styles.cls(o,[],{x:r.top,y:r.left})),mt(e,i),wt(i,"data-preview-support-element-id",t.id),i},$e.prototype.addFrame=function(t,e){var n=Rt("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return mt(e,n),wt(n,"data-preview-support-element-id",t.id),n},$e.prototype._cloneMarkers=function(t,e="djs-dragger"){var n=this;if(t.childNodes)for(var o=0;o<t.childNodes.length;o++)n._cloneMarkers(t.childNodes[o],e);(function(t){return-1!==Ie.indexOf(t.nodeName)})(t)&&De.forEach(function(o){if(wt(t,o)){var i=function(t,e,n){var o=(i=wt(t,e),i.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]);var i;return at("marker#"+o,n||document)}(t,o,n._canvas.getContainer());n._cloneMarker(t,i,o,e)}})},$e.prototype._cloneMarker=function(t,e,n,o="djs-dragger"){var i=e.id+"-"+o,r=this._clonedMarkers[i];if(!r){var a=i+"-clone";(r=St(e)).id=a,Et(r).add(o),this._clonedMarkers[i]=r;var c=at("defs",this._canvas._svg);c||(c=Rt("defs"),mt(this._canvas._svg,c)),mt(c,r)}wt(t,n,"url(#"+this._clonedMarkers[i].id+")")};var He={__init__:["previewSupport"],previewSupport:["type",$e]},Ve=Math.round;function Ge(t,e,n,o,i){function r(t,e,n,o){return i.allowed("elements.move",{shapes:t,delta:e,position:n,target:o})}function a(t,n,o,i){if(c(o)&&(i=o,o=!1),!n.waypoints&&n.parent&&!Et(t.target).has("djs-hit-no-move")){var r=function(t){return{x:t.x+Ve(t.width/2),y:t.y+Ve(t.height/2)}}(n);return e.init(t,r,"shape.move",{cursor:"grabbing",autoActivate:o,data:{shape:n,context:i||{}}}),!0}}t.on("shape.move.start",1500,function(t){var e=t.context,n=t.shape,i=o.get().slice();-1===i.indexOf(n)&&(i=[n]),i=function(t){var e=b(t,"id");return d(t,function(t){for(;t=t.parent;)if(e[t.id])return!1;return!0})}(i),O(e,{shapes:i,validatedShapes:i,shape:n})}),t.on("shape.move.start",1250,function(t){var e=t.context,n=e.validatedShapes;if(!(e.canExecute=r(n)))return!1}),t.on("shape.move.move",500,function(t){var e,n=t.context,o=n.validatedShapes,i=t.hover,a={x:t.dx,y:t.dy};e=r(o,a,{x:t.x,y:t.y},i),n.delta=a,n.canExecute=e,n.target=null!==e?i:null}),t.on("shape.move.end",function(t){var e=t.context,o=e.delta,i=e.canExecute,r="attach"===i,a=e.shapes;if(!1===i)return!1;o.x=Ve(o.x),o.y=Ve(o.y),0===o.x&&0===o.y||n.moveElements(a,o,e.target,{primaryShape:e.shape,attach:r})}),t.on("element.mousedown",function(t){if(vt(t)){var e=lt(t);if(!e)throw new Error("must supply DOM mousedown event");return a(e,t.element)}}),this.start=a}function Ne(t,e,n){var o=Tt();o.setTranslate(e,n),Ft(t,o)}function Fe(t){return c(t)&&h(t,"waypoints")}function We(t){return c(t)&&h(t,"labelTarget")}Ge.$inject=["eventBus","dragging","modeling","selection","rules"];var qe="djs-dragging",Ue="drop-ok",Ye="drop-not-ok",Ke="new-parent",Xe="attach-ok";function Ze(e,n,o,i){function r(t){var e=function(t){var e=d(t,function(e){return!Fe(e)||p(t,C({id:e.source.id}))&&p(t,C({id:e.target.id}))});return e}(a(t));return e}function a(e){var n=ce(e,!0),o=x(n,function(t){return(t.incoming||[]).concat(t.outgoing||[])});return t(n.concat(o))}function c(t,e){[Xe,Ue,Ye,Ke].forEach(function(o){o===e?n.addMarker(t,o):n.removeMarker(t,o)})}e.on("shape.move.start",499,function(e){var c=e.context,s=c.shapes,u=c.allDraggedElements,l=r(s);if(!c.dragGroup){var h=Rt("g");wt(h,o.cls("djs-drag-group",["no-events"])),mt(n.getActiveLayer(),h),c.dragGroup=h}l.forEach(function(t){i.addDragger(t,c.dragGroup)}),f(u=u?t([u,a(s)]):a(s),function(t){n.addMarker(t,qe)}),c.allDraggedElements=u,c.differentParents=1!==_(b(s,function(t){return t.parent&&t.parent.id}))}),e.on("shape.move.move",499,function(t){var e=t.context,n=e.dragGroup,o=e.target,i=e.shape.parent,r=e.canExecute;o&&("attach"===r?c(o,Xe):e.canExecute&&o&&o.id!==i.id?c(o,Ke):c(o,e.canExecute?Ue:Ye)),Ne(n,t.dx,t.dy)}),e.on(["shape.move.out","shape.move.cleanup"],function(t){var e=t.context.target;e&&c(e,null)}),e.on("shape.move.cleanup",function(t){var e=t.context,o=e.allDraggedElements,i=e.dragGroup;f(o,function(t){n.removeMarker(t,qe)}),i&&Gt(i)}),this.makeDraggable=function(t,e,o){i.addDragger(e,t.dragGroup),o&&n.addMarker(e,qe),t.allDraggedElements?t.allDraggedElements.push(e):t.allDraggedElements=[e]}}Ze.$inject=["eventBus","canvas","styles","previewSupport"];var Je={__depends__:[ne,_e,de,be,Ae,He],__init__:["move","movePreview"],move:["type",Ge],movePreview:["type",Ze]};function Qe(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}Qe.$inject=["eventBus","dragging"],Qe.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error('A tool has to be registered with it\'s "events"');n.push(t),this.bindEvents(t,e)},Qe.prototype.isActive=function(t){return t&&this._active===t},Qe.prototype.length=function(t){return this._tools.length},Qe.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))},Qe.prototype.bindEvents=function(t,e){var n=this._eventBus,o=this._dragging,i=[];n.on(e.tool+".init",function(e){if(!e.context.reactivate&&this.isActive(t))return this.setActive(null),void o.cancel();this.setActive(t)},this),f(e,function(t){i.push(t+".ended"),i.push(t+".canceled")}),n.on(i,250,function(t){this._active&&(function(t){var e=t.originalEvent&&t.originalEvent.target;return e&&q(e,'.group[data-group="tools"]')}(t)||this.setActive(null))},this)};var tn={__depends__:[Ae],__init__:["toolManager"],toolManager:["type",Qe]};function en(t){var e=this;function n(t){e._lastMoveEvent=t}this._lastMoveEvent=null,t.on("canvas.init",function(t){(e._svg=t.svg).addEventListener("mousemove",n)}),t.on("canvas.destroy",function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)})}en.$inject=["eventBus"],en.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||function(t,e){var n=document.createEvent("MouseEvent"),o=t,i=e,r=t,a=e;n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,o,i,r,a,!1,!1,!1,!1,0,null);return n}(0,0)};var nn={__init__:["mouse"],mouse:["type",en]},on="crosshair";function rn(t,e,n,o,i,r,a){this._selection=i,this._dragging=n,this._mouse=a;var c=this,s=function(t){var n,o=e.getActiveLayer();wt(n=t.frame=Rt("rect"),{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),mt(o,n)},u=function(t){var e=t.frame,n=t.bbox;wt(e,{x:n.x,y:n.y,width:n.width,height:n.height})},l=function(t){t.frame&&Gt(t.frame)};r.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",function(e){var n=e.originalEvent.target;(e.hover||n instanceof SVGElement)&&t.once("lasso.selection.ended",function(){c.activateLasso(e.originalEvent,!0)})}),t.on("lasso.end",function(t){var e=an(t),n=o.filter(function(t){return t});c.select(n,e)}),t.on("lasso.start",function(t){var e=t.context;e.bbox=an(t),s(e)}),t.on("lasso.move",function(t){var e=t.context;e.bbox=an(t),u(e)}),t.on("lasso.cleanup",function(t){var e=t.context;l(e)}),t.on("element.mousedown",1500,function(t){if(yt(t))return c.activateLasso(t.originalEvent),!0})}function an(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y};return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?{x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?{x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?{x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:{x:n.x,y:n.y,width:0,height:0}}rn.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],rn.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:on,data:{context:{}}})},rn.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:on,data:{context:{}}})},rn.prototype.select=function(t,e){var n=function(t,e){var n={};return f(t,function(t){var o=t;o.waypoints&&(o=se(o)),!s(e.y)&&o.x>e.x&&(n[t.id]=t),!s(e.x)&&o.y>e.y&&(n[t.id]=t),o.x>e.x&&o.y>e.y&&(s(e.width)&&s(e.height)&&o.width+o.x<e.width+e.x&&o.height+o.y<e.height+e.y?n[t.id]=t:s(e.width)&&s(e.height)||(n[t.id]=t))}),n}(t,e);this._selection.select(w(n))},rn.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},rn.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};var cn={__depends__:[tn,nn],__init__:["lassoTool"],lassoTool:["type",rn]};function sn(t){return CSS.escape(t)}var un=".djs-palette-toggle",ln=".entry",hn=un+", "+ln,pn="djs-palette-",dn="open",fn="two-column";function vn(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",function(t){var e=t.tool;n.updateToolHighlight(e)}),t.on("i18n.changed",function(){n._update()}),t.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}function yn(t,e){var n=e.getPaletteEntries();return u(n)?n(t):(f(n,function(e,n){t[n]=e}),t)}vn.$inject=["eventBus","canvas"],vn.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("palette.getProviders",t,function(t){t.providers.push(e)}),this._rebuild()},vn.prototype.getEntries=function(){return this._getProviders().reduce(yn,{})},vn.prototype._rebuild=function(){this._diagramInitialized&&(this._getProviders().length&&(this._container||this._init(),this._update()))},vn.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),o=this._container=rt(vn.HTML_MARKUP);n.appendChild(o),N(n).add(pn+"shown"),et.bind(o,hn,"click",function(e){var n,o,i=e.delegateTarget;if(o=un,(n=i)&&"function"==typeof n.matches&&n.matches(o))return t.toggle();t.trigger("click",e)}),J.bind(o,"mousedown",function(t){t.stopPropagation()}),et.bind(o,ln,"dragstart",function(e){t.trigger("dragstart",e)}),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:o})},vn.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},vn.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),o=this._container,i=this._eventBus,r=N(o),a=N(n);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),r.toggle(fn,e),a.toggle(pn+fn,e),"open"in t&&(r.toggle(dn,t.open),a.toggle(pn+dn,t.open)),i.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},vn.prototype._update=function(){var t=at(".djs-palette-entries",this._container),e=this._entries=this.getEntries();W(t),f(e,function(e,n){var o=e.group||"default",i=at("[data-group="+sn(o)+"]",t);i||(V(i=rt('<div class="group"></div>'),"data-group",o),t.appendChild(i));var r=e.html||(e.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),c=rt(r);if(i.appendChild(c),!e.separator&&(V(c,"data-action",n),e.title&&V(c,"title",e.title),e.className&&function(t,e){var n=N(t);(a(e)?e:e.split(/\s+/g)).forEach(function(t){n.add(t)})}(c,e.className),e.imageUrl)){var s=rt("<img>");V(s,"src",e.imageUrl),c.appendChild(s)}}),this.open()},vn.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=V(r,"data-action"),i=e.originalEvent||e,this.triggerEntry(o,t,i,n)):e.preventDefault()},vn.prototype.triggerEntry=function(t,e,n,o){var i,r;if((i=this._entries[t])&&(r=i.action,!1!==this._eventBus.fire("palette.trigger",{entry:i,event:n}))){if(u(r)){if("click"===e)return r(n,o)}else if(r[e])return r[e](n,o);n.preventDefault()}},vn.prototype._layoutChanged=function(){this._toggleState({})},vn.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},vn.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},vn.prototype.open=function(){this._toggleState({open:!0})},vn.prototype.toggle=function(){this.isOpen()?this.close():this.open()},vn.prototype.isActiveTool=function(t){return t&&this._activeTool===t},vn.prototype.updateToolHighlight=function(t){var e;this._toolsContainer||(e=at(".djs-palette-entries",this._container),this._toolsContainer=at("[data-group=tools]",e)),f(this._toolsContainer.children,function(e){var n=e.getAttribute("data-action");if(n){var o=N(e);n=n.replace("-tool",""),o.contains("entry")&&n===t?o.add("highlighted-entry"):o.remove("highlighted-entry")}})},vn.prototype.isOpen=function(){return N(this._container).has(dn)},vn.prototype._getParentContainer=function(){return this._canvas.getContainer()},vn.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';var gn={__init__:["palette"],palette:["type",vn]},mn="drop-ok",xn="drop-not-ok",_n="attach-ok",wn="new-parent",bn="create";function En(t,e,n,o,i){function r(e,n){[_n,mn,xn,wn].forEach(function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)})}function c(){var t=e.context();t&&t.prefix===bn&&e.cancel()}n.on(["create.move","create.hover"],function(t){var e=t.context,n=e.elements,o=t.hover,a=e.source,c=e.hints||{};if(!o)return e.canExecute=!1,void(e.target=null);kn(t);var s={x:t.x,y:t.y},u=e.canExecute=o&&function(t,e,n,o,r){if(!e)return!1;var a=p(t=d(t,function(e){var n=e.labelTarget;return!(e.parent||We(e)&&-1!==t.indexOf(n))}),function(t){return!Fe(t)}),c=!1,s=!1,u=!1;Cn(t)&&(c=i.allowed("shape.attach",{position:n,shape:a,target:e})),c||(u=Cn(t)?i.allowed("shape.create",{position:n,shape:a,source:o,target:e}):i.allowed("elements.create",{elements:t,position:n,target:e}));var l=r.connectionTarget;return u||c?(a&&o&&(s=i.allowed("connection.create",{source:l===o?a:o,target:l===o?o:a,hints:{targetParent:e,targetAttach:c}})),{attach:c,connect:s}):(null===u||null===c)&&null}(n,o,s,a,c);o&&null!==u&&(e.target=o,u&&u.attach?r(o,_n):r(o,u?wn:xn))}),n.on(["create.end","create.out","create.cleanup"],function(t){var e=t.hover;e&&r(e,null)}),n.on("create.end",function(t){var e=t.context,n=e.source,i=e.shape,r=e.elements,a=e.target,c=e.canExecute,s=c&&c.attach,u=c&&c.connect,l=e.hints||{};if(!1===c||!a)return!1;kn(t);var h={x:t.x,y:t.y};i=u?o.appendShape(n,i,h,a,{attach:s,connection:!0===u?{}:u,connectionTarget:l.connectionTarget}):p(r=o.createElements(r,h,a,O({},l,{attach:s})),function(t){return!Fe(t)}),O(e,{elements:r,shape:i}),O(t,{elements:r,shape:i})}),n.on("create.init",function(){n.on("elements.changed",c),n.once(["create.cancel","create.end"],2e3,function(){n.off("elements.changed",c)})}),this.start=function(t,n,o){a(n)||(n=[n]);var i=p(n,function(t){return!Fe(t)});if(i){o=O({elements:n,hints:{},shape:i},o||{}),f(n,function(t){s(t.x)||(t.x=0),s(t.y)||(t.y=0)});var r=se(d(n,function(t){return!t.hidden}));f(n,function(t){Fe(t)&&(t.waypoints=x(t.waypoints,function(t){return{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2}})),O(t,{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2})}),e.init(t,bn,{cursor:"grabbing",autoActivate:!0,data:{shape:i,elements:n,context:o}})}}}function kn(t){var e=t.context.createConstraints;e&&(e.left&&(t.x=Math.max(t.x,e.left)),e.right&&(t.x=Math.min(t.x,e.right)),e.top&&(t.y=Math.max(t.y,e.top)),e.bottom&&(t.y=Math.min(t.y,e.bottom)))}function Cn(t){return t&&1===t.length&&!Fe(t[0])}En.$inject=["canvas","dragging","eventBus","modeling","rules"];function Sn(t,e,n,o,i){e.on("create.move",750,function(e){var r=e.hover,a=e.context,c=a.elements,s=a.dragGroup;s||(s=a.dragGroup=function(t){var e=Rt("g");wt(e,i.cls("djs-drag-group",["no-events"]));var r=Rt("g");return t.forEach(function(t){var i;t.hidden||(t.waypoints?(i=n._createContainer("connection",r),n.drawConnection(Le(i),t)):(i=n._createContainer("shape",r),n.drawShape(Le(i),t),Ne(i,t.x,t.y)),o.addDragger(t,e,i))}),e}(c)),r?(s.parentNode||mt(t.getActiveLayer(),s),Ne(s,e.x,e.y)):Gt(s)}),e.on("create.cleanup",function(t){var e=t.context.dragGroup;e&&Gt(e)})}Sn.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];var jn={__depends__:[Ae,He,be,_e],__init__:["create","createPreview"],create:["type",En],createPreview:["type",Sn]};function Mn(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}Mn.prototype.next=function(){return this._prefix+ ++this._counter};var Pn=new Mn("ov");function Rn(t,e,n,o){var i,r;this._eventBus=e,this._canvas=n,this._elementRegistry=o,this._ids=Pn,this._overlayDefaults=O({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(i=n.getContainer(),H(r=rt('<div class="djs-overlay-container" />'),{position:"absolute",width:0,height:0}),i.insertBefore(r,i.firstChild),r),this._init()}function On(t,e,n){H(t,{left:e+"px",top:n+"px"})}function Bn(t,e){t.style.display=!1===e?"none":""}function zn(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach(function(n){t.style[n+"transform"]=e})}Rn.$inject=["config.overlays","eventBus","canvas","elementRegistry"],Rn.prototype.get=function(t){if(l(t)&&(t={id:t}),l(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?d(e.overlays,C({type:t.type})):e.overlays.slice():[]}return t.type?d(this._overlays,C({type:t.type})):t.id?this._overlays[t.id]:null},Rn.prototype.add=function(t,e,n){if(c(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var o=this._ids.next();return n=O({},this._overlayDefaults,n,{id:o,type:e,element:t,html:n.html}),this._addOverlay(n),o},Rn.prototype.remove=function(t){var e=this.get(t)||[];a(e)||(e=[e]);var n=this;f(e,function(t){var e=n._getOverlayContainer(t.element,!0);if(t&&(st(t.html),st(t.htmlContainer),delete t.htmlContainer,delete t.element,delete n._overlays[t.id]),e){var o=e.overlays.indexOf(t);-1!==o&&e.overlays.splice(o,1)}})},Rn.prototype.isShown=function(){return"none"!==this._overlayRoot.style.display},Rn.prototype.show=function(){Bn(this._overlayRoot)},Rn.prototype.hide=function(){Bn(this._overlayRoot,!1)},Rn.prototype.clear=function(){this._overlays={},this._overlayContainers=[],W(this._overlayRoot)},Rn.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,o=e.x,i=e.y;if(e.waypoints){var r=se(e);o=r.x,i=r.y}On(n,o,i),V(t.html,"data-container-id",e.id)},Rn.prototype._updateOverlay=function(t){var e,n,o=t.position,i=t.htmlContainer,r=t.element,a=o.left,c=o.top;void 0!==o.right&&(e=r.waypoints?se(r).width:r.width,a=-1*o.right+e);void 0!==o.bottom&&(n=r.waypoints?se(r).height:r.height,c=-1*o.bottom+n);On(i,a||0,c||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())},Rn.prototype._createOverlayContainer=function(t){var e=rt('<div class="djs-overlays" />');H(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},Rn.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";zn(this._overlayRoot,n)},Rn.prototype._getOverlayContainer=function(t,e){var n=p(this._overlayContainers,function(e){return e.element===t});return n||e?n:this._createOverlayContainer(t)},Rn.prototype._addOverlay=function(t){var e,n,o=t.id,i=t.element,r=t.html;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),l(r)&&(r=rt(r)),n=this._getOverlayContainer(i),H(e=rt('<div class="djs-overlay" data-overlay-id="'+o+'">'),{position:"absolute"}),e.appendChild(r),t.type&&N(e).add("djs-overlay-"+t.type),Bn(e,this._canvas.findRoot(i)===this._canvas.getRootElement()),t.htmlContainer=e,n.overlays.push(t),n.html.appendChild(e),this._overlays[o]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())},Rn.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,o=this._canvas.findRoot(t.element),r=n&&n.minZoom,a=n&&n.maxZoom,c=t.htmlContainer,s=!0;(o!==this._canvas.getRootElement()||n&&(i(r)&&r>e.scale||i(a)&&a<e.scale))&&(s=!1),Bn(c,s),this._updateOverlayScale(t,e)},Rn.prototype._updateOverlayScale=function(t,e){var n,o,r,a=t.scale,c=t.htmlContainer,s="";!0!==a&&(!1===a?(n=1,o=1):(n=a.min,o=a.max),i(n)&&e.scale<n&&(r=(1/e.scale||1)*n),i(o)&&e.scale>o&&(r=(1/e.scale||1)*o)),i(r)&&(s="scale("+r+","+r+")"),zn(c,s)},Rn.prototype._updateOverlaysVisibilty=function(t){var e=this;f(this._overlays,function(n){e._updateOverlayVisibilty(n,t)})},Rn.prototype._init=function(){var t=this._eventBus,e=this;t.on("canvas.viewbox.changing",function(t){e.hide()}),t.on("canvas.viewbox.changed",function(t){var n;n=t.viewbox,e._updateRoot(n),e._updateOverlaysVisibilty(n),e.show()}),t.on(["shape.remove","connection.remove"],function(t){var n=t.element;f(e.get({element:n}),function(t){e.remove(t.id)});var o=e._getOverlayContainer(n);if(o){st(o.html);var i=e._overlayContainers.indexOf(o);-1!==i&&e._overlayContainers.splice(i,1)}}),t.on("element.changed",500,function(t){var n=t.element,o=e._getOverlayContainer(n,!0);o&&(f(o.overlays,function(t){e._updateOverlay(t)}),e._updateOverlayContainer(o))}),t.on("element.marker.update",function(t){var n=e._getOverlayContainer(t.element,!0);n&&N(n.html)[t.add?"add":"remove"](t.marker)}),t.on("root.set",function(){e._updateOverlaysVisibilty(e._canvas.viewbox())}),t.on("diagram.clear",this.clear,this)};var Tn={__init__:["overlays"],overlays:["type",Rn]},An=".entry";function Ln(t,e,n,o){this._canvas=t,this._eventBus=n,this._overlays=o;var r=i(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:r},this._current=null,this._init()}function Dn(t,e){return-1!==t.indexOf(e)}Ln.$inject=["canvas","config.contextPad","eventBus","overlays"],Ln.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",function(e){var n=e.newSelection,o=n.length?1===n.length?n[0]:n:null;o?t.open(o,!0):t.close()}),this._eventBus.on("elements.changed",function(e){var n=e.elements,o=t._current;if(o){var i=o.target;m(a(i)?i:[i],function(t){return Dn(n,t)})&&t.open(i,!0)}})},Ln.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("contextPad.getProviders",t,function(t){t.providers.push(e)})},Ln.prototype.getEntries=function(t){var e=this._getProviders(),n=a(t)?"getMultiElementContextPadEntries":"getContextPadEntries",o={};return f(e,function(e){if(u(e[n])){var i=e[n](t);u(i)?o=i(o):f(i,function(t,e){o[e]=t})}}),o},Ln.prototype.trigger=function(t,e,n){var o,i,r=e.delegateTarget||e.target;return r?(o=V(r,"data-action"),i=e.originalEvent||e,"mouseover"===t?this._timeout=setTimeout(()=>{this._mouseout=this.triggerEntry(o,"hover",i,n)},300):"mouseout"===t&&(clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null)),this.triggerEntry(o,t,i,n)):e.preventDefault()},Ln.prototype.triggerEntry=function(t,e,n,o){if(this.isShown()){var i=this._current.target,r=this._current.entries[t];if(r){var a=r.action;if(!1!==this._eventBus.fire("contextPad.trigger",{entry:r,event:n})){if(u(a)){if("click"===e)return a(n,i,o)}else if(a[e])return a[e](n,i,o);n.preventDefault()}}}},Ln.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))},Ln.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},Ln.prototype._updateAndOpen=function(t){var e,n=this.getEntries(t),o=this.getPad(t),i=o.html;f(n,function(t,n){var o,r=t.group||"default",c=rt(t.html||'<div class="entry" draggable="true"></div>');V(c,"data-action",n),(o=at("[data-group="+sn(r)+"]",i))||(V(o=rt('<div class="group"></div>'),"data-group",r),i.appendChild(o)),o.appendChild(c),t.className&&function(t,e){var n=N(t);(e=a(e)?e:e.split(/\s+/g)).forEach(function(t){n.add(t)})}(c,t.className),t.title&&V(c,"title",t.title),t.imageUrl&&(V(e=rt("<img>"),"src",t.imageUrl),e.style.width="100%",e.style.height="100%",c.appendChild(e))}),N(i).add("open"),this._current={target:t,entries:n,pad:o},this._eventBus.fire("contextPad.open",{current:this._current})},Ln.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,o=rt('<div class="djs-context-pad"></div>'),i=this._getPosition(t),r=O({html:o},this._overlaysConfig,i);et.bind(o,An,"click",function(t){e.trigger("click",t)}),et.bind(o,An,"dragstart",function(t){e.trigger("dragstart",t)}),et.bind(o,An,"mouseover",function(t){e.trigger("mouseover",t)}),et.bind(o,An,"mouseout",function(t){e.trigger("mouseout",t)}),J.bind(o,"mousedown",function(t){t.stopPropagation()});var a=this._canvas.getRootElement();this._overlayId=n.add(a,"context-pad",r);var c=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:c}),c},Ln.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},Ln.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return a(t)===a(n)&&(a(t)?t.length===n.length&&g(t,function(t){return Dn(n,t)}):n===t)},Ln.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()},Ln.prototype._getPosition=function(t){var e,n=se(a(t=Fe(t)?(e=t).waypoints[e.waypoints.length-1]:t)?t:[t]);return{position:{left:n.x+n.width+12,top:n.y-6}}};var In={__depends__:[ne,Tn],contextPad:["type",Ln]};function $n(t,e){return t&&e?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):-1}function Hn(t,e,n,o){if(void 0===o&&(o=5),!t||!e||!n)return!1;var i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),r=$n(t,e);return Math.abs(i/r)<=o}function Vn(t,e){var n=Array.from(arguments).flat();const o={x:"v",y:"h"};for(const[t,e]of Object.entries(o))if(Gn(t,n))return e;return!1}function Gn(t,e){const n=e[0];return g(e,function(e){return Math.abs(n[t]-e[t])<=2})}function Nn(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function Fn(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function Wn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/**
   * This file contains source code adapted from Snap.svg (licensed Apache-2.0).
   *
   * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js
   */var qn=/,?([a-z]),?/gi,Un=parseFloat,Yn=Math,Kn=Yn.PI,Xn=Yn.min,Zn=Yn.max,Jn=Yn.pow,Qn=Yn.abs,to=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,eo=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi,no=Array.isArray||function(t){return t instanceof Array};function oo(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function io(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)oo(t,n)&&(e[n]=io(t[n]));return e}function ro(t){var e=ro.ps=ro.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout(function(){for(var n in e)oo(e,n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])}),e[t]}function ao(t,e,n,o){return 1===arguments.length&&(e=t.y,n=t.width,o=t.height,t=t.x),{x:t,y:e,width:n,height:o,x2:t+n,y2:e+o}}function co(){return this.join(",").replace(qn,"$1")}function so(t){var e=io(t);return e.toString=co,e}function uo(t,e,n,o,i,r,a,c,s){var u=1-s,l=Jn(u,3),h=Jn(u,2),p=s*s*s,d=l*e+3*h*s*o+3*u*s*s*r+p*c;return{x:yo(l*t+3*h*s*n+3*u*s*s*i+p*a),y:yo(d)}}function lo(t){var e=Eo.apply(null,t);return ao(e.x0,e.y0,e.x1-e.x0,e.y1-e.y0)}function ho(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function po(t,e,n,o,i){return t*(t*(-3*e+9*n-9*o+3*i)+6*e-12*n+6*o)-3*e+3*n}function fo(t,e,n,o,i,r,a,c,s){null==s&&(s=1);for(var u=(s=s>1?1:s<0?0:s)/2,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0,d=0;d<12;d++){var f=u*l[d]+u,v=po(f,t,n,i,a),y=po(f,e,o,r,c),g=v*v+y*y;p+=h[d]*Yn.sqrt(g)}return u*p}function vo(t,e,n,o,i,r,a,c){if(!(Zn(t,n)<Xn(i,a)||Xn(t,n)>Zn(i,a)||Zn(e,o)<Xn(r,c)||Xn(e,o)>Zn(r,c))){var s=(t*o-e*n)*(r-c)-(e-o)*(i*c-r*a),u=(t-n)*(r-c)-(e-o)*(i-a);if(u){var l=yo(((t*o-e*n)*(i-a)-(t-n)*(i*c-r*a))/u),h=yo(s/u),p=+l.toFixed(2),d=+h.toFixed(2);if(!(p<+Xn(t,n).toFixed(2)||p>+Zn(t,n).toFixed(2)||p<+Xn(i,a).toFixed(2)||p>+Zn(i,a).toFixed(2)||d<+Xn(e,o).toFixed(2)||d>+Zn(e,o).toFixed(2)||d<+Xn(r,c).toFixed(2)||d>+Zn(r,c).toFixed(2)))return{x:l,y:h}}}}function yo(t){return Math.round(1e11*t)/1e11}function go(t,e,n){if(!function(t,e){return t=ao(t),ho(e=ao(e),t.x,t.y)||ho(e,t.x2,t.y)||ho(e,t.x,t.y2)||ho(e,t.x2,t.y2)||ho(t,e.x,e.y)||ho(t,e.x2,e.y)||ho(t,e.x,e.y2)||ho(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}(lo(t),lo(e)))return n?0:[];for(var o=fo.apply(0,t),i=fo.apply(0,e),r=xo(t)?1:~~(o/5)||1,a=xo(e)?1:~~(i/5)||1,c=[],s=[],u={},l=n?0:[],h=0;h<r+1;h++){var p=uo.apply(0,t.concat(h/r));c.push({x:p.x,y:p.y,t:h/r})}for(h=0;h<a+1;h++)p=uo.apply(0,e.concat(h/a)),s.push({x:p.x,y:p.y,t:h/a});for(h=0;h<r;h++)for(var d=0;d<a;d++){var f,v=c[h],y=c[h+1],g=s[d],m=s[d+1],x=Qn(y.x-v.x)<.01?"y":"x",_=Qn(m.x-g.x)<.01?"y":"x",w=vo(v.x,v.y,y.x,y.y,g.x,g.y,m.x,m.y);if(w){if(u[f=w.x.toFixed(9)+"#"+w.y.toFixed(9)])continue;u[f]=!0;var b=v.t+Qn((w[x]-v[x])/(y[x]-v[x]))*(y.t-v.t),E=g.t+Qn((w[_]-g[_])/(m[_]-g[_]))*(m.t-g.t);b>=0&&b<=1&&E>=0&&E<=1&&(n?l++:l.push({x:w.x,y:w.y,t1:b,t2:E}))}}return l}function mo(t){var e=ro(t);if(e.abs)return so(e.abs);if(no(t)&&no(t&&t[0])||(t=function(t){if(!t)return null;var e=ro(t);if(e.arr)return io(e.arr);var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},o=[];return no(t)&&no(t[0])&&(o=io(t)),o.length||String(t).replace(to,function(t,e,i){var r=[],a=e.toLowerCase();for(i.replace(eo,function(t,e){e&&r.push(+e)}),"m"==a&&r.length>2&&(o.push([e].concat(r.splice(0,2))),a="l",e="m"==e?"l":"L");r.length>=n[a]&&(o.push([e].concat(r.splice(0,n[a]))),n[a]););}),o.toString=ro.toString,e.arr=io(o),o}(t)),!t||!t.length)return[["M",0,0]];var n,o=[],i=0,r=0,a=0,c=0,s=0;"M"==t[0][0]&&(a=i=+t[0][1],c=r=+t[0][2],s++,o[0]=["M",i,r]);for(var u,l,h=s,p=t.length;h<p;h++){if(o.push(u=[]),(n=(l=t[h])[0])!=n.toUpperCase())switch(u[0]=n.toUpperCase(),u[0]){case"A":u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=+l[6]+i,u[7]=+l[7]+r;break;case"V":u[1]=+l[1]+r;break;case"H":u[1]=+l[1]+i;break;case"M":a=+l[1]+i,c=+l[2]+r;default:for(var d=1,f=l.length;d<f;d++)u[d]=+l[d]+(d%2?i:r)}else for(var v=0,y=l.length;v<y;v++)u[v]=l[v];switch(n=n.toUpperCase(),u[0]){case"Z":i=+a,r=+c;break;case"H":i=u[1];break;case"V":r=u[1];break;case"M":a=u[u.length-2],c=u[u.length-1];default:i=u[u.length-2],r=u[u.length-1]}}return o.toString=co,e.abs=so(o),o}function xo(t){return t[0]===t[2]&&t[1]===t[3]&&t[4]===t[6]&&t[5]===t[7]}function _o(t,e,n,o){return[t,e,n,o,n,o]}function wo(t,e,n,o,i,r){var a=1/3,c=2/3;return[a*t+c*n,a*e+c*o,a*i+c*n,a*r+c*o,i,r]}function bo(t,e,n,o,i,r,a,c,s,u){var l,h,p=120*Kn/180,d=Kn/180*(+i||0),f=[],v=(h=function(t,e,n){return{x:t*Yn.cos(n)-e*Yn.sin(n),y:t*Yn.sin(n)+e*Yn.cos(n)}},function t(){var e=Array.prototype.slice.call(arguments,0),n=e.join(""),o=t.cache=t.cache||{},i=t.count=t.count||[];return oo(o,n)?(function(t,e){for(var n=0,o=t.length;n<o;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}(i,n),o[n]):(i.length>=1e3&&delete o[i.shift()],i.push(n),o[n]=h.apply(0,e),o[n])});if(u)k=u[0],C=u[1],b=u[2],E=u[3];else{t=(l=v(t,e,-d)).x,e=l.y;var y=(t-(c=(l=v(c,s,-d)).x))/2,g=(e-(s=l.y))/2,m=y*y/(n*n)+g*g/(o*o);m>1&&(n*=m=Yn.sqrt(m),o*=m);var x=n*n,_=o*o,w=(r==a?-1:1)*Yn.sqrt(Qn((x*_-x*g*g-_*y*y)/(x*g*g+_*y*y))),b=w*n*g/o+(t+c)/2,E=w*-o*y/n+(e+s)/2,k=Yn.asin(((e-E)/o).toFixed(9)),C=Yn.asin(((s-E)/o).toFixed(9));(k=t<b?Kn-k:k)<0&&(k=2*Kn+k),(C=c<b?Kn-C:C)<0&&(C=2*Kn+C),a&&k>C&&(k-=2*Kn),!a&&C>k&&(C-=2*Kn)}var S=C-k;if(Qn(S)>p){var j=C,M=c,P=s;C=k+p*(a&&C>k?1:-1),f=bo(c=b+n*Yn.cos(C),s=E+o*Yn.sin(C),n,o,i,0,a,M,P,[C,j,b,E])}S=C-k;var R=Yn.cos(k),O=Yn.sin(k),B=Yn.cos(C),z=Yn.sin(C),T=Yn.tan(S/4),A=4/3*n*T,L=4/3*o*T,D=[t,e],I=[t+A*O,e-L*R],$=[c+A*z,s-L*B],H=[c,s];if(I[0]=2*D[0]-I[0],I[1]=2*D[1]-I[1],u)return[I,$,H].concat(f);for(var V=[],G=0,N=(f=[I,$,H].concat(f).join().split(",")).length;G<N;G++)V[G]=G%2?v(f[G-1],f[G],d).y:v(f[G],f[G+1],d).x;return V}function Eo(t,e,n,o,i,r,a,c){for(var s,u,l,h,p,d,f,v,y=[],g=[[],[]],m=0;m<2;++m)if(0==m?(u=6*t-12*n+6*i,s=-3*t+9*n-9*i+3*a,l=3*n-3*t):(u=6*e-12*o+6*r,s=-3*e+9*o-9*r+3*c,l=3*o-3*e),Qn(s)<1e-12){if(Qn(u)<1e-12)continue;0<(h=-l/u)&&h<1&&y.push(h)}else f=u*u-4*l*s,v=Yn.sqrt(f),f<0||(0<(p=(-u+v)/(2*s))&&p<1&&y.push(p),0<(d=(-u-v)/(2*s))&&d<1&&y.push(d));for(var x,_=y.length,w=_;_--;)x=1-(h=y[_]),g[0][_]=x*x*x*t+3*x*x*h*n+3*x*h*h*i+h*h*h*a,g[1][_]=x*x*x*e+3*x*x*h*o+3*x*h*h*r+h*h*h*c;return g[0][w]=t,g[1][w]=e,g[0][w+1]=a,g[1][w+1]=c,g[0].length=g[1].length=w+2,{x0:Xn.apply(0,g[0]),y0:Xn.apply(0,g[1]),x1:Zn.apply(0,g[0]),y1:Zn.apply(0,g[1])}}function ko(t){var e=ro(t);if(e.curve)return so(e.curve);for(var n=mo(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i=function(t,e,n){var o,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(bo.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==n||"S"==n?(o=2*e.x-e.bx,i=2*e.y-e.by):(o=e.x,i=e.y),t=["C",o,i].concat(t.slice(1));break;case"T":"Q"==n||"T"==n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(wo(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(wo(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(_o(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(_o(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(_o(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(_o(e.x,e.y,e.X,e.Y))}return t},r=function(t,e){if(t[e].length>7){t[e].shift();for(var o=t[e];o.length;)a[e]="A",t.splice(e++,0,["C"].concat(o.splice(0,6)));t.splice(e,1),l=n.length}},a=[],c="",s="",u=0,l=n.length;u<l;u++){n[u]&&(c=n[u][0]),"C"!=c&&(a[u]=c,u&&(s=a[u-1])),n[u]=i(n[u],o,s),"A"!=a[u]&&"C"==c&&(a[u]="C"),r(n,u);var h=n[u],p=h.length;o.x=h[p-2],o.y=h[p-1],o.bx=Un(h[p-4])||o.x,o.by=Un(h[p-3])||o.y}return e.curve=so(n),n}var Co=Wn(function(t,e,n){t=ko(t),e=ko(e);for(var o,i,r,a,c,s,u,l,h,p,d=n?0:[],f=0,v=t.length;f<v;f++){var y=t[f];if("M"==y[0])o=c=y[1],i=s=y[2];else{"C"==y[0]?(h=[o,i].concat(y.slice(1)),o=h[6],i=h[7]):(h=[o,i,o,i,c,s,c,s],o=c,i=s);for(var g=0,m=e.length;g<m;g++){var x=e[g];if("M"==x[0])r=u=x[1],a=l=x[2];else{"C"==x[0]?(p=[r,a].concat(x.slice(1)),r=p[6],a=p[7]):(p=[r,a,r,a,u,l,u,l],r=u,a=l);var _=go(h,p,n);if(n)d+=_;else{for(var w=0,b=_.length;w<b;w++)_[w].segment1=f,_[w].segment2=g,_[w].bez1=h,_[w].bez2=p;d=d.concat(_)}}}}}return d}),So=Math.round,jo=Math.max;function Mo(t,e){return function(t,e){var n,o;for(n=0;o=t[n];n++)if($n(o,e)<=10)return{point:t[n],bendpoint:!0,index:n};return null}(t,e)||function(t,e){var n,o,i=Co(function(t,e){return[["M",t.x,t.y],["m",0,-e],["a",e,e,0,1,1,0,2*e],["a",e,e,0,1,1,0,-2*e],["z"]]}(e,10),(n=[],t.forEach(function(t,e){n.push([0===e?"M":"L",t.x,t.y])}),n)),r=i[0],a=i[i.length-1];return r?r!==a?r.segment2!==a.segment2?{point:t[o=jo(r.segment2,a.segment2)-1],bendpoint:!0,index:o}:{point:{x:So(r.x+a.x)/2,y:So(r.y+a.y)/2},index:r.segment2}:{point:{x:So(r.x),y:So(r.y)},index:r.segment2}:null}(t,e)}function Po(t,e){var n=e[0],o=e[1],i={x:o.x-n.x,y:o.y-n.y},r=function(t,e,n){var o=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}];return-(o[0].n*e[0]+o[1].n*e[1])/(o[0].lambda*e[0]+o[1].lambda*e[1])}([n.x,n.y],[i.x,i.y],[t.x,t.y]);return{x:n.x+r*i.x,y:n.y+r*i.y}}function Ro(t,e){var n,o=Po(t,e),i={x:o.x-t.x,y:o.y-t.y};return n=i,Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))}var Oo="djs-bendpoint",Bo="djs-segment-dragger";function zo(t,e,n){var o=function(t,e){var n,o=pt(e),i=t._container.getBoundingClientRect();n={x:i.left,y:i.top};var r=t.viewbox();return{x:r.x+(o.x-n.x)/r.scale,y:r.y+(o.y-n.y)/r.scale}}(t,n);return Mo(e,o)}function To(t,e){var n=Rt("g");Et(n).add(Oo),mt(t,n);var o=Rt("circle");wt(o,{cx:0,cy:0,r:4}),Et(o).add("djs-visual"),mt(n,o);var i=Rt("circle");return wt(i,{cx:0,cy:0,r:10}),Et(i).add("djs-hit"),mt(n,i),e&&Et(n).add(e),n}function Ao(t,e,n,o){var i=Rt("g");mt(t,i);var r=function(t,e,n){var o=e.x-t.x,i=e.y-t.y;return Do("h"===n?o:i)}(e,n,o),a=Rt("rect");wt(a,{x:-9,y:-3,width:18,height:6}),Et(a).add("djs-visual"),mt(i,a);var c=Rt("rect");return wt(c,{x:-r/2,y:-8.5,width:r,height:17}),Et(c).add("djs-hit"),mt(i,c),function(t,e){var n=Tt();n.setRotate(e,0,0),Ft(t,n)}(i,"v"===o?90:0),i}function Lo(t,e,n){var o=Rt("g"),i=Fn(e,n),r=Vn(e,n);return mt(t,o),Ao(o,e,n,r),Et(o).add(Bo),Et(o).add("h"===r?"horizontal":"vertical"),Ne(o,i.x,i.y),o}function Do(t){return Math.abs(Math.round(2*t/3))}function Io(t,e){var n=function(t,e){for(var n,o=e.waypoints,i=1/0,r=0;r<o.length-1;r++){var a=Ro(t,[o[r],o[r+1]]);a<i&&(i=a,n=r)}return[o[n],o[n+1]]}(t,e);return Po(t,n)}function $o(t,e,n,o,i){function r(t,n){var r,a=n.waypoints,c=zo(e,a,t);if(c)return r=function(t,e){var n,o,i=t.waypoints;return e.index<=0||e.bendpoint?null:(o=Vn((n={start:i[e.index-1],end:i[e.index]}).start,n.end))?Do("h"===o?n.end.x-n.start.x:n.end.y-n.start.y)/2:null}(n,c),!function(t,e,n){var o,i,r,a,c,s,u=t.index,l=t.point;return!(u<=0||t.bendpoint)&&(r=Fn(o=e[u-1],i=e[u]),a=Vn(o,i),c=Math.abs(l.x-r.x),s=Math.abs(l.y-r.y),a&&c<=n&&s<=n)}(c,a,r)?o.start(t,n,c.index,!c.bendpoint):i.start(t,n,c.index),!0}function a(t,e,o){J.bind(t,e,function(t){n.triggerMouseEvent(e,t,o),t.stopPropagation()})}function c(t,n){var o=e.getLayer("overlays"),i=at('.djs-bendpoints[data-element-id="'+sn(t.id)+'"]',o);return!i&&n&&(wt(i=Rt("g"),{"data-element-id":t.id}),Et(i).add("djs-bendpoints"),mt(o,i),a(i,"mousedown",t),a(i,"click",t),a(i,"dblclick",t)),i}function s(t,e){return at('.djs-segment-dragger[data-segment-idx="'+t+'"]',e)}function u(t,e){e.waypoints.forEach(function(e,n){var o=To(t);mt(t,o),Ne(o,e.x,e.y)}),To(t,"floating")}function l(t,e){for(var n,o,i,r=e.waypoints,c=1;c<r.length;c++)Vn(n=r[c-1],o=r[c])&&(wt(i=Lo(t,n,o),{"data-segment-idx":c}),a(i,"mousemove",e))}function h(t){var e=c(t);return e||(u(e=c(t,!0),t),l(e,t)),e}function p(t){var e=c(t);e&&(!function(t){f(ct("."+Bo,t),function(t){Gt(t)})}(e),function(t){f(ct("."+Oo,t),function(t){Gt(t)})}(e),l(e,t),u(e,t))}function d(t,e,n){var o,i,r=s(e.index,t),a=n[e.index-1],c=n[e.index],u=e.point,l=Fn(a,c),h=Vn(a,c);r&&(o=function(t){return at(".djs-visual",t)}(r),i={x:u.x-l.x,y:u.y-l.y},"v"===h&&(i={x:i.y,y:i.x}),Ne(o,i.x,i.y))}t.on("connection.changed",function(t){p(t.element)}),t.on("connection.remove",function(t){var e=c(t.element);e&&Gt(e)}),t.on("element.marker.update",function(t){var e,n=t.element;n.waypoints&&(e=h(n),t.add?Et(e).add(t.marker):Et(e).remove(t.marker))}),t.on("element.mousemove",function(t){var n,o,i=t.element,r=i.waypoints;if(r){if(n=c(i,!0),!(o=zo(e,r,t.originalEvent)))return;!function(t,e){var n=at(".floating",t),o=e.point;n&&Ne(n,o.x,o.y)}(n,o),o.bendpoint||d(n,o,r)}}),t.on("element.mousedown",function(t){if(vt(t)){var e=t.originalEvent,n=t.element;if(n.waypoints)return r(e,n)}}),t.on("selection.changed",function(t){var e=t.newSelection[0];e&&e.waypoints&&h(e)}),t.on("element.hover",function(t){var e=t.element;e.waypoints&&(h(e),n.registerEvent(t.gfx,"mousemove","element.mousemove"))}),t.on("element.out",function(t){n.unregisterEvent(t.gfx,"mousemove","element.mousemove")}),t.on("element.updateId",function(t){var e=t.element,n=t.newId;if(e.waypoints){var o=c(e);o&&wt(o,{"data-element-id":n})}}),this.addHandles=h,this.updateHandles=p,this.getBendpointsContainer=c,this.getSegmentDragger=s}function Ho(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function Vo(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Go(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function No(t){for(var e=t.waypoints,n=e.reduce(function(t,n,o){var i,r,a=e[o-1];if(a){var c=t[t.length-1],s=c&&c.endLength||0,u=(i=a,r=n,Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)));t.push({start:a,end:n,startLength:s,endLength:s+u,length:u})}return t},[]),o=n.reduce(function(t,e){return t+e.length},0),i=o/2,r=0,a=n[r];a.endLength<i;)a=n[++r];var c=(i-a.startLength)/a.length;return{x:a.start.x+(a.end.x-a.start.x)*c,y:a.start.y+(a.end.y-a.start.y)*c}}function Fo(t){return Fe(t)?No(t):Ho({x:(e=t).x+(e.width||0)/2,y:e.y+(e.height||0)/2});var e}function Wo(t,e,n){c(n=n||0)||(n={x:n,y:n});var o=Vo(t),i=Vo(e),r=o.bottom+n.y<=i.top,a=o.left-n.x>=i.right,s=o.top-n.y>=i.bottom,u=r?"top":s?"bottom":null,l=o.right+n.x<=i.left?"left":a?"right":null;return l&&u?u+"-"+l:l||u||"intersect"}function qo(t,e,n){var o=Co(t,e);return 1===o.length||2===o.length&&$n(o[0],o[1])<1?Ho(o[0]):o.length>1?(o=k(o,function(t){var e=Math.floor(100*t.t2)||1;return e=((e=100-e)<10?"0":"")+e,t.segment2+"#"+e}),Ho(o[n?0:o.length-1])):null}$o.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var Uo=Math.round,Yo="reconnectStart",Ko="reconnectEnd",Xo="updateWaypoints";function Zo(t,e,n,o,i,r){this._injector=t,this.start=function(t,e,r,a){var c,s=n.getGraphics(e),u=e.source,l=e.target,h=e.waypoints,p=(c=a||0!==r?a||r!==h.length-1?Xo:Ko:Yo)===Xo?"connection.updateWaypoints":"connection.reconnect",d=i.allowed(p,{connection:e,source:u,target:l});!1===d&&(d=i.allowed(p,{connection:e,source:l,target:u})),!1!==d&&o.init(t,"bendpoint.move",{data:{connection:e,connectionGfx:s,context:{allowed:d,bendpointIndex:r,connection:e,source:u,target:l,insert:a,type:c}}})},e.on("bendpoint.move.hover",function(t){var e,n=t.context,o=n.connection,r=o.source,a=o.target,c=t.hover,s=n.type;if(n.hover=c,c){var u=s===Xo?"connection.updateWaypoints":"connection.reconnect";if(e=n.allowed=i.allowed(u,{connection:o,source:s===Yo?c:r,target:s===Ko?c:a}))return n.source=s===Yo?c:r,void(n.target=s===Ko?c:a);!1===e&&(e=n.allowed=i.allowed(u,{connection:o,source:s===Ko?c:a,target:s===Yo?c:r})),e&&(n.source=s===Ko?c:a,n.target=s===Yo?c:r)}}),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(t){var e=t.context,n=e.type;e.hover=null,e.source=null,e.target=null,n!==Xo&&(e.allowed=!1)}),e.on("bendpoint.move.end",function(t){var e=t.context,n=e.allowed,o=e.bendpointIndex,i=e.connection,a=e.insert,c=i.waypoints.slice(),s=e.source,u=e.target,l=e.type,h=e.hints||{},p={x:Uo(t.x),y:Uo(t.y)};if(!n)return!1;l===Xo?(a?c.splice(o,0,p):c[o]=p,h.bendpointMove={insert:a,bendpointIndex:o},c=this.cropWaypoints(i,c),r.updateWaypoints(i,function(t){t=t.slice();for(var e,n,o,i=0;t[i];)e=t[i],n=t[i-1],0===$n(e,o=t[i+1])||Hn(n,o,e)?t.splice(i,1):i++;return t}(c),h)):(l===Yo?(h.docking="source",Jo(e)&&(h.docking="target",h.newWaypoints=c.reverse())):l===Ko&&(h.docking="target",Jo(e)&&(h.docking="source",h.newWaypoints=c.reverse())),r.reconnect(i,s,u,p,h))},this)}function Jo(t){var e=t.hover,n=t.source,o=t.target,i=t.type;return i===Yo?e&&o&&e===o&&n!==o:i===Ko?e&&n&&e===n&&n!==o:void 0}Zo.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],Zo.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var o=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=o,e};var Qo="updateWaypoints",ti="connect-ok",ei="connect-not-ok",ni="connect-hover",oi="djs-updating",ii="djs-dragging";function ri(t,e,n,o){this._injector=e;var i=e.get("connectionPreview",!1);n.on("bendpoint.move.start",function(t){var e=t.context,n=e.bendpointIndex,i=e.connection,r=e.insert,a=i.waypoints,c=a.slice();e.waypoints=a,r&&c.splice(n,0,{x:t.x,y:t.y}),i.waypoints=c,Et(e.draggerGfx=To(o.getLayer("overlays"))).add("djs-dragging"),o.addMarker(i,ii),o.addMarker(i,oi)}),n.on("bendpoint.move.hover",function(t){var e=t.context,n=e.allowed,i=e.hover,r=e.type;if(i){if(o.addMarker(i,ni),r===Qo)return;n?(o.removeMarker(i,ei),o.addMarker(i,ti)):!1===n&&(o.removeMarker(i,ti),o.addMarker(i,ei))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,function(t){var e=t.context,n=e.hover,i=e.target;n&&(o.removeMarker(n,ni),o.removeMarker(n,i?ti:ei))}),n.on("bendpoint.move.move",function(e){var n=e.context,o=n.allowed,r=n.bendpointIndex,a=n.draggerGfx,c=n.hover,s=n.type,u=n.connection,l=u.source,h=u.target,p=u.waypoints.slice(),d={x:e.x,y:e.y},f=n.hints||{},v={};i&&(f.connectionStart&&(v.connectionStart=f.connectionStart),f.connectionEnd&&(v.connectionEnd=f.connectionEnd),"reconnectStart"===s?Jo(n)?(v.connectionEnd=v.connectionEnd||d,v.source=h,v.target=c||l,p=p.reverse()):(v.connectionStart=v.connectionStart||d,v.source=c||l,v.target=h):"reconnectEnd"===s?Jo(n)?(v.connectionStart=v.connectionStart||d,v.source=c||h,v.target=l,p=p.reverse()):(v.connectionEnd=v.connectionEnd||d,v.source=l,v.target=c||h):(v.noCropping=!0,v.noLayout=!0,p[r]=d),s===Qo&&(p=t.cropWaypoints(u,p)),v.waypoints=p,i.drawPreview(n,o,v)),Ne(a,e.x,e.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,function(t){var e=t.context,n=e.connection,r=e.draggerGfx,a=e.hover,c=e.target,s=e.waypoints;n.waypoints=s,Gt(r),o.removeMarker(n,oi),o.removeMarker(n,ii),a&&(o.removeMarker(a,ti),o.removeMarker(a,c?ti:ei)),i&&i.cleanUp(e)})}ri.$inject=["bendpointMove","injector","eventBus","canvas"];var ai="connect-hover",ci="djs-updating";function si(t,e,n){return ui(t,e,t[e]+n)}function ui(t,e,n){return{x:"x"===e?n:t.x,y:"y"===e?n:t.y}}function li(t){return"x"===t?"y":"x"}function hi(t,e,n){var o,i;return t.original?t.original:(o=Fo(e),ui(t,i=li(n),o[i]))}function pi(t,e,n,o,i,r){var a=t.get("connectionDocking",!1);function c(t,e){if(!a)return e;var n,o=t.waypoints;return t.waypoints=e,n=a.getCroppedWaypoints(t),t.waypoints=o,n}function s(t){i.update("connection",t.connection,t.connectionGfx)}function u(t,e,n){var o=t.newWaypoints,i=function(t,e,n,o){var i=Math.max(e[o],n[o]),r=Math.min(e[o],n[o]);return ui(e,o,Math.min(Math.max(r+20,t[o]),i-20))}(n,o[t.segmentStartIndex+e],o[t.segmentEndIndex+e],li(t.axis));Ne(t.draggerGfx,i.x,i.y)}this.start=function(t,e,i){var r,a,c,s,u=n.getGraphics(e),l=i-1,h=i,p=e.waypoints,d=p[l],f=p[h],v=zo(n,p,t);(a=Vn(d,f))&&(c="v"===a?"x":"y",0===l&&(d=hi(d,e.source,c)),h===p.length-1&&(f=hi(f,e.target,c)),r={connection:e,segmentStartIndex:l,segmentEndIndex:h,segmentStart:d,segmentEnd:f,axis:c,dragPosition:s=v?v.point:{x:(d.x+f.x)/2,y:(d.y+f.y)/2}},o.init(t,s,"connectionSegment.move",{cursor:"x"===c?"resize-ew":"resize-ns",data:{connection:e,connectionGfx:u,context:r}}))},e.on("connectionSegment.move.start",function(t){var e=t.context,o=t.connection,i=n.getLayer("overlays");e.originalWaypoints=o.waypoints.slice(),e.draggerGfx=Lo(i,e.segmentStart,e.segmentEnd),Et(e.draggerGfx).add("djs-dragging"),n.addMarker(o,ci)}),e.on("connectionSegment.move.move",function(t){var e,n,o=t.context,i=o.connection,r=o.segmentStartIndex,a=o.segmentEndIndex,l=o.segmentStart,h=o.segmentEnd,p=o.axis,d=o.originalWaypoints.slice(),f=si(l,p,t["d"+p]),v=si(h,p,t["d"+p]),y=d.length,g=0;d[r]=f,d[a]=v,r<2&&(e=Wo(i.source,f),1===r?"intersect"===e&&(d.shift(),d[0]=f,g--):"intersect"!==e&&(d.unshift(l),g++)),a>y-3&&(n=Wo(i.target,v),a===y-2?"intersect"===n&&(d.pop(),d[d.length-1]=v):"intersect"!==n&&d.push(h)),o.newWaypoints=i.waypoints=c(i,d),u(o,g,t),o.newSegmentStartIndex=r+g,s(t)}),e.on("connectionSegment.move.hover",function(t){t.context.hover=t.hover,n.addMarker(t.hover,ai)}),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(t){var e=t.context.hover;e&&n.removeMarker(e,ai)}),e.on("connectionSegment.move.cleanup",function(t){var e=t.context,o=e.connection;e.draggerGfx&&Gt(e.draggerGfx),n.removeMarker(o,ci)}),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(t){var e=t.context;e.connection.waypoints=e.originalWaypoints,s(t)}),e.on("connectionSegment.move.end",function(t){var e=t.context,n=e.connection,o=e.newWaypoints,i=e.newSegmentStartIndex,a=function(t,e){var n=0;return{waypoints:t.filter(function(o,i){return!Hn(t[i-1],t[i+1],o)||(n=i<=e?n-1:n,!1)}),segmentOffset:n}}(o=o.map(function(t){return{original:t.original,x:Math.round(t.x),y:Math.round(t.y)}}),i),s=c(n,a.waypoints),u=a.segmentOffset,l={segmentMove:{segmentStartIndex:e.segmentStartIndex,newSegmentStartIndex:i+u}};r.updateWaypoints(n,s,l)})}function di(t,e,n){if("string"!=typeof e)throw new Error("axis must be in [x, y]");if("number"!=typeof n&&!1!==n)throw new Error("value must be Number or false");var o,i=t[e],r=t.snapped=t.snapped||{};return!1===n?r[e]=!1:(r[e]=!0,o=n-i,t[e]+=o,t["d"+e]+=o),i}pi.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var fi=Math.abs,vi=Math.round;function yi(t){function e(t,e){if(a(t)){for(var n=t.length;n--;)if(fi(t[n]-e)<=10)return t[n]}else{var o=e%(t=+t);if(o<10)return e-o;if(o>t-10)return e-o+t}return e}function n(t,e){return t.waypoints?Io(e,t):t.width?{x:vi(t.width/2+t.x),y:vi(t.height/2+t.y)}:void 0}t.on("connectionSegment.move.move",1500,function(t){var o,i,r=function(t){var e=t.context,o=e.snapPoints,i=e.connection,r=i.waypoints,a=e.segmentStart,c=e.segmentStartIndex,s=e.segmentEnd,u=e.segmentEndIndex,l=e.axis;if(o)return o;var h=[r[c-1],a,s,r[u+1]];return c<2&&h.unshift(n(i.source,t)),u>r.length-3&&h.unshift(n(i.target,t)),e.snapPoints=o={horizontal:[],vertical:[]},f(h,function(t){t&&(t=t.original||t,"y"===l&&o.horizontal.push(t.y),"x"===l&&o.vertical.push(t.x))}),o}(t),a=t.x,c=t.y;if(r){var s=a-(o=e(r.vertical,a)),u=c-(i=e(r.horizontal,c));O(t,{dx:t.dx-s,dy:t.dy-u,x:o,y:i}),(s||-1!==r.vertical.indexOf(a))&&di(t,"x",o),(u||-1!==r.horizontal.indexOf(c))&&di(t,"y",i)}}),t.on(["connect.hover","connect.move","connect.end"],1500,function(t){var e=t.context.hover,o=e&&n(e,t);Fe(e)&&o&&o.x&&o.y&&(di(t,"x",o.x),di(t,"y",o.y))}),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(t){var o,i,r=t.context,a=function(t){var e=t.snapPoints,n=t.connection.waypoints,o=t.bendpointIndex;if(e)return e;var i=[n[o-1],n[o+1]];return t.snapPoints=e={horizontal:[],vertical:[]},f(i,function(t){t&&(t=t.original||t,e.horizontal.push(t.y),e.vertical.push(t.x))}),e}(r),c=r.hover,s=c&&n(c,t),u=t.x,l=t.y;if(a){var h=u-(o=e(s?a.vertical.concat([s.x]):a.vertical,u)),p=l-(i=e(s?a.horizontal.concat([s.y]):a.horizontal,l));O(t,{dx:t.dx-h,dy:t.dy-p,x:t.x-h,y:t.y-p}),(h||-1!==a.vertical.indexOf(u))&&di(t,"x",o),(p||-1!==a.horizontal.indexOf(l))&&di(t,"y",i)}})}yi.$inject=["eventBus"];var gi={__depends__:[Ae,be],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",$o],bendpointMove:["type",Zo],bendpointMovePreview:["type",ri],connectionSegmentMove:["type",pi],bendpointSnapping:["type",yi]};function mi(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}function xi(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n}function _i(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var o=t.indexOf(e);if(-1!==o){if(o===n)return;if(-1===n)return;t.splice(o,1)}-1!==n?t.splice(n,0,e):t.push(e)}}function wi(t,e){return t&&e?t.indexOf(e):-1}function bi(t,e){if("function"!=typeof e)throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function Ei(t){this._eventBus=t}function ki(t){return function(e,n,o,i,r){(u(e)||s(e))&&(r=i,i=o,o=n,n=e,e=null),this.on(e,t,n,o,i,r)}}Ei.$inject=["eventBus"],Ei.prototype.on=function(t,e,n,o,i,r){if((u(e)||s(e))&&(r=i,i=o,o=n,n=e,e=null),u(n)&&(r=i,i=o,o=n,n=1e3),c(i)&&(r=i,i=!1),!u(o))throw new Error("handlerFn must be a function");a(t)||(t=[t]);var l=this._eventBus;f(t,function(t){var a=["commandStack",t,e].filter(function(t){return t}).join(".");l.on(a,n,i?function(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}(o,r):o,r)})},Ei.prototype.canExecute=ki("canExecute"),Ei.prototype.preExecute=ki("preExecute"),Ei.prototype.preExecuted=ki("preExecuted"),Ei.prototype.execute=ki("execute"),Ei.prototype.executed=ki("executed"),Ei.prototype.postExecute=ki("postExecute"),Ei.prototype.postExecuted=ki("postExecuted"),Ei.prototype.revert=ki("revert"),Ei.prototype.reverted=ki("reverted");function Ci(t,e,n){Ei.call(this,e);var o=t.get("movePreview",!1);e.on("shape.move.start",1400,function(t){var e=t.context,n=e.shapes,o=e.validatedShapes;e.shapes=Si(n),e.validatedShapes=Si(o)}),o&&e.on("shape.move.start",250,function(t){var e=t.context,n=e.shapes,i=[];f(n,function(t){f(t.labels,function(n){n.hidden||-1!==e.shapes.indexOf(n)||i.push(n),t.labelTarget&&i.push(t)})}),f(i,function(t){o.makeDraggable(e,t,!0)})}),this.preExecuted("elements.move",1400,function(t){var e=t.context.closure,n=e.enclosedElements,o=[];f(n,function(t){f(t.labels,function(t){n[t.id]||o.push(t)})}),e.addAll(o)}),this.preExecute(["connection.delete","shape.delete"],function(t){var e=t.context;bi((e.connection||e.shape).labels,function(t){n.removeShape(t,{nested:!0})})}),this.execute("shape.delete",function(t){var e=t.context,n=e.shape,o=n.labelTarget;o&&(e.labelTargetIndex=wi(o.labels,n),e.labelTarget=o,n.labelTarget=null)}),this.revert("shape.delete",function(t){var e=t.context,n=e.shape,o=e.labelTarget,i=e.labelTargetIndex;o&&(_i(o.labels,n,i),n.labelTarget=o)})}function Si(t){return d(t,function(e){return-1===t.indexOf(e.labelTarget)})}mi(Ci,Ei),Ci.$inject=["injector","eventBus","modeling"];var ji={__init__:["labelSupport"],labelSupport:["type",Ci]};function Mi(t,e,n,o){t.on("element.changed",function(o){var i=o.element;(i.parent||i===e.getRootElement())&&(o.gfx=n.getGraphics(i)),o.gfx&&t.fire(ue(i)+".changed",o)}),t.on("elements.changed",function(e){var n=e.elements;n.forEach(function(e){t.fire("element.changed",{element:e})}),o.updateContainments(n)}),t.on("shape.changed",function(t){o.update("shape",t.element,t.gfx)}),t.on("connection.changed",function(t){o.update("connection",t.element,t.gfx)})}Mi.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];var Pi={__init__:["changeSupport"],changeSupport:["type",Mi]},Ri=Math.max,Oi=Math.min;function Bi(t,e,n){var o=e[t],i=n.min&&n.min[t],r=n.max&&n.max[t];return s(i)&&(o=(/top|left/.test(t)?Oi:Ri)(o,i)),s(r)&&(o=(/top|left/.test(t)?Ri:Oi)(o,r)),o}function zi(t,e){return void 0!==t?t:20}function Ti(t){return!t.waypoints&&"label"!==t.type}function Ai(t,e){var n;if((n=void 0===t.length?d(t.children,Ti):t).length)return function(t,e){var n,o,i,r;return"object"==typeof e?(n=zi(e.left),o=zi(e.right),i=zi(e.top),r=zi(e.bottom)):n=o=i=r=zi(e),{x:t.x-n,y:t.y-i,width:t.width+n+o,height:t.height+i+r}}(se(n),e)}function Li(t,e,n,o){this._dragging=o,this._rules=e;var i=this;function r(t,e){var n,o=t.shape,r=t.direction,a=t.resizeConstraints;t.delta=e,n=function(t,e,n){var o=n.x,i=n.y,r={x:t.x,y:t.y,width:t.width,height:t.height};return-1!==e.indexOf("n")?(r.y=t.y+i,r.height=t.height-i):-1!==e.indexOf("s")&&(r.height=t.height+i),-1!==e.indexOf("e")?r.width=t.width+o:-1!==e.indexOf("w")&&(r.x=t.x+o,r.width=t.width-o),r}(o,r,e),t.newBounds=function(t,e){if(!e)return t;var n=Vo(t);return Go({top:Bi("top",n,e),right:Bi("right",n,e),bottom:Bi("bottom",n,e),left:Bi("left",n,e)})}(n,a),t.canExecute=i.canResize(t)}function a(t){var e,o=t.shape,i=t.canExecute,r=t.newBounds;if(i){if(e=r,!function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(o,r={x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}))return;n.resizeShape(o,r)}}t.on("resize.start",function(t){var e,n,o;e=t.context,n=e.resizeConstraints,o=e.minBounds,void 0===n&&(void 0===o&&(o=i.computeMinResizeBox(e)),e.resizeConstraints={min:Vo(o)})}),t.on("resize.move",function(t){var e={x:t.dx,y:t.dy};r(t.context,e)}),t.on("resize.end",function(t){a(t.context)})}function Di(t,e){var n=Fo(t),o=Vo(t),i={x:n.x,y:n.y};return-1!==e.indexOf("n")?i.y=o.top:-1!==e.indexOf("s")&&(i.y=o.bottom),-1!==e.indexOf("e")?i.x=o.right:-1!==e.indexOf("w")&&(i.x=o.left),i}function Ii(t){var e="resize-";return"n"===t||"s"===t?e+"ns":"e"===t||"w"===t?e+"ew":"nw"===t||"se"===t?e+"nwse":e+"nesw"}Li.prototype.canResize=function(t){var e=this._rules,n=B(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)},Li.prototype.activate=function(t,e,n){var o,i,r=this._dragging;if("string"==typeof n&&(n={direction:n}),!(i=(o=O({shape:e},n)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");r.init(t,Di(e,i),"resize",{autoActivate:!0,cursor:Ii(i),data:{shape:e,context:o}})},Li.prototype.computeMinResizeBox=function(t){var e=t.shape;return function(t,e,n,o){var i=Vo(e),r={top:/n/.test(t)?i.bottom-n.height:i.top,left:/w/.test(t)?i.right-n.width:i.left,bottom:/s/.test(t)?i.top+n.height:i.bottom,right:/e/.test(t)?i.left+n.width:i.right},a=o?Vo(o):r;return Go({top:Oi(r.top,a.top),left:Oi(r.left,a.left),bottom:Ri(r.bottom,a.bottom),right:Ri(r.right,a.right)})}(t.direction,e,t.minDimensions||{width:10,height:10},Ai(e,t.childrenBoxPadding))},Li.$inject=["eventBus","rules","modeling","dragging"];var $i="djs-resizing",Hi="resize-not-ok";function Vi(t,e,n){t.on("resize.move",500,function(t){var o,i,r,a;o=t.context,i=o.shape,r=o.newBounds,(a=o.frame)||(a=o.frame=n.addFrame(i,e.getActiveLayer()),e.addMarker(i,$i)),r.width>5&&wt(a,{x:r.x,width:r.width}),r.height>5&&wt(a,{y:r.y,height:r.height}),o.canExecute?Et(a).remove(Hi):Et(a).add(Hi)}),t.on("resize.cleanup",function(t){var n,o;n=t.context,o=n.shape,n.frame&&Gt(n.frame),e.removeMarker(o,$i)})}Vi.$inject=["eventBus","canvas","previewSupport"];var Gi=-6,Ni="djs-resizer",Fi=["n","w","s","e","nw","ne","se","sw"];function Wi(t,e,n,o){this._resize=o,this._canvas=e;var i=this;t.on("selection.changed",function(t){var e=t.newSelection;i.removeResizers(),1===e.length&&f(e,R(i.addResizer,i))}),t.on("shape.changed",function(t){var e=t.element;n.isSelected(e)&&(i.removeResizers(),i.addResizer(e))})}Wi.prototype.makeDraggable=function(t,e,n){var o=this._resize;function i(e){vt(e)&&o.activate(e,t,n)}J.bind(e,"mousedown",i),J.bind(e,"touchstart",i)},Wi.prototype._createResizer=function(t,e,n,o){var i=this._getResizersParent(),r=function(t){var e={x:0,y:0};-1!==t.indexOf("e")?e.x=6:-1!==t.indexOf("w")&&(e.x=Gi);-1!==t.indexOf("s")?e.y=6:-1!==t.indexOf("n")&&(e.y=Gi);return e}(o),a=Rt("g");Et(a).add(Ni),Et(a).add(Ni+"-"+t.id),Et(a).add(Ni+"-"+o),mt(i,a);var c=Rt("rect");wt(c,{x:-4+r.x,y:-4+r.y,width:8,height:8}),Et(c).add(Ni+"-visual"),mt(a,c);var s=Rt("rect");return wt(s,{x:-10+r.x,y:-10+r.y,width:20,height:20}),Et(s).add(Ni+"-hit"),mt(a,s),function(t,e,n,o,i){var r=Tt();r.setTranslate(e,n);var a=Tt();a.setRotate(o||0,0,0);var c=Tt();c.setScale(i||1,i||1),Ft(t,[r,a,c])}(a,e,n),a},Wi.prototype.createResizer=function(t,e){var n=Di(t,e),o=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,o,e)},Wi.prototype.addResizer=function(t){var e=this;!Fe(t)&&this._resize.canResize({shape:t})&&f(Fi,function(n){e.createResizer(t,n)})},Wi.prototype.removeResizers=function(){Ct(this._getResizersParent())},Wi.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},Wi.$inject=["eventBus","canvas","selection","resize"];var qi={__depends__:[be,Ae,He],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Li],resizePreview:["type",Vi],resizeHandles:["type",Wi]},Ui=Math.min,Yi=Math.max;function Ki(t){t.preventDefault()}function Xi(t){t.stopPropagation()}function Zi(t){this.container=t.container,this.parent=rt('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=at("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=R(this.autoResize,this),this.handlePaste=R(this.handlePaste,this)}function Ji(t,e){this._eventBus=t,this._providers=[],this._textbox=new Zi({container:e.getContainer(),keyHandler:R(this._handleKey,this),resizeHandler:R(this._handleResize,this)})}Zi.prototype.create=function(t,e,n,o){var i=this.parent,r=this.content,a=this.container;o=this.options=o||{};var c=B(e=this.style=e||{},["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);O(i.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var s=B(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return O(r.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},s),o.centerVertically&&O(r.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},s),r.innerText=n,J.bind(r,"keydown",this.keyHandler),J.bind(r,"mousedown",Xi),J.bind(r,"paste",this.handlePaste),o.autoResize&&J.bind(r,"input",this.autoResize),o.resizable&&this.resizable(e),a.appendChild(i),this.setSelection(r.lastChild,r.lastChild&&r.lastChild.length),i},Zi.prototype.handlePaste=function(t){var e,n=this.options,o=this.style;if(t.preventDefault(),e=t.clipboardData?t.clipboardData.getData("text/plain"):window.clipboardData.getData("Text"),this.insertText(e),n.autoResize){var i=this.autoResize(o);i&&this.resizeHandler(i)}},Zi.prototype.insertText=function(t){t=t.replace(/\r\n|\r|\n/g,"\n"),document.execCommand("insertText",!1,t)||this._insertTextIE(t)},Zi.prototype._insertTextIE=function(t){var e,n,o,i=this.getSelection(),r=i.startContainer,a=i.endContainer,c=i.startOffset,s=i.endOffset,u=i.commonAncestorContainer,l=(e=u.childNodes,[].slice.call(e));if(function(t){return t.nodeType===Node.TEXT_NODE}(u)){var h=r.textContent;r.textContent=h.substring(0,c)+t+h.substring(s),n=r,o=c+t.length}else if(r===this.content&&a===this.content){var p=document.createTextNode(t);this.content.insertBefore(p,l[c]),n=p,o=p.textContent.length}else{var d=l.indexOf(r),f=l.indexOf(a);l.forEach(function(e,n){n===d?e.textContent=r.textContent.substring(0,c)+t+a.textContent.substring(s):n>d&&n<=f&&st(e)}),n=r,o=c+t.length}n&&void 0!==o&&setTimeout(function(){self.setSelection(n,o)})},Zi.prototype.autoResize=function(){var t=this.parent,e=this.content,n=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-n){var o=t.getBoundingClientRect(),i=e.scrollHeight;t.style.height=i+"px",this.resizeHandler({width:o.width,height:o.height,dx:0,dy:i-o.height})}},Zi.prototype.resizable=function(){var t=this,e=this.parent,n=this.resizeHandle,o=parseInt(this.style.minWidth)||0,i=parseInt(this.style.minHeight)||0,r=parseInt(this.style.maxWidth)||1/0,a=parseInt(this.style.maxHeight)||1/0;if(!n){var c,s,u,l;n=this.resizeHandle=rt('<div class="djs-direct-editing-resize-handle"></div>');var h=function(n){Ki(n),Xi(n);var h=Ui(Yi(u+n.clientX-c,o),r),p=Ui(Yi(l+n.clientY-s,i),a);e.style.width=h+"px",e.style.height=p+"px",t.resizeHandler({width:u,height:l,dx:n.clientX-c,dy:n.clientY-s})},p=function(t){Ki(t),Xi(t),J.unbind(document,"mousemove",h,!1),J.unbind(document,"mouseup",p,!1)};J.bind(n,"mousedown",function(t){Ki(t),Xi(t),c=t.clientX,s=t.clientY;var n=e.getBoundingClientRect();u=n.width,l=n.height,J.bind(document,"mousemove",h),J.bind(document,"mouseup",p)})}O(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),e.appendChild(n)},Zi.prototype.destroy=function(){var t=this.parent,e=this.content,n=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),J.unbind(e,"keydown",this.keyHandler),J.unbind(e,"mousedown",Xi),J.unbind(e,"input",this.autoResize),J.unbind(e,"paste",this.handlePaste),n&&(n.removeAttribute("style"),st(n)),st(t)},Zi.prototype.getValue=function(){return this.content.innerText.trim()},Zi.prototype.getSelection=function(){return window.getSelection().getRangeAt(0)},Zi.prototype.setSelection=function(t,e){var n=document.createRange();null===t?n.selectNodeContents(this.content):(n.setStart(t,e),n.setEnd(t,e));var o=window.getSelection();o.removeAllRanges(),o.addRange(n)},Ji.$inject=["eventBus","canvas"],Ji.prototype.registerProvider=function(t){this._providers.push(t)},Ji.prototype.isActive=function(t){return!(!this._active||t&&this._active.element!==t)},Ji.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},Ji.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})},Ji.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0},Ji.prototype.complete=function(){var t=this._active;if(t){var e,n=t.context.bounds,o=this.$textbox.getBoundingClientRect(),i=this.getValue();i===t.context.text&&o.height===n.height&&o.width===n.width||(e=this._textbox.container.getBoundingClientRect(),t.provider.update(t.element,i,t.context.text,{x:o.left-e.left,y:o.top-e.top,width:o.width,height:o.height})),this._fire("complete"),this.close()}},Ji.prototype.getValue=function(){return this._textbox.getValue()},Ji.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;return 27===e?(t.preventDefault(),this.cancel()):13!==e||t.shiftKey?void 0:(t.preventDefault(),this.complete())},Ji.prototype._handleResize=function(t){this._fire("resize",t)},Ji.prototype.activate=function(t){var e;this.isActive()&&this.cancel();var n=p(this._providers,function(n){return(e=n.activate(t))?n:null});return e&&(this.$textbox=this._textbox.create(e.bounds,e.style,e.text,e.options),this._active={element:t,context:e,provider:n},e.options&&e.options.resizable&&(this.resizable=!0),this._fire("activate")),!!e};var Qi={__depends__:[ne],__init__:["directEditing"],directEditing:["type",Ji]},tr="connect-ok",er="connect-not-ok";function nr(t,e,n,o,i,r){t.on("connect.move",function(t){var e,n=t.context,o=n.source,i=n.target,a=n.visual;e=function(t,e,n,o){var i=r.getShapePath(n),a=o&&r.getShapePath(o),c=r.getConnectionPath({waypoints:[t,e]});return[t=qo(i,c,!0)||t,e=o&&qo(a,c,!1)||e]}(n.sourcePosition,{x:t.x,y:t.y},o,i),wt(a,{points:[e[0].x,e[0].y,e[1].x,e[1].y]})}),t.on("connect.hover",function(t){var e=t.context;e.source;var n,o=t.hover;null!==(n=e.canExecute=!0)&&(e.target=o,i.addMarker(o,n?tr:er))}),t.on(["connect.out","connect.cleanup"],function(t){var e=t.context;e.target&&i.removeMarker(e.target,e.canExecute?tr:er),e.target=null,e.canExecute=!1}),t.on("connect.cleanup",function(t){var e=t.context;e.visual&&Gt(e.visual)}),t.on("connect.start",function(t){var e,n=t.context;wt(e=Rt("polyline"),{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),mt(i.getDefaultLayer(),e),n.visual=e}),t.on("connect.end",function(t){var e=t.context;if(e.source,e.type,e.sourcePosition,e.target,t.x,t.y,!(e.canExecute||!0))return!1}),this.start=function(t,n,o,i,r){"object"!=typeof i&&(r=i,i=Fo(n)),e.init(t,"connect",{autoActivate:r,data:{shape:n,context:{type:o,source:n,sourcePosition:i}}})}}nr.$inject=["eventBus","dragging","modeling","rules","canvas","graphicsFactory"];var or={__depends__:[_e,be,Ae],connect:["type",nr]};function ir(t,e,n,o){this._canvas=e,this._graphicsFactory=n,this._elementFactory=o,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}ir.$inject=["injector","canvas","graphicsFactory","elementFactory"],ir.prototype.drawPreview=function(t,e,n){n=n||{};var o,i,r,a=t.connectionPreviewGfx,c=t.getConnection,s=n.source,u=n.target,l=n.waypoints,h=n.connectionStart,p=n.connectionEnd,d=n.noLayout,f=n.noCropping,v=n.noNoop,y=this;a||(a=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),Ct(a),c||(c=t.getConnection=(i=function(t,e,n){return y.getConnection(t,e,n)},r={},function(t){var e=JSON.stringify(t),n=r[e];return n||(n=r[e]=i.apply(null,arguments)),n})),e&&(o=c(e,s,u)),o?(t.connection&&(o.connectionType=t.connection.connectionType),o.waypoints=l||[],this._layouter&&!d&&(o.waypoints=this._layouter.layoutConnection(o,{source:s,target:u,connectionStart:h,connectionEnd:p,waypoints:n.waypoints||o.waypoints})),o.waypoints&&o.waypoints.length||(o.waypoints=[s?Fo(s):h,u?Fo(u):p]),this._connectionDocking&&(s||u)&&!f&&(o.waypoints=this._connectionDocking.getCroppedWaypoints(o,s,u)),this._graphicsFactory.drawConnection(a,o)):!v&&this.drawNoopPreview(a,n)},ir.prototype.drawNoopPreview=function(t,e){var n=e.source,o=e.target,i=e.connectionStart||Fo(n),r=e.connectionEnd||Fo(o),a=this.cropWaypoints(i,r,n,o);mt(t,this.createNoopConnection(a[0],a[1]))},ir.prototype.cropWaypoints=function(t,e,n,o){var i=this._graphicsFactory,r=n&&i.getShapePath(n),a=o&&i.getShapePath(o),c=i.getConnectionPath({waypoints:[t,e]});return[t=n&&qo(r,c,!0)||t,e=o&&qo(a,c,!1)||e]},ir.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&Gt(t.connectionPreviewGfx)},ir.prototype.getConnection=function(t){var e=function(t){return c(t)?t:{}}(t);return this._elementFactory.createConnection(e)},ir.prototype.createConnectionPreviewGfx=function(){var t=Rt("g");return wt(t,{pointerEvents:"none"}),Et(t).add("djs-connection").add("djs-connection-preview"),mt(this._canvas.getActiveLayer(),t),t},ir.prototype.createNoopConnection=function(t,e){return Zt([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};var rr={__init__:["connectionPreview"],connectionPreview:["type",ir]};function ar(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}ar.$inject=["eventBus","injector"],ar.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()},ar.prototype.canExecute=function(t,e){const n={command:t,context:e},o=this._getHandler(t);let i=this._fire(t,"canExecute",n);if(void 0===i){if(!o)return!1;o.canExecute&&(i=o.canExecute(e))}return i},ar.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,!1!==t&&this._fire("changed",{trigger:"clear"})},ar.prototype.undo=function(){let t,e=this._getUndoAction();if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),t&&t.id===e.id);)e=t;this._popAction()}},ar.prototype.redo=function(){let t,e=this._getRedoAction();if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),t&&t.id===e.id);)e=t;this._popAction()}},ar.prototype.register=function(t,e){this._setHandler(t,e)},ar.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)},ar.prototype.canUndo=function(){return!!this._getUndoAction()},ar.prototype.canRedo=function(){return!!this._getRedoAction()},ar.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},ar.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},ar.prototype._internalUndo=function(t){const e=t.command,n=t.context,o=this._getHandler(e);this._atomicDo(()=>{this._fire(e,"revert",t),o.revert&&this._markDirty(o.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)})},ar.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const o=e?[t+"."+e,e]:[t];let i;n=this._eventBus.createEvent(n);for(const t of o)if(i=this._eventBus.fire("commandStack."+t,n),n.cancelBubble)break;return i},ar.prototype._createId=function(){return this._uid++},ar.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}},ar.prototype._internalExecute=function(t,e){const n=t.command,o=t.context,i=this._getHandler(n);if(!i)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),i.preExecute&&i.preExecute(o),this._fire(n,"preExecuted",t)),this._atomicDo(()=>{this._fire(n,"execute",t),i.execute&&this._markDirty(i.execute(o)),this._executedAction(t,e),this._fire(n,"executed",t)}),e||(this._fire(n,"postExecute",t),i.postExecute&&i.postExecute(o),this._fire(n,"postExecuted",t)),this._popAction()},ar.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,o=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=o&&o.id||this._createId()),n.push(t)},ar.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,o=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:E("id",o.reverse())}),o.length=0,this._fire("changed",{trigger:e}),t.trigger=null)},ar.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=a(t)?t:[t],e.dirty=e.dirty.concat(t))},ar.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)},ar.prototype._revertedAction=function(t){this._stackIdx--},ar.prototype._getHandler=function(t){return this._handlerMap[t]},ar.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};var cr={commandStack:["type",ar]};function sr(t){return O({original:t.point.original||t.point},t.actual)}function ur(t,e){this._elementRegistry=t,this._graphicsFactory=e}ur.$inject=["elementRegistry","graphicsFactory"],ur.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var o=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),r=t.waypoints.slice(o.idx+1,i.idx);return r.unshift(sr(o)),r.push(sr(i)),r},ur.prototype.getDockingPoint=function(t,e,n){var o,i,r=t.waypoints;return{point:i=r[o=n?0:r.length-1],actual:this._getIntersection(e,t,n)||i,idx:o}},ur.prototype._getIntersection=function(t,e,n){return qo(this._getShapePath(t),this._getConnectionPath(e),n)},ur.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)},ur.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)},ur.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var lr={exports:{}},hr={};hr.extend=function(t,e,n,o){var i=n.inverse;return Object.defineProperty(t,"remove",{value:function(t){var n=this.indexOf(t);return-1!==n&&(this.splice(n,1),e.unset(t,i,o)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,n){var r=this.indexOf(t);if(void 0===n){if(-1!==r)return;n=this.length}-1!==r&&this.splice(r,1),this.splice(n,0,t),-1===r&&e.set(t,i,o)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},hr.isExtended=function(t){return!0===t.__refs_collection};var pr=hr;function dr(t,e,n){var o=pr.extend(n[e.name]||[],t,e,n);Object.defineProperty(n,e.name,{enumerable:e.enumerable,value:o}),o.length&&o.forEach(function(o){t.set(o,e.inverse,n)})}function fr(t,e){if(!(this instanceof fr))return new fr(t,e);t.inverse=e,e.inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}fr.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}e.collection?dr(this,e,t):function(t,e,n){var o=e.inverse,i=n[e.name];Object.defineProperty(n,e.name,{configurable:e.configurable,enumerable:e.enumerable,get:function(){return i},set:function(e){if(e!==i){var r=i;i=null,r&&t.unset(r,o,n),i=e,t.set(i,o,n)}}})}(this,e,t)},fr.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return pr.isExtended(n)||dr(this,e,t),n},fr.prototype.ensureBound=function(t,e){(function(t,e){return Object.prototype.hasOwnProperty.call(t,e.name||e)})(t,e)||this.bind(t,e)},fr.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},fr.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var vr=fr;lr.exports=vr,lr.exports.Collection=hr;var yr=Wn(lr.exports),gr=new yr({name:"children",enumerable:!0,collection:!0},{name:"parent"}),mr=new yr({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),xr=new yr({name:"attachers",collection:!0},{name:"host"}),_r=new yr({name:"outgoing",collection:!0},{name:"source"}),wr=new yr({name:"incoming",collection:!0},{name:"target"});function br(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),gr.bind(this,"parent"),mr.bind(this,"labels"),_r.bind(this,"outgoing"),wr.bind(this,"incoming")}function Er(){br.call(this),gr.bind(this,"children"),xr.bind(this,"host"),xr.bind(this,"attachers")}function kr(){br.call(this),gr.bind(this,"children")}function Cr(){Er.call(this),mr.bind(this,"labelTarget")}function Sr(){br.call(this),_r.bind(this,"source"),wr.bind(this,"target")}mi(Er,br),mi(kr,Er),mi(Cr,Er),mi(Sr,br);var jr={connection:Sr,shape:Er,label:Cr,root:kr};function Mr(){this._uid=12}Mr.prototype.createRoot=function(t){return this.create("root",t)},Mr.prototype.createLabel=function(t){return this.create("label",t)},Mr.prototype.createShape=function(t){return this.create("shape",t)},Mr.prototype.createConnection=function(t){return this.create("connection",t)},Mr.prototype.create=function(t,e){return(e=O({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=jr[t];if(!n)throw new Error("unknown type: <"+t+">");return O(new n,e)}(t,e)};var Pr,Rr={exports:{}},Or={exports:{}};try{var Br=require("util");if("function"!=typeof Br.inherits)throw"";Rr.exports=Br.inherits}catch(mi){Rr.exports=(Pr||(Pr=1,"function"==typeof Object.create?Or.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Or.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),Or.exports)}var zr=Wn(Rr.exports);function Tr(){Mr.call(this)}function Ar(){}zr(Tr,Mr),Tr.prototype.createEnumeration=function(t){var e={shapeType:"enumeration",businessObject:{}};return O(e,t),this.createShape(e)},Tr.prototype.createClass=function(t){var e={shapeType:"class",businessObject:{}};return O(e,t),this.createShape(e)},Tr.prototype.createUmlLabel=function(t){var e={shapeType:"label"};return O(e,t),this.createLabel(e)},Tr.prototype.createInheritance=function(t){var e={connectionType:"inheritance"};return O(e,t),this.createConnection(e)},Tr.prototype.createAssociation=function(t){var e={connectionType:"association"};return O(e,t),this.createConnection(e)},Tr.prototype.createAggregation=function(t){var e={connectionType:"aggregation"};return O(e,t),this.createConnection(e)},Tr.prototype.createComposition=function(t){var e={connectionType:"composition"};return O(e,t),this.createConnection(e)},Tr.prototype.createDependency=function(t){var e={connectionType:"dependency"};return O(e,t),this.createConnection(e)},Tr.prototype.createRealization=function(t){var e={connectionType:"realization"};return O(e,t),this.createConnection(e)},Ar.prototype.layoutConnection=function(t,e){return[(e=e||{}).connectionStart||Fo(e.source||t.source),e.connectionEnd||Fo(e.target||t.target)]};var Lr=Math.round,Dr={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Ir(t,e,n){var o,i,r,a=Wo(e,t,5),c=n.split(":")[0],s=Lr((e.x-t.x)/2+t.x),u=Lr((e.y-t.y)/2+t.y),l=(r=a,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[c].test(r)),h=/h|r|l/.test(c),p=!1,d=!1;return l?(o=h?{x:s,y:t.y}:{x:t.x,y:u},i=h?"h:h":"v:v"):(p=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(a,c),i=h?"h:v":"v:h",p?h?(d=u===t.y,o={x:t.x+20*(/l/.test(c)?-1:1),y:d?u+20:u}):o={x:(d=s===t.x)?s+20:s,y:t.y+20*(/t/.test(c)?-1:1)}:o={x:s,y:u}),{waypoints:Hr(t,o,i).concat(o),directions:i,turnNextDirections:d}}function $r(t){return t.split(":").reverse().join(":")}function Hr(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(qr(n)){var o=function(t,e,n){return Ir(t,e,n)}(t,e,n),i=function(t,e,n){var o=Ir(e,t,$r(n));return{waypoints:o.waypoints.slice().reverse(),directions:$r(o.directions),turnNextDirections:o.turnNextDirections}}(t,e,n),r=function(t,e){var n=t.directions.split(":")[1],o=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(o="h"==o?"v":"h");var i=n+":"+o;return{waypoints:Hr(t.waypoints[t.waypoints.length-1],e.waypoints[0],i),directions:i}}(o,i);return[].concat(o.waypoints,r.waypoints,i.waypoints)}return function(t,e,n){var o=Lr((e.x-t.x)/2+t.x),i=Lr((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:o,y:t.y},{x:o,y:e.y}];if("v:v"===n)return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function Vr(t,e,n){var o=Hr(t,e,n);return o.unshift(t),o.push(e),Yr(o)}function Gr(t,e,n,o,i){var r=v(i&&i.preferredLayouts||[],"straight")[0]||"h:h",a=Wo(t,e,Dr[r]||0),c=function(t,e){if(qr(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}(a,r);n=n||Fo(t),o=o||Fo(e);var s=c.split(":"),u=Ur(n,t,s[0],function(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}(a));return Vr(u,Ur(o,e,s[1],a),c)}function Nr(t,e,n,o,i,r){var c;return a(n)&&(i=n,r=o,n=Fo(t),o=Fo(e)),i=i||[],c=-1!==(r=O({preferredLayouts:[]},r)).preferredLayouts.indexOf("straight")&&function(t,e,n,o,i){var r,a,c={};if(a=Wo(t,e),!/^(top|bottom|left|right)$/.test(a))return null;/top|bottom/.test(a)&&(r="x");/left|right/.test(a)&&(r="y");return"target"===i.preserveDocking?Fr(r,o,t)?(c[r]=o[r],[{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y,original:{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y}},{x:o.x,y:o.y}]):null:Fr(r,n,e)?(c[r]=n[r],[{x:n.x,y:n.y},{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y,original:{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y}}]):null}(t,e,n,o,r),c||(c=r.connectionEnd&&function(t,e,n,o){var i=o.slice().reverse();return i=Wr(t,e,n,i),i?i.reverse():null}(e,t,o,i),c||((c=r.connectionStart&&Wr(t,e,n,i))||(!r.connectionStart&&!r.connectionEnd&&i&&i.length?i:Gr(t,e,n,o,r))))}function Fr(t,e,n){return function(t,e,n){return t>=e&&t<=n}(e[t],n[t],n[t]+n[{x:"width",y:"height"}[t]])}function Wr(t,e,n,o){if(function(t){return t.length<3||!(t.length>4)&&!!p(t,function(e,n){var o=t[n-1];return o&&$n(e,o)<3})}(o))return null;var i,r=o[0],a=o.slice();return a[0]=n,a[1]=function(t,e,n){switch(Vn(e,t)){case"v":return{x:n.x,y:t.y};case"h":return{x:t.x,y:n.y}}return{x:t.x,y:t.y}}(a[1],r,n),i=function(t,e,n){var o;for(o=t.length-2;0!==o;o--)if(Nn(t[o],e,20)||Nn(t[o],n,20))return t.slice(o);return t}(a,t,e),i!==a&&(a=Wr(t,e,n,i)),a&&Vn(a)?null:a}function qr(t){return t&&/t|r|b|l/.test(t)}function Ur(t,e,n,o){if("h"===n&&(n=/left/.test(o)?"l":"r"),"v"===n&&(n=/top/.test(o)?"t":"b"),"t"===n)return{original:t,x:t.x,y:e.y};if("r"===n)return{original:t,x:e.x+e.width,y:t.y};if("b"===n)return{original:t,x:t.x,y:e.y+e.height};if("l"===n)return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function Yr(t){return t.reduce(function(e,n,o){return Hn(e[e.length-1],t[o+1],n,0)||e.push(n),e},[])}function Kr(){}function Xr(t){return c(t)&&h(t,"children")&&!Fe(t)}function Zr(t,e,n){Ei.call(this,t),this.executed(["connection.layout","connection.create","connection.reconnectEnd","connection.reconnectStart"],function(t){var n,o=t.context;o.cropped||((n=o.connection).waypoints=e.getCroppedWaypoints(n),o.cropped=!0)}),this.postExecuted(["connection.layout","connection.reconnectEnd","connection.reconnectStart","connection.updateWaypoints","connection.move"],function(t){n.execute("layout.connection.labels",t.context)}),this.reverted(["connection.layout"],function(t){delete t.context.cropped}),t.on("element.hover",1500,function(t){if(We(t.element)&&"classifier"===t.element.labelType)return!1});t.on(["element.click","element.mousedown","element.mouseup","element.contextmenu","element.dblclick"],1500,function(e){We(e.element)&&"classifier"===e.element.labelType&&(e.stopPropagation(),t.fire(e.type,{element:e.element.parent,originalEvent:e.originalEvent,srcEvent:e.srcEvent}))})}function Jr(t,e){this._modeling=t,this._textRenderer=e}function Qr(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function ta(t,e,n){var o=function(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}(t,e);return Qr(t,e,n/o)}function ea(t){this._modeling=t}function na(t,e,n,o,i){this._eventBus=t,this._graphicsFactory=o,this._selection=n,this._layouter=i,this._elementRegistry=e}function oa(t,e){this._modeling=t,this._canvas=e}function ia(t){this._modeling=t}function ra(t,e){this._canvas=t,this._layouter=e}zr(Kr,Ar),Kr.prototype.layoutConnection=function(t,e){e=e||{};var n=t.source,o=t.target,i=t.waypoints,r=e.connectionStart,a=e.connectionEnd,c=e;return O(c,{preferredLayouts:["v:v"]}),Yr(Nr(n,o,r,a,i,c))},zr(Zr,Ei),Zr.$inject=["eventBus","connectionDocking","commandStack"],Jr.$inject=["modeling","textRenderer"],Jr.prototype.postExecute=function(t){var e=t.newLabel,n=t.element,o=this._textRenderer.getDimensions(e,{});"class"==n.type?n.businessObject.name=e:(n.businessObject=e,n.width=o.width,n.height=o.height),this._modeling.resizeShape(n,{x:n.x,y:n.y,width:Math.max(n.width,10),height:Math.max(n.height,10)})},ea.$inject=["modeling"],ea.prototype.preExecute=function(t){var e,n=this._modeling;function o(t,e,n){t.moveShape(e,{x:n.x-e.x,y:n.y-e.y})}function i(t,e,n){"left"===t?e.x-=n.width:"top"===t&&(e.y-=n.height)}function r(t,e,n){"left"===t?e.x-=5:"right"===t?e.x+=n.width+5:"top"===t?e.y-=5:"bottom"===t&&(e.y+=n.height+5)}function a(t,e,n,o){var i=ta(t,e,function(t){return t?15:5}(o));return!function(t){return"right"===t||"left"===t}(n)?i.x+=5:i.y+=5,i}function c(t,e){var n=t.connectionType;return"source"===e?"aggregation"===n||"composition"===n:"association"===n||"inheritance"===n}function s(t,e){return t.y===e.y?function(t,e){return t.x<e.x?"right":"left"}(t,e):function(t,e){return t.y<e.y?"bottom":"top"}(t,e)}e=t.connection,function(t,e){for(var n=function(t){var e=t.labels.filter(function(t){return"sourceCard"===t.labelType||"sourceName"===t.labelType});return e.sort(function(t,e){return t.labelType.localeCompare(e.labelType)})}(e),u=c(e,"source"),l=e.waypoints[0],h=e.waypoints[1],p=s(l,h),d=a(l,h,p,u),f=0;f<n.length;f++){var v=n[f];i(p,d,v),o(t,v,d),r(p,d,v)}}(n,e),function(t,e){for(var n=function(t){var e=t.labels.filter(function(t){return"targetCard"===t.labelType||"targetName"===t.labelType});return e.sort(function(t,e){return t.labelType.localeCompare(e.labelType)})}(e),u=c(e,"target"),l=e.waypoints[e.waypoints.length-1],h=e.waypoints[e.waypoints.length-2],p=s(l,h),d=a(l,h,p,u),f=0;f<n.length;f++){var v=n[f];i(p,d,v),o(t,v,d),r(p,d,v)}}(n,e)},na.$inject=["eventBus","elementRegistry","selection","graphicsFactory","layouter"],na.prototype.execute=function(t){var e=t.element,n=t.visibility;this.visibilityContext={elements:[],visibility:n},n&&this.showHiddenParents(e),this.setVisibility(e,n),Fe(e)&&n&&(this._setVisibility(e.source,!0),this.updateGraphics(e.source,!0),this._setVisibility(e.target,!0),this.updateGraphics(e.target,!0)),this.visibilityContext.elements.forEach(t=>{t.hidden&&this._selection.deselect(t)}),this._eventBus.fire("elements.visibility",this.visibilityContext)},na.prototype.showHiddenParents=function(t){var e=t.parent;e.isVisible||(Fe(e)&&(this._setVisibility(e.source,!0),this.updateGraphics(e.source,!0),this._setVisibility(e.target,!0),this.updateGraphics(e.target,!0)),this._setVisibility(e,!0),this.updateGraphics(e,!0))},na.prototype.setVisibility=function(t,e){this._setVisibility(t,e),t.hidden=!e&&!this._layouter.showHiddenElements,Xr(t)?We(t)?this.setLabelVisibility(t,e):this.setShapeVisibility(t,e):this.setConnectionVisibility(t,e)},na.prototype._setVisibility=function(t,e){t.isVisible!==e&&(this.visibilityContext.elements.includes(t)||this.visibilityContext.elements.push(t),t.isVisible=e)},na.prototype.setLabelVisibility=function(t,e){this.setChildrenVisibility(t,e),this.updateGraphics(t,!1)},na.prototype.setConnectionVisibility=function(t,e){this.setChildrenVisibility(t,e),this.updateGraphics(t,!1)},na.prototype.setShapeVisibility=function(t,e){this.setAttachedEdgesVisibility(t,e),this.setChildrenVisibility(t,e),this.updateGraphics(t,!1)},na.prototype.setAttachedEdgesVisibility=function(t,e){this.setIncomingAttachedEdgesVisibility(t,e),this.setOutgoingAttachedEdgesVisibility(t,e)},na.prototype.setIncomingAttachedEdgesVisibility=function(t,e){var n=this;"incoming"in t&&t.incoming.forEach(function(t){e?t.source.isVisible&&n.setVisibility(t,e):n.setVisibility(t,e)})},na.prototype.setOutgoingAttachedEdgesVisibility=function(t,e){var n=this;"outgoing"in t&&t.outgoing.forEach(function(t){e?t.target.isVisible&&n.setVisibility(t,e):n.setVisibility(t,e)})},na.prototype.setChildrenVisibility=function(t,e){var n=this;"children"in t&&t.children.forEach(function(t){n.setVisibility(t,e)})},na.prototype.updateGraphics=function(t,e){Fe(t)?this.updateGfx(t,"connection"):this.updateGfx(t,"shape"),e&&this.updateGraphicChildren(t)},na.prototype.updateGraphicChildren=function(t){var e=this;"children"in t&&t.children.forEach(function(t){e.updateGraphics(t,!1)})},na.prototype.updateGfx=function(t,e){var n=this._elementRegistry.getGraphics(t,!1);this._graphicsFactory.update(e,t,n)},oa.$inject=["modeling","canvas"],oa.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,o=t.alignment;f(n,function(t){var n={x:0,y:0};i(o.left)?n.x=o.left-t.x:i(o.right)?n.x=o.right-t.width-t.x:i(o.center)?n.x=o.center-Math.round(t.width/2)-t.x:i(o.top)?n.y=o.top-t.y:i(o.bottom)?n.y=o.bottom-t.height-t.y:i(o.middle)&&(n.y=o.middle-Math.round(t.height/2)-t.y),e.moveElements([t],n,t.parent)})},oa.prototype.postExecute=function(t){},ia.$inject=["modeling"],ia.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,o=t.shape,i=t.hints||{};o=t.shape=this._modeling.createShape(o,t.position,n,{attach:i.attach}),t.shape=o},ia.prototype.postExecute=function(t){var e,n,o=t.hints||{};e=t.source,n=t.shape,m(e.outgoing,function(t){return t.target===n})||(o.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))},ra.$inject=["canvas","layouter"],ra.prototype.execute=function(t){var e=t.connection,n=t.source,o=t.target,i=t.parent,r=t.parentIndex,a=t.hints;if(!n||!o)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=o,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,i,r),e},ra.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var aa=Math.round;function ca(t){this._modeling=t}ca.$inject=["modeling"],ca.prototype.preExecute=function(t){var e=t.elements,n=t.parent,o=t.parentIndex,i=t.position,r=t.hints,a=this._modeling;f(e,function(t){s(t.x)||(t.x=0),s(t.y)||(t.y=0)});var c=se(d(e,function(t){return!t.hidden}));f(e,function(t){Fe(t)&&(t.waypoints=x(t.waypoints,function(t){return{x:aa(t.x-c.x-c.width/2+i.x),y:aa(t.y-c.y-c.height/2+i.y)}})),O(t,{x:aa(t.x-c.x-c.width/2+i.x),y:aa(t.y-c.y-c.height/2+i.y)})});var u=oe(e),l={};f(e,function(t){if(Fe(t))l[t.id]=s(o)?a.createConnection(l[t.source.id],l[t.target.id],o,t,t.parent||n,r):a.createConnection(l[t.source.id],l[t.target.id],t,t.parent||n,r);else{var e=O({},r);-1===u.indexOf(t)&&(e.autoResize=!1),We(t)&&(e=function(t,e){let n={};return f(Object(t),function(t,o){-1===e.indexOf(o)&&(n[o]=t)}),n}(e,["attach"])),l[t.id]=s(o)?a.createShape(t,B(t,["x","y","width","height"]),t.parent||n,o,e):a.createShape(t,B(t,["x","y","width","height"]),t.parent||n,e)}}),t.elements=w(l)};var sa=Math.round;function ua(t){this._canvas=t}function la(t){ua.call(this,t)}ua.$inject=["canvas"],ua.prototype.execute=function(t){var e=t.shape,n=t.position,o=t.parent,i=t.parentIndex;if(!o)throw new Error("parent required");if(!n)throw new Error("position required");return void 0!==n.width?O(e,n):O(e,{x:n.x-sa(e.width/2),y:n.y-sa(e.height/2)}),this._canvas.addShape(e,o,i),e},ua.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e},mi(la,ua),la.$inject=["canvas"];var ha=ua.prototype.execute;la.prototype.execute=function(t){var e=t.shape;return function(t){["width","height"].forEach(function(e){void 0===t[e]&&(t[e]=0)})}(e),e.labelTarget=t.labelTarget,ha.call(this,t)};var pa=ua.prototype.revert;function da(t,e){this._canvas=t,this._modeling=e}function fa(t,e){this._modeling=t,this._elementRegistry=e}function va(t,e){this._canvas=t,this._modeling=e}function ya(t){this._modeling=t}la.prototype.revert=function(t){return t.shape.labelTarget=null,pa.call(this,t)},da.$inject=["canvas","modeling"],da.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;bi(n.incoming,function(t){e.removeConnection(t,{nested:!0})}),bi(n.outgoing,function(t){e.removeConnection(t,{nested:!0})})},da.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=wi(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e},da.prototype.revert=function(t){var e=t.connection,n=t.parent,o=t.parentIndex;return e.source=t.source,e.target=t.target,_i(n.children,e,o),this._canvas.addConnection(e,n),e},fa.$inject=["modeling","elementRegistry"],fa.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry;f(t.elements,function(t){n.get(t.id)&&(t.waypoints?e.removeConnection(t):e.removeShape(t))})},va.$inject=["canvas","modeling"],va.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;bi(n.incoming,function(t){e.removeConnection(t,{nested:!0})}),bi(n.outgoing,function(t){e.removeConnection(t,{nested:!0})}),bi(n.children,function(t){Fe(t)?e.removeConnection(t,{nested:!0}):e.removeShape(t,{nested:!0})})},va.prototype.execute=function(t){var e=this._canvas,n=t.shape,o=n.parent;return t.oldParent=o,t.oldParentIndex=wi(o.children,n),e.removeShape(n),n},va.prototype.revert=function(t){var e=this._canvas,n=t.shape,o=t.oldParent,i=t.oldParentIndex;return _i(o.children,n,i),e.addShape(n,o),n},ya.$inject=["modeling"];var ga={x:"y",y:"x"};function ma(t,e){this._layouter=t,this._canvas=e}function xa(){}function _a(t,e,n){var o=Pe(e),i=Pe(n),r=Re(t,o),a=r.x*(n.width/e.width),c=r.y*(n.height/e.height);return Ho({x:i.x+a,y:i.y+c})}function wa(t,e,n){var o=Sa(t),i=ja(o,e),r=o[0];return i.length?i[i.length-1]:_a(r.original||r,n,e)}function ba(t,e,n){var o=Sa(t),i=ja(o,e),r=o[o.length-1];return i.length?i[0]:_a(r.original||r,n,e)}function Ea(t,e,n){var o=Sa(t),i=Ca(e,n),r=o[0];return _a(r.original||r,i,e)}function ka(t,e,n){var o=Sa(t),i=Ca(e,n),r=o[o.length-1];return _a(r.original||r,i,e)}function Ca(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function Sa(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function ja(t,e){return d(x(t,Ma),function(t){return function(t,e){return"intersect"===Wo(e,t,1)}(t,e)})}function Ma(t){return t.original||t}function Pa(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function Ra(t){this._modeling=t}function Oa(t){this._helper=new Ra(t)}function Ba(t){this._modeling=t,this._helper=new Ra(t)}function za(t){this._modeling=t}function Ta(t){return t.original||t}function Aa(t,e){this._modeling=t,this._rules=e}function La(t){this._modeling=t}function Da(t,e){return-1!==t.indexOf(e)}function Ia(t){this._modeling=t}function $a(t){return O({},t)}function Ha(t){switch(t){case"n":case"s":return"y";case"w":case"e":return"x"}}function Va(t,e,n){var o=Ha(n);return/e|s/.test(n)?t[o]>e:/n|w/.test(n)?t[o]<e:void 0}function Ga(t,e){return-1!==t.indexOf(e)}function Na(t){this._modeling=t}function Fa(t){var e={};return f(t,function(t){e[t.id]=t.hidden,t.children&&(e=O({},e,Fa(t.children)))}),e}function Wa(t,e){var n=[];return f(t,function(t){t.hidden=e,n=n.concat(t),t.children&&(n=n.concat(Wa(t.children,t.collapsed||e)))}),n}function qa(t,e){var n=[];return f(t,function(t){t.hidden=e[t.id],n=n.concat(t),t.children&&(n=n.concat(qa(t.children,e)))}),n}function Ua(t){this._modeling=t}function Ya(t,e){return xi(t&&t.attachers,e)}function Ka(t,e,n){if(t){var o=t.attachers;o||(t.attachers=o=[]),_i(o,e,n)}}function Xa(){}function Za(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var o=this;t.on("diagram.init",function(){o.registerHandlers(n)})}function Ja(t,e,n,o,i,r,a,c,s){this.canvas=r,this._textRenderer=i,this._graphicsFactory=c,this._elementRegistry=n,this._selection=a,this._layouter=s,Za.call(this,t,e,o)}ya.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,o=t.axis,i=t.dimension;function r(t,e){t.range.min=Math.min(e[o],t.range.min),t.range.max=Math.max(e[o]+e[i],t.range.max)}function a(t){return t[o]+t[i]/2}function c(t){return t.length-1}function s(t){return t.max-t.min}var u,l,h=n[0],p=c(n),d=n[p],v=0;f(n,function(t,u){var l,h,d;t.elements.length<2?u&&u!==n.length-1&&(r(t,t.elements[0]),v+=s(t.range)):(h=(l=k(t.elements,o))[0],u===p&&(h=l[c(l)]),d=a(h),t.range=null,f(l,function(n){!function(t,n){var i={y:0};i[o]=t-a(n),i[o]&&(i[ga[o]]=0,e.moveElements([n],i,n.parent))}(d,n),null!==t.range?r(t,n):t.range={min:n[o],max:n[o]+n[i]}}),u&&u!==n.length-1&&(v+=s(t.range)))}),l=Math.abs(d.range.min-h.range.max),(u=Math.round((l-v)/(n.length-1)))<n.length-1||f(n,function(t,r){var a,c={};t!==h&&t!==d&&(a=n[r-1],t.range.max=0,f(t.elements,function(n,r){c[ga[o]]=0,c[o]=a.range.max-n[o]+u,t.range.min!==n[o]&&(c[o]+=n[o]-t.range.min),c[o]&&e.moveElements([n],c,n.parent),t.range.max=Math.max(n[o]+n[i],r?t.range.max:0)}))})},ya.prototype.postExecute=function(t){},ma.$inject=["layouter","canvas"],ma.prototype.execute=function(t){var e=t.connection;return O(t,{oldWaypoints:e.waypoints}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e},ma.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e},xa.prototype.execute=function(t){var e=t.connection,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldParent=r,t.oldParentIndex=xi(r.children,e),_i(o.children,e,i),e.parent=o,f(e.waypoints,function(t){t.x+=n.x,t.y+=n.y,t.original&&(t.original.x+=n.x,t.original.y+=n.y)}),e},xa.prototype.revert=function(t){var e=t.connection,n=e.parent,o=t.oldParent,i=t.oldParentIndex,r=t.delta;return xi(n.children,e),_i(o.children,e,i),e.parent=o,f(e.waypoints,function(t){t.x-=r.x,t.y-=r.y,t.original&&(t.original.x-=r.x,t.original.y-=r.y)}),e},Pa.prototype.add=function(t,e){return this.addAll([t],e)},Pa.prototype.addAll=function(t,e){var n=function(t,e,n){o(e)&&(e=!0),c(e)&&(n=e,e=!0);var i=he((n=n||{}).allShapes),r=he(n.allConnections),a=he(n.enclosedElements),s=he(n.enclosedConnections),u=he(n.topLevel,e&&b(t,function(t){return t.id}));function l(t){u[t.source.id]&&u[t.target.id]&&(u[t.id]=[t]),i[t.source.id]&&i[t.target.id]&&(s[t.id]=a[t.id]=t),r[t.id]=t}return ae(t,function(t){if(a[t.id]=t,!t.waypoints)return i[t.id]=t,f(t.incoming,l),f(t.outgoing,l),t.children;s[t.id]=r[t.id]=t}),{allShapes:i,allConnections:r,topLevel:u,enclosedConnections:s,enclosedElements:a}}(t,!!e,this);return O(this,n),this},Ra.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]},Ra.prototype.moveClosure=function(t,e,n,o,i){var r=this._modeling,a=t.allShapes,c=t.allConnections,s=t.enclosedConnections,u=t.topLevel,l=!1;i&&i.parent===n&&(l=!0),f(a,function(t){r.moveShape(t,e,u[t.id]&&!l&&n,{recurse:!1,layout:!1})}),f(c,function(t){var o=!!a[t.source.id],i=!!a[t.target.id];s[t.id]&&o&&i?r.moveConnection(t,e,u[t.id]&&!l&&n):r.layoutConnection(t,{connectionStart:o&&Ea(t,t.source,e),connectionEnd:i&&ka(t,t.target,e)})})},Ra.prototype.getClosure=function(t){return(new Pa).addAll(t,!0)},Oa.$inject=["modeling"],Oa.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)},Oa.prototype.postExecute=function(t){var e,n=t.hints;n&&n.primaryShape&&(e=n.primaryShape,n.oldParent=e.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,e)},Ba.$inject=["modeling"],Ba.prototype.execute=function(t){var e=t.shape,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldBounds=B(e,["x","y","width","height"]),t.oldParent=r,t.oldParentIndex=xi(r.children,e),_i(o.children,e,i),O(e,{parent:o,x:e.x+n.x,y:e.y+n.y}),e},Ba.prototype.postExecute=function(t){var e=t.shape,n=t.delta,o=t.hints,i=this._modeling;!1!==o.layout&&(f(e.incoming,function(t){i.layoutConnection(t,{connectionEnd:ka(t,e,n)})}),f(e.outgoing,function(t){i.layoutConnection(t,{connectionStart:Ea(t,e,n)})})),!1!==o.recurse&&this.moveChildren(t)},Ba.prototype.revert=function(t){var e=t.shape,n=t.oldParent,o=t.oldParentIndex,i=t.delta;return _i(n.children,e,o),O(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e},Ba.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)},Ba.prototype.getNewParent=function(t){return t.newParent||t.shape.parent},za.$inject=["modeling"],za.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,o=t.connection,i=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return a(i)&&(t.oldWaypoints=o.waypoints,o.waypoints=i),e&&(t.oldSource=o.source,o.source=e),n&&(t.oldTarget=o.target,o.target=n),o},za.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,o=t.newTarget,i=t.dockingOrPoints,r=t.hints||{},c={};r.connectionStart&&(c.connectionStart=r.connectionStart),r.connectionEnd&&(c.connectionEnd=r.connectionEnd),!1!==r.layoutConnection&&(!n||o&&"source"!==r.docking||(c.connectionStart=c.connectionStart||Ta(a(i)?i[0]:i)),!o||n&&"target"!==r.docking||(c.connectionEnd=c.connectionEnd||Ta(a(i)?i[i.length-1]:i)),r.newWaypoints&&(c.waypoints=r.newWaypoints),this._modeling.layoutConnection(e,c))},za.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,o=t.oldWaypoints,i=t.connection;return e&&(i.source=e),n&&(i.target=n),o&&(i.waypoints=o),i},Aa.$inject=["modeling","rules"],Aa.prototype.preExecute=function(t){var e,n=this,o=this._modeling,i=this._rules,r=t.oldShape,a=t.newData,c=t.hints||{};function s(t,e,n){return i.allowed("connection.reconnect",{connection:n,source:t,target:e})}var u,l={x:a.x,y:a.y},h={x:r.x,y:r.y,width:r.width,height:r.height};e=t.newShape=t.newShape||n.createShape(a,l,r.parent,c),r.host&&o.updateAttachment(e,r.host),!1!==c.moveChildren&&(u=r.children.slice(),o.moveElements(u,{x:0,y:0},e,c));var p=r.incoming.slice(),d=r.outgoing.slice();f(p,function(t){s(t.source,e,t)&&n.reconnectEnd(t,e,ba(t,e,h),c)}),f(d,function(t){var o=t.target;s(e,o,t)&&n.reconnectStart(t,e,wa(t,e,h),c)})},Aa.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)},Aa.prototype.execute=function(t){},Aa.prototype.revert=function(t){},Aa.prototype.createShape=function(t,e,n,o){return this._modeling.createShape(t,e,n,o)},Aa.prototype.reconnectStart=function(t,e,n,o){this._modeling.reconnectStart(t,e,n,o)},Aa.prototype.reconnectEnd=function(t,e,n,o){this._modeling.reconnectEnd(t,e,n,o)},La.$inject=["modeling"],La.prototype.execute=function(t){var e=t.shape,n=t.newBounds,o=t.minBounds;if(void 0===n.x||void 0===n.y||void 0===n.width||void 0===n.height)throw new Error("newBounds must have {x, y, width, height} properties");if(o&&(n.width<o.width||n.height<o.height))throw new Error("width and height cannot be less than minimum height and width");if(!o&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},O(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},La.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,o=t.oldBounds;!1!==(t.hints||{}).layout&&(f(n.incoming,function(t){e.layoutConnection(t,{connectionEnd:ba(t,n,o)})}),f(n.outgoing,function(t){e.layoutConnection(t,{connectionStart:wa(t,n,o)})}))},La.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return O(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Ia.$inject=["modeling"],Ia.prototype.preExecute=function(t){var e=t.delta,n=t.direction,o=t.movingShapes,i=t.resizingShapes,r=t.start,a={};this.moveShapes(o,e),f(i,function(t){a[t.id]=function(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}(t)}),this.resizeShapes(i,e,n),this.updateConnectionWaypoints(function(t,e){var n=[];return f(t.concat(e),function(o){var i=o.incoming,r=o.outgoing;f(i.concat(r),function(o){var i=o.source,r=o.target;(Da(t,i)||Da(t,r)||Da(e,i)||Da(e,r))&&(Da(n,o)||n.push(o))})}),n}(o,i),e,n,r,o,i,a)},Ia.prototype.execute=function(){},Ia.prototype.revert=function(){},Ia.prototype.moveShapes=function(t,e){var n=this;f(t,function(t){n._modeling.moveShape(t,e,null,{autoResize:!1,layout:!1,recurse:!1})})},Ia.prototype.resizeShapes=function(t,e,n){var o=this;f(t,function(t){var i=function(t,e,n){var o=t.x,i=t.y,r=t.width,a=t.height,c=n.x,s=n.y;switch(e){case"n":return{x:o,y:i+s,width:r,height:a-s};case"s":return{x:o,y:i,width:r,height:a+s};case"w":return{x:o+c,y:i,width:r-c,height:a};case"e":return{x:o,y:i,width:r+c,height:a};default:throw new Error("unknown direction: "+e)}}(t,n,e);o._modeling.resizeShape(t,i,null,{attachSupport:!1,autoResize:!1,layout:!1})})},Ia.prototype.updateConnectionWaypoints=function(t,e,n,o,i,r,a){var c=this,s=i.concat(r);f(t,function(t){var u=t.source,l=t.target,h=function(t){return x(t.waypoints,function(t){return(t=$a(t)).original&&(t.original=$a(t.original)),t})}(t),p=Ha(n),d={};Ga(s,u)&&Ga(s,l)?(h=x(h,function(t){return Va(t,o,n)&&(t[p]=t[p]+e[p]),t.original&&Va(t.original,o,n)&&(t.original[p]=t.original[p]+e[p]),t}),c._modeling.updateWaypoints(t,h,{labelBehavior:!1})):(Ga(s,u)||Ga(s,l))&&(Ga(i,u)?d.connectionStart=Ea(t,u,e):Ga(i,l)?d.connectionEnd=ka(t,l,e):Ga(r,u)?d.connectionStart=wa(t,u,a[u.id]):Ga(r,l)&&(d.connectionEnd=ba(t,l,a[l.id])),c._modeling.layoutConnection(t,d))})},Na.$inject=["modeling"],Na.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=Fa(n),e.collapsed=!e.collapsed;var o=Wa(n,e.collapsed);return[e].concat(o)},Na.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,o=qa(e.children,n);return e.collapsed=!e.collapsed,[e].concat(o)},Ua.$inject=["modeling"],Ua.prototype.execute=function(t){var e=t.shape,n=t.newHost,o=e.host;return t.oldHost=o,t.attacherIdx=Ya(o,e),Ka(n,e),e.host=n,e},Ua.prototype.revert=function(t){var e=t.shape,n=t.newHost,o=t.oldHost,i=t.attacherIdx;return e.host=o,Ya(n,e),Ka(o,e,i),e},Xa.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e},Xa.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e},Za.$inject=["eventBus","elementFactory","commandStack"],Za.prototype.getHandlers=function(){return{"shape.append":ia,"shape.create":ua,"shape.delete":va,"shape.move":Ba,"shape.resize":La,"shape.replace":Aa,"shape.toggleCollapse":Na,spaceTool:Ia,"label.create":la,"connection.create":ra,"connection.delete":da,"connection.move":xa,"connection.layout":ma,"connection.updateWaypoints":Xa,"connection.reconnect":za,"elements.create":ca,"elements.move":Oa,"elements.delete":fa,"elements.distribute":ya,"elements.align":oa,"element.updateAttachment":Ua}},Za.prototype.registerHandlers=function(t){f(this.getHandlers(),function(e,n){t.registerHandler(n,e)})},Za.prototype.moveShape=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=null);var r={shape:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("shape.move",r)},Za.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)},Za.prototype.moveElements=function(t,e,n,o){var i,r=(o=o||{}).attach,a=n;!0===r?(i=n,a=n.parent):!1===r&&(i=null);var c={shapes:t,delta:e,newParent:a,newHost:i,hints:o};this._commandStack.execute("elements.move",c)},Za.prototype.moveConnection=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=void 0);var r={connection:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("connection.move",r)},Za.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)},Za.prototype.createConnection=function(t,e,n,o,i,r){"object"==typeof n&&(r=i,i=o,o=n,n=void 0);var a={source:t,target:e,parent:i,parentIndex:n,connection:o=this._create("connection",o),hints:r};return this._commandStack.execute("connection.create",a),a.connection},Za.prototype.createShape=function(t,e,n,o,i){"number"!=typeof o&&(i=o,o=void 0);var r,a,c=(i=i||{}).attach;t=this._create("shape",t),c?(r=n.parent,a=n):r=n;var s={position:e,shape:t,parent:r,parentIndex:o,host:a,hints:i};return this._commandStack.execute("shape.create",s),s.shape},Za.prototype.createElements=function(t,e,n,o,i){a(t)||(t=[t]),"number"!=typeof o&&(i=o,o=void 0);var r={position:e,elements:t,parent:n,parentIndex:o,hints:i=i||{}};return this._commandStack.execute("elements.create",r),r.elements},Za.prototype.createLabel=function(t,e,n,o){n=this._create("label",n);var i={labelTarget:t,position:e,parent:o||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape},Za.prototype.appendShape=function(t,e,n,o,i){i=i||{};var r={source:t,position:n,target:o,shape:e=this._create("shape",e),connection:i.connection,connectionParent:i.connectionParent,hints:i};return this._commandStack.execute("shape.append",r),r.shape},Za.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)},Za.prototype.distributeElements=function(t,e,n){var o={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",o)},Za.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)},Za.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)},Za.prototype.replaceShape=function(t,e,n){var o={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",o),o.newShape},Za.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)},Za.prototype.resizeShape=function(t,e,n,o){var i={shape:t,newBounds:e,minBounds:n,hints:o};this._commandStack.execute("shape.resize",i)},Za.prototype.createSpace=function(t,e,n,o,i){var r={delta:n,direction:o,movingShapes:t,resizingShapes:e,start:i};this._commandStack.execute("spaceTool",r)},Za.prototype.updateWaypoints=function(t,e,n){var o={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",o)},Za.prototype.reconnect=function(t,e,n,o,i){var r={connection:t,newSource:e,newTarget:n,dockingOrPoints:o,hints:i||{}};this._commandStack.execute("connection.reconnect",r)},Za.prototype.reconnectStart=function(t,e,n,o){o||(o={}),this.reconnect(t,e,t.target,n,O(o,{docking:"source"}))},Za.prototype.reconnectEnd=function(t,e,n,o){o||(o={}),this.reconnect(t,t.source,e,n,O(o,{docking:"target"}))},Za.prototype.connect=function(t,e,n,o){return this.createConnection(t,e,n||{},t.parent,o)},Za.prototype._create=function(t,e){return e instanceof br?e:this._elementFactory.create(t,e)},Za.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)},zr(Ja,Za),Ja.$inject=["eventBus","elementFactory","elementRegistry","commandStack","textRenderer","canvas","selection","graphicsFactory","layouter"],Ja.prototype.getHandlers=function(){var t=Za.prototype.getHandlers.call(this);return t["element.updateLabel"]=Jr,t["layout.connection.labels"]=ea,t["element.visibility"]=na,t},Ja.prototype.updateLabel=function(t,e){this._commandStack.execute("element.updateLabel",{element:t,newLabel:e})},Ja.prototype.connect=function(t,e,n,o,i){return this.createConnection(t,e,O({connectionType:n},o),t.parent)},Ja.prototype.setVisibility=function(t,e){this._commandStack.execute("element.visibility",{element:t,visibility:e})};var Qa={__init__:["umlUpdater","modeling"],__depends__:[cr],connectionDocking:["type",ur],elementFactory:["type",Tr],modeling:["type",Ja],umlUpdater:["type",Zr],layouter:["type",Kr]},tc="drop-ok",ec="drop-not-ok",nc="attach-ok",oc="new-parent",ic="create";function rc(t,e,n,o,i,r){function c(e,n){[nc,tc,ec,oc].forEach(function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)})}function u(){var t=e.context();t&&t.prefix===ic&&e.cancel()}n.on(["create.move","create.hover"],function(t){var e=t.context;e.elements;var n=t.hover;if(e.source,e.hints,!n)return e.canExecute=!1,void(e.target=null);!function(t){var e=t.context,n=e.createConstraints;if(!n)return;n.left&&(t.x=Math.max(t.x,n.left));n.right&&(t.x=Math.min(t.x,n.right));n.top&&(t.y=Math.max(t.y,n.top));n.bottom&&(t.y=Math.min(t.y,n.bottom))}(t),t.x,t.y;var o=e.canExecute=n;n&&null!==o&&(e.target=n,o&&o.attach?c(n,nc):c(n,o?oc:ec))}),n.on(["create.end","create.out","create.cleanup"],function(t){var e=t.hover;e&&c(e,null)}),n.on("create.ended",function(t){n.fire("create."+t.context.type,{context:{bounds:{x:t.x,y:t.y,width:t.shape.width,height:t.shape.height}}})}),n.on("create.end",function(t){return!0}),n.on("create.init",function(){n.on("elements.changed",u),n.once(["create.cancel","create.end"],2e3,function(){n.off("elements.changed",u)})}),this.start=function(t,n,o){a(n)||(n=[n]);var i=p(n,function(t){return!Fe(t)});if(i){o=O({elements:n,hints:{},shape:i},o||{}),f(n,function(t){s(t.x)||(t.x=0),s(t.y)||(t.y=0)});var r=se(d(n,function(t){return!t.hidden}));f(n,function(t){Fe(t)&&(t.waypoints=x(t.waypoints,function(t){return{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2}})),O(t,{x:t.x-r.x-r.width/2,y:t.y-r.y-r.height/2})}),e.init(t,ic,{cursor:"grabbing",autoActivate:!0,data:{shape:i,elements:n,context:o}})}}}rc.$inject=["canvas","dragging","eventBus","modeling","elementRegistry","rules"];var ac={__depends__:[Ae],create:["type",rc]};function cc(t,e,n,o,i,r){this._create=t,this._elementFactory=e,this._lassoTool=n,this._palette=o,this._textRenderer=i,this._eventBus=r,o.registerProvider(this)}cc.$inject=["create","elementFactory","lassoTool","palette","textRenderer","eventBus"],cc.prototype.getPaletteEntries=function(){var t=this._create,e=this._elementFactory,n=this._lassoTool;function o(n,o,i,r){function a(o){var i=e.createClass({width:200,height:100,name:"Name"}),r={type:n};t.start(o,i,r)}return{group:o,className:i,title:r,action:{dragstart:a,click:a}}}return this._textRenderer,this._eventBus,{"lasso-tool":{group:"tools",className:"palette-icon-lasso-tool",title:"Activate Lasso Tool",action:{click:function(t){n.activateSelection(t)}}},"tool-separator":{group:"tools",separator:!0},"create-class":o("class","create","palette-icon-create-class","Create Class"),"create-enumeration":o("enumeration","create","palette-icon-create-enumeration","Create Enumeration")}};var sc={__depends__:[ac,gn,cn],__init__:["paletteProvider"],paletteProvider:["type",cc]},uc={__depends__:[cr,Pi,_e,be],__init__:["modeling"],modeling:["type",Za],layouter:["type",Ar]};function lc(t,e,n,o){this._connect=t,this._modeling=n,this._eventBus=o,this._contextPad=e,e.registerProvider(this)}lc.$inject=["connect","contextPad","modeling","eventBus"],lc.prototype.getContextPadEntries=function(t){var e=this._modeling,n=this._connect,o=this._eventBus,i=this._contextPad;function r(t,e){o.fire("delete.element",{context:{element:e}})}function a(t,e,o){n.start(t,e,o)}function c(t,e){O(t,{context:{shape:e}}),o.fire("create.class.property",t)}function s(t,e){return{group:"add",className:"context-pad-icon-"+t,title:e,action:{click:function(e,n){a(e,n,t)},dragstart:function(e,n){a(e,n,t)}}}}var u={delete:{group:"admin",className:"context-pad-icon-delete",title:"Remove",action:{click:r,dragstart:r}},visibility:function(t){return t.isVisible?{group:"admin",className:"context-pad-icon-hide",title:"Hide Part",action:{click:function(t,n){i.close(),e.setVisibility(n,!1)}}}:{group:"admin",className:"context-pad-icon-show",title:"Show Part",action:{click:function(t,n){i.close(),e.setVisibility(n,!0)}}}}(t)};return Xr(t)&&!We(t)&&("stereotypes"in t&&-1!=t.stereotypes.indexOf("enumeration")||O(u,{"inheritance-connection":s("inheritance","Inheritance Connection"),"composition-connection":s("composition","Composition Connection"),"association-connection":s("association","Association Connection"),"create-property":{group:"add",className:"context-pad-icon-create-property",title:"Create Property",action:{click:c}}}),t.isImported&&O(u,{goto:{group:"admin",className:"context-pad-icon-goto",title:"Go to",action:{click:function(t,e){o.fire("element.goto",{context:{element:e}})}}}})),u};var hc={__depends__:[In,or,uc],__init__:["contextPadProvider"],contextPadProvider:["type",lc]};function pc(t){Ei.call(this,t),this.init()}function dc(t){pc.call(this,t)}pc.$inject=["eventBus"],mi(pc,Ei),pc.prototype.addRule=function(t,e,n){var o=this;"string"==typeof t&&(t=[t]),t.forEach(function(t){o.canExecute(t,e,function(t,e,o){return n(t)},!0)})},pc.prototype.init=function(){},zr(dc,pc),dc.$inject=["eventBus"],dc.prototype.init=function(){this.addRule("shape.resize",function(t){var e=t.shape;return Xr(e)&&!We(e)}),this.addRule("elements.move",function(t){var e;return!t.shapes.some(function(t){return We(t)})&&!(We(t.target)||Xr(t.target)&&(e=t.target,!c(e)||!r(e.parent)))})};var fc={__depends__:[be],__init__:["umlRulesProvider"],umlRulesProvider:["type",dc]};function vc(t){return Math.log(t)/Math.log(10)}function yc(t,e){var n=vc(t.min),o=vc(t.max);return(Math.abs(n)+Math.abs(o))/e}var gc=Math.sign||function(t){return t>=0?1:-1},mc={min:.2,max:4};function xc(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=R(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var o=this;e.on("canvas.init",function(e){o._init(!1!==t.enabled)})}xc.$inject=["config.zoomScroll","eventBus","canvas"],xc.prototype.scroll=function(t){this._canvas.scroll(t)},xc.prototype.reset=function(){this._canvas.zoom("fit-viewport")},xc.prototype.zoom=function(t,e){var n=yc(mc,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},xc.prototype._handleWheel=function(t){if(!q(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,o=t.ctrlKey||dt()&&t.metaKey,i=t.shiftKey,r=-1*this._scale;if(r*=o?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,o){var a=e.getBoundingClientRect(),c={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*gc(t.deltaY)*r,this.zoom(n,c)}else n=i?{dx:r*t.deltaY,dy:0}:{dx:r*t.deltaX,dy:r*t.deltaY},this.scroll(n)}},xc.prototype.stepZoom=function(t,e){var n=yc(mc,10);this._zoom(t,e,n)},xc.prototype._zoom=function(t,e,n){var o=this._canvas,i=t>0?1:-1,r=vc(o.zoom()),a=Math.round(r/n)*n;a+=n*i;var c,s,u=Math.pow(10,a);o.zoom((c=mc,s=u,Math.max(c.min,Math.min(c.max,s))),e)},xc.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,o=this._enabled;return void 0===t&&(t=!o),o!==t&&J[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},xc.prototype._init=function(t){this.toggle(t)};var _c={__init__:["zoomScroll"],zoomScroll:["type",xc]};function wc(t,e){var n;function o(o){var i,r=n.start,a=n.button,c=pt(o),s=Re(c,r);(!n.dragging&&(i=s,Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))>15)&&(n.dragging=!0,0===a&&Me(t),Se("grab")),n.dragging)&&(s=Re(c,n.last||n.start),e.scroll({dx:s.x,dy:s.y}),n.last=c);o.preventDefault()}function i(t){J.unbind(document,"mousemove",o),J.unbind(document,"mouseup",i),n=null,je()}t.on("element.mousedown",500,function(t){return function(t){if(q(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:pt(t)},J.bind(document,"mousemove",o),J.bind(document,"mouseup",i),!0}(t.originalEvent)}),this.isActive=function(){return!!n}}wc.$inject=["eventBus","canvas"];var bc={__init__:["moveCanvas"],moveCanvas:["type",wc]};function Ec(t,e){var n=this;e=e||1e3,t.on(["render.shape","render.connection"],e,function(t,e){var o=t.type,i=e.element,r=e.gfx,a=e.attrs;if(n.canRender(i))return"render.shape"===o?n.drawShape(r,i,a):n.drawConnection(r,i,a)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)})}function kc(t,e,n,o){var i=o.createText(e,n);return Et(i).add("djs-label"),mt(t,i),i}function Cc(t,e,n,o){var i=function(t,e,n){var o=Rt("rect");return function(t,e,n){wt(t,{width:e,height:n})}(o,t,e),Pc(o,n),o}(e,n,o);return mt(t,i),i}function Sc(t,e,n){var o=Mc(e),i=function(t){var e=Mc(t);return jc(e,{stroke:"white","stroke-width":10})}(function(t){var e=t.length,n=t.slice();e>=2&&(n[0]=Qr(t[0],t[1],.1),n[e-1]=Qr(t[e-2],t[e-1],.9));return n}(e)),r=function(t){var e=Rt("g");return Et(e).add("djs-visual"),t.forEach(function(t){mt(e,t)}),e}([i,jc(o,n)]);return mt(t,r),r}function jc(t,e){var n=Rt("path");return function(t,e){wt(t,{d:e})}(n,t),function(t,e){"markerEnd"in e&&wt(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&wt(t,{"marker-start":"url(#"+e.markerStart+")"})}(n,e),function(t,e){"transform"in e&&wt(t,{transform:e.transform})}(n,e),Pc(n,e),n}function Mc(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function Pc(t,e){"stroke"in e&&wt(t,{stroke:e.stroke}),"stroke-width"in e&&wt(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&wt(t,{fill:e.fill}),"stroke-dasharray"in e&&wt(t,{"stroke-dasharray":e["stroke-dasharray"]})}function Rc(t){t.style.removeProperty("opacity")}function Oc(t,e){var n=t.closest(".djs-group");e.parent&&e.parent.isVisible?e.isVisible?Rc(n):function(t){t.style.setProperty("opacity",.3)}(n):Rc(n)}function Bc(t,e,n){e.businessObject;var o=Cc(t,e.width,e.height,{fill:"none",stroke:"black"}),i=function(t){return O({dy:".75em"},{x:t.width/2,"text-anchor":"middle"})}(e);if(i.y=5,"stereotypes"in e&&e.stereotypes.forEach(function(e){var o=kc(t,"&lt;&lt;"+e+"&gt;&gt;",i,n);i.y+=o.getBBox().height}),"name"in e){var r=kc(t,e.name,i,n);i.y+=r.getBBox().height}return e.labels.some(function(t){return"property"===t.labelType||"classifier"===t.labelType})&&"name"in e&&function(t,e,n){(function(t,e,n){var o=Rt("line");wt(o,{x1:e.x,y1:e.y,x2:n.x,y2:n.y,stroke:"black"}),mt(t,o)})(t,{x:0,y:n},{x:e,y:n})}(t,e.width,i.y),Oc(t,e),o}function zc(t,e,n){var o=kc(t,e.businessObject+"",{dy:".75em"},n);return Oc(t,e),o}function Tc(t,e){return Hc(t,e,{stroke:"black",markerEnd:"association-marker"})}function Ac(t,e){return Hc(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function Lc(t,e){return Hc(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function Dc(t,e){return Hc(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function Ic(t,e){return Hc(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function $c(t,e){return Hc(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function Hc(t,e,n){var o=Sc(t,e.waypoints,n);return Oc(t,e),o}Ec.prototype.canRender=function(t){},Ec.prototype.drawShape=function(t,e){},Ec.prototype.drawConnection=function(t,e){},Ec.prototype.getShapePath=function(t){},Ec.prototype.getConnectionPath=function(t){};var Vc=[{name:"association-marker",element:jc("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:jc("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:jc("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:jc("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:jc("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:jc("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function Gc(t,e,n,o){var i=Rt("marker");mt(i,n),wt(i,{id:e,viewBox:"0 0 10 10",refX:Nc(o),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),mt(t,i)}function Nc(t){return t?0:10}function Fc(t,e,n,o){Ec.call(this,t),this.textRenderer=n,this._layouter=o,this.drawShapeHandlers={class:Bc,label:zc},this.drawConnectionHandlers={association:Tc,inheritance:Ac,realization:Lc,dependency:Dc,aggregation:Ic,composition:$c},function(t){var e=at("defs",t._svg);e||(e=Rt("defs"),mt(t._svg,e)),Vc.forEach(function(t){var n=t.element.cloneNode(!0);Gc(e,t.name,t.element,!1),Gc(e,t.name+"-reversed",n,!0)})}(e)}function Wc(){this._style={fontFamily:"DroidSansMono",fontSize:12}}zr(Fc,Ec),Fc.$inject=["eventBus","canvas","textRenderer","layouter"],Fc.prototype.canRender=function(t){return!0},Fc.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},Fc.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},Fc.prototype.getShapePath=function(t){return n=(e=t).x,o=e.y,i=e.width,Wt([["M",n,o],["l",i,0],["l",0,e.height],["l",-i,0],["z"]]);var e,n,o,i},Wc.prototype.createText=function(t,e){var n=Rt("text");return wt(n,e=O(e,this._style)),Vt(n,t),n},Wc.prototype.getDimensions=function(t,e){var n=Rt("text");wt(n,this._style),mt(function(){var t=document.getElementById("helper-svg");if(!t)return function(){var t=Rt("svg");return wt(t,{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(t),t}();return t}(),n),n.textContent=t;var o=n.getBBox();return Gt(n),o},Wc.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},Wc.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var qc={__init__:["umlRenderer"],umlRenderer:["type",Fc],textRenderer:["type",Wc]};function Uc(t,e,n,o,i,r){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=o,this.layouter=i,this.commandStack=r}function Yc(t,e,n,o,i,r,a){return delete o.id,a.createClass(o,e)}function Kc(t,e,n){t in e&&(n[t]=e[t])}function Xc(t,e){var n,o;return n="waypoints"in t?Yr(t.waypoints):Vr(Zc(e.get(t.source)),Zc(e.get(t.target))),(o=n).forEach(function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)}),o}function Zc(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}Uc.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],Uc.prototype.import=function(t){var e=this.textRenderer,n=this.elementFactory,o=this.canvas,i=this.modeling;this.layouter;this.commandStack;var r=n.createRoot();o.setRootElement(r);var a=function(t,e,n,o,i,r){return new Map(t.map(function(t){var a=t.businessObject||{};return[t.id,Yc(n,i,e,t,a,o,r)]}))}(t.graph.nodes,n,o,e,r,i);!function(t,e,n,o,i,r,a,c){t.forEach(function(t){var n={connectionType:t.type,waypoints:Xc(t,e)};O(n,function(t){var e={};return Kc("sourceName",t,e),Kc("targetName",t,e),Kc("sourceCardinality",t,e),Kc("targetCardinality",t,e),e}(t)),c.createConnection(e.get(t.source),e.get(t.target),n,r)})}(t.graph.edges,a,0,0,0,r,0,i)};var Jc={__depends__:[qc,{umlImporter:["type",Uc]}]};const Qc=/^class[ {]/;function ts(t){return Array.isArray(t)}function es(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ns(...t){1===t.length&&ts(t[0])&&(t=t[0]);const e=(t=[...t]).pop();return e.$inject=t,e}const os=/constructor\s*[^(]*\(\s*([^)]*)\)/m,is=/^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m,rs=/\/\*([^*]*)\*\//m;function as(t){if("function"!=typeof t)throw new Error(`Cannot annotate "${t}". Expected a function!`);const e=t.toString().match(function(t){return Qc.test(t.toString())}(t)?os:is);if(!e)return[];const n=e[1]||e[2];return n&&n.split(",").map(t=>{const e=t.match(rs);return(e&&e[1]||t).trim()})||[]}function cs(t,e){e=e||{get:function(t,e){if(n.push(t),!1===e)return null;throw a(`No provider for "${t}"!`)}};const n=[],o=this._providers=Object.create(e._providers||null),i=this._instances=Object.create(null),r=i.injector=this,a=function(t){const e=n.join(" -> ");return n.length=0,new Error(e?`${t} (Resolving: ${e})`:t)};function c(t,r){if(!o[t]&&-1!==t.indexOf(".")){const e=t.split(".");let n=c(e.shift());for(;e.length;)n=n[e.shift()];return n}if(es(i,t))return i[t];if(es(o,t)){if(-1!==n.indexOf(t))throw n.push(t),a("Cannot resolve circular dependency!");return n.push(t),i[t]=o[t][0](o[t][1]),n.pop(),i[t]}return e.get(t,r)}function s(t,e){if(void 0===e&&(e={}),"function"!=typeof t){if(!ts(t))throw a(`Cannot invoke "${t}". Expected a function!`);t=ns(t.slice())}return{fn:t,dependencies:(t.$inject||as(t)).map(t=>es(e,t)?e[t]:c(t))}}function u(t){const{fn:e,dependencies:n}=s(t);return new(Function.prototype.bind.apply(e,[null].concat(n)))}function l(t,e,n){const{fn:o,dependencies:i}=s(t,n);return o.apply(e,i)}function h(t){return ns(e=>t.get(e))}function p(t,e){if(e&&e.length){const n=Object.create(null),i=Object.create(null),r=[],a=[],c=[];let s,u,l,p;for(let t in o)s=o[t],-1!==e.indexOf(t)&&("private"===s[2]?(u=r.indexOf(s[3]),-1===u?(l=s[3].createChild([],e),p=h(l),r.push(s[3]),a.push(l),c.push(p),n[t]=[p,t,"private",l]):n[t]=[c[u],t,"private",a[u]]):n[t]=[s[2],s[1]],i[t]=!0),"factory"!==s[2]&&"type"!==s[2]||!s[1].$scope||e.forEach(e=>{-1!==s[1].$scope.indexOf(e)&&(n[t]=[s[2],s[1]],i[e]=!0)});e.forEach(t=>{if(!i[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')}),t.unshift(n)}return new cs(t,r)}const d={factory:l,type:u,value:function(t){return t}};function f(t,e){const n=t.__init__||[];return function(){n.forEach(t=>{"string"==typeof t?e.get(t):e.invoke(t)})}}function v(t){const e=t.__exports__;if(e){const n=t.__modules__,i=Object.keys(t).reduce((e,n)=>("__exports__"!==n&&"__modules__"!==n&&"__init__"!==n&&"__depends__"!==n&&(e[n]=t[n]),e),Object.create(null)),r=p((n||[]).concat(i)),a=ns(function(t){return r.get(t)});e.forEach(function(t){o[t]=[a,t,"private",r]});const c=(t.__init__||[]).slice();return c.unshift(function(){r.init()}),f(t=Object.assign({},t,{__init__:c}),r)}return Object.keys(t).forEach(function(e){if("__init__"===e||"__depends__"===e)return;if("private"===t[e][2])return void(o[e]=t[e]);const n=t[e][0],i=t[e][1];o[e]=[d[n],ss(n,i),n]}),f(t,r)}function y(t,e){return-1!==t.indexOf(e)||-1!==(t=(e.__depends__||[]).reduce(y,t)).indexOf(e)?t:t.concat(e)}this.get=c,this.invoke=l,this.instantiate=u,this.createChild=p,this.init=function(t){const e=t.reduce(y,[]).map(v);let n=!1;return function(){n||(n=!0,e.forEach(t=>t()))}}(t)}function ss(t,e){return"value"!==t&&ts(e)&&(e=ns(e.slice())),e}function us(t,e){Ec.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}mi(us,Ec),us.prototype.canRender=function(){return!0},us.prototype.drawShape=function(t,e,n){var o=Rt("rect");return wt(o,{x:0,y:0,width:e.width||0,height:e.height||0}),le(e)?wt(o,O({},this.FRAME_STYLE,n||{})):wt(o,O({},this.SHAPE_STYLE,n||{})),mt(t,o),o},us.prototype.drawConnection=function(t,e,n){var o=Zt(e.waypoints,O({},this.CONNECTION_STYLE,n||{}));return mt(t,o),o},us.prototype.getShapePath=function(t){var e=t.x,n=t.y,o=t.width;return Wt([["M",e,n],["l",o,0],["l",0,t.height],["l",-o,0],["z"]])},us.prototype.getConnectionPath=function(t){var e,n,o=t.waypoints,i=[];for(e=0;n=o[e];e++)n=n.original||n,i.push([0===e?"M":"L",n.x,n.y]);return Wt(i)},us.$inject=["eventBus","styles"];var ls={__init__:["defaultRenderer"],defaultRenderer:["type",us],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){return O(this.style(e,n),{class:t})},this.style=function(e,n){a(e)||n||(n=e,e=[]);var o=y(e,function(e,n){return O(e,t[n]||{})},{});return n?O(o,n):o},this.computeStyle=function(t,n,o){return a(n)||(o=n,n=[]),e.style(n||[],O({},o,t||{}))}}]};function hs(t,e){return Math.round(t*e)/e}function ps(t){return s(t)?t+"px":t}function ds(t,e,n){const o=Rt("g");Et(o).add(e);const i=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(o,t.childNodes[i]||null),o}const fs={shape:["x","y","width","height"],connection:["waypoints"]};function vs(t,e,n,o){this._eventBus=e,this._elementRegistry=o,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function ys(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}vs.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],vs.prototype._init=function(t){const e=this._eventBus,n=this._container=function(t){const e=(t=O({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),H(n,{position:"relative",overflow:"hidden",width:ps(t.width),height:ps(t.height)}),e.appendChild(n),n}(t),o=this._svg=Rt("svg");wt(o,{width:"100%",height:"100%"}),mt(n,o);const i=this._viewport=ds(o,"viewport");t.deferUpdate&&(this._viewboxChanged=function(t,e){let n,o,i,r;function a(n){let a=Date.now(),u=n?0:r+e-a;if(u>0)return c(u);t.apply(i,o),s()}function c(t){n=setTimeout(a,t)}function s(){n&&clearTimeout(n),n=r=o=i=void 0}function u(...t){r=Date.now(),o=t,i=this,n||c(e)}return u.flush=function(){n&&a(!0),s()},u.cancel=s,u}(R(this._viewboxChanged,this),300)),e.on("diagram.init",()=>{e.fire("canvas.init",{svg:o,viewport:i})}),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],()=>{delete this._cachedViewbox}),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},vs.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},vs.prototype._clear=function(){this._elementRegistry.getAll().forEach(t=>{const e=ue(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)}),this._planes=[],this._rootElement=null,delete this._cachedViewbox},vs.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},vs.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},vs.prototype._getChildIndex=function(t){return y(this._layers,function(e,n){return n.visible&&t>=n.index&&e++,e},0)},vs.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:ds(this._viewport,"layer-"+t,n),index:e,visible:!0}},vs.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,o=e.group,i=e.index;if(e.visible)return o;const r=this._getChildIndex(i);return n.insertBefore(o,n.childNodes[r]||null),e.visible=!0,o},vs.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(Gt(n),e.visible=!1,n):n},vs.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],Gt(e.group))},vs.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},vs.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},vs.prototype.getRootElements=function(){return this._planes.map(function(t){return t.rootElement})},vs.prototype._findPlaneForRoot=function(t){return p(this._planes,function(e){return e.rootElement===t})},vs.prototype.getContainer=function(){return this._container},vs.prototype._updateMarker=function(t,e,n){let o;t.id||(t=this._elementRegistry.get(t)),o=this._elementRegistry._elements[t.id],o&&(f([o.gfx,o.secondaryGfx],function(t){t&&(n?Et(t).add(e):Et(t).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:o.gfx,marker:e,add:!!n}))},vs.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},vs.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},vs.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));return Et(this.getGraphics(t)).has(e)},vs.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},vs.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},vs.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const o=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,o),this._planes.push({rootElement:t,layer:o}),t},vs.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter(function(e){return e.rootElement!==t}),this._rootElement===t&&(this._rootElement=null),t},vs.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},vs.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},vs.prototype._addRoot=function(t,e){const n=this._elementRegistry,o=this._eventBus;o.fire("root.add",{element:t}),n.add(t,e),o.fire("root.added",{element:t,gfx:e})},vs.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},vs.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=fs[t],o=g(n,function(t){return void 0!==e[t]});if(!o)throw new Error("must supply { "+n.join(", ")+" } with "+t)},vs.prototype._setParent=function(t,e,n){_i(e.children,t,n),t.parent=e},vs.prototype._addElement=function(t,e,n,o){n=n||this.getRootElement();const i=this._eventBus,r=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,o);const a=r.create(t,e,o);return this._elementRegistry.add(e,a),r.update(t,e,a),i.fire(t+".added",{element:e,gfx:a}),e},vs.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},vs.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},vs.prototype._removeElement=function(t,e){const n=this._elementRegistry,o=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t))return i.fire(e+".remove",{element:t}),o.remove(t),xi(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t},vs.prototype.removeShape=function(t){return this._removeElement(t,"shape")},vs.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},vs.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},vs.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},vs.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},vs.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let o,i,r,a,c,s,u;return t?(this._changeViewbox(function(){c=Math.min(n.width/t.width,n.height/t.height);const o=this._svg.createSVGMatrix().scale(c).translate(-t.x,-t.y);Ft(e,o)}),t):(r=this._rootElement?this.getActiveLayer():null,o=r&&r.getBBox()||{},a=Ft(e),i=a?a.matrix:function(t,e,n,o,i,r){var a=Bt().createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return zt(a,t);case 6:return zt(a,{a:t,b:e,c:n,d:o,e:i,f:r})}}(),c=hs(i.a,1e3),s=hs(-i.e||0,1e3),u=hs(-i.f||0,1e3),t=this._cachedViewbox={x:s?s/c:0,y:u?u/c:0,width:n.width/c,height:n.height/c,scale:c,inner:{width:o.width||0,height:o.height||0,x:o.x||0,y:o.y||0},outer:n})},vs.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox(function(){t=O({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),ys(e,n)}),{x:n.e,y:n.f}},vs.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const o=this.findRoot(t);if(o!==this.getRootElement()&&this.setRootElement(o),o===t)return;e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const i=se(t),r=Vo(i),a=this.viewbox(),c=this.zoom();let s,u;a.y+=e.top/c,a.x+=e.left/c,a.width-=(e.right+e.left)/c,a.height-=(e.bottom+e.top)/c;const l=Vo(a);if(i.width<a.width&&i.height<a.height){const t=Math.max(0,r.right-l.right),e=Math.min(0,r.left-l.left),n=Math.max(0,r.bottom-l.bottom),o=Math.min(0,r.top-l.top);s=t||e,u=n||o}else s=i.x-a.x,u=i.y-a.y;this.scroll({dx:-s*c,dy:-u*c})},vs.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,o;return this._changeViewbox(function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),o=this._setZoom(t,e)}),hs(o.a,1e3)},vs.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,o=e.inner;let i,r;return o.x>=0&&o.y>=0&&o.x+o.width<=n.width&&o.y+o.height<=n.height&&!t?r={x:0,y:0,width:Math.max(o.width+o.x,n.width),height:Math.max(o.height+o.y,n.height)}:(i=Math.min(1,n.width/o.width,n.height/o.height),r={x:o.x+(t?o.width/2-n.width/i/2:0),y:o.y+(t?o.height/2-n.height/i/2:0),width:n.width/i,height:n.height/i}),this.viewbox(r),this.viewbox(!1).scale},vs.prototype._setZoom=function(t,e){const n=this._svg,o=this._viewport,i=n.createSVGMatrix(),r=n.createSVGPoint();let a,c,s,u,l;s=o.getCTM();const h=s.a;return e?(a=O(r,e),c=a.matrixTransform(s.inverse()),u=i.translate(c.x,c.y).scale(1/h*t).translate(-c.x,-c.y),l=s.multiply(u)):l=i.scale(t),ys(this._viewport,l),l},vs.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},vs.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},vs.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var gs="data-element-id";function ms(t){this._elements={},this._eventBus=t}ms.$inject=["eventBus"],ms.prototype.add=function(t,e,n){var o=t.id;this._validateId(o),wt(e,gs,o),n&&wt(n,gs,o),this._elements[o]={element:t,gfx:e,secondaryGfx:n}},ms.prototype.remove=function(t){var e=this._elements,n=t.id||t,o=n&&e[n];o&&(wt(o.gfx,gs,""),o.secondaryGfx&&wt(o.secondaryGfx,gs,""),delete e[n])},ms.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),o=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,o)},ms.prototype.updateGraphics=function(t,e,n){var o=t.id||t,i=this._elements[o];return n?i.secondaryGfx=e:i.gfx=e,e&&wt(e,gs,o),e},ms.prototype.get=function(t){var e;e="string"==typeof t?t:t&&wt(t,gs);var n=this._elements[e];return n&&n.element},ms.prototype.filter=function(t){var e=[];return this.forEach(function(n,o){t(n,o)&&e.push(n)}),e},ms.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),o=0;o<n.length;o++){var i=e[n[o]],r=i.element;if(t(r,i.gfx))return r}},ms.prototype.getAll=function(){return this.filter(function(t){return t})},ms.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach(function(n){var o=e[n],i=o.element,r=o.gfx;return t(i,r)})},ms.prototype.getGraphics=function(t,e){var n=t.id||t,o=this._elements[n];return o&&(e?o.secondaryGfx:o.gfx)},ms.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var xs="__fn",_s=Array.prototype.slice;function ws(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function bs(){}function Es(t,e){this._eventBus=t,this._elementRegistry=e}function ks(t,e,n){var o=n||e.firstChild;t!==o&&e.insertBefore(t,o)}ws.prototype.on=function(t,e,n,o){if(t=a(t)?t:[t],u(e)&&(o=n,n=e,e=1e3),!s(e))throw new Error("priority must be a number");var i=n;o&&((i=R(n,o))[xs]=n[xs]||n);var r=this;t.forEach(function(t){r._addListener(t,{priority:e,callback:i,next:null})})},ws.prototype.once=function(t,e,n,o){var i=this;if(u(e)&&(o=n,n=e,e=1e3),!s(e))throw new Error("priority must be a number");function r(){r.__isTomb=!0;var e=n.apply(o,arguments);return i.off(t,r),e}r[xs]=n,this.on(t,e,r)},ws.prototype.off=function(t,e){t=a(t)?t:[t];var n=this;t.forEach(function(t){n._removeListener(t,e)})},ws.prototype.createEvent=function(t){var e=new bs;return e.init(t),e},ws.prototype.fire=function(t,e){var n,o,i,r;if(r=_s.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(o=this._listeners[t]){n=e instanceof bs?e:this.createEvent(e),r[0]=n;var a=n.type;t!==a&&(n.type=t);try{i=this._invokeListeners(n,r,o)}finally{t!==a&&(n.type=a)}return void 0===i&&n.defaultPrevented&&(i=!1),i}},ws.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},ws.prototype._destroy=function(){this._listeners={}},ws.prototype._invokeListeners=function(t,e,n){for(var o;n&&!t.cancelBubble;)o=this._invokeListener(t,e,n),n=n.next;return o},ws.prototype._invokeListener=function(t,e,n){var o;if(n.callback.__isTomb)return o;try{o=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==o&&(t.returnValue=o,t.stopPropagation()),!1===o&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener",t),t}return o},ws.prototype._addListener=function(t,e){var n,o=this._getListeners(t);if(o){for(;o;){if(o.priority<e.priority)return e.next=o,void(n?n.next=e:this._setListeners(t,e));n=o,o=o.next}n.next=e}else this._setListeners(t,e)},ws.prototype._getListeners=function(t){return this._listeners[t]},ws.prototype._setListeners=function(t,e){this._listeners[t]=e},ws.prototype._removeListener=function(t,e){var n,o,i,r=this._getListeners(t);if(e)for(;r;)n=r.next,(i=r.callback)!==e&&i[xs]!==e||(o?o.next=n:this._setListeners(t,n)),o=r,r=n;else this._setListeners(t,null)},bs.prototype.stopPropagation=function(){this.cancelBubble=!0},bs.prototype.preventDefault=function(){this.defaultPrevented=!0},bs.prototype.init=function(t){O(this,t||{})},Es.$inject=["eventBus","elementRegistry"],Es.prototype._getChildrenContainer=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(n),e||(Et(e=Rt("g")).add("djs-children"),mt(n.parentNode,e))):e=n,e},Es.prototype._clear=function(t){var e=Le(t);return W(e),e},Es.prototype._createContainer=function(t,e,n,o){var i=Rt("g");Et(i).add("djs-group"),void 0!==n?ks(i,e,e.childNodes[n]):mt(e,i);var r=Rt("g");Et(r).add("djs-element"),Et(r).add("djs-"+t),o&&Et(r).add("djs-frame"),mt(i,r);var a=Rt("g");return Et(a).add("djs-visual"),mt(r,a),r},Es.prototype.create=function(t,e,n){var o=this._getChildrenContainer(e.parent);return this._createContainer(t,o,n,le(e))},Es.prototype.updateContainments=function(t){var e,n=this,o=this._elementRegistry;e=y(t,function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t},{}),f(e,function(t){var e=t.children;if(e){var i=n._getChildrenContainer(t);f(e.slice().reverse(),function(t){ks(o.getGraphics(t).parentNode,i)})}})},Es.prototype.drawShape=function(t,e,n={}){return this._eventBus.fire("render.shape",{gfx:t,element:e,attrs:n})},Es.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},Es.prototype.drawConnection=function(t,e,n={}){return this._eventBus.fire("render.connection",{gfx:t,element:e,attrs:n})},Es.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},Es.prototype.update=function(t,e,n){if(e.parent){var o=this._clear(n);if("shape"===t)this.drawShape(o,e),Ne(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(o,e)}e.hidden?wt(n,"display","none"):wt(n,"display","block")}},Es.prototype.remove=function(t){Gt(this._elementRegistry.getGraphics(t).parentNode)};var Cs={__depends__:[ls],__init__:["canvas"],canvas:["type",vs],elementRegistry:["type",ms],elementFactory:["type",Mr],eventBus:["type",ws],graphicsFactory:["type",Es]};function Ss(t){return function(t){var e=new cs(t);return e.init(),e}([{config:["value",t=t||{}]},Cs].concat(t.modules||[]))}function js(t,e){this._injector=e=e||Ss(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function Ms(t){this._container=this._createContainer(t),this._init(this._container,t)}function Ps(t){Ms.call(this,t)}return js.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},js.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},zr(Ms,js),Ms.prototype._coreModules=[Jc],Ms.prototype._viewModules=[_c,bc],Ms.prototype._modules=[].concat(Ms.prototype._coreModules,Ms.prototype._viewModules),Ms.prototype.importJSON=function(t){this.get("umlImporter").import(t)},Ms.prototype._createContainer=function(t){var e;return O((e=rt("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},Ms.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};js.call(this,n),e&&e.parent&&this.attachTo(e.parent)},Ms.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=at(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},Ms.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},Ms.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},zr(Ps,Ms),Ps.prototype._modelingModules=[_e,Je,de,cn,gn,jn,In,or,be,sc,hc,fc,Qa,ji,Pi,qi,Qi,rr,gi],Ps.prototype._modules=[].concat(Ps.prototype._modules,Ps.prototype._modelingModules),Ps});
