<p>Über Promethus können die <strong>nummerische Attribute</strong> der MBeans über einen Zeitraum getrackt und auf einfache Art und Weise graphisch dargestellt werden. MBeans stellen Metriken und Statusinformationen über die <strong>JMX </strong>(<strong>J</strong>ava <strong>M</strong>anagement E<strong>x</strong>tension) bereit. Allerdings ist die direkte Integration von JMX in Überwachungssysteme wie Prometheus nicht trivial, da Prometheus standardmäßig keine Unterstützung für das Abfragen von JMX-Metriken bietet. Dazu wird ein JMX Exporter benötigt.</p>

<p>Der JMX Exporter fungiert als Brücke zwischen JMX und Prometheus. Er verbindet sich mit der JMX-Schnittstelle der Java-Anwendung, sammelt die Metriken von MBeans und wandelt sie in ein Format um, das von Prometheus verstanden werden kann. Diese umgewandelten Metriken werden dann über eine HTTP-Schnittstelle bereitgestellt, die Prometheus regelmäßig abfragt (scraped).</p>

<p>Sollen auch nicht-nummerische Werte gespeichert werden, so wird der Einsatz eines anderen Tools als Prometheus empfohlen.</p>

<p><img src="ref:screenshot_prometheus_klein_51723.png" style="opacity:1" /></p>

<p><em>Bild 1: Screenshot eines von Prometheus erstellten Graphen über die Anzahl der eingeloggten Benutzer des MBeans MonitorUser.</em></p>

<h2>Starten des Prometheus Java Agent</h2>

<p>Zunächst muss der gewünschte <strong>JMX Prometheus Java Agent</strong> heruntergeladen werden. Durch ihn werden die Daten der MBeans exportiert.</p>

<p><a href="https://github.com/prometheus/jmx_exporter/releases">https://github.com/prometheus/jmx_exporter/releases</a></p>

<p>Des weiteren wird eine Konfiguration benötigt. Eine minimale <strong>Konfiguration config.yaml</strong> sieht wie folgt aus:</p>

<pre>
<code class="language-xml">rules:
- pattern: ".*"</code></pre>

<p>Zum Starten kann in Eclipse eine <strong>Launch Konfiguration</strong> geschrieben werden. Dazu muss</p>

<pre>
<code>-javaagent:Pfad_zum_Java_Agent=Portnummer_JMX:Pfad_zur_Konfiguration</code></pre>

<p>in die entsprechenden <strong>VM Argumente</strong> eingetragen werden. <em>Pfad_zum_Java_Agent</em>, <em>Portnummer_JMX</em> und <em>Pfad_zur_Konfiguration</em> sind hierbei zu ersetzen.</p>

<p>Nach dem Start der Applikation können die <strong>Metriken</strong> nun unter</p>

<pre>
<code>http://localhost:Portnummer_JMX/metrics</code></pre>

<p>eingesehen werden (siehe Bild 2). Im Folgenden wird "12345" als Portnummer für den JMX Exporter gewählt.</p>

<p><img src="ref:jmx_metrics_67153.png" style="opacity:1" /></p>

<p><em>Bild 2: Darstellung der Metriken. Markiert sind hier die Zeilen eines Attributs (Anzahl der eingeloggten Benutzer) der vordefinierten MBean MonitorUser aus TopLogic. Zu sehen ist hier, dass der Wert dieses Attributs bei 2 liegt, also zu diesem Zeitpunkt 2 Benutzer gleichzeitig eingeloggt waren.</em></p>

<h2>Prometheus starten</h2>

<p>Als erstes muss Prometheus heruntergeladen werden.</p>

<p><a href="https://prometheus.io/download/">https://prometheus.io/download/</a></p>

<p>In der <strong>prometheus.yml</strong> kann nun zusätzlich der JMX Exporter konfiguriert werden:</p>

<pre>
<code class="language-xml">- job_name: 'jmx-exporter'
    static_configs:
      - targets: ['localhost:8080']</code></pre>

<p>Hier ist als Target die Applikation anzugeben von der die Daten der MBeans entnommen werden können.</p>

<p>Der nächste Schritt ist das Starten von Prometheus. Standardmäßig ist Prometheus nun unter</p>

<pre>
<code>http://localhost:9090</code></pre>

<p>erreichbar.</p>

<p><img src="ref:screenshot_prometheus_erklaerung_klein_23848.png" style="opacity:1" /></p>

<p><em>Bild 3: Erklärung der Prometheus-Oberfläche. 1) Auswählen der Metrik. 2) Laden der Metrik. 3) Tab zur graphischen Auswertung. 4) Beobachtungszeit. 5) Startzeitpunkt. 6) Auswertungsintervall. 7) Verschiedene Darstellungen.</em></p>

<p> </p>