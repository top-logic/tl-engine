/*! uml-js - uml-modeler v1.0.0 | Copyright (c) 2019 Business Operation Systems GmbH. All Rights Reserved */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.UmlJS=e()}(this,function(){"use strict";function p(t){return Array.prototype.concat.apply([],t)}var e=Object.prototype.toString,a=Object.prototype.hasOwnProperty;function u(t){return void 0===t}function s(t){return void 0!==t}function h(t){return"[object Array]"===e.call(t)}function l(t){return"[object Object]"===e.call(t)}function d(t){return"[object Number]"===e.call(t)}function f(t){return"[object Function]"===e.call(t)}function c(t){return"[object String]"===e.call(t)}function v(t,n){var o;return n=S(n),m(t,function(t,e){if(n(t,e))return o=t,!1}),o}function y(t,n){var o=[];return m(t,function(t,e){n(t,e)&&o.push(t)}),o}function m(t,e){if(!u(t)){var n,o,i=h(t)?C:k;for(var r in t){if(n=t,o=r,a.call(n,o))if(!1===e(t[r],i(r)))return}}}function g(t,n){return u(t)?[]:(function(t){if(!h(t))throw new Error("must supply array")}(t),n=S(n),t.filter(function(t,e){return!n(t,e)}))}function r(t,n,o){return m(t,function(t,e){o=n(o,t,e)}),o}function o(t,o){return r(t,function(t,e,n){return t&&o(e,n)},!0)}function x(t,n){var o=[];return m(t,function(t,e){o.push(n(t,e))}),o}function _(t){return(e=t,e&&Object.keys(e)||[]).length;var e}function w(t,o){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return o=E(o),m(t,function(t){var e=o(t)||"_",n=i[e];n||(n=i[e]=[]),n.push(t)}),i}function b(t,r){r=E(r);var a=[];return m(t,function(t,e){for(var n=r(t,e),o={d:n,v:t},i=0;i<a.length;i++){if(n<a[i].d)return void a.splice(i,0,o)}a.push(o)}),x(a,function(t){return t.v})}function i(t){return function(n){return o(t,function(t,e){return n[e]===t})}}function E(e){return f(e)?e:function(t){return t[e]}}function S(e){return f(e)?e:function(t){return t===e}}function k(t){return t}function C(t){return Number(t)}function j(t,e){return t.bind(e)}var M=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};function R(t){for(var e=arguments.length,n=Array(1<e?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return M.apply(void 0,[t].concat(n))}function z(e,t){var n={},o=Object(e);return m(t,function(t){t in o&&(n[t]=e[t])}),n}function B(t,e,n){return 2==arguments.length?t.getAttribute(e):null===n?t.removeAttribute(e):(t.setAttribute(e,n),t)}var P=[].indexOf,O=function(t,e){if(P)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1},n=/\s+/,A=Object.prototype.toString;function T(t){return new L(t)}function L(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function D(t){for(var e;t.childNodes.length;)e=t.childNodes[0],t.removeChild(e);return t}L.prototype.add=function(t){if(this.list)return this.list.add(t),this;var e=this.array();return~O(e,t)||e.push(t),this.el.className=e.join(" "),this},L.prototype.remove=function(t){if("[object RegExp]"==A.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var e=this.array(),n=O(e,t);return~n&&e.splice(n,1),this.el.className=e.join(" "),this},L.prototype.removeMatching=function(t){for(var e=this.array(),n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},L.prototype.toggle=function(t,e){return this.list?void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t):void 0!==e?e?this.add(t):this.remove(t):this.has(t)?this.remove(t):this.add(t),this},L.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(n);return""===t[0]&&t.shift(),t},L.prototype.has=L.prototype.contains=function(t){return this.list?this.list.contains(t):!!~O(this.array(),t)};var t=Element.prototype,I=t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector,$=function(t,e){if(I)return I.call(t,e);for(var n=t.parentNode.querySelectorAll(e),o=0;o<n.length;++o)if(n[o]==t)return!0;return!1};var N,H=function(t,e,n){for(var o=n?t:t.parentNode;o&&o!==document;){if($(o,e))return o;o=o.parentNode}},F=window.addEventListener?"addEventListener":"attachEvent",G=window.removeEventListener?"removeEventListener":"detachEvent",W="addEventListener"!==F?"on":"",V={bind:function(t,e,n,o){return t[F](W+e,n,o||!1),n},unbind:function(t,e,n,o){return t[G](W+e,n,o||!1),n}},q=["focus","blur"],U=function(n,o,t,i,e){return-1!==q.indexOf(t)&&(e=!0),V.bind(n,t,function(t){var e=t.target||t.srcElement;t.delegateTarget=H(e,o,!0,n),t.delegateTarget&&i.call(n,t)},e)},Y=function(t,e,n,o){-1!==q.indexOf(e)&&(o=!0),V.unbind(t,e,n,o)},X=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var o=n[1];if("body"==o){var i=e.createElement("html");return i.innerHTML=t,i.removeChild(i.lastChild)}var r=Z[o]||Z._default,a=r[0],c=r[1],s=r[2];(i=e.createElement("div")).innerHTML=c+t+s;for(;a--;)i=i.lastChild;if(i.firstChild==i.lastChild)return i.removeChild(i.firstChild);var u=e.createDocumentFragment();for(;i.firstChild;)u.appendChild(i.removeChild(i.firstChild));return u},K=!1;"undefined"!=typeof document&&((N=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',K=!N.getElementsByTagName("link").length,N=void 0);var Z={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:K?[1,"X<div>","</div>"]:[0,"",""]};Z.td=Z.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],Z.option=Z.optgroup=[1,'<select multiple="multiple">',"</select>"],Z.thead=Z.tbody=Z.colgroup=Z.caption=Z.tfoot=[1,"<table>","</table>"],Z.polyline=Z.ellipse=Z.polygon=Z.circle=Z.text=Z.line=Z.path=Z.rect=Z.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var Q="undefined"!=typeof Element?Element.prototype:{},J=Q.matches||Q.matchesSelector||Q.webkitMatchesSelector||Q.mozMatchesSelector||Q.msMatchesSelector||Q.oMatchesSelector,tt=function(t,e){if(!t||1!==t.nodeType)return!1;if(J)return J.call(t,e);for(var n=t.parentNode.querySelectorAll(e),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1};function et(t,e){return(e=e||document).querySelector(t)}function nt(t,e){return(e=e||document).querySelectorAll(t)}function ot(t){t.parentNode&&t.parentNode.removeChild(t)}function it(t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation()}function rt(t){return t.originalEvent||t.srcEvent}function at(t,e){it(t),it(rt(t))}function ct(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function st(t){return!(rt(t)||t).button}function ut(t){var e=rt(t)||t;return!!st(t)&&(/mac/i.test(navigator.platform)?e.metaKey:e.ctrlKey)}function lt(t,e){return e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}function ht(t,e){return lt(e,t),t}var pt=2,dt={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":pt,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":pt,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function ft(t,e,n){var o=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=dt[o];i?(i===pt&&"number"==typeof n&&(n=String(n)+"px"),t.style[o]=n):t.setAttributeNS(null,e,n)}function vt(t,e,n){if("string"==typeof e){if(void 0===n)return o=t,dt[i=e]?o.style[i]:o.getAttributeNS(null,i);ft(t,e,n)}else!function(t,e){var n,o,i=Object.keys(e);for(n=0;o=i[n];n++)ft(t,o,e[o])}(t,e);var o,i;return t}function yt(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}var gt=/\s+/,mt=Object.prototype.toString;function xt(t){return void 0!==t}function _t(t){return new wt(t)}function wt(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function bt(t){var e=t.parentNode;return e&&e.removeChild(t),t}function Et(t){for(var e;e=t.firstChild;)bt(e);return t}wt.prototype.add=function(t){if(this.list)return this.list.add(t),this;var e=this.array();return~yt(e,t)||e.push(t),xt(this.el.className.baseVal)?this.el.className.baseVal=e.join(" "):this.el.className=e.join(" "),this},wt.prototype.remove=function(t){if("[object RegExp]"===mt.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var e=this.array(),n=yt(e,t);return~n&&e.splice(n,1),this.el.className.baseVal=e.join(" "),this},wt.prototype.removeMatching=function(t){for(var e=this.array(),n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},wt.prototype.toggle=function(t,e){return this.list?xt(e)?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t):xt(e)?e?this.add(t):this.remove(t):this.has(t)?this.remove(t):this.add(t),this},wt.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(gt);return""===t[0]&&t.shift(),t},wt.prototype.has=wt.prototype.contains=function(t){return this.list?this.list.contains(t):!!~yt(this.array(),t)};var St={svg:"http://www.w3.org/2000/svg"},kt='<svg xmlns="'+St.svg+'"';function Ct(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(St.svg)&&(t=kt+t.substring(4)):(t=kt+">"+t+"</svg>",e=!0);var n,o,i=(n=t,(o=new DOMParser).async=!1,o.parseFromString(n,"text/xml"));if(!e)return i;for(var r=document.createDocumentFragment(),a=i.firstChild;a.firstChild;)r.appendChild(a.firstChild);return r}function jt(t,e){var n;return n="<"===t.charAt(0)?(n=Ct(t).firstChild,document.importNode(n,!0)):document.createElementNS(St.svg,t),e&&vt(n,e),n}var Mt=jt("svg");function Rt(t,e){var n,o,i=Object.keys(e);for(n=0;o=i[n];n++)t[o]=e[o];return t}function zt(t){return t?Mt.createSVGTransformFromMatrix(t):Mt.createSVGTransform()}var Bt=/([&<>]{1})/g,Pt=/([\n\r"]{1})/g,Ot={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function At(t,e){return t.replace(e,function(t,e){return Ot[e]||e})}function Tt(t,e){var n,o,i,r,a;switch(t.nodeType){case 3:e.push(At(t.textContent,Bt));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(n=0,o=(i=t.attributes).length;n<o;++n)r=i.item(n),e.push(" ",r.name,'="',At(r.value,Pt),'"');if(t.hasChildNodes()){for(e.push(">"),n=0,o=(a=t.childNodes).length;n<o;++n)Tt(a.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("\x3c!--",At(t.nodeValue,Bt),"--\x3e");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function Lt(t,e){var n=Ct(e);if(Et(t),e){"#document-fragment"!==n.nodeName&&(n=n.documentElement);for(var o,i=(o=n.childNodes,Array.prototype.slice.call(o)),r=0;r<i.length;r++)lt(i[r],t)}}function Dt(t,e){if(void 0===e)return function(t){for(var e=t.firstChild,n=[];e;)Tt(e,n),e=e.nextSibling;return n.join("")}(t);try{Lt(t,e)}catch(t){throw new Error("error parsing SVG: "+t.message)}return t}function It(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,o,i,r;for(t.clear(),n=0;o=e[n];n++)t.appendItem((i=t,(r=o)instanceof SVGMatrix?i.createSVGTransformFromMatrix(r):r))}(n,e)),n.consolidate()}function $t(t){return t.join(",").replace(/,?([A-z]),?/g,"$1")}function Nt(t){for(var e,n="",o=0;e=t[o];o++)n+=e.x+","+e.y+" ";return n}function Ht(t,e){var n=jt("polyline");return vt(n,{points:Nt(t)}),e&&vt(n,e),n}function Ft(t){return!0}function Gt(a,c,t){var i=t.cls("djs-hit",["no-fill","no-border"],{stroke:"white",strokeWidth:15});function r(t,e,n){var o,i,r;(o=e,(h[t]||st)(o))&&(n?r=c.getGraphics(n):(i=e.delegateTarget||e.target)&&(r=i,n=c.get(r)),r&&n&&!1===a.fire(t,{element:n,gfx:r,originalEvent:e})&&(e.stopPropagation(),e.preventDefault()))}var s={};function u(t){return s[t]}var l={mouseover:"element.hover",mouseout:"element.out",click:"element.click",dblclick:"element.dblclick",mousedown:"element.mousedown",mouseup:"element.mouseup",contextmenu:"element.contextmenu"},h={"element.contextmenu":Ft};var p="svg, .djs-element";function o(t,e,n,o){var i=s[n]=function(t){r(n,t)};o&&(h[n]=o),i.$delegate=U(t,p,e,i)}function d(t,e,n){var o=u(n);o&&Y(t,e,o.$delegate)}a.on("canvas.destroy",function(t){var n;n=t.svg,m(l,function(t,e){d(n,e,t)})}),a.on("canvas.init",function(t){var n;n=t.svg,m(l,function(t,e){o(n,e,t)})}),a.on(["shape.added","connection.added"],function(t){var e,n=t.element,o=t.gfx;n.waypoints?e=Ht(n.waypoints):vt(e=jt("rect"),{x:0,y:0,width:n.width,height:n.height}),vt(e,i),ht(o,e)}),a.on("shape.changed",500,function(t){var e=t.element;vt(et(".djs-hit",t.gfx),{width:e.width,height:e.height})}),a.on("connection.changed",function(t){var e,n,o=t.element,i=et(".djs-hit",t.gfx);e=i,n=o.waypoints,vt(e,{points:Nt(n)})}),this.fire=r,this.triggerMouseEvent=function(t,e,n){var o=l[t];if(!o)throw new Error("unmapped DOM event name <"+t+">");return r(o,e,n)},this.mouseHandler=u,this.registerEvent=o,this.unregisterEvent=d}Gt.$inject=["eventBus","elementRegistry","styles"];var Wt={__init__:["interactionEvents"],interactionEvents:["type",Gt]};function Vt(t,e,n){var o=!n||-1===t.indexOf(e);return o&&t.push(e),o}function qt(t,o,i){i=i||0,h(t)||(t=[t]),m(t,function(t,e){var n=o(t,e,i);h(n)&&n.length&&qt(n,o,i+1)})}function Ut(t,e){return i=!e,r=-1,a=[],c=[],qt(t,function(t,e,n){Vt(a,t,i);var o=t.children;if((-1===r||n<r)&&o&&Vt(c,o,i))return o}),a;var i,r,a,c}function Yt(t,a){var c,s,u,l;return a=!!a,h(t)||(t=[t]),m(t,function(t){var e=t;t.waypoints&&!a&&(e=Yt(t.waypoints,!0));var n=e.x,o=e.y,i=e.height||0,r=e.width||0;(n<c||void 0===c)&&(c=n),(o<s||void 0===s)&&(s=o),(u<n+r||void 0===u)&&(u=n+r),(l<o+i||void 0===l)&&(l=o+i)}),{x:c,y:s,height:l-s,width:u-c}}function Xt(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function Kt(t,e){return R({},t||{},e||{})}function Zt(t,e,n){this.offset=6;var o=e.cls("djs-outline",["no-fill"]),i=this;function r(t,e){var n=jt("rect");return vt(n,R({x:10,y:10,width:100,height:100},o)),ht(t,n),n}t.on(["shape.added","shape.changed"],500,function(t){var e=t.element,n=t.gfx,o=et(".djs-outline",n);o||(o=r(n)),i.updateShapeOutline(o,e)}),t.on(["connection.added","connection.changed"],function(t){var e=t.element,n=t.gfx,o=et(".djs-outline",n);o||(o=r(n)),i.updateConnectionOutline(o,e)})}Zt.prototype.updateShapeOutline=function(t,e){vt(t,{x:-this.offset,y:-this.offset,width:e.width+2*this.offset,height:e.height+2*this.offset})},Zt.prototype.updateConnectionOutline=function(t,e){var n=Yt(e);vt(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},Zt.$inject=["eventBus","styles","elementRegistry"];var Qt={__init__:["outline"],outline:["type",Zt]};function Jt(t){this._eventBus=t,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],function(t){var e=t.element;n.deselect(e)}),t.on(["diagram.clear"],function(t){n.select(null)})}Jt.$inject=["eventBus"],Jt.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(-1!==n){var o=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:e})}},Jt.prototype.get=function(){return this._selectedElements},Jt.prototype.isSelected=function(t){return-1!==this._selectedElements.indexOf(t)},Jt.prototype.select=function(t,e){var n=this._selectedElements,o=n.slice();h(t)||(t=t?[t]:[]),e?m(t,function(t){-1===n.indexOf(t)&&n.push(t)}):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:n})};var te="selected";function ee(t,n,e,o){function i(t,e){n.addMarker(t,e)}function r(t,e){n.removeMarker(t,e)}this._multiSelectionBox=null,t.on("element.hover",function(t){i(t.element,"hover")}),t.on("element.out",function(t){r(t.element,"hover")}),t.on("selection.changed",function(t){var e=t.oldSelection,n=t.newSelection;m(e,function(t){-1===n.indexOf(t)&&r(t,te)}),m(n,function(t){-1===e.indexOf(t)&&i(t,te)})})}function ne(t,r,a,o){t.on("create.end",500,function(t){t.context.canExecute&&r.select(t.context.shape)}),t.on("connect.end",500,function(t){t.context.canExecute&&t.context.target&&r.select(t.context.target)}),t.on("shape.move.end",500,function(t){var e=t.previousSelection||[],n=o.get(t.context.shape.id);v(e,function(t){return n.id===t.id})||r.select(n)}),t.on("element.click",function(t){var e=t.element;e===a.getRootElement()&&(e=null);var n=r.isSelected(e),o=1<r.get().length,i=ut(t);if(n&&o)return i?r.deselect(e):r.select(e);n?r.deselect(e):r.select(e,i)})}ee.$inject=["eventBus","canvas","selection","styles"],ne.$inject=["eventBus","selection","canvas","elementRegistry"];var oe={__init__:["selectionVisuals","selectionBehavior"],__depends__:[Wt,Qt],selection:["type",Jt],selectionVisuals:["type",ee],selectionBehavior:["type",ne]};function ie(t){this._commandStack=t.get("commandStack",!1)}ie.$inject=["injector"],ie.prototype.allowed=function(t,e){var n=!0,o=this._commandStack;return o&&(n=o.canExecute(t,e)),void 0===n||n};var re={__init__:["rules"],rules:["type",ie]},ae=/^djs-cursor-.*$/;function ce(t){var e=T(document.body);e.removeMatching(ae),t&&e.add("djs-cursor-"+t)}function se(){ce(null)}var ue=5e3;function le(t,e){function n(){return!1}return e=e||"element.click",t.once(e,ue,n),function(){t.off(e,n)}}function he(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function pe(t,e){return{x:t.x-e.x,y:t.y-e.y}}var de=Math.round,fe="djs-drag-active";function ve(t){t.preventDefault()}function ye(h,p,d){var f,v={threshold:5,trapClick:!0};function y(t){var e=p.viewbox(),n=p._container.getBoundingClientRect();return{x:e.x+(t.x-n.left)/e.scale,y:e.y+(t.y-n.top)/e.scale}}function g(t,e){e=e||f;var n=h.createEvent(R({},e.payload,e.data,{isTouch:e.isTouch}));return!1!==h.fire("drag."+t,n)&&h.fire(e.prefix+"."+t,n)}function m(t,e){var n,o=f.payload,i=f.displacement,r=f.globalStart,a=ct(t),c=pe(a,r),s=f.localStart,u=y(a),l=pe(u,s);if(!f.active&&(e||(n=c,Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))>f.threshold))){if(R(o,{x:de(s.x+i.x),y:de(s.y+i.y),dx:0,dy:0},{originalEvent:t}),!1===g("start"))return k();f.active=!0,f.keepSelection||(o.previousSelection=d.get(),d.select(null)),f.cursor&&ce(f.cursor),p.addMarker(p.getRootElement(),fe)}at(t),f.active&&(R(o,{x:de(u.x+i.x),y:de(u.y+i.y),dx:de(l.x),dy:de(l.y)},{originalEvent:t}),g("move"))}function x(t){var e=!0;f.active&&(t&&at(f.payload.originalEvent=t),e=g("end")),!1===e&&g("rejected"),g("ended",o(!0!==e))}function _(t){27===t.which&&(ve(t),k())}function w(t){var e;f.active&&(e=le(h),setTimeout(e,400),ve(t)),x(t)}function b(t){m(t)}function E(t){var e=f.payload;e.hoverGfx=t.gfx,e.hover=t.element,g("hover")}function S(t){g("out");var e=f.payload;e.hoverGfx=null,e.hover=null}function k(t){var e;if(f){var n=f.active;n&&g("cancel"),e=o(t),n&&g("canceled",e)}}function o(t){var e,n;g("cleanup"),se(),n=f.trapClick?w:x,V.unbind(document,"mousemove",m),V.unbind(document,"dragstart",ve),V.unbind(document,"selectstart",ve),V.unbind(document,"mousedown",n,!0),V.unbind(document,"mouseup",n,!0),V.unbind(document,"keyup",_),V.unbind(document,"touchstart",b,!0),V.unbind(document,"touchcancel",k,!0),V.unbind(document,"touchmove",m,!0),V.unbind(document,"touchend",x,!0),h.off("element.hover",E),h.off("element.out",S),p.removeMarker(p.getRootElement(),fe);var o=f.payload.previousSelection;return!1!==t&&o&&!d.get().length&&d.select(o),e=f,f=null,e}h.on("diagram.destroy",k),this.init=function(t,e,n,o){f&&k(!1),"string"==typeof e&&(o=n,n=e,e=null);var i,r,a,c,s,u,l=(o=R({},v,o||{})).data||{};c=o.trapClick?w:x,t?(i=rt(t)||t,r=ct(t),at(t),"dragstart"===i.type&&ve(i)):(i=null,r={x:0,y:0}),a=y(r),e||(e=a),u=i,s="undefined"!=typeof TouchEvent&&u instanceof TouchEvent,f=R({prefix:n,data:l,payload:{},globalStart:r,displacement:pe(e,a),localStart:a,isTouch:s},o),o.manual||(s?(V.bind(document,"touchstart",b,!0),V.bind(document,"touchcancel",k,!0),V.bind(document,"touchmove",m,!0),V.bind(document,"touchend",x,!0)):(V.bind(document,"mousemove",m),V.bind(document,"dragstart",ve),V.bind(document,"selectstart",ve),V.bind(document,"mousedown",c,!0),V.bind(document,"mouseup",c,!0)),V.bind(document,"keyup",_),h.on("element.hover",E),h.on("element.out",S)),g("init"),o.autoActivate&&m(t,!0)},this.move=m,this.hover=E,this.out=S,this.end=x,this.cancel=k,this.context=function(){return f},this.setOptions=function(t){R(v,t)}}function ge(e,a,c){var n=this;e.on("drag.start",function(t){e.once("drag.move",function(){e.once("drag.move",function(t){n.ensureHover(t)})})}),this.ensureHover=function(t){if(!t.hover){var e,n,o,i,r=t.originalEvent;if(r instanceof MouseEvent)e=ct(r),n=document.elementFromPoint(e.x,e.y),(i=H(n,"svg, .djs-element",!0))&&(o=c.get(i),a.hover({element:o,gfx:i}))}}}ye.$inject=["eventBus","canvas","selection"],ge.$inject=["eventBus","dragging","elementRegistry"];var me={__init__:["hoverFix"],__depends__:[oe],dragging:["type",ye],hoverFix:["type",ge]};function xe(t,e,n){this._elementRegistry=t,this._canvas=e,this._styles=n}xe.$inject=["elementRegistry","canvas","styles"],xe.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)},xe.prototype.addDragger=function(t,e){var n=this.getGfx(t),o=n.cloneNode(!0),i=n.getBoundingClientRect();return t.waypoints&&function e(t){t.children&&m(t.children,function(t){e(t)});t.style.markerStart="";t.style.markerEnd=""}(o),vt(o,this._styles.cls("djs-dragger",[],{x:i.top,y:i.left})),ht(e,o),o},xe.prototype.addFrame=function(t,e){var n=jt("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return ht(e,n),n};var _e={__init__:["previewSupport"],previewSupport:["type",xe]},we=Math.round;function be(t,r,a,c,i){function s(t,e,n,o){return i.allowed("elements.move",{shapes:t,delta:e,position:n,target:o})}function n(t,e,n){if(!e.waypoints&&e.parent){var o,i={x:(o=e).x+we(o.width/2),y:o.y+we(o.height/2)};return r.init(t,i,"shape.move",{cursor:"grabbing",autoActivate:n,data:{shape:e,context:{}}}),!0}}t.on("shape.move.start",1500,function(t){var e,n,o=t.context,i=t.shape,r=c.get().slice();-1===r.indexOf(i)&&(r=[i]),n=w(e=r,"id"),R(o,{shapes:r=y(e,function(t){for(;t=t.parent;)if(n[t.id])return!1;return!0}),validatedShapes:r,shape:i})}),t.on("shape.move.start",1250,function(t){var e=t.context,n=e.validatedShapes;if(!(e.canExecute=s(n)))return!1}),t.on("shape.move.move",500,function(t){var e,n=t.context,o=n.validatedShapes,i=t.hover,r={x:t.dx,y:t.dy};e=s(o,r,{x:t.x,y:t.y},i),n.delta=r,null!==(n.canExecute=e)?n.target=i:n.target=null}),t.on("shape.move.end",function(t){var e=t.context,n=e.delta,o=e.canExecute,i="attach"===o,r=e.shapes;if(!o)return!1;n.x=we(n.x),n.y=we(n.y),a.moveElements(r,n,e.target,{primaryShape:e.shape,attach:i})}),t.on("element.mousedown",function(t){var e=rt(t);if(!e)throw new Error("must supply DOM mousedown event");return n(e,t.element)}),this.start=n}function Ee(t,e,n){var o=zt();o.setTranslate(e,n),It(t,o)}be.$inject=["eventBus","dragging","modeling","selection","rules"];var Se="djs-dragging",ke="drop-ok",Ce="drop-not-ok",je="new-parent",Me="attach-ok";function Re(t,e,a,c,s){function u(t){var e,n=l(t);return y(e=n,function(t){return!t.waypoints||v(e,i({id:t.source.id}))&&v(e,i({id:t.target.id}))})}function l(t){var e=Ut(t,!0),n=x(e,function(t){return(t.incoming||[]).concat(t.outgoing||[])});return p(e.concat(n))}function h(e,n){[Me,ke,Ce,je].forEach(function(t){t===n?a.addMarker(e,t):a.removeMarker(e,t)})}t.on("shape.move.start",499,function(t){var e=t.context,n=e.shapes,o=e.allDraggedElements,i=u(n);if(!e.dragGroup){var r=jt("g");vt(r,c.cls("djs-drag-group",["no-events"])),ht(a.getDefaultLayer(),r),e.dragGroup=r}i.forEach(function(t){s.addDragger(t,e.dragGroup)}),m(o=o?p([o,l(n)]):l(n),function(t){a.addMarker(t,Se)}),e.allDraggedElements=o,e.differentParents=1!==_(w(n,function(t){return t.parent&&t.parent.id}))}),t.on("shape.move.move",499,function(t){var e=t.context,n=e.dragGroup,o=e.target,i=e.shape.parent,r=e.canExecute;o&&("attach"===r?h(o,Me):e.canExecute&&o&&o.id!==i.id?h(o,je):h(o,e.canExecute?ke:Ce)),Ee(n,t.dx,t.dy)}),t.on(["shape.move.out","shape.move.cleanup"],function(t){var e=t.context.target;e&&h(e,null)}),t.on("shape.move.cleanup",function(t){var e=t.context,n=e.allDraggedElements,o=e.dragGroup;m(n,function(t){a.removeMarker(t,Se)}),o&&Et(o)}),this.makeDraggable=function(t,e,n){s.addDragger(e,t.dragGroup),n&&a.addMarker(e,Se),t.allDraggedElements?t.allDraggedElements.push(e):t.allDraggedElements=[e]}}Re.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];var ze={__depends__:[Wt,oe,Qt,re,me,_e],__init__:["move","movePreview"],move:["type",be],movePreview:["type",Re]};function Be(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}Be.$inject=["eventBus","dragging"],Be.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error('A tool has to be registered with it\'s "events"');n.push(t),this.bindEvents(t,e)},Be.prototype.isActive=function(t){return t&&this._active===t},Be.prototype.length=function(t){return this._tools.length},Be.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))},Be.prototype.bindEvents=function(e,t){var n=this._eventBus,o=this._dragging,i=[];n.on(t.tool+".init",function(t){if(!t.context.reactivate&&this.isActive(e))return this.setActive(null),void o.cancel();this.setActive(e)},this),m(t,function(t){i.push(t+".ended"),i.push(t+".canceled")}),n.on(i,250,function(t){var e=t.originalEvent;this._active&&(e&&H(e.target,'.group[data-group="tools"]')||this.setActive(null))},this)};var Pe={__depends__:[me],__init__:["toolManager"],toolManager:["type",Be]},Oe="crosshair";function Ae(n,o,t,i,e,r){this._selection=e,this._dragging=t;var a=this,c=function(t){var e,n=o.getDefaultLayer();vt(e=t.frame=jt("rect"),{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),ht(n,e)},s=function(t){var e=t.frame,n=t.bbox;vt(e,{x:n.x,y:n.y,width:n.width,height:n.height})},u=function(t){t.frame&&bt(t.frame)};r.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),n.on("lasso.selection.end",function(t){var e=t.originalEvent.target;(t.hover||e instanceof SVGElement)&&n.once("lasso.selection.ended",function(){a.activateLasso(t.originalEvent,!0)})}),n.on("lasso.end",function(t){var e=Te(t),n=i.filter(function(t){return t});a.select(n,e)}),n.on("lasso.start",function(t){var e=t.context;e.bbox=Te(t),c(e)}),n.on("lasso.move",function(t){var e=t.context;e.bbox=Te(t),s(e)}),n.on("lasso.cleanup",function(t){var e=t.context;u(e)}),n.on("element.mousedown",1500,function(t){if(n=rt(e=t)||e,st(e)&&n.shiftKey)return a.activateLasso(t.originalEvent),!0;var e,n})}function Te(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y};return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:n.x<=e.x&&e.y<n.y||n.x<e.x&&e.y<=n.y?{x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&n.y<e.y||e.x<n.x&&n.y<=e.y?{x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:n.x<=e.x&&n.y<e.y||n.x<e.x&&n.y<=e.y?{x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:{x:n.x,y:n.y,width:0,height:0}}Ae.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager"],Ae.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:Oe,data:{context:{}}})},Ae.prototype.activateSelection=function(t){this._dragging.init(t,"lasso.selection",{trapClick:!1,cursor:Oe,data:{context:{}}})},Ae.prototype.select=function(t,e){var n,o,i=(n=e,o={},m(t,function(t){var e=t;e.waypoints&&(e=Yt(e)),!d(n.y)&&e.x>n.x&&(o[t.id]=t),!d(n.x)&&e.y>n.y&&(o[t.id]=t),e.x>n.x&&e.y>n.y&&(d(n.width)&&d(n.height)&&e.width+e.x<n.width+n.x&&e.height+e.y<n.height+n.y?o[t.id]=t:d(n.width)&&d(n.height)||(o[t.id]=t))}),o);this._selection.select(x(i,function(t){return t}))},Ae.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateSelection()},Ae.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};var Le={__depends__:[Pe],__init__:["lassoTool"],lassoTool:["type",Ae]},De=".djs-palette-toggle";function Ie(t,e){this._eventBus=t,this._canvas=e,this._providers=[];var n=this;t.on("tool-manager.update",function(t){var e=t.tool;n.updateToolHighlight(e)}),t.on("i18n.changed",function(){n._update()}),t.on("diagram.init",function(){n._diagramInitialized=!0,n._providers.length&&(n._init(),n._update())})}Ie.$inject=["eventBus","canvas"],Ie.prototype.registerProvider=function(t){this._providers.push(t),this._diagramInitialized&&(this._container||this._init(),this._update())},Ie.prototype.getEntries=function(){var n={};return m(this._providers,function(t){m(t.getPaletteEntries(),function(t,e){n[e]=t})}),n},Ie.prototype._init=function(){var t=this._canvas,e=this._eventBus,n=t.getContainer(),o=this._container=X(Ie.HTML_MARKUP),i=this;n.appendChild(o),U(o,".djs-palette-toggle, .entry","click",function(t){var e=t.delegateTarget;if(tt(e,De))return i.toggle();i.trigger("click",t)}),V.bind(o,"mousedown",function(t){t.stopPropagation()}),U(o,".entry","dragstart",function(t){i.trigger("dragstart",t)}),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:o})},Ie.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),o=this._container,i=this._eventBus,r=T(o);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),r.toggle("two-column",e),"open"in t&&r.toggle("open",t.open),i.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},Ie.prototype._update=function(){var u=et(".djs-palette-entries",this._container),t=this._entries=this.getEntries();D(u),m(t,function(t,e){var n=t.group||"default",o=et("[data-group="+n+"]",u);o||(o=X('<div class="group" data-group="'+n+'"></div>'),u.appendChild(o));var i,r,a,c=t.html||(t.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),s=X(c);o.appendChild(s),t.separator||(B(s,"data-action",e),t.title&&B(s,"title",t.title),t.className&&(i=s,r=t.className,a=T(i),(h(r)?r:r.split(/\s+/g)).forEach(function(t){a.add(t)})),t.imageUrl&&s.appendChild(X('<img src="'+t.imageUrl+'">')))}),this.open()},Ie.prototype.trigger=function(t,e,n){var o,i,r,a=this._entries,c=e.delegateTarget||e.target;if(!c)return e.preventDefault();(o=a[B(c,"data-action")])&&(i=o.action,r=e.originalEvent||e,f(i)?"click"===t&&i(r,n):i[t]&&i[t](r,n),e.preventDefault())},Ie.prototype._layoutChanged=function(){this._toggleState({})},Ie.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},Ie.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},Ie.prototype.open=function(){this._toggleState({open:!0})},Ie.prototype.toggle=function(t){this.isOpen()?this.close():this.open()},Ie.prototype.isActiveTool=function(t){return t&&this._activeTool===t},Ie.prototype.updateToolHighlight=function(o){var t;this._toolsContainer||(t=et(".djs-palette-entries",this._container),this._toolsContainer=et("[data-group=tools]",t)),m(this._toolsContainer.children,function(t){var e=t.getAttribute("data-action");if(e){var n=T(t);e=e.replace("-tool",""),n.contains("entry")&&e===o?n.add("highlighted-entry"):n.remove("highlighted-entry")}})},Ie.prototype.isOpen=function(){return T(this._container).has("open")},Ie.prototype._getParentContainer=function(){return this._canvas.getContainer()},Ie.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';var $e={__init__:["palette"],palette:["type",Ie]},Ne="drop-ok",He="drop-not-ok",Fe="attach-ok",Ge="new-parent";function We(t,o,s,u,r,a,c){function l(e,n){[Fe,Ne,He,Ge].forEach(function(t){t===n?r.addMarker(e,t):r.removeMarker(e,t)})}t.on("create.move",function(t){var e,n=t.context,o=t.hover,i=n.shape,r=n.source,a={x:t.x,y:t.y};e=n.canExecute=o&&function(t,e,n,o){if(!e)return!1;var i,r,a,c={source:n,shape:t,target:e,position:o};return(r=s.allowed("shape.attach",c))||(i=s.allowed("shape.create",c)),(i||r)&&(a=n&&s.allowed("connection.create",{source:n,target:t,hints:{targetParent:e,targetAttach:r}})),!(!i&&!r)&&{attach:r,connect:a}}(i,o,r,a),o&&null!==e&&(n.target=o,e&&e.attach?l(o,Fe):l(o,e?Ge:He))}),t.on("create.move",750,function(t){var e=t.context,n=e.shape,o=e.visual;o||(o=e.visual=function(t){var e,n,o;vt(e=jt("g"),a.cls("djs-drag-group",["no-events"])),ht(r.getDefaultLayer(),e),_t(n=jt("g")).add("djs-dragger"),ht(e,n),Ee(n,t.width/-2,t.height/-2);var i=jt("g");return _t(i).add("djs-visual"),ht(n,i),o=i,c.drawShape(o,t),e}(n)),Ee(o,t.x,t.y)}),t.on(["create.end","create.out","create.cleanup"],function(t){var e=t.context.target;e&&l(e,null)}),t.on("create.end",function(t){var e=t.context,n=e.source,o=e.shape,i=e.target,r=e.canExecute,a=r&&r.attach,c=r&&r.connect,s={x:t.x,y:t.y};if(!r)return!1;o=c?u.appendShape(n,o,s,i,{attach:a,connection:!0===c?{}:c}):u.createShape(o,s,i,{attach:a}),e.shape=o}),t.on("create.cleanup",function(t){var e=t.context;e.visual&&bt(e.visual)}),this.start=function(t,e,n){o.init(t,"create",{cursor:"grabbing",autoActivate:!0,data:{shape:e,context:{shape:e,source:n}}})}}We.$inject=["eventBus","dragging","rules","modeling","canvas","styles","graphicsFactory"];var Ve={__depends__:[me,oe,re],create:["type",We]};function qe(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}qe.prototype.next=function(){return this._prefix+ ++this._counter};var Ue=new qe("ov");function Ye(t,e,n,o){var i,r;this._eventBus=e,this._canvas=n,this._elementRegistry=o,this._ids=Ue,this._overlayDefaults=R({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(i=n.getContainer(),r=X('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />'),i.insertBefore(r,i.firstChild),r),this._init()}function Xe(t,e,n){R(t.style,{left:e+"px",top:n+"px"})}function Ke(t,e){t.style.display=!1===e?"none":""}function Ze(e,n){e.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach(function(t){e.style[t+"transform"]=n})}Ye.$inject=["config.overlays","eventBus","canvas","elementRegistry"],Ye.prototype.get=function(t){if(c(t)&&(t={id:t}),c(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?y(e.overlays,i({type:t.type})):e.overlays.slice():[]}return t.type?y(this._overlays,i({type:t.type})):t.id?this._overlays[t.id]:null},Ye.prototype.add=function(t,e,n){if(l(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var o=this._ids.next();return n=R({},this._overlayDefaults,n,{id:o,type:e,element:t,html:n.html}),this._addOverlay(n),o},Ye.prototype.remove=function(t){var e=this.get(t)||[];h(e)||(e=[e]);var o=this;m(e,function(t){var e=o._getOverlayContainer(t.element,!0);if(t&&(ot(t.html),ot(t.htmlContainer),delete t.htmlContainer,delete t.element,delete o._overlays[t.id]),e){var n=e.overlays.indexOf(t);-1!==n&&e.overlays.splice(n,1)}})},Ye.prototype.show=function(){Ke(this._overlayRoot)},Ye.prototype.hide=function(){Ke(this._overlayRoot,!1)},Ye.prototype.clear=function(){this._overlays={},this._overlayContainers=[],D(this._overlayRoot)},Ye.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,o=e.x,i=e.y;if(e.waypoints){var r=Yt(e);o=r.x,i=r.y}Xe(n,o,i),B(t.html,"data-container-id",e.id)},Ye.prototype._updateOverlay=function(t){var e,n,o=t.position,i=t.htmlContainer,r=t.element,a=o.left,c=o.top;void 0!==o.right&&(e=r.waypoints?Yt(r).width:r.width,a=-1*o.right+e);void 0!==o.bottom&&(n=r.waypoints?Yt(r).height:r.height,c=-1*o.bottom+n);Xe(i,a||0,c||0)},Ye.prototype._createOverlayContainer=function(t){var e=X('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},Ye.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";Ze(this._overlayRoot,n)},Ye.prototype._getOverlayContainer=function(e,t){var n=v(this._overlayContainers,function(t){return t.element===e});return n||t?n:this._createOverlayContainer(e)},Ye.prototype._addOverlay=function(t){var e,n,o=t.id,i=t.element,r=t.html;r.get&&r.constructor.prototype.jquery&&(r=r.get(0)),c(r)&&(r=X(r)),n=this._getOverlayContainer(i),(e=X('<div class="djs-overlay" data-overlay-id="'+o+'" style="position: absolute">')).appendChild(r),t.type&&T(e).add("djs-overlay-"+t.type),t.htmlContainer=e,n.overlays.push(t),n.html.appendChild(e),this._overlays[o]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())},Ye.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,o=n&&n.minZoom,i=n&&n.maxZoom,r=t.htmlContainer,a=!0;n&&((s(o)&&o>e.scale||s(i)&&i<e.scale)&&(a=!1),Ke(r,a)),this._updateOverlayScale(t,e)},Ye.prototype._updateOverlayScale=function(t,e){var n,o,i,r=t.scale,a=t.htmlContainer,c="";!0!==r&&(o=!1===r?n=1:(n=r.min,r.max),s(n)&&e.scale<n&&(i=(1/e.scale||1)*n),s(o)&&e.scale>o&&(i=(1/e.scale||1)*o)),s(i)&&(c="scale("+i+","+i+")"),Ze(a,c)},Ye.prototype._updateOverlaysVisibilty=function(e){var n=this;m(this._overlays,function(t){n._updateOverlayVisibilty(t,e)})},Ye.prototype._init=function(){var t=this._eventBus,i=this;t.on("canvas.viewbox.changing",function(t){i.hide()}),t.on("canvas.viewbox.changed",function(t){var e;e=t.viewbox,i._updateRoot(e),i._updateOverlaysVisibilty(e),i.show()}),t.on(["shape.remove","connection.remove"],function(t){var e=t.element;m(i.get({element:e}),function(t){i.remove(t.id)});var n=i._getOverlayContainer(e);if(n){ot(n.html);var o=i._overlayContainers.indexOf(n);-1!==o&&i._overlayContainers.splice(o,1)}}),t.on("element.changed",500,function(t){var e=t.element,n=i._getOverlayContainer(e,!0);n&&(m(n.overlays,function(t){i._updateOverlay(t)}),i._updateOverlayContainer(n))}),t.on("element.marker.update",function(t){var e=i._getOverlayContainer(t.element,!0);e&&T(e.html)[t.add?"add":"remove"](t.marker)}),t.on("diagram.clear",this.clear,this)};var Qe={__init__:["overlays"],overlays:["type",Ye]};function Je(t,e,n){this._providers=[],this._eventBus=e,this._overlays=n;var o=s(t&&t.scale)?t.scale:{min:1,max:1.5};this._overlaysConfig={position:{right:-9,top:-6},scale:o},this._current=null,this._init()}Je.$inject=["config.contextPad","eventBus","overlays"],Je.prototype._init=function(){var t=this._eventBus,o=this;t.on("selection.changed",function(t){var e=t.newSelection;1===e.length?o.open(e[0]):o.close()}),t.on("elements.delete",function(t){m(t.elements,function(t){o.isOpen(t)&&o.close()})}),t.on("element.changed",function(t){var e=t.element,n=o._current;n&&n.element===e&&o.open(e,!0)})},Je.prototype.registerProvider=function(t){this._providers.push(t)},Je.prototype.getEntries=function(e){var n={};return m(this._providers,function(t){m(t.getContextPadEntries(e),function(t,e){n[e]=t})}),n},Je.prototype.trigger=function(t,e,n){var o,i,r=this._current.element,a=this._current.entries,c=e.delegateTarget||e.target;if(!c)return e.preventDefault();if(o=a[B(c,"data-action")].action,i=e.originalEvent||e,f(o)){if("click"===t)return o(i,r,n)}else if(o[t])return o[t](i,r,n);e.preventDefault()},Je.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))},Je.prototype._updateAndOpen=function(t){var e=this.getEntries(t),n=this.getPad(t),s=n.html;m(e,function(t,e){var n,o,i,r,a=t.group||"default",c=X(t.html||'<div class="entry" draggable="true"></div>');B(c,"data-action",e),(n=et("[data-group="+a+"]",s))||(n=X('<div class="group" data-group="'+a+'"></div>'),s.appendChild(n)),n.appendChild(c),t.className&&(o=c,i=t.className,r=T(o),(h(i)?i:i.split(/\s+/g)).forEach(function(t){r.add(t)})),t.title&&B(c,"title",t.title),t.imageUrl&&c.appendChild(X('<img src="'+t.imageUrl+'">'))}),T(s).add("open"),this._current={element:t,pad:n,entries:e},this._eventBus.fire("contextPad.open",{current:this._current})},Je.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,o=X('<div class="djs-context-pad"></div>'),i=R({html:o},this._overlaysConfig);U(o,".entry","click",function(t){e.trigger("click",t)}),U(o,".entry","dragstart",function(t){e.trigger("dragstart",t)}),V.bind(o,"mousedown",function(t){t.stopPropagation()}),this._overlayId=n.add(t,"context-pad",i);var r=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{element:t,pad:r}),r},Je.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},Je.prototype.isOpen=function(t){return!(!this._current||t&&this._current.element!==t)};var tn={__depends__:[Wt,Qe],contextPad:["type",Je]};function en(t,e){return t&&e?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):-1}function nn(t,e,n,o){if(void 0===o&&(o=5),!t||!e||!n)return!1;var i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),r=en(t,e);return Math.abs(i/r)<=o}var on=2;function rn(t,e){return Math.abs(t.x-e.x)<=on?"h":Math.abs(t.y-e.y)<=on&&"v"}function an(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function cn(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}var sn="djs-bendpoint",un="djs-segment-dragger";function ln(t,e){var n=jt("g");_t(n).add(sn),ht(t,n);var o=jt("circle");vt(o,{cx:0,cy:0,r:4}),_t(o).add("djs-visual"),ht(n,o);var i=jt("circle");return vt(i,{cx:0,cy:0,r:10}),_t(i).add("djs-hit"),ht(n,i),e&&_t(n).add(e),n}function hn(t,e,n){var o=jt("g");ht(t,o);var i=jt("rect");vt(i,{x:-7,y:-1.5,width:14,height:3}),_t(i).add("djs-visual"),ht(o,i);var r,a,c,s=jt("rect");return vt(s,{x:-10,y:-4.5,width:20,height:9}),_t(s).add("djs-hit"),ht(o,s),r=o,a="h"===n?90:0,(c=zt()).setRotate(a,0,0),It(r,c),o}function pn(t,e,n){var o=jt("g"),i=cn(e,n),r=rn(e,n);return ht(t,o),hn(o,0,r),_t(o).add(un),_t(o).add("h"===r?"vertical":"horizontal"),Ee(o,i.x,i.y),o}var dn="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function fn(t,e){return t(e={exports:{}},e.exports),e.exports}var vn=fn(function(t,e){var n;n=dn,t.exports=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,n=String(t),o=n.length,i=-1,r="",a=n.charCodeAt(0);++i<o;)0!=(e=n.charCodeAt(i))?r+=1<=e&&e<=31||127==e||0==i&&48<=e&&e<=57||1==i&&48<=e&&e<=57&&45==a?"\\"+e.toString(16)+" ":0==i&&1==o&&45==e||!(128<=e||45==e||95==e||48<=e&&e<=57||65<=e&&e<=90||97<=e&&e<=122)?"\\"+n.charAt(i):n.charAt(i):r+="ï¿½";return r};return t.CSS||(t.CSS={}),t.CSS.escape=e}(n)}),yn="hasOwnProperty",gn=/,?([a-z]),?/gi,mn=parseFloat,xn=Math,_n=xn.PI,wn=xn.min,bn=xn.max,En=xn.pow,Sn=xn.abs,kn=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,Cn=/(-?\d*\.?\d*(?:e[-+]?\\d+)?)[\s]*,?[\s]*/gi;
/**
   * This file contains portions that got extraced from Snap.svg (licensed Apache-2.0).
   *
   * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js
   */function jn(t,e){return"finite"==(e=String.prototype.toLowerCase.call(e))?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||("null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||Object.prototype.toString.call(t).slice(8,-1).toLowerCase()==e)}function Mn(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)t[yn](n)&&(e[n]=Mn(t[n]));return e}function Rn(e){var n=Rn.ps=Rn.ps||{};return n[e]?n[e].sleep=100:n[e]={sleep:100},setTimeout(function(){for(var t in n)n[yn](t)&&t!=e&&(n[t].sleep--,!n[t].sleep&&delete n[t])}),n[e]}function zn(t,e,n,o){return null==t&&(t=e=n=o=0),null==e&&(e=t.y,n=t.width,o=t.height,t=t.x),{x:t,y:e,width:n,w:n,height:o,h:o,x2:t+n,y2:e+o,cx:t+n/2,cy:e+o/2,r1:xn.min(n,o)/2,r2:xn.max(n,o)/2,r0:xn.sqrt(n*n+o*o)/2,path:function(t,e,n,o,i){if(i)return[["M",+t+ +i,e],["l",n-2*i,0],["a",i,i,0,0,1,i,i],["l",0,o-2*i],["a",i,i,0,0,1,-i,i],["l",2*i-n,0],["a",i,i,0,0,1,-i,-i],["l",0,2*i-o],["a",i,i,0,0,1,i,-i],["z"]];var r=[["M",t,e],["l",n,0],["l",0,o],["l",-n,0],["z"]];return r.toString=Bn,r}(t,e,n,o),vb:[t,e,n,o].join(" ")}}function Bn(){return this.join(",").replace(gn,"$1")}function Pn(t){var e=Mn(t);return e.toString=Bn,e}function On(t,e,n,o,i,r,a,c,s){var u=1-s,l=En(u,3),h=En(u,2),p=s*s,d=p*s,f=t+2*s*(n-t)+p*(i-2*n+t),v=e+2*s*(o-e)+p*(r-2*o+e),y=n+2*s*(i-n)+p*(a-2*i+n),g=o+2*s*(r-o)+p*(c-2*r+o);return{x:l*t+3*h*s*n+3*u*s*s*i+d*a,y:l*e+3*h*s*o+3*u*s*s*r+d*c,m:{x:f,y:v},n:{x:y,y:g},start:{x:u*t+s*n,y:u*e+s*o},end:{x:u*i+s*a,y:u*r+s*c},alpha:90-180*xn.atan2(f-y,v-g)/_n}}function An(t,e,n,o,i,r,a,c){jn(t,"array")||(t=[t,e,n,o,i,r,a,c]);var s=function(t,e,n,o,i,r,a,c){for(var s,u,l,h,p,d,f,v,y=[],g=[[],[]],m=0;m<2;++m)if(l=0==m?(u=6*t-12*n+6*i,s=-3*t+9*n-9*i+3*a,3*n-3*t):(u=6*e-12*o+6*r,s=-3*e+9*o-9*r+3*c,3*o-3*e),Sn(s)<1e-12){if(Sn(u)<1e-12)continue;0<(h=-l/u)&&h<1&&y.push(h)}else f=u*u-4*l*s,v=xn.sqrt(f),f<0||(0<(p=(-u+v)/(2*s))&&p<1&&y.push(p),0<(d=(-u-v)/(2*s))&&d<1&&y.push(d));var x,_=y.length,w=_;for(;_--;)h=y[_],x=1-h,g[0][_]=x*x*x*t+3*x*x*h*n+3*x*h*h*i+h*h*h*a,g[1][_]=x*x*x*e+3*x*x*h*o+3*x*h*h*r+h*h*h*c;return g[0][w]=t,g[1][w]=e,g[0][w+1]=a,g[1][w+1]=c,g[0].length=g[1].length=w+2,{min:{x:wn.apply(0,g[0]),y:wn.apply(0,g[1])},max:{x:bn.apply(0,g[0]),y:bn.apply(0,g[1])}}}.apply(null,t);return zn(s.min.x,s.min.y,s.max.x-s.min.x,s.max.y-s.min.y)}function Tn(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function Ln(t,e,n,o,i){return t*(t*(-3*e+9*n-9*o+3*i)+6*e-12*n+6*o)-3*e+3*n}function Dn(t,e,n,o,i,r,a,c,s){null==s&&(s=1);for(var u=(s=1<s?1:s<0?0:s)/2,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0,d=0;d<12;d++){var f=u*l[d]+u,v=Ln(f,t,n,i,a),y=Ln(f,e,o,r,c),g=v*v+y*y;p+=h[d]*xn.sqrt(g)}return u*p}function In(t,e,n,o,i,r,a,c){if(!(bn(t,n)<wn(i,a)||wn(t,n)>bn(i,a)||bn(e,o)<wn(r,c)||wn(e,o)>bn(r,c))){var s=(t-n)*(r-c)-(e-o)*(i-a);if(s){var u=((t*o-e*n)*(i-a)-(t-n)*(i*c-r*a))/s,l=((t*o-e*n)*(r-c)-(e-o)*(i*c-r*a))/s,h=+u.toFixed(2),p=+l.toFixed(2);if(!(h<+wn(t,n).toFixed(2)||h>+bn(t,n).toFixed(2)||h<+wn(i,a).toFixed(2)||h>+bn(i,a).toFixed(2)||p<+wn(e,o).toFixed(2)||p>+bn(e,o).toFixed(2)||p<+wn(r,c).toFixed(2)||p>+bn(r,c).toFixed(2)))return{x:u,y:l}}}}function $n(t,e,n){var o,i,r=An(t),a=An(e);if(i=a,o=zn(o=r),!(Tn(i=zn(i),o.x,o.y)||Tn(i,o.x2,o.y)||Tn(i,o.x,o.y2)||Tn(i,o.x2,o.y2)||Tn(o,i.x,i.y)||Tn(o,i.x2,i.y)||Tn(o,i.x,i.y2)||Tn(o,i.x2,i.y2)||(o.x<i.x2&&o.x>i.x||i.x<o.x2&&i.x>o.x)&&(o.y<i.y2&&o.y>i.y||i.y<o.y2&&i.y>o.y)))return n?0:[];for(var c=~~(Dn.apply(0,t)/5),s=~~(Dn.apply(0,e)/5),u=[],l=[],h={},p=n?0:[],d=0;d<c+1;d++){var f=On.apply(0,t.concat(d/c));u.push({x:f.x,y:f.y,t:d/c})}for(d=0;d<s+1;d++)f=On.apply(0,e.concat(d/s)),l.push({x:f.x,y:f.y,t:d/s});for(d=0;d<c;d++)for(var v=0;v<s;v++){var y=u[d],g=u[d+1],m=l[v],x=l[v+1],_=Sn(g.x-y.x)<.01?"y":"x",w=Sn(x.x-m.x)<.01?"y":"x",b=In(y.x,y.y,g.x,g.y,m.x,m.y,x.x,x.y);if(b){if(h[b.x.toFixed(0)]==b.y.toFixed(0))continue;h[b.x.toFixed(0)]=b.y.toFixed(0);var E=y.t+Sn((b[_]-y[_])/(g[_]-y[_]))*(g.t-y.t),S=m.t+Sn((b[w]-m[w])/(x[w]-m[w]))*(x.t-m.t);0<=E&&E<=1&&0<=S&&S<=1&&(n?p++:p.push({x:b.x,y:b.y,t1:E,t2:S}))}}return p}function Nn(t,e,n,o,i){if(null==i&&null==o&&(o=n),t=+t,e=+e,n=+n,o=+o,null!=i)var r=Math.PI/180,a=t+n*Math.cos(-o*r),c=t+n*Math.cos(-i*r),s=[["M",a,e+n*Math.sin(-o*r)],["A",n,n,0,+(180<i-o),0,c,e+n*Math.sin(-i*r)]];else s=[["M",t,e],["m",0,-o],["a",n,o,0,1,1,0,2*o],["a",n,o,0,1,1,0,-2*o],["z"]];return s.toString=Bn,s}function Hn(t){var e=Rn(t);if(e.abs)return Pn(e.abs);if(jn(t,"array")&&jn(t&&t[0],"array")||(t=function(t){if(!t)return null;var e=Rn(t);if(e.arr)return Mn(e.arr);var r={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},a=[];return jn(t,"array")&&jn(t[0],"array")&&(a=Mn(t)),a.length||String(t).replace(kn,function(t,e,n){var o=[],i=e.toLowerCase();if(n.replace(Cn,function(t,e){e&&o.push(+e)}),"m"==i&&2<o.length&&(a.push([e].concat(o.splice(0,2))),i="l",e="m"==e?"l":"L"),"o"==i&&1==o.length&&a.push([e,o[0]]),"r"==i)a.push([e].concat(o));else for(;o.length>=r[i]&&(a.push([e].concat(o.splice(0,r[i]))),r[i]););}),a.toString=Rn.toString,e.arr=Mn(a),a}(t)),!t||!t.length)return[["M",0,0]];var n,o=[],i=0,r=0,a=0,c=0,s=0;"M"==t[0][0]&&(a=i=+t[0][1],c=r=+t[0][2],s++,o[0]=["M",i,r]);for(var u,l,h=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),p=s,d=t.length;p<d;p++){if(o.push(u=[]),(n=(l=t[p])[0])!=n.toUpperCase())switch(u[0]=n.toUpperCase(),u[0]){case"A":u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=+l[6]+i,u[7]=+l[7]+r;break;case"V":u[1]=+l[1]+r;break;case"H":u[1]=+l[1]+i;break;case"R":for(var f=[i,r].concat(l.slice(1)),v=2,y=f.length;v<y;v++)f[v]=+f[v]+i,f[++v]=+f[v]+r;o.pop(),o=o.concat(Vn(f,h));break;case"O":o.pop(),(f=Nn(i,r,l[1],l[2])).push(f[0]),o=o.concat(f);break;case"U":o.pop(),o=o.concat(Nn(i,r,l[1],l[2],l[3])),u=["U"].concat(o[o.length-1].slice(-2));break;case"M":a=+l[1]+i,c=+l[2]+r;default:for(v=1,y=l.length;v<y;v++)u[v]=+l[v]+(v%2?i:r)}else if("R"==n)f=[i,r].concat(l.slice(1)),o.pop(),o=o.concat(Vn(f,h)),u=["R"].concat(l.slice(-2));else if("O"==n)o.pop(),(f=Nn(i,r,l[1],l[2])).push(f[0]),o=o.concat(f);else if("U"==n)o.pop(),o=o.concat(Nn(i,r,l[1],l[2],l[3])),u=["U"].concat(o[o.length-1].slice(-2));else for(var g=0,m=l.length;g<m;g++)u[g]=l[g];if("O"!=(n=n.toUpperCase()))switch(u[0]){case"Z":i=+a,r=+c;break;case"H":i=u[1];break;case"V":r=u[1];break;case"M":a=u[u.length-2],c=u[u.length-1];default:i=u[u.length-2],r=u[u.length-1]}}return o.toString=Bn,e.abs=Pn(o),o}function Fn(t,e,n,o){return[t,e,n,o,n,o]}function Gn(t,e,n,o,i,r){return[1/3*t+2/3*n,1/3*e+2/3*o,1/3*i+2/3*n,1/3*r+2/3*o,i,r]}function Wn(t,e,n,o,i,r,a,c,s,u){var l,h,p,d,f=120*_n/180,v=_n/180*(+i||0),y=[],g=(h=function(t,e,n){return{x:t*xn.cos(n)-e*xn.sin(n),y:t*xn.sin(n)+e*xn.cos(n)}},function t(){var e=Array.prototype.slice.call(arguments,0),n=e.join("â"),o=t.cache=t.cache||{},i=t.count=t.count||[];return o[yn](n)?function(t,e){for(var n=0,o=t.length;n<o;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}(i,n):(1e3<=i.length&&delete o[i.shift()],i.push(n),o[n]=h.apply(p,e)),d?d(o[n]):o[n]});if(u)C=u[0],j=u[1],S=u[2],k=u[3];else{t=(l=g(t,e,-v)).x,e=l.y;var m=(t-(c=(l=g(c,s,-v)).x))/2,x=(e-(s=l.y))/2,_=m*m/(n*n)+x*x/(o*o);1<_&&(n*=_=xn.sqrt(_),o*=_);var w=n*n,b=o*o,E=(r==a?-1:1)*xn.sqrt(Sn((w*b-w*x*x-b*m*m)/(w*x*x+b*m*m))),S=E*n*x/o+(t+c)/2,k=E*-o*m/n+(e+s)/2,C=xn.asin(((e-k)/o).toFixed(9)),j=xn.asin(((s-k)/o).toFixed(9));(C=t<S?_n-C:C)<0&&(C=2*_n+C),(j=c<S?_n-j:j)<0&&(j=2*_n+j),a&&j<C&&(C-=2*_n),!a&&C<j&&(j-=2*_n)}var M=j-C;if(Sn(M)>f){var R=j,z=c,B=s;j=C+f*(a&&C<j?1:-1),y=Wn(c=S+n*xn.cos(j),s=k+o*xn.sin(j),n,o,i,0,a,z,B,[j,R,S,k])}M=j-C;var P=xn.cos(C),O=xn.sin(C),A=xn.cos(j),T=xn.sin(j),L=xn.tan(M/4),D=4/3*n*L,I=4/3*o*L,$=[t,e],N=[t+D*O,e-I*P],H=[c+D*T,s-I*A],F=[c,s];if(N[0]=2*$[0]-N[0],N[1]=2*$[1]-N[1],u)return[N,H,F].concat(y);for(var G=[],W=0,V=(y=[N,H,F].concat(y).join().split(",")).length;W<V;W++)G[W]=W%2?g(y[W-1],y[W],v).y:g(y[W],y[W+1],v).x;return G}function Vn(t,e){for(var n=[],o=0,i=t.length;o<i-2*!e;o+=2){var r=[{x:+t[o-2],y:+t[o-1]},{x:+t[o],y:+t[o+1]},{x:+t[o+2],y:+t[o+3]},{x:+t[o+4],y:+t[o+5]}];e?o?i-4==o?r[3]={x:+t[0],y:+t[1]}:i-2==o&&(r[2]={x:+t[0],y:+t[1]},r[3]={x:+t[2],y:+t[3]}):r[0]={x:+t[i-2],y:+t[i-1]}:i-4==o?r[3]=r[2]:o||(r[0]={x:+t[o],y:+t[o+1]}),n.push(["C",(-r[0].x+6*r[1].x+r[2].x)/6,(-r[0].y+6*r[1].y+r[2].y)/6,(r[1].x+6*r[2].x-r[3].x)/6,(r[1].y+6*r[2].y-r[3].y)/6,r[2].x,r[2].y])}return n}function qn(t,e){var n=!e&&Rn(t);if(!e&&n.curve)return Pn(n.curve);for(var r=Hn(t),a=e&&Hn(e),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},c=function(t,e,n){var o,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(Wn.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":i="C"==n||"S"==n?(o=2*e.x-e.bx,2*e.y-e.by):(o=e.x,e.y),t=["C",o,i].concat(t.slice(1));break;case"T":e.qy="Q"==n||"T"==n?(e.qx=2*e.x-e.qx,2*e.y-e.qy):(e.qx=e.x,e.y),t=["C"].concat(Gn(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(Gn(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(Fn(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(Fn(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(Fn(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(Fn(e.x,e.y,e.X,e.Y))}return t},s=function(t,e){if(7<t[e].length){t[e].shift();for(var n=t[e];n.length;)l[e]="A",a&&(h[e]="A"),t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),v=bn(r.length,a&&a.length||0)}},u=function(t,e,n,o,i){t&&e&&"M"==t[i][0]&&"M"!=e[i][0]&&(e.splice(i,0,["M",o.x,o.y]),n.bx=0,n.by=0,n.x=t[i][1],n.y=t[i][2],v=bn(r.length,a&&a.length||0))},l=[],h=[],p="",d="",f=0,v=bn(r.length,a&&a.length||0);f<v;f++){r[f]&&(p=r[f][0]),"C"!=p&&(l[f]=p,f&&(d=l[f-1])),r[f]=c(r[f],o,d),"A"!=l[f]&&"C"==p&&(l[f]="C"),s(r,f),a&&(a[f]&&(p=a[f][0]),"C"!=p&&(h[f]=p,f&&(d=h[f-1])),a[f]=c(a[f],i,d),"A"!=h[f]&&"C"==p&&(h[f]="C"),s(a,f)),u(r,a,o,i,f),u(a,r,i,o,f);var y=r[f],g=a&&a[f],m=y.length,x=a&&g.length;o.x=y[m-2],o.y=y[m-1],o.bx=mn(y[m-4])||o.x,o.by=mn(y[m-3])||o.y,i.bx=a&&(mn(g[x-4])||i.x),i.by=a&&(mn(g[x-3])||i.y),i.x=a&&g[x-2],i.y=a&&g[x-1]}return a||(n.curve=Pn(r)),a?[r,a]:r}var Un=function(t,e,n){t=qn(t),e=qn(e);for(var o,i,r,a,c,s,u,l,h,p,d=n?0:[],f=0,v=t.length;f<v;f++){var y=t[f];if("M"==y[0])o=c=y[1],i=s=y[2];else{i="C"==y[0]?(o=(h=[o,i].concat(y.slice(1)))[6],h[7]):(h=[o,i,o,i,c,s,c,s],o=c,s);for(var g=0,m=e.length;g<m;g++){var x=e[g];if("M"==x[0])r=u=x[1],a=l=x[2];else{a="C"==x[0]?(r=(p=[r,a].concat(x.slice(1)))[6],p[7]):(p=[r,a,r,a,u,l,u,l],r=u,l);var _=$n(h,p,n);if(n)d+=_;else{for(var w=0,b=_.length;w<b;w++)_[w].segment1=f,_[w].segment2=g,_[w].bez1=h,_[w].bez2=p;d=d.concat(_)}}}}}return d},Yn=Math.round,Xn=Math.max;var Kn=10;function Zn(t,e){return function(t,e){var n,o;for(n=0;o=t[n];n++)if(en(o,e)<=Kn)return{point:t[n],bendpoint:!0,index:n};return null}(t,e)||(n=t,c=Un((r=Kn,[["M",(i=e).x,i.y],["m",0,-r],["a",r,r,0,1,1,0,2*r],["a",r,r,0,1,1,0,-2*r],["z"]]),(o=[],n.forEach(function(t,e){o.push([0===e?"M":"L",t.x,t.y])}),o)),s=c[0],u=c[c.length-1],s?s!==u?s.segment2!==u.segment2?{point:n[a=Xn(s.segment2,u.segment2)-1],bendpoint:!0,index:a}:{point:{x:Yn(s.x+u.x)/2,y:Yn(s.y+u.y)/2},index:s.segment2}:{point:{x:Yn(s.x),y:Yn(s.y)},index:s.segment2}:null);var n,o,i,r,a,c,s,u}function Qn(t,i,o,v,y){function g(t,e){return Zn(t,function(t,e){var n,o=ct(e),i=t._container.getBoundingClientRect();n={x:i.left,y:i.top};var r=t.viewbox();return{x:r.x+(o.x-n.x)/r.scale,y:r.y+(o.y-n.y)/r.scale}}(i,e))}function r(t,e){var n,o,i,r,a,c,s,u,l,h,p,d=e.waypoints,f=g(d,t);if(f)return o=d,i=10,h=(n=f).index,p=n.point,!(h<=0||n.bendpoint)&&(c=cn(r=o[h-1],a=o[h]),s=rn(r,a),u=Math.abs(p.x-c.x),l=Math.abs(p.y-c.y),s&&u<=i&&l<=i)?y.start(t,e,f.index):v.start(t,e,f.index,!f.bendpoint),!0}function a(t,e,n){V.bind(t,e,function(t){o.triggerMouseEvent(e,t,n),t.stopPropagation()})}function c(t,e){var n=i.getLayer("overlays"),o=et('.djs-bendpoints[data-element-id="'+vn(t.id)+'"]',n);return!o&&e&&(vt(o=jt("g"),{"data-element-id":t.id}),_t(o).add("djs-bendpoints"),ht(n,o),a(o,"mousedown",t),a(o,"click",t),a(o,"dblclick",t)),o}function n(o,t){t.waypoints.forEach(function(t,e){var n=ln(o);ht(o,n),Ee(n,t.x,t.y)}),ln(o,"floating")}function s(t,e){for(var n,o,i=e.waypoints,r=1;r<i.length;r++)rn(n=i[r-1],o=i[r])&&pn(t,n,o)}function u(t){var e=c(t);return e||(n(e=c(t,!0),t),s(e,t)),e}function e(t){var e=c(t);e&&(m(nt("."+un,e),function(t){bt(t)}),m(nt("."+sn,e),function(t){bt(t)}),s(e,t),n(e,t))}t.on("connection.changed",function(t){e(t.element)}),t.on("connection.remove",function(t){var e=c(t.element);e&&bt(e)}),t.on("element.marker.update",function(t){var e,n=t.element;n.waypoints&&(e=u(n),t.add?_t(e).add(t.marker):_t(e).remove(t.marker))}),t.on("element.mousemove",function(t){var e,n,o=t.element,i=o.waypoints;if(i){if(!(e=et(".floating",c(o,!0))))return;(n=g(i,t.originalEvent))&&Ee(e,n.point.x,n.point.y)}}),t.on("element.mousedown",function(t){var e=t.originalEvent,n=t.element,o=n.waypoints;if(o)return r(e,n)}),t.on("selection.changed",function(t){var e=t.newSelection[0];e&&e.waypoints&&u(e)}),t.on("element.hover",function(t){var e=t.element;e.waypoints&&(u(e),o.registerEvent(t.gfx,"mousemove","element.mousemove"))}),t.on("element.out",function(t){o.unregisterEvent(t.gfx,"mousemove","element.mousemove")}),t.on("element.updateId",function(t){var e=t.element,n=t.newId;if(e.waypoints){var o=c(e);o&&vt(o,{"data-element-id":n})}}),this.addHandles=u,this.updateHandles=e,this.getBendpointsContainer=c}Qn.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var Jn="connect-ok",to="connect-not-ok",eo="connect-hover",no="djs-updating",oo="connection.updateWaypoints",io="connection.reconnectStart",ro="connection.reconnectEnd",ao=Math.round;function co(t,e,c,s,n,o,u){var a=t.get("connectionDocking",!1);function l(t){n.update("connection",t.connection,t.connectionGfx)}this.start=function(t,e,n,o){var i,r=e.waypoints,a=c.getGraphics(e);i={connection:e,bendpointIndex:n,insert:o,type:o||0!==n?o||n!==r.length-1?oo:ro:io},s.init(t,"bendpoint.move",{data:{connection:e,connectionGfx:a,context:i}})},e.on("bendpoint.move.start",function(t){var e=t.context,n=e.connection,o=n.waypoints,i=o.slice(),r=e.insert,a=e.bendpointIndex;e.originalWaypoints=o,r&&i.splice(a,0,null),n.waypoints=i,e.draggerGfx=ln(c.getLayer("overlays")),_t(e.draggerGfx).add("djs-dragging"),c.addMarker(n,no)}),e.on("bendpoint.move.hover",function(t){var e=t.context;if(e.hover=t.hover,t.hover){c.addMarker(t.hover,eo);var n=e.allowed=o.allowed(e.type,e);n?(c.removeMarker(e.hover,to),c.addMarker(e.hover,Jn),e.target=e.hover):!1===n&&(c.removeMarker(e.hover,Jn),c.addMarker(e.hover,to),e.target=null)}}),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(t){var e=t.context.hover;e&&(c.removeMarker(e,eo),c.removeMarker(e,t.context.target?Jn:to))}),e.on("bendpoint.move.move",function(t){var e,n,o=t.context,i=o.type,r=t.connection;r.waypoints[o.bendpointIndex]={x:t.x,y:t.y},a&&(o.hover&&(i===io&&(e=o.hover),i===ro&&(n=o.hover)),r.waypoints=a.getCroppedWaypoints(r,e,n)),Ee(o.draggerGfx,t.x,t.y),l(t)}),e.on(["bendpoint.move.end","bendpoint.move.cancel"],function(t){var e=t.context,n=e.hover,o=e.connection;bt(e.draggerGfx),e.newWaypoints=o.waypoints.slice(),o.waypoints=e.originalWaypoints,c.removeMarker(o,no),n&&(c.removeMarker(n,Jn),c.removeMarker(n,to))}),e.on("bendpoint.move.end",function(t){var e,n=t.context,o=n.newWaypoints,i=n.bendpointIndex,r=o[i],a=n.allowed;if(r.x=ao(r.x),r.y=ao(r.y),a&&n.type===io)u.reconnectStart(n.connection,n.target,r);else if(a&&n.type===ro)u.reconnectEnd(n.connection,n.target,r);else{if(!1===a||n.type!==oo)return l(t),!1;e={bendpointMove:{insert:t.context.insert,bendpointIndex:i}},u.updateWaypoints(n.connection,function(t){t=t.slice();for(var e,n,o,i=0;t[i];)e=t[i],n=t[i-1],0===en(e,o=t[i+1])||nn(n,o,e)?t.splice(i,1):i++;return t}(o),e)}}),e.on("bendpoint.move.cancel",function(t){l(t)})}function so(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function uo(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function lo(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function ho(t){return so({x:t.x+(t.width||0)/2,y:t.y+(t.height||0)/2})}function po(t,e,n){l(n=n||0)||(n={x:n,y:n});var o=uo(t),i=uo(e),r=o.bottom+n.y<=i.top,a=o.left-n.x>=i.right,c=o.top-n.y>=i.bottom,s=r?"top":c?"bottom":null,u=o.right+n.x<=i.left?"left":a?"right":null;return u&&s?s+"-"+u:u||s||"intersect"}function fo(t,e,n){var o=Un(t,e);return 1===o.length?so(o[0]):2===o.length&&en(o[0],o[1])<1?so(o[0]):1<o.length?so((o=b(o,function(t){var e=Math.floor(100*t.t2)||1;return e=((e=100-e)<10?"0":"")+e,t.segment2+"#"+e}))[n?0:o.length-1]):null}co.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","rules","modeling"];var vo="connect-hover",yo="djs-updating";function go(t,e,n){return mo(t,e,t[e]+n)}function mo(t,e,n){return{x:"x"===e?n:t.x,y:"y"===e?n:t.y}}function xo(t){return"x"===t?"y":"x"}function _o(t,e,n){var o,i;return t.original?t.original:(o=ho(e),mo(t,i=xo(n),o[i]))}function wo(t,e,p,d,n,o,f){var i=t.get("connectionDocking",!1);function v(t,e){if(!i)return e;var n,o=t.waypoints;return t.waypoints=e,n=i.getCroppedWaypoints(t),t.waypoints=o,n}function y(t){n.update("connection",t.connection,t.connectionGfx)}function g(t,e,n){var o,i,r,a,c,s,u=t.newWaypoints,l=u[t.segmentStartIndex+e],h=u[t.segmentEndIndex+e],p=xo(t.axis),d=(o=n,i=l,r=h,a=p,c=Math.max(i[a],r[a]),s=Math.min(i[a],r[a]),mo(i,a,Math.min(Math.max(s+20,o[a]),c-20)));Ee(t.draggerGfx,d.x,d.y)}this.start=function(t,e,n){var o,i,r,a=p.getGraphics(e),c=n-1,s=n,u=e.waypoints,l=u[c],h=u[s];(i=rn(l,h))&&(r="v"===i?"y":"x",0===c&&(l=_o(l,e.source,r)),s===u.length-1&&(h=_o(h,e.target,r)),o={connection:e,segmentStartIndex:c,segmentEndIndex:s,segmentStart:l,segmentEnd:h,axis:r},d.init(t,{x:(l.x+h.x)/2,y:(l.y+h.y)/2},"connectionSegment.move",{cursor:"x"===r?"resize-ew":"resize-ns",data:{connection:e,connectionGfx:a,context:o}}))},e.on("connectionSegment.move.start",function(t){var e=t.context,n=t.connection,o=p.getLayer("overlays");e.originalWaypoints=n.waypoints.slice(),e.draggerGfx=pn(o,e.segmentStart,e.segmentEnd),_t(e.draggerGfx).add("djs-dragging"),p.addMarker(n,yo)}),e.on("connectionSegment.move.move",function(t){var e,n,o=t.context,i=o.connection,r=o.segmentStartIndex,a=o.segmentEndIndex,c=o.segmentStart,s=o.segmentEnd,u=o.axis,l=o.originalWaypoints.slice(),h=go(c,u,t["d"+u]),p=go(s,u,t["d"+u]),d=l.length,f=0;l[r]=h,l[a]=p,r<2&&(e=po(i.source,h),1===r?"intersect"===e&&(l.shift(),l[0]=h,f--):"intersect"!==e&&(l.unshift(c),f++)),d-3<a&&(n=po(i.target,p),a===d-2?"intersect"===n&&(l.pop(),l[l.length-1]=p):"intersect"!==n&&l.push(s)),o.newWaypoints=i.waypoints=v(i,l),g(o,f,t),o.newSegmentStartIndex=r+f,y(t)}),e.on("connectionSegment.move.hover",function(t){t.context.hover=t.hover,p.addMarker(t.hover,vo)}),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(t){var e=t.context.hover;e&&p.removeMarker(e,vo)}),e.on("connectionSegment.move.cleanup",function(t){var e=t.context,n=e.connection;e.draggerGfx&&bt(e.draggerGfx),p.removeMarker(n,yo)}),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(t){var e=t.context;e.connection.waypoints=e.originalWaypoints,y(t)}),e.on("connectionSegment.move.end",function(t){var e=t.context,n=e.connection,o=e.newWaypoints,i=e.newSegmentStartIndex;o=o.map(function(t){return{original:t.original,x:Math.round(t.x),y:Math.round(t.y)}});var r,a,c,s=(a=i,c=0,{waypoints:(r=o).filter(function(t,e){return!nn(r[e-1],r[e+1],t)||(c=e<=a?c-1:c,!1)}),segmentOffset:c}),u=v(n,s.waypoints),l=s.segmentOffset,h={segmentMove:{segmentStartIndex:e.segmentStartIndex,newSegmentStartIndex:i+l}};f.updateWaypoints(n,u,h)})}wo.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","rules","modeling"];var bo=Math.abs,Eo=Math.round;function So(t){function u(t,e){if(h(t)){for(var n=t.length;n--;)if(bo(t[n]-e)<=10)return t[n]}else{var o=e%(t=+t);if(o<10)return e-o;if(t-10<o)return e-o+t}return e}function l(t){if(t.width)return{x:Eo(t.width/2+t.x),y:Eo(t.height/2+t.y)}}t.on("connectionSegment.move.move",1500,function(t){var e,n,o=function(t){var e=t.snapPoints,n=t.connection,o=n.waypoints,i=t.segmentStart,r=t.segmentStartIndex,a=t.segmentEnd,c=t.segmentEndIndex,s=t.axis;if(e)return e;var u=[o[r-1],i,a,o[c+1]];return r<2&&u.unshift(l(n.source)),c>o.length-3&&u.unshift(l(n.target)),t.snapPoints=e={horizontal:[],vertical:[]},m(u,function(t){t&&(t=t.original||t,"y"===s&&e.horizontal.push(t.y),"x"===s&&e.vertical.push(t.x))}),e}(t.context),i=t.x,r=t.y;if(o){var a=i-(e=u(o.vertical,i)),c=r-(n=u(o.horizontal,r));R(t,{dx:t.dx-a,dy:t.dy-c,x:e,y:n})}}),t.on("bendpoint.move.move",1500,function(t){var e=t.context,n=function(t){var e=t.snapPoints,n=t.connection.waypoints,o=t.bendpointIndex;if(e)return e;var i=[n[o-1],n[o+1]];return t.snapPoints=e={horizontal:[],vertical:[]},m(i,function(t){t&&(t=t.original||t,e.horizontal.push(t.y),e.vertical.push(t.x))}),e}(e),o=e.target,i=o&&l(o),r=t.x,a=t.y;if(n){var c=r-u(i?n.vertical.concat([i.x]):n.vertical,r),s=a-u(i?n.horizontal.concat([i.y]):n.horizontal,a);R(t,{dx:t.dx-c,dy:t.dy-s,x:t.x-c,y:t.y-s})}})}So.$inject=["eventBus"];var ko={__depends__:[me,re],__init__:["bendpoints","bendpointSnapping"],bendpoints:["type",Qn],bendpointMove:["type",co],connectionSegmentMove:["type",wo],bendpointSnapping:["type",So]},Co=fn(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}});function jo(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n}function Mo(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var o=t.indexOf(e);if(-1!==o){if(o===n)return;if(-1===n)return;t.splice(o,1)}-1!==n?t.splice(n,0,e):t.push(e)}}function Ro(t,e){return t&&e?t.indexOf(e):-1}function zo(t,e){if("function"!=typeof e)throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function Bo(t){this._eventBus=t}Bo.$inject=["eventBus"],Bo.prototype.on=function(t,i,r,a,c,s){if((f(i)||d(i))&&(s=c,c=a,a=r,r=i,i=null),f(r)&&(s=c,c=a,a=r,r=1e3),l(c)&&(s=c,c=!1),!f(a))throw new Error("handlerFn must be a function");h(t)||(t=[t]);var u=this._eventBus;m(t,function(t){var e,n,o=["commandStack",t,i].filter(function(t){return t}).join(".");u.on(o,r,c?(e=a,n=s,function(t){return e.call(n||null,t.context,t.command,t)}):a,s)})};m(["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"],function(r){Bo.prototype[r]=function(t,e,n,o,i){(f(t)||d(t))&&(i=o,o=n,n=e,e=t,t=null),this.on(t,r,e,n,o,i)}});function Po(t,e,n){Bo.call(this,e);var i=t.get("movePreview",!1);e.on("shape.move.start",1400,function(t){var e=t.context,n=e.shapes,o=e.validatedShapes;e.shapes=Oo(n),e.validatedShapes=Oo(o)}),i&&e.on("shape.move.start",250,function(t){var n=t.context,e=n.shapes,o=[];m(e,function(e){m(e.labels,function(t){t.hidden||-1!==n.shapes.indexOf(t)||o.push(t),e.labelTarget&&o.push(e)})}),m(o,function(t){i.makeDraggable(n,t,!0)})}),this.preExecuted("elements.move",1400,function(t){var e=t.context.closure,n=e.enclosedElements,o=[];m(n,function(t){m(t.labels,function(t){n[t.id]||o.push(t)})}),e.addAll(o)}),this.preExecute(["connection.delete","shape.delete"],function(t){var e=t.context;zo((e.connection||e.shape).labels,function(t){n.removeShape(t,{nested:!0})})}),this.execute("shape.delete",function(t){var e=t.context,n=e.shape,o=n.labelTarget;o&&(e.labelTargetIndex=Ro(o.labels,n),e.labelTarget=o,n.labelTarget=null)}),this.revert("shape.delete",function(t){var e=t.context,n=e.shape,o=e.labelTarget,i=e.labelTargetIndex;o&&(Mo(o.labels,n,i),n.labelTarget=o)})}function Oo(e){return y(e,function(t){return-1===e.indexOf(t.labelTarget)})}Co(Po,Bo),Po.$inject=["injector","eventBus","modeling"];var Ao={__init__:["labelSupport"],labelSupport:["type",Po]};function To(n,o,i,r){n.on("element.changed",function(t){var e=t.element;(e.parent||e===o.getRootElement())&&(t.gfx=i.getGraphics(e)),t.gfx&&n.fire(Xt(e)+".changed",t)}),n.on("elements.changed",function(t){var e=t.elements;e.forEach(function(t){n.fire("element.changed",{element:t})}),r.updateContainments(e)}),n.on("shape.changed",function(t){r.update("shape",t.element,t.gfx)}),n.on("connection.changed",function(t){r.update("connection",t.element,t.gfx)})}To.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];var Lo={__init__:["changeSupport"],changeSupport:["type",To]},Do=Math.max,Io=Math.min,$o=20;function No(t,e,n){var o=e[t],i=n.min&&n.min[t],r=n.max&&n.max[t];return d(i)&&(o=(/top|left/.test(t)?Io:Do)(o,i)),d(r)&&(o=(/top|left/.test(t)?Do:Io)(o,r)),o}function Ho(t,e){return void 0!==t?t:$o}function Fo(t){return!t.waypoints&&"label"!==t.type}function Go(t,e){var n,o,i,r,a,c,s;if((n=void 0===t.length?y(t.children,Fo):t).length)return o=Yt(n),"object"==typeof(i=e)?(r=Ho(i.left),a=Ho(i.right),c=Ho(i.top),s=Ho(i.bottom)):r=a=c=s=Ho(i),{x:o.x-r,y:o.y-c,width:o.width+r+a,height:o.height+c+s}}function Wo(t,e,r,n){this._dragging=n,this._rules=e;var a=this;function o(t,e){var n,o=t.shape,i=t.direction,r=t.resizeConstraints;n=function(t,e,n){var o=n.x,i=n.y;switch(e){case"nw":return{x:t.x+o,y:t.y+i,width:t.width-o,height:t.height-i};case"sw":return{x:t.x+o,y:t.y,width:t.width-o,height:t.height+i};case"ne":return{x:t.x,y:t.y+i,width:t.width+o,height:t.height-i};case"se":return{x:t.x,y:t.y,width:t.width+o,height:t.height+i};default:throw new Error("unrecognized direction: "+e)}}(o,i,t.delta=e),t.newBounds=function(t,e){if(!e)return t;var n=uo(t);return lo({top:No("top",n,e),right:No("right",n,e),bottom:No("bottom",n,e),left:No("left",n,e)})}(n,r),t.canExecute=a.canResize(t)}function i(t){var e,n=t.shape,o=t.canExecute,i=t.newBounds;o&&(e=i,i={x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)},r.resizeShape(n,i))}t.on("resize.start",function(t){var e,n,o;e=t.context,n=e.resizeConstraints,o=e.minBounds,void 0===n&&(void 0===o&&(o=a.computeMinResizeBox(e)),e.resizeConstraints={min:uo(o)})}),t.on("resize.move",function(t){var e={x:t.dx,y:t.dy};o(t.context,e)}),t.on("resize.end",function(t){i(t.context)})}Wo.prototype.canResize=function(t){var e=this._rules,n=z(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)},Wo.prototype.activate=function(t,e,n){var o,i,r=this._dragging;if("string"==typeof n&&(n={direction:n}),!(i=(o=R({shape:e},n)).direction))throw new Error("must provide a direction (nw|se|ne|sw)");r.init(t,"resize",{autoActivate:!0,cursor:"resize-"+(/nw|se/.test(i)?"nwse":"nesw"),data:{shape:e,context:o}})},Wo.prototype.computeMinResizeBox=function(t){var e,n,o,i,r,a,c,s,u=t.shape,l=t.direction;return e=t.minDimensions||{width:10,height:10},n=Go(u,t.childrenBoxPadding),o=l,i=e,r=n,a=uo(u),c={top:/n/.test(o)?a.bottom-i.height:a.top,left:/w/.test(o)?a.right-i.width:a.left,bottom:/s/.test(o)?a.top+i.height:a.bottom,right:/e/.test(o)?a.left+i.width:a.right},s=r?uo(r):c,lo({top:Io(c.top,s.top),left:Io(c.left,s.left),bottom:Do(c.bottom,s.bottom),right:Do(c.right,s.right)})},Wo.$inject=["eventBus","rules","modeling","dragging"];var Vo="djs-resizing",qo="resize-not-ok";function Uo(t,r,a){t.on("resize.move",500,function(t){var e,n,o,i;e=t.context,n=e.shape,o=e.newBounds,(i=e.frame)||(i=e.frame=a.addFrame(n,r.getDefaultLayer()),r.addMarker(n,Vo)),5<o.width&&vt(i,{x:o.x,width:o.width}),5<o.height&&vt(i,{y:o.y,height:o.height}),e.canExecute?_t(i).remove(qo):_t(i).add(qo)}),t.on("resize.cleanup",function(t){var e,n;e=t.context,n=e.shape,e.frame&&bt(e.frame),r.removeMarker(n,Vo)})}Uo.$inject=["eventBus","canvas","previewSupport"];var Yo="djs-resizer";function Xo(t,e,n,o){this._resize=o,this._canvas=e;var i=this;t.on("selection.changed",function(t){var e=t.newSelection;i.removeResizers(),1===e.length&&m(e,j(i.addResizer,i))}),t.on("shape.changed",function(t){var e=t.element;n.isSelected(e)&&(i.removeResizers(),i.addResizer(e))})}Xo.prototype.makeDraggable=function(e,t,n){var o=this._resize;function i(t){st(t)&&o.activate(t,e,n)}V.bind(t,"mousedown",i),V.bind(t,"touchstart",i)},Xo.prototype._createResizer=function(t,e,n,o,i){var r=this._getResizersParent(),a=jt("g");_t(a).add(Yo),_t(a).add(Yo+"-"+t.id),_t(a).add(Yo+"-"+i),ht(r,a);var c=jt("rect");vt(c,{x:-7,y:-7,width:5,height:5}),_t(c).add(Yo+"-visual"),ht(a,c);var s=jt("rect");return vt(s,{x:-7,y:-7,width:20,height:20}),_t(s).add(Yo+"-hit"),ht(a,s),function(t,e,n,o,i){var r=zt();r.setTranslate(e,n);var a=zt();a.setRotate(o,0,0);var c=zt();c.setScale(i||1,i||1),It(t,[r,a,c])}(a,e,n,o),a},Xo.prototype.createResizer=function(t,e){var n,o=uo(t);n="nw"===e?this._createResizer(t,o.left,o.top,0,e):"ne"===e?this._createResizer(t,o.right,o.top,90,e):"se"===e?this._createResizer(t,o.right,o.bottom,180,e):this._createResizer(t,o.left,o.bottom,270,e),this.makeDraggable(t,n,e)},Xo.prototype.addResizer=function(t){this._resize.canResize({shape:t})&&(this.createResizer(t,"nw"),this.createResizer(t,"ne"),this.createResizer(t,"se"),this.createResizer(t,"sw"))},Xo.prototype.removeResizers=function(){Et(this._getResizersParent())},Xo.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},Xo.$inject=["eventBus","canvas","selection","resize"];var Ko={__depends__:[re,me,_e],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Wo],resizePreview:["type",Uo],resizeHandles:["type",Xo]},Zo=Math.min,Qo=Math.max;function Jo(t){t.preventDefault()}function ti(t){t.stopPropagation()}function ei(t){this.container=t.container,this.parent=X('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=et("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=j(this.autoResize,this),this.handlePaste=j(this.handlePaste,this)}function ni(t,e){this._eventBus=t,this._providers=[],this._textbox=new ei({container:e.getContainer(),keyHandler:j(this._handleKey,this),resizeHandler:j(this._handleResize,this)})}ei.prototype.create=function(t,e,n,o){var i=this.parent,r=this.content,a=this.container;o=this.options=o||{};var c=z(e=this.style=e||{},["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);R(i.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var s=z(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return R(r.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},s),o.centerVertically&&R(r.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},s),r.innerText=n,V.bind(r,"keydown",this.keyHandler),V.bind(r,"mousedown",ti),V.bind(r,"paste",this.handlePaste),o.autoResize&&V.bind(r,"input",this.autoResize),o.resizable&&this.resizable(e),a.appendChild(i),this.setSelection(r.lastChild,r.lastChild&&r.lastChild.length),i},ei.prototype.handlePaste=function(t){var n,e,o=this,i=this.options,r=this.style;if(t.preventDefault(),n=t.clipboardData?t.clipboardData.getData("text/plain"):window.clipboardData.getData("Text"),!document.execCommand("insertHTML",!1,n)){var a,c,s=this.getSelection(),u=s.startContainer,l=s.endContainer,h=s.startOffset,p=s.endOffset,d=s.commonAncestorContainer,f=(e=d.childNodes,[].slice.call(e));if(d.nodeType===Node.TEXT_NODE){var v=u.textContent;u.textContent=v.substring(0,h)+n+v.substring(p),a=u,c=h+n.length}else if(u===this.content&&l===this.content){var y=document.createTextNode(n);this.content.insertBefore(y,f[h]),c=(a=y).textContent.length}else{var g=f.indexOf(u),m=f.indexOf(l);f.forEach(function(t,e){e===g?t.textContent=u.textContent.substring(0,h)+n+l.textContent.substring(p):g<e&&e<=m&&ot(t)}),a=u,c=h+n.length}a&&void 0!==c&&setTimeout(function(){o.setSelection(a,c)})}if(i.autoResize){var x=this.autoResize(r);x&&this.resizeHandler(x)}},ei.prototype.autoResize=function(){var t=this.parent,e=this.content,n=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-n){var o=t.getBoundingClientRect(),i=e.scrollHeight;t.style.height=i+"px",this.resizeHandler({width:o.width,height:o.height,dx:0,dy:i-o.height})}},ei.prototype.resizable=function(){var o=this,i=this.parent,t=this.resizeHandle,r=parseInt(this.style.minWidth)||0,a=parseInt(this.style.minHeight)||0,c=parseInt(this.style.maxWidth)||1/0,s=parseInt(this.style.maxHeight)||1/0;if(!t){var u,l,h,p;t=this.resizeHandle=X('<div class="djs-direct-editing-resize-handle"></div>');var n=function(t){Jo(t),ti(t);var e=Zo(Qo(h+t.clientX-u,r),c),n=Zo(Qo(p+t.clientY-l,a),s);i.style.width=e+"px",i.style.height=n+"px",o.resizeHandler({width:h,height:p,dx:t.clientX-u,dy:t.clientY-l})},d=function(t){Jo(t),ti(t),V.unbind(document,"mousemove",n,!1),V.unbind(document,"mouseup",d,!1)};V.bind(t,"mousedown",function(t){Jo(t),ti(t),u=t.clientX,l=t.clientY;var e=i.getBoundingClientRect();h=e.width,p=e.height,V.bind(document,"mousemove",n),V.bind(document,"mouseup",d)})}R(t.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),i.appendChild(t)},ei.prototype.destroy=function(){var t=this.parent,e=this.content,n=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),V.unbind(e,"keydown",this.keyHandler),V.unbind(e,"mousedown",ti),V.unbind(e,"input",this.autoResize),V.unbind(e,"paste",this.handlePaste),n&&(n.removeAttribute("style"),ot(n)),ot(t)},ei.prototype.getValue=function(){return this.content.innerText},ei.prototype.getSelection=function(){return window.getSelection().getRangeAt(0)},ei.prototype.setSelection=function(t,e){var n=document.createRange();null===t?n.selectNodeContents(this.content):(n.setStart(t,e),n.setEnd(t,e));var o=window.getSelection();o.removeAllRanges(),o.addRange(n)},ni.$inject=["eventBus","canvas"],ni.prototype.registerProvider=function(t){this._providers.push(t)},ni.prototype.isActive=function(){return!!this._active},ni.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},ni.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})},ni.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0},ni.prototype.complete=function(){var t=this._active;if(t){var e=this.getValue(),n=this.$textbox.getBoundingClientRect();(e!==t.context.text||this.resizable)&&t.provider.update(t.element,e,t.context.text,{x:n.top,y:n.left,width:n.width,height:n.height}),this._fire("complete"),this.close()}},ni.prototype.getValue=function(){return this._textbox.getValue()},ni.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;return 27===e?(t.preventDefault(),this.cancel()):13!==e||t.shiftKey?void 0:(t.preventDefault(),this.complete())},ni.prototype._handleResize=function(t){this._fire("resize",t)},ni.prototype.activate=function(e){var n;this.isActive()&&this.cancel();var t=v(this._providers,function(t){return(n=t.activate(e))?t:null});return n&&(this.$textbox=this._textbox.create(n.bounds,n.style,n.text,n.options),this._active={element:e,context:n,provider:t},n.options&&n.options.resizable&&(this.resizable=!0),this._fire("activate")),!!n};var oi={__depends__:[Wt],__init__:["directEditing"],directEditing:["type",ni]},ii="connect-ok",ri="connect-not-ok";function ai(t,r,e,n,i,v){t.on("connect.move",function(t){var e,n,o,i,r,a,c,s,u,l=t.context,h=l.source,p=l.target,d=l.visual,f=l.sourcePosition;e={x:t.x,y:t.y},o=f,i=e,r=h,a=p,c=v.getShapePath(r),s=a&&v.getShapePath(a),u=v.getConnectionPath({waypoints:[o,i]}),vt(d,{points:[(n=[o=fo(c,u,!0)||o,i=a&&fo(s,u,!1)||i])[0].x,n[0].y,n[1].x,n[1].y]})}),t.on("connect.hover",function(t){var e,n=t.context,o=(n.source,t.hover);null!==(e=n.canExecute=!0)&&(n.target=o,i.addMarker(o,e?ii:ri))}),t.on(["connect.out","connect.cleanup"],function(t){var e=t.context;e.target&&i.removeMarker(e.target,e.canExecute?ii:ri),e.target=null,e.canExecute=!1}),t.on("connect.cleanup",function(t){var e=t.context;e.visual&&bt(e.visual)}),t.on("connect.start",function(t){var e,n=t.context;vt(e=jt("polyline"),{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),ht(i.getDefaultLayer(),e),n.visual=e}),t.on("connect.end",function(t){var e=t.context;e.source,e.type,e.sourcePosition,e.target,t.x,t.y;if(!(e.canExecute||!0))return!1}),this.start=function(t,e,n,o,i){"object"!=typeof o&&(i=o,o=ho(e)),r.init(t,"connect",{autoActivate:i,data:{shape:e,context:{type:n,source:e,sourcePosition:o}}})}}ai.$inject=["eventBus","dragging","modeling","rules","canvas","graphicsFactory"];var ci={__depends__:[oe,re,me],connect:["type",ai]};function si(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[]},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}si.$inject=["eventBus","injector"],si.prototype.execute=function(t,e){if(!t)throw new Error("command required");var n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction(n)},si.prototype.canExecute=function(t,e){var n={command:t,context:e},o=this._getHandler(t),i=this._fire(t,"canExecute",n);if(void 0===i){if(!o)return!1;o.canExecute&&(i=o.canExecute(e))}return i},si.prototype.clear=function(t){this._stack.length=0,!(this._stackIdx=-1)!==t&&this._fire("changed")},si.prototype.undo=function(){var t,e=this._getUndoAction();if(e){for(this._pushAction(e);e&&(this._internalUndo(e),(t=this._getUndoAction())&&t.id===e.id);)e=t;this._popAction()}},si.prototype.redo=function(){var t,e=this._getRedoAction();if(e){for(this._pushAction(e);e&&(this._internalExecute(e,!0),(t=this._getRedoAction())&&t.id===e.id);)e=t;this._popAction()}},si.prototype.register=function(t,e){this._setHandler(t,e)},si.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");var n=this._injector.instantiate(e);this.register(t,n)},si.prototype.canUndo=function(){return!!this._getUndoAction()},si.prototype.canRedo=function(){return!!this._getRedoAction()},si.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},si.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},si.prototype._internalUndo=function(t){var e=this,n=t.command,o=t.context,i=this._getHandler(n);this._atomicDo(function(){e._fire(n,"revert",t),i.revert&&e._markDirty(i.revert(o)),e._revertedAction(t),e._fire(n,"reverted",t)})},si.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);var o,i,r,a=e?[t+"."+e,e]:[t];for(n=this._eventBus.createEvent(n),o=0;(i=a[o])&&(r=this._eventBus.fire("commandStack."+i,n),!n.cancelBubble);o++);return r},si.prototype._createId=function(){return this._uid++},si.prototype._atomicDo=function(t){var e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}},si.prototype._internalExecute=function(t,e){var n=this,o=t.command,i=t.context,r=this._getHandler(o);if(!r)throw new Error("no command handler registered for <"+o+">");this._pushAction(t),e||(this._fire(o,"preExecute",t),r.preExecute&&r.preExecute(i),this._fire(o,"preExecuted",t)),this._atomicDo(function(){n._fire(o,"execute",t),r.execute&&n._markDirty(r.execute(i)),n._executedAction(t,e),n._fire(o,"executed",t)}),e||(this._fire(o,"postExecute",t),r.postExecute&&r.postExecute(i),this._fire(o,"postExecuted",t)),this._popAction(t)},si.prototype._pushAction=function(t){var e=this._currentExecution,n=e.actions,o=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=o&&o.id||this._createId()),n.push(t)},si.prototype._popAction=function(){var t=this._currentExecution,e=t.actions,n=t.dirty;e.pop(),e.length||(this._eventBus.fire("elements.changed",{elements:function(e){e=E(e);for(var n={},t=arguments.length,o=Array(1<t?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return m(o,function(t){return w(t,e,n)}),x(n,function(t,e){return t[0]})}("id",n)}),n.length=0,this._fire("changed"))},si.prototype._markDirty=function(t){var e=this._currentExecution;t&&(t=h(t)?t:[t],e.dirty=e.dirty.concat(t))},si.prototype._executedAction=function(t,e){var n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)},si.prototype._revertedAction=function(t){this._stackIdx--},si.prototype._getHandler=function(t){return this._handlerMap[t]},si.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};var ui={commandStack:["type",si]};function li(t){return R({original:t.point.original||t.point},t.actual)}function hi(t,e){this._elementRegistry=t,this._graphicsFactory=e}hi.$inject=["elementRegistry","graphicsFactory"],hi.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var o=this.getDockingPoint(t,e,!0),i=this.getDockingPoint(t,n),r=t.waypoints.slice(o.idx+1,i.idx);return r.unshift(li(o)),r.push(li(i)),r},hi.prototype.getDockingPoint=function(t,e,n){var o,i,r=t.waypoints;return{point:i=r[o=n?0:r.length-1],actual:this._getIntersection(e,t,n)||i,idx:o}},hi.prototype._getIntersection=function(t,e,n){return fo(this._getShapePath(t),this._getConnectionPath(e),n)},hi.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)},hi.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)},hi.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var pi={extend:function(t,o,e,i){var r=e.inverse;return Object.defineProperty(t,"remove",{value:function(t){var e=this.indexOf(t);return-1!==e&&(this.splice(e,1),o.unset(t,r,i)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,e){var n=this.indexOf(t);if(void 0===e){if(-1!==n)return;e=this.length}-1!==n&&this.splice(n,1),this.splice(e,0,t),-1===n&&o.set(t,r,i)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},isExtended:function(t){return!0===t.__refs_collection}};function di(e,n,o){var t=pi.extend(o[n.name]||[],e,n,o);Object.defineProperty(o,n.name,{enumerable:n.enumerable,value:t}),t.length&&t.forEach(function(t){e.set(t,n.inverse,o)})}function fi(t,e){if(!(this instanceof fi))return new fi(t,e);(t.inverse=e).inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}fi.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}var n,o,i,r,a;e.collection?di(this,e,t):(n=this,i=t,r=(o=e).inverse,a=i[o.name],Object.defineProperty(i,o.name,{configurable:o.configurable,enumerable:o.enumerable,get:function(){return a},set:function(t){if(t!==a){var e=a;a=null,e&&n.unset(e,r,i),a=t,n.set(a,r,i)}}}))},fi.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return pi.isExtended(n)||di(this,e,t),n},fi.prototype.ensureBound=function(t,e){var n,o;n=t,o=e,Object.prototype.hasOwnProperty.call(n,o.name||o)||this.bind(t,e)},fi.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},fi.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var vi=fi,yi=pi;vi.Collection=yi;var gi=new vi({name:"children",enumerable:!0,collection:!0},{name:"parent"}),mi=new vi({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),xi=new vi({name:"attachers",collection:!0},{name:"host"}),_i=new vi({name:"outgoing",collection:!0},{name:"source"}),wi=new vi({name:"incoming",collection:!0},{name:"target"});function bi(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),gi.bind(this,"parent"),mi.bind(this,"labels"),_i.bind(this,"outgoing"),wi.bind(this,"incoming")}function Ei(){bi.call(this),gi.bind(this,"children"),xi.bind(this,"host"),xi.bind(this,"attachers")}function Si(){Ei.call(this)}function ki(){Ei.call(this),mi.bind(this,"labelTarget")}function Ci(){bi.call(this),_i.bind(this,"source"),wi.bind(this,"target")}Co(Ei,bi),Co(Si,Ei),Co(ki,Ei),Co(Ci,bi);var ji={connection:Ci,shape:Ei,label:ki,root:Si};function Mi(){this._uid=12}function Ri(){Mi.call(this)}function zi(){}Mi.prototype.createRoot=function(t){return this.create("root",t)},Mi.prototype.createLabel=function(t){return this.create("label",t)},Mi.prototype.createShape=function(t){return this.create("shape",t)},Mi.prototype.createConnection=function(t){return this.create("connection",t)},Mi.prototype.create=function(t,e){return(e=R({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=ji[t];if(!n)throw new Error("unknown type: <"+t+">");return R(new n,e)}(t,e)},Co(Ri,Mi),Ri.prototype.createEnumeration=function(t){var e={shapeType:"enumeration",businessObject:{}};return R(e,t),this.createShape(e)},Ri.prototype.createClass=function(t){var e={shapeType:"class",businessObject:{}};return R(e,t),this.createShape(e)},Ri.prototype.createUmlLabel=function(t){var e={shapeType:"label"};return R(e,t),this.createLabel(e)},Ri.prototype.createInheritance=function(t){var e={connectionType:"inheritance"};return R(e,t),this.createConnection(e)},Ri.prototype.createAssociation=function(t){var e={connectionType:"association"};return R(e,t),this.createConnection(e)},Ri.prototype.createAggregation=function(t){var e={connectionType:"aggregation"};return R(e,t),this.createConnection(e)},Ri.prototype.createComposition=function(t){var e={connectionType:"composition"};return R(e,t),this.createConnection(e)},Ri.prototype.createDependency=function(t){var e={connectionType:"dependency"};return R(e,t),this.createConnection(e)},Ri.prototype.createRealization=function(t){var e={connectionType:"realization"};return R(e,t),this.createConnection(e)},zi.prototype.layoutConnection=function(t,e){return[(e=e||{}).connectionStart||ho(t.source),e.connectionEnd||ho(t.target)]};var Bi=20,Pi=5,Oi=Math.round,Ai=20,Ti={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Li(t,e,n){var o,i,r,a,c=po(e,t,Pi),s=n.split(":")[0],u=Oi((e.x-t.x)/2+t.x),l=Oi((e.y-t.y)/2+t.y),h=(r=c,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[s].test(r)),p=/h|r|l/.test(s),d=!1;return h?(o=p?{x:u,y:t.y}:{x:t.x,y:l},i=p?"h:h":"v:v"):(a=c,i=p?"h:v":"v:h",o=!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[s].test(a)?p?(d=l===t.y,{x:t.x+Bi*(/l/.test(s)?-1:1),y:d?l+Bi:l}):{x:(d=u===t.x)?u+Bi:u,y:t.y+Bi*(/t/.test(s)?-1:1)}:{x:u,y:l}),{waypoints:Ii(t,o,i).concat(o),directions:i,turnNextDirections:d}}function Di(t){return t.split(":").reverse().join(":")}function Ii(t,e,n){if(!(o=n=n||"h:h")||!/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(o))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");var o,i;if(Wi(n)){var r=Li(t,e,n),a={waypoints:(i=Li(e,t,Di(n))).waypoints.slice().reverse(),directions:Di(i.directions),turnNextDirections:i.turnNextDirections},c=function(t,e){var n=t.directions.split(":")[1],o=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(o="h"==o?"v":"h");var i=n+":"+o;return{waypoints:Ii(t.waypoints[t.waypoints.length-1],e.waypoints[0],i),directions:i}}(r,a);return[].concat(r.waypoints,c.waypoints,a.waypoints)}return function(t,e,n){var o=Oi((e.x-t.x)/2+t.x),i=Oi((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:o,y:t.y},{x:o,y:e.y}];if("v:v"===n)return[{x:t.x,y:i},{x:e.x,y:i}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function $i(t,e,n){var o=Ii(t,e,n);return o.unshift(t),o.push(e),qi(o)}function Ni(t,e,n,o,i){var r=g(i&&i.preferredLayouts||[],"straight")[0]||"h:h",a=po(t,e,Ti[r]||0),c=function(t,e){if(Wi(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}(a,r);n=n||ho(t),o=o||ho(e);var s=c.split(":");return $i(Vi(n,t,s[0],{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[a]),Vi(o,e,s[1],a),c)}function Hi(t,e,n,o,i,r){var a;return h(n)&&(i=n,r=o,n=ho(t),o=ho(e)),i=i||[],-1!==(r=R({preferredLayouts:[]},r)).preferredLayouts.indexOf("straight")&&(a=function(t,e,n,o,i){var r,a,c={};if(a=po(t,e),!/^(top|bottom|left|right)$/.test(a))return null;/top|bottom/.test(a)&&(r="x");/left|right/.test(a)&&(r="y");return"target"===i.preserveDocking?Fi(r,o,t)?(c[r]=o[r],[{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y,original:{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y}},{x:o.x,y:o.y}]):null:Fi(r,n,e)?(c[r]=n[r],[{x:n.x,y:n.y},{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y,original:{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y}}]):null}(t,e,n,o,r)),a||(r.connectionEnd?a=(a=Gi(e,t,o,i.slice().reverse()))&&a.reverse():r.connectionStart?a=Gi(t,e,n,i):i&&i.length&&(a=i)),a||(a=Ni(t,e,n,o,r)),a}function Fi(t,e,n){var o,i,r;return o=e[t],i=n[t],r=n[t]+n[{x:"width",y:"height"}[t]],i<=o&&o<=r}function Gi(t,e,n,o){if((i=o).length<3||!(4<i.length)&&v(i,function(t,e){var n=i[e-1];return n&&en(t,n)<3}))return null;var i,r,a=o[0],c=o.slice();return c[0]=n,c[1]=function(t,e,n){switch(rn(e,t)){case"v":return{x:t.x,y:n.y};case"h":return{x:n.x,y:t.y}}return{x:t.x,y:t.y}}(c[1],a,n),(r=function(t,e,n){var o;for(o=t.length-2;0!==o;o--)if(an(t[o],e,Ai)||an(t[o],n,Ai))return t.slice(o);return t}(c,t,e))!==c?Gi(t,e,n,r):c}function Wi(t){return t&&/t|r|b|l/.test(t)}function Vi(t,e,n,o){if("h"===n&&(n=/left/.test(o)?"l":"r"),"v"===n&&(n=/top/.test(o)?"t":"b"),"t"===n)return{original:t,x:t.x,y:e.y};if("r"===n)return{original:t,x:e.x+e.width,y:t.y};if("b"===n)return{original:t,x:t.x,y:e.y+e.height};if("l"===n)return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function qi(o){return o.reduce(function(t,e,n){return nn(t[t.length-1],o[n+1],e,0)||t.push(e),t},[])}function Ui(){}function Yi(e,o,n){Bo.call(this,e),this.executed(["connection.layout","connection.create","connection.reconnectEnd","connection.reconnectStart"],function(t){var e,n=t.context;n.cropped||((e=n.connection).waypoints=o.getCroppedWaypoints(e),n.cropped=!0)}),this.postExecuted(["connection.layout","connection.reconnectEnd","connection.reconnectStart","connection.updateWaypoints","connection.move"],function(t){n.execute("layout.connection.labels",t.context)}),this.reverted(["connection.layout"],function(t){delete t.context.cropped}),e.on("element.hover",1500,function(t){if(t.element instanceof ki&&"classifier"===t.element.labelType)return!1});e.on(["element.click","element.mousedown","element.mouseup","element.contextmenu","element.dblclick"],1500,function(t){t.element instanceof ki&&"classifier"===t.element.labelType&&(t.stopPropagation(),e.fire(t.type,{element:t.element.parent,originalEvent:t.originalEvent,srcEvent:t.srcEvent}))})}function Xi(t,e){this._modeling=t,this._textRenderer=e}function Ki(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function Zi(t,e,n){var o,i,r,a;return Ki(t,e,n/(i=e,r=(o=t).x-i.x,a=o.y-i.y,Math.sqrt(r*r+a*a)))}function Qi(t){this._modeling=t}function Ji(t,e,n){this._graphicsFactory=t,this._elementRegistry=e,this._selection=n}function tr(t){this._modeling=t}Co(Ui,zi),Ui.prototype.layoutConnection=function(t,e){e=e||{};var n=t.source,o=t.target,i=t.waypoints,r=e.connectionStart,a=e.connectionEnd,c=e;return R(c,{preferredLayouts:["v:v"]}),qi(Hi(n,o,r,a,i,c))},Co(Yi,Bo),Yi.$inject=["eventBus","connectionDocking","commandStack"],Xi.$inject=["modeling","textRenderer"],Xi.prototype.postExecute=function(t){var e=t.newLabel,n=t.element,o=this._textRenderer.getDimensions(e,{});"class"==n.type?n.businessObject.name=e:(n.businessObject=e,n.width=o.width,n.height=o.height),this._modeling.resizeShape(n,{x:n.x,y:n.y,width:Math.max(n.width,10),height:Math.max(n.height,10)})},Qi.$inject=["modeling"],Qi.prototype.preExecute=function(t){var e,n=this._modeling;function l(t,e,n){t.moveShape(e,{x:n.x-e.x,y:n.y-e.y})}function h(t,e,n){"left"===t?e.x-=n.width:"top"===t&&(e.y-=n.height)}function p(t,e,n){"left"===t?e.x-=5:"right"===t?e.x+=n.width+5:"top"===t?e.y-=5:"bottom"===t&&(e.y+=n.height+5)}function d(t,e,n,o){var i,r=Zi(t,e,o?15:5);return"right"===(i=n)||"left"===i?r.y+=5:r.x+=5,r}function f(t,e){var n=t.connectionType;return"source"===e?"aggregation"===n||"composition"===n:"association"===n||"inheritance"===n}function v(t,e){return t.y===e.y?(o=e,t.x<o.x?"right":"left"):(n=e,t.y<n.y?"bottom":"top");var n,o}e=t.connection,function(t,e){for(var n=e.labels.filter(function(t){return"sourceCard"===t.labelType||"sourceName"===t.labelType}).sort(function(t,e){return t.labelType.localeCompare(e.labelType)}),o=f(e,"source"),i=e.waypoints[0],r=e.waypoints[1],a=v(i,r),c=d(i,r,a,o),s=0;s<n.length;s++){var u=n[s];h(a,c,u),l(t,u,c),p(a,c,u)}}(n,e),function(t,e){for(var n=e.labels.filter(function(t){return"targetCard"===t.labelType||"targetName"===t.labelType}).sort(function(t,e){return t.labelType.localeCompare(e.labelType)}),o=f(e,"target"),i=e.waypoints[e.waypoints.length-1],r=e.waypoints[e.waypoints.length-2],a=v(i,r),c=d(i,r,a,o),s=0;s<n.length;s++){var u=n[s];h(a,c,u),l(t,u,c),p(a,c,u)}}(n,e)},Ji.$inject=["graphicsFactory","elementRegistry","selection"],Ji.prototype.execute=function(t){var e=t.element;this.hide(e),this._selection.deselect(e)},Ji.prototype.hide=function(t){t.hidden=!0,t instanceof Ei?t instanceof ki?this.hideLabel(t):this.hideShape(t):this.hideConnection(t)},Ji.prototype.hideLabel=function(t){this.hideChildren(t),this.updateGfx(t,"shape")},Ji.prototype.hideConnection=function(t){this.hideChildren(t),this.updateGfx(t,"connection")},Ji.prototype.hideShape=function(t){this.hideAttachedEdges(t),this.hideChildren(t),this.updateGfx(t,"shape")},Ji.prototype.hideAttachedEdges=function(t){this.hideIncomingAttachedEdges(t),this.hideOutgoingAttachedEdges(t)},Ji.prototype.hideIncomingAttachedEdges=function(t){var e=this;"incoming"in t&&t.incoming.forEach(function(t){e.hide(t)})},Ji.prototype.hideOutgoingAttachedEdges=function(t){var e=this;"outgoing"in t&&t.outgoing.forEach(function(t){e.hide(t)})},Ji.prototype.hideChildren=function(t){var e=this;"children"in t&&t.children.forEach(function(t){e.hide(t)})},Ji.prototype.updateGfx=function(t,e){var n=this._elementRegistry.getGraphics(t,!1);this._graphicsFactory.update(e,t,n)},tr.$inject=["modeling"],tr.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,o=t.shape;o=t.shape=this._modeling.createShape(o,t.position,n,{attach:t.attach}),t.shape=o},tr.prototype.postExecute=function(t){var e,n,o=t.connectionParent||t.shape.parent;e=t.source,n=t.shape,v(e.outgoing,function(t){return t.target===n})||this._modeling.connect(t.source,t.shape,t.connection,o)};var er=Math.round;function nr(t){this._canvas=t}function or(t,e){this._canvas=t,this._modeling=e}function ir(t,e,n){var o=he(e),i=he(n),r=pe(t,o),a=r.x*(n.width/e.width),c=r.y*(n.height/e.height);return so({x:i.x+a,y:i.y+c})}function rr(t,e,n){var o=lr(t)[0];return ir(o.original||o,n,e)}function ar(t,e,n){var o=lr(t),i=o[o.length-1];return ir(i.original||i,n,e)}function cr(t,e,n){return rr(t,e,ur(e,n))}function sr(t,e,n){return ar(t,e,ur(e,n))}function ur(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function lr(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function hr(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function pr(t){this._modeling=t}function dr(t){this._modeling=t,this._helper=new pr(t)}function fr(t){this._modeling=t}function vr(t,e){this._modeling=t,this._rules=e}function yr(t){this._modeling=t}function gr(t){this._modeling=t}function mr(t){nr.call(this,t)}nr.$inject=["canvas"],nr.prototype.execute=function(t){var e=t.shape,n=t.position,o=t.parent,i=t.parentIndex;if(!o)throw new Error("parent required");if(!n)throw new Error("position required");return void 0!==n.width?R(e,n):R(e,{x:n.x-er(e.width/2),y:n.y-er(e.height/2)}),this._canvas.addShape(e,o,i),e},nr.prototype.revert=function(t){this._canvas.removeShape(t.shape)},or.$inject=["canvas","modeling"],or.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;zo(n.incoming,function(t){e.removeConnection(t,{nested:!0})}),zo(n.outgoing,function(t){e.removeConnection(t,{nested:!0})}),zo(n.children,function(t){t.waypoints?e.removeConnection(t,{nested:!0}):e.removeShape(t,{nested:!0})})},or.prototype.execute=function(t){var e=this._canvas,n=t.shape,o=n.parent;return t.oldParent=o,t.oldParentIndex=Ro(o.children,n),e.removeShape(n),n},or.prototype.revert=function(t){var e=this._canvas,n=t.shape,o=t.oldParent,i=t.oldParentIndex;return Mo(o.children,n,i),e.addShape(n,o),n},hr.prototype.add=function(t,e){return this.addAll([t],e)},hr.prototype.addAll=function(t,e){return R(this,function(t,e,n){u(e)&&(e=!0),l(e)&&(n=e,e=!0);var o=Kt((n=n||{}).allShapes),i=Kt(n.allConnections),r=Kt(n.enclosedElements),a=Kt(n.enclosedConnections),c=Kt(n.topLevel,e&&w(t,function(t){return t.id}));function s(t){c[t.source.id]&&c[t.target.id]&&(c[t.id]=[t]),o[t.source.id]&&o[t.target.id]&&(a[t.id]=r[t.id]=t),i[t.id]=t}return qt(t,function(t){if(!(r[t.id]=t).waypoints)return m((o[t.id]=t).incoming,s),m(t.outgoing,s),t.children;a[t.id]=i[t.id]=t}),{allShapes:o,allConnections:i,topLevel:c,enclosedConnections:a,enclosedElements:r}}(t,!!e,this)),this},pr.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]},pr.prototype.moveClosure=function(t,o,i,e,n){var r=this._modeling,a=t.allShapes,c=t.allConnections,s=t.enclosedConnections,u=t.topLevel,l=!1;n&&n.parent===i&&(l=!0),m(a,function(t){r.moveShape(t,o,u[t.id]&&!l&&i,{recurse:!1,layout:!1})}),m(c,function(t){var e=!!a[t.source.id],n=!!a[t.target.id];s[t.id]&&e&&n?r.moveConnection(t,o,u[t.id]&&!l&&i):r.layoutConnection(t,{connectionStart:e&&cr(t,t.source,o),connectionEnd:n&&sr(t,t.target,o)})})},pr.prototype.getClosure=function(t){return(new hr).addAll(t,!0)},dr.$inject=["modeling"],dr.prototype.execute=function(t){var e=t.shape,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldBounds=z(e,["x","y","width","height"]),t.oldParent=r,t.oldParentIndex=jo(r.children,e),Mo(o.children,e,i),R(e,{parent:o,x:e.x+n.x,y:e.y+n.y}),e},dr.prototype.postExecute=function(t){var e=t.shape,n=t.delta,o=t.hints,i=this._modeling;!1!==o.layout&&(m(e.incoming,function(t){i.layoutConnection(t,{connectionEnd:sr(t,e,n)})}),m(e.outgoing,function(t){i.layoutConnection(t,{connectionStart:cr(t,e,n)})})),!1!==o.recurse&&this.moveChildren(t)},dr.prototype.revert=function(t){var e=t.shape,n=t.oldParent,o=t.oldParentIndex,i=t.delta;return Mo(n.children,e,o),R(e,{parent:n,x:e.x-i.x,y:e.y-i.y}),e},dr.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)},dr.prototype.getNewParent=function(t){return t.newParent||t.shape.parent},fr.$inject=["modeling"],fr.prototype.execute=function(t){var e=t.shape,n=t.newBounds,o=t.minBounds;if(void 0===n.x||void 0===n.y||void 0===n.width||void 0===n.height)throw new Error("newBounds must have {x, y, width, height} properties");if(o&&(n.width<o.width||n.height<o.height))throw new Error("width and height cannot be less than minimum height and width");if(!o&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},R(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},fr.prototype.postExecute=function(t){var e=t.shape,n=t.oldBounds,o=this._modeling;m(e.incoming,function(t){o.layoutConnection(t,{connectionEnd:ar(t,e,n)})}),m(e.outgoing,function(t){o.layoutConnection(t,{connectionStart:rr(t,e,n)})})},fr.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return R(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},vr.$inject=["modeling","rules"],vr.prototype.preExecute=function(t){var o,i=this,e=this._modeling,r=this._rules,n=t.oldShape,a=t.newData,c=t.hints;function s(t,e,n,o){return r.allowed(t,{source:e,target:n,connection:o})}var u,l={x:a.x,y:a.y};o=t.newShape=t.newShape||i.createShape(a,l,n.parent,c),n.host&&e.updateAttachment(o,n.host),!1!==c.moveChildren&&(u=n.children.slice(),e.moveElements(u,{x:0,y:0},o));var h=n.incoming.slice(),p=n.outgoing.slice();m(h,function(t){var e=t.waypoints,n=e[e.length-1];s("connection.reconnectEnd",t.source,o,t)&&i.reconnectEnd(t,o,n)}),m(p,function(t){var e=t.waypoints[0],n=t.target;s("connection.reconnectStart",o,n,t)&&i.reconnectStart(t,o,e)})},vr.prototype.postExecute=function(t){var e=this._modeling,n=t.oldShape,o=t.newShape;m(o.incoming,function(t){e.layoutConnection(t,{endChanged:!0})}),m(o.outgoing,function(t){e.layoutConnection(t,{startChanged:!0})}),e.removeShape(n)},vr.prototype.execute=function(t){},vr.prototype.revert=function(t){},vr.prototype.createShape=function(t,e,n,o){return this._modeling.createShape(t,e,n,o)},vr.prototype.reconnectStart=function(t,e,n){this._modeling.reconnectStart(t,e,n)},vr.prototype.reconnectEnd=function(t,e,n){this._modeling.reconnectEnd(t,e,n)},yr.$inject=["modeling"],yr.prototype.execute=function(t){var e,n,o,i=t.shape,r=i.children;return t.oldChildrenVisibility=(e={},r.forEach(function(t){e[t.id]=t.hidden}),e),i.collapsed=!i.collapsed,n=r,o=i.collapsed,n.forEach(function(t){t.hidden=o}),[i].concat(r)},yr.prototype.revert=function(t){var e,n=t.shape,o=t.oldChildrenVisibility,i=n.children;return e=o,i.forEach(function(t){t.hidden=e[t.id]}),n.collapsed=!n.collapsed,[n].concat(i)},gr.$inject=["modeling"],gr.prototype.preExecute=function(t){var n=this._modeling,e=t.resizingShapes,o=t.delta,i=t.direction;m(e,function(t){var e=function(t,e,n){var o=n.x,i=n.y;switch(e){case"n":return{x:t.x,y:t.y+i,width:t.width,height:t.height-i};case"s":return{x:t.x,y:t.y,width:t.width,height:t.height+i};case"w":return{x:t.x+o,y:t.y,width:t.width-o,height:t.height};case"e":return{x:t.x,y:t.y,width:t.width+o,height:t.height};default:throw new Error("unrecognized direction: "+e)}}(t,i,o);n.resizeShape(t,e)})},gr.prototype.postExecute=function(t){var e=this._modeling,n=t.movingShapes,o=t.delta;e.moveElements(n,o,void 0,{autoResize:!1,attach:!1})},gr.prototype.execute=function(t){},gr.prototype.revert=function(t){},Co(mr,nr),mr.$inject=["canvas"];var xr=nr.prototype.execute;mr.prototype.execute=function(t){var e,n=t.shape;return e=n,["width","height"].forEach(function(t){void 0===e[t]&&(e[t]=0)}),n.labelTarget=t.labelTarget,xr.call(this,t)};var _r=nr.prototype.revert;function wr(t,e){this._canvas=t,this._layouter=e}function br(t,e){this._canvas=t,this._modeling=e}function Er(){}function Sr(t,e){this._layouter=t,this._canvas=e}function kr(){}function Cr(){}function jr(t){this._helper=new pr(t)}function Mr(t,e){this._modeling=t,this._elementRegistry=e}function Rr(t){this._modeling=t}mr.prototype.revert=function(t){return t.shape.labelTarget=null,_r.call(this,t)},wr.$inject=["canvas","layouter"],wr.prototype.execute=function(t){var e=t.connection,n=t.source,o=t.target,i=t.parent,r=t.parentIndex,a=t.hints;if(!n||!o)throw new Error("source and target required");if(!i)throw new Error("parent required");return e.source=n,e.target=o,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,i,r),e},wr.prototype.revert=function(t){var e=t.connection;this._canvas.removeConnection(e),e.source=null,e.target=null},br.$inject=["canvas","modeling"],br.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=Ro(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e},br.prototype.revert=function(t){var e=t.connection,n=t.parent,o=t.parentIndex;return e.source=t.source,e.target=t.target,Mo(n.children,e,o),this._canvas.addConnection(e,n),e},Er.prototype.execute=function(t){var e=t.connection,n=t.delta,o=t.newParent||e.parent,i=t.newParentIndex,r=e.parent;return t.oldParent=r,t.oldParentIndex=jo(r.children,e),Mo(o.children,e,i),e.parent=o,m(e.waypoints,function(t){t.x+=n.x,t.y+=n.y,t.original&&(t.original.x+=n.x,t.original.y+=n.y)}),e},Er.prototype.revert=function(t){var e=t.connection,n=e.parent,o=t.oldParent,i=t.oldParentIndex,r=t.delta;return jo(n.children,e),Mo(o.children,e,i),e.parent=o,m(e.waypoints,function(t){t.x-=r.x,t.y-=r.y,t.original&&(t.original.x-=r.x,t.original.y-=r.y)}),e},Sr.$inject=["layouter","canvas"],Sr.prototype.execute=function(t){var e=t.connection;return R(t,{oldWaypoints:e.waypoints}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e},Sr.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e},kr.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e},kr.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e},Cr.$inject=[],Cr.prototype.execute=function(t){var e,n=t.newSource,o=t.newTarget,i=t.connection,r=t.dockingOrPoints,a=i.waypoints;if(!n&&!o)throw new Error("newSource or newTarget are required");if(n&&o)throw new Error("must specify either newSource or newTarget");return t.oldWaypoints=a,h(r)?e=r:(e=a.slice()).splice(n?0:-1,1,r),n&&(t.oldSource=i.source,i.source=n),o&&(t.oldTarget=i.target,i.target=o),i.waypoints=e,i},Cr.prototype.revert=function(t){var e=t.newSource,n=t.newTarget,o=t.connection;return e&&(o.source=t.oldSource),n&&(o.target=t.oldTarget),o.waypoints=t.oldWaypoints,o},jr.$inject=["modeling"],jr.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)},jr.prototype.postExecute=function(t){var e,n=t.hints;n&&n.primaryShape&&(e=n.primaryShape,n.oldParent=e.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,e)},Mr.$inject=["modeling","elementRegistry"],Mr.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry;m(t.elements,function(t){n.get(t.id)&&(t.waypoints?e.removeConnection(t):e.removeShape(t))})},Rr.$inject=["modeling"];var zr={x:"y",y:"x"};function Br(t,e){this._modeling=t,this._canvas=e}function Pr(t){this._modeling=t}function Or(t,e){return jo(t&&t.attachers,e)}function Ar(t,e,n){if(t){var o=t.attachers;o||(t.attachers=o=[]),Mo(o,e,n)}}function Tr(e,t){m(t,function(t){e[t]&&delete e[t]})}function Lr(t,e,n,o,i,r){this._eventBus=t,this._canvas=e,this._selection=n,this._elementFactory=o,this._modeling=i,this._rules=r}function Dr(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var o=this;t.on("diagram.init",function(){o.registerHandlers(n)})}function Ir(t,e,n,o,i){this.canvas=i,this._textRenderer=o,Dr.call(this,t,e,n)}Rr.prototype.preExecute=function(t){var r=this._modeling,a=t.groups,c=t.axis,s=t.dimension;function u(t,e){t.range.min=Math.min(e[c],t.range.min),t.range.max=Math.max(e[c]+e[s],t.range.max)}function l(t){return t[c]+t[s]/2}function h(t){return t.length-1}function p(t){return t.max-t.min}var d,e,f=a[0],v=h(a),y=a[v],g=0;m(a,function(o,t){var e,n,i;o.elements.length<2?t&&t!==a.length-1&&(u(o,o.elements[0]),g+=p(o.range)):(n=(e=b(o.elements,c))[0],t===v&&(n=e[h(e)]),i=l(n),o.range=null,m(e,function(t){var e,n;(n={y:0})[c]=i-l(e=t),n[c]&&(n[zr[c]]=0,r.moveElements([e],n,e.parent)),null!==o.range?u(o,t):o.range={min:t[c],max:t[c]+t[s]}}),t&&t!==a.length-1&&(g+=p(o.range)))}),e=Math.abs(y.range.min-f.range.max),(d=Math.round((e-g)/(a.length-1)))<a.length-1||m(a,function(n,t){var o,i={};n!==f&&n!==y&&(o=a[t-1],n.range.max=0,m(n.elements,function(t,e){i[zr[c]]=0,i[c]=o.range.max-t[c]+d,n.range.min!==t[c]&&(i[c]+=t[c]-n.range.min),i[c]&&r.moveElements([t],i,t.parent),n.range.max=Math.max(t[c]+t[s],e?n.range.max:0)}))})},Rr.prototype.postExecute=function(t){},Br.$inject=["modeling","canvas"],Br.prototype.preExecute=function(t){var n=this._modeling,e=t.elements,o=t.alignment;m(e,function(t){var e={x:0,y:0};o.left?e.x=o.left-t.x:o.right?e.x=o.right-t.width-t.x:o.center?e.x=o.center-Math.round(t.width/2)-t.x:o.top?e.y=o.top-t.y:o.bottom?e.y=o.bottom-t.height-t.y:o.middle&&(e.y=o.middle-Math.round(t.height/2)-t.y),n.moveElements([t],e,t.parent)})},Br.prototype.postExecute=function(t){},Pr.$inject=["modeling"],Pr.prototype.execute=function(t){var e=t.shape,n=t.newHost,o=e.host;return t.oldHost=o,t.attacherIdx=Or(o,e),Ar(n,e),e.host=n,e},Pr.prototype.revert=function(t){var e=t.shape,n=t.newHost,o=t.oldHost,i=t.attacherIdx;return e.host=o,Or(n,e),Ar(o,e,i),e},Lr.$inject=["eventBus","canvas","selection","elementFactory","modeling","rules"],Lr.prototype.preExecute=function(t){var c=this._eventBus,s=this,u=t.tree,l=t.topParent,h=t.position;u.createdElements={},u.labels=[],m(u,function(t,e){var a=parseInt(e,10);isNaN(a)||(a||(t=x(t,function(t){return t.parent=l,t})),m(t=b(t,"priority"),function(t){var e,n=t.id,o=t.parent,i={},r=R({},t);if(a&&(r.parent=s._getCreatedElement(o,u)),o)if(c.fire("element.paste",{createdElements:u.createdElements,descriptor:r}),o=r.parent,r.waypoints)(r=s._createConnection(r,o,h,u))&&(u.createdElements[n]={element:r,descriptor:t});else{if(r.parent!==l&&(i.root=!1),r.host&&(i.attach=!0,o=s._getCreatedElement(r.host,u)),r.labelTarget)return u.labels.push(r);e={x:Math.round(h.x+r.delta.x+r.width/2),y:Math.round(h.y+r.delta.y+r.height/2)},Tr(r,["id","parent","delta","host","priority"]),(r=s._createShape(r,o,e,i))&&(u.createdElements[n]={element:r,descriptor:t})}}))})},Lr.prototype.postExecute=function(t){var r=this._modeling,e=this._selection,a=this,c=t.tree,n=c.labels,o=[];m(n,function(e){var t,n,o,i=a._getCreatedElement(e.labelTarget,c);i&&(t=i.labels)&&t.length&&(n={x:i.x,y:i.y},i.waypoints&&(n=i.waypoints[0]),m(t,function(t){o={x:Math.round(n.x-t.x+e.delta.x),y:Math.round(n.y-t.y+e.delta.y)},r.moveShape(t,o,i.parent)}))}),m(c[0],function(t){var e=t.id,n=c.createdElements[e];n&&o.push(n.element)}),e.select(o)},Lr.prototype._createConnection=function(n,t,o,e){var i,r,a=this._modeling,c=this._rules;return n.waypoints=x(n.waypoints,function(t,e){return{x:Math.round(o.x+n.delta[e].x),y:Math.round(o.y+n.delta[e].y)}}),i=this._getCreatedElement(n.source,e),r=this._getCreatedElement(n.target,e),i&&r&&c.allowed("element.paste",{source:i,target:r})?(Tr(n,["id","parent","delta","source","target","width","height","priority"]),a.createConnection(i,r,n,t)):null},Lr.prototype._createShape=function(t,e,n,o,i){var r=this._modeling,a=this._elementFactory;if(!this._rules.allowed("element.paste",{element:t,position:n,parent:e}))return null;var c=a.createShape(t);return r.createShape(c,n,e,o,i),c},Lr.prototype._getCreatedElement=function(t,e){return e.createdElements[t]&&e.createdElements[t].element},Dr.$inject=["eventBus","elementFactory","commandStack"],Dr.prototype.getHandlers=function(){return{"shape.append":tr,"shape.create":nr,"shape.delete":or,"shape.move":dr,"shape.resize":fr,"shape.replace":vr,"shape.toggleCollapse":yr,spaceTool:gr,"label.create":mr,"connection.create":wr,"connection.delete":br,"connection.move":Er,"connection.layout":Sr,"connection.updateWaypoints":kr,"connection.reconnectStart":Cr,"connection.reconnectEnd":Cr,"elements.move":jr,"elements.delete":Mr,"elements.distribute":Rr,"elements.align":Br,"element.updateAttachment":Pr,"elements.paste":Lr}},Dr.prototype.registerHandlers=function(n){m(this.getHandlers(),function(t,e){n.registerHandler(e,t)})},Dr.prototype.moveShape=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=null);var r={shape:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("shape.move",r)},Dr.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)},Dr.prototype.moveElements=function(t,e,n,o){var i,r=(o=o||{}).attach,a=n;!0===r?a=(i=n).parent:!1===r&&(i=null);var c={shapes:t,delta:e,newParent:a,newHost:i,hints:o};this._commandStack.execute("elements.move",c)},Dr.prototype.moveConnection=function(t,e,n,o,i){"object"==typeof o&&(i=o,o=void 0);var r={connection:t,delta:e,newParent:n,newParentIndex:o,hints:i||{}};this._commandStack.execute("connection.move",r)},Dr.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)},Dr.prototype.createConnection=function(t,e,n,o,i,r){"object"==typeof n&&(r=i,i=o,o=n,n=void 0);var a={source:t,target:e,parent:i,parentIndex:n,connection:o=this._create("connection",o),hints:r};return this._commandStack.execute("connection.create",a),a.connection},Dr.prototype.createShape=function(t,e,n,o,i){"number"!=typeof o&&(i=o,o=void 0);var r,a,c=(i=i||{}).attach;t=this._create("shape",t),c?(r=n.parent,a=n):r=n;var s={position:e,shape:t,parent:r,parentIndex:o,host:a,hints:i};return this._commandStack.execute("shape.create",s),s.shape},Dr.prototype.createLabel=function(t,e,n,o){n=this._create("label",n);var i={labelTarget:t,position:e,parent:o||t.parent,shape:n};return this._commandStack.execute("label.create",i),i.shape},Dr.prototype.appendShape=function(t,e,n,o,i){i=i||{};var r={source:t,position:n,target:o,shape:e=this._create("shape",e),connection:i.connection,connectionParent:i.connectionParent,attach:i.attach};return this._commandStack.execute("shape.append",r),r.shape},Dr.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)},Dr.prototype.distributeElements=function(t,e,n){var o={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",o)},Dr.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)},Dr.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)},Dr.prototype.replaceShape=function(t,e,n){var o={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",o),o.newShape},Dr.prototype.pasteElements=function(t,e,n){var o={tree:t,topParent:e,position:n};this._commandStack.execute("elements.paste",o)},Dr.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)},Dr.prototype.resizeShape=function(t,e,n){var o={shape:t,newBounds:e,minBounds:n};this._commandStack.execute("shape.resize",o)},Dr.prototype.createSpace=function(t,e,n,o){var i={movingShapes:t,resizingShapes:e,delta:n,direction:o};this._commandStack.execute("spaceTool",i)},Dr.prototype.updateWaypoints=function(t,e,n){var o={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",o)},Dr.prototype.reconnectStart=function(t,e,n){var o={connection:t,newSource:e,dockingOrPoints:n};this._commandStack.execute("connection.reconnectStart",o)},Dr.prototype.reconnectEnd=function(t,e,n){var o={connection:t,newTarget:e,dockingOrPoints:n};this._commandStack.execute("connection.reconnectEnd",o)},Dr.prototype.connect=function(t,e,n,o){return this.createConnection(t,e,n||{},t.parent,o)},Dr.prototype._create=function(t,e){return e instanceof bi?e:this._elementFactory.create(t,e)},Dr.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)},Co(Ir,Dr),Ir.$inject=["eventBus","elementFactory","commandStack","textRenderer","canvas"],Ir.prototype.getHandlers=function(){var t=Dr.prototype.getHandlers.call(this);return t["element.updateLabel"]=Xi,t["layout.connection.labels"]=Qi,t["element.hide"]=Ji,t},Ir.prototype.updateLabel=function(t,e){this._commandStack.execute("element.updateLabel",{element:t,newLabel:e})},Ir.prototype.connect=function(t,e,n,o,i){return this.createConnection(t,e,R({connectionType:n},o),t.parent)},Ir.prototype.hide=function(t){var e={element:t};this._commandStack.execute("element.hide",e)};var $r={__init__:["umlUpdater","modeling"],__depends__:[ui],connectionDocking:["type",hi],elementFactory:["type",Ri],modeling:["type",Ir],umlUpdater:["type",Yi],layouter:["type",Ui]},Nr="drop-ok",Hr="drop-not-ok",Fr="attach-ok",Gr="new-parent";function Wr(e,o,t,r,a,c){function i(e,n){[Fr,Nr,Hr,Gr].forEach(function(t){t===n?r.addMarker(e,t):r.removeMarker(e,t)})}e.on("create.move",function(t){var e,n=t.context,o=t.hover;n.shape,t.x,t.y;e=n.canExecute=o,o&&null!==e&&(n.target=o,e&&e.attach?i(o,Fr):i(o,e?Gr:Hr))}),e.on("create.move",750,function(t){var e=t.context,n=e.shape,o=e.visual;o||(o=e.visual=function(t){var e,n,o;vt(e=jt("g"),a.cls("djs-drag-group",["no-events"])),ht(r.getDefaultLayer(),e),_t(n=jt("g")).add("djs-dragger"),ht(e,n),Ee(n,t.width/-2,t.height/-2);var i=jt("g");return _t(i).add("djs-visual"),ht(n,i),o=i,c.drawShape(o,t),e}(n)),Ee(o,t.x,t.y)}),e.on(["create.end","create.out","create.cleanup"],function(t){var e=t.context.target;e&&i(e,null)}),e.on("create.ended",function(t){e.fire("create."+t.context.type,{context:{bounds:{x:t.x,y:t.y,width:t.shape.width,height:t.shape.height}}})}),e.on("create.end",function(t){return!0}),e.on("create.cleanup",function(t){var e=t.context;e.visual&&bt(e.visual)}),this.start=function(t,e,n){o.init(t,"create",{cursor:"grabbing",autoActivate:!0,data:{shape:e,context:{shape:e,type:n}}})}}Wr.$inject=["eventBus","dragging","modeling","canvas","styles","graphicsFactory"];var Vr={__depends__:[me],create:["type",Wr]};function qr(t,e,n,o,i,r){this._create=t,this._elementFactory=e,this._lassoTool=n,this._palette=o,this._textRenderer=i,this._eventBus=r,o.registerProvider(this)}qr.$inject=["create","elementFactory","lassoTool","palette","textRenderer","eventBus"],qr.prototype.getPaletteEntries=function(){var r=this._create,a=this._elementFactory,e=this._lassoTool;this._textRenderer,this._eventBus;function t(n,t,e,o){function i(t){var e=a.createClass({width:200,height:100,name:"Name"});r.start(t,e,n)}return{group:t,className:e,title:o,action:{dragstart:i,click:i}}}return{"lasso-tool":{group:"tools",className:"palette-icon-lasso-tool",title:"Activate Lasso Tool",action:{click:function(t){e.activateSelection(t)}}},"tool-separator":{group:"tools",separator:!0},"create-class":t("class","create","palette-icon-create-class","Create Class"),"create-enumeration":t("enumeration","create","palette-icon-create-enumeration","Create Enumeration")}};var Ur={__depends__:[Vr,$e,Le],__init__:["paletteProvider"],paletteProvider:["type",qr]},Yr={__depends__:[ui,Lo,oe,re],__init__:["modeling"],modeling:["type",Dr],layouter:["type",zi]};function Xr(t,e,n,o){this._connect=t,this._modeling=n,this._eventBus=o,(this._contextPad=e).registerProvider(this)}Xr.$inject=["connect","contextPad","modeling","eventBus"],Xr.prototype.getContextPadEntries=function(t){var n=this._modeling,o=this._connect,i=this._eventBus,r=this._contextPad;function e(t,e){i.fire("delete.element",{context:{element:e}})}function a(t,e,n){o.start(t,e,n)}function c(t,e){R(t,{context:{shape:e}}),i.fire("create.class.property",t)}function s(t,e){n.hide(e),r.close()}function u(n,t){return{group:"add",className:"context-pad-icon-"+n,title:t,action:{click:function(t,e){a(t,e,n)},dragstart:function(t,e){a(t,e,n)}}}}var l={delete:{group:"admin",className:"context-pad-icon-delete",title:"Remove",action:{click:e,dragstart:e}},hide:{group:"admin",className:"context-pad-icon-hide",title:"Hide Part",action:{click:s}}};return t instanceof Ei&&!(t instanceof ki)&&("stereotypes"in t&&-1!=t.stereotypes.indexOf("enumeration")||R(l,{"inheritance-connection":u("inheritance","Inheritance Connection"),"composition-connection":u("composition","Composition Connection"),"association-connection":u("association","Association Connection"),"create-property":{group:"add",className:"context-pad-icon-create-property",title:"Create Property",action:{click:c}}}),t.isImported&&R(l,{goto:{group:"admin",className:"context-pad-icon-goto",title:"Go to",action:{click:function(t,e){i.fire("element.goto",{context:{element:e}})}}}})),l};var Kr={__depends__:[tn,ci,Yr],__init__:["contextPadProvider"],contextPadProvider:["type",Xr]};function Zr(t){Bo.call(this,t),this.init()}function Qr(t){Zr.call(this,t)}Zr.$inject=["eventBus"],Co(Zr,Bo),Zr.prototype.addRule=function(t,e,o){var n=this;"string"==typeof t&&(t=[t]),t.forEach(function(t){n.canExecute(t,e,function(t,e,n){return o(t)},!0)})},Zr.prototype.init=function(){},Co(Qr,Zr),Qr.$inject=["eventBus"],Qr.prototype.init=function(){this.addRule("shape.resize",function(t){var e=t.shape;return e instanceof Ei&&!(e instanceof ki)}),this.addRule("elements.move",function(t){return!t.shapes.some(function(t){return t instanceof ki})&&!(t.target instanceof ki||t.target instanceof Ei&&!(t.target instanceof Si))})};var Jr={__depends__:[re],__init__:["umlRulesProvider"],umlRulesProvider:["type",Qr]};function ta(t){return Math.log(t)/Math.log(10)}function ea(t,e){var n=ta(t.min),o=ta(t.max);return(Math.abs(n)+Math.abs(o))/e}var na=Math.sign||function(t){return 0<=t?1:-1},oa={min:.2,max:4};function ia(e,t,n){e=e||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=j(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||.75;var o=this;t.on("canvas.init",function(t){o._init(!1!==e.enabled)})}ia.$inject=["config.zoomScroll","eventBus","canvas"],ia.prototype.scroll=function(t){this._canvas.scroll(t)},ia.prototype.reset=function(){this._canvas.zoom("fit-viewport")},ia.prototype.zoom=function(t,e){var n=ea(oa,20);this._totalDelta+=t,.1<Math.abs(this._totalDelta)&&(this._zoom(t,e,n),this._totalDelta=0)},ia.prototype._handleWheel=function(t){if(!H(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,o=t.ctrlKey,i=t.shiftKey,r=-1*this._scale;if(r*=o?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,o){var a=e.getBoundingClientRect(),c={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*na(t.deltaY)*r,this.zoom(n,c)}else n=i?{dx:r*t.deltaY,dy:0}:{dx:r*t.deltaX,dy:r*t.deltaY},this.scroll(n)}},ia.prototype.stepZoom=function(t,e){var n=ea(oa,10);this._zoom(t,e,n)},ia.prototype._zoom=function(t,e,n){var o=this._canvas,i=0<t?1:-1,r=ta(o.zoom()),a=Math.round(r/n)*n;a+=n*i;var c,s,u=Math.pow(10,a);o.zoom((c=oa,s=u,Math.max(c.min,Math.min(c.max,s))),e)},ia.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,o=this._enabled;return void 0===t&&(t=!o),o!==t&&V[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t},ia.prototype._init=function(t){this.toggle(t)};var ra={__init__:["zoomScroll"],zoomScroll:["type",ia]};function aa(r,a){var c;function e(t){var e,n=c.start,o=ct(t),i=pe(o,n);(!c.dragging&&(e=i,15<Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)))&&(c.dragging=!0,le(r),ce("grab")),c.dragging)&&(i=pe(o,c.last||c.start),a.scroll({dx:i.x,dy:i.y}),c.last=o);t.preventDefault()}function n(t){V.unbind(document,"mousemove",e),V.unbind(document,"mouseup",n),c=null,se()}r.on("element.mousedown",500,function(t){return function(t){if(H(t.target,".djs-draggable"))return;if(t.button||t.ctrlKey||t.shiftKey||t.altKey)return;return c={start:ct(t)},V.bind(document,"mousemove",e),V.bind(document,"mouseup",n),!0}(t.originalEvent)})}aa.$inject=["eventBus","canvas"];var ca={__init__:["moveCanvas"],moveCanvas:["type",aa]},sa=1e3;function ua(t,e){var r=this;e=e||sa,t.on(["render.shape","render.connection"],e,function(t,e){var n=t.type,o=e.element,i=e.gfx;if(r.canRender(o))return"render.shape"===n?r.drawShape(i,o):r.drawConnection(i,o)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(t,e){if(r.canRender(e))return"render.getShapePath"===t.type?r.getShapePath(e):r.getConnectionPath(e)})}function la(t,e,n,o){var i=o.createText(e,n);return _t(i).add("djs-label"),ht(t,i),i}function ha(t,e,n,o){var i,r,a,c,s=(i=e,r=n,a=o,c=jt("rect"),vt(c,{width:i,height:r}),va(c,a),c);return ht(t,s),s}function pa(t,e,n){var o,i,r=fa(e),a=da(fa(function(t){var e=t.length,n=t.slice();2<=e&&(n[0]=Ki(t[0],t[1],.1),n[e-1]=Ki(t[e-2],t[e-1],.9));return n}(e)),{stroke:"white","stroke-width":10}),c=da(r,n),s=(o=[a,c],i=jt("g"),o.forEach(function(t){ht(i,t)}),i);return ht(t,s),s}function da(t,e){var n,o,i=jt("path");return vt(i,{d:t}),function(t,e){"markerEnd"in e&&vt(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&vt(t,{"marker-start":"url(#"+e.markerStart+")"})}(i,e),n=i,"transform"in(o=e)&&vt(n,{transform:o.transform}),va(i,e),i}function fa(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function va(t,e){"stroke"in e&&vt(t,{stroke:e.stroke}),"stroke-width"in e&&vt(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&vt(t,{fill:e.fill}),"stroke-dasharray"in e&&vt(t,{"stroke-dasharray":e["stroke-dasharray"]})}function ya(n,t,o){t.businessObject;var e,i,r,a,c,s,u,l=ha(n,t.width,t.height,{fill:"none",stroke:"black"}),h=R({dy:".75em"},{x:t.width/2,"text-anchor":"middle"});if(h.y=5,"stereotypes"in t&&t.stereotypes.forEach(function(t){var e=la(n,"&lt;&lt;"+t+"&gt;&gt;",h,o);h.y+=e.getBBox().height}),"name"in t){var p=la(n,t.name,h,o);h.y+=p.getBBox().height}return t.labels.some(function(t){return"property"===t.labelType||"classifier"===t.labelType})&&"name"in t&&(e=n,i=t.width,r=h.y,a=e,c={x:0,y:r},s={x:i,y:r},vt(u=jt("line"),{x1:c.x,y1:c.y,x2:s.x,y2:s.y,stroke:"black"}),ht(a,u)),l}function ga(t,e,n){return la(t,e.businessObject+"",{dy:".75em"},n)}function ma(t,e){return Sa(t,e,{stroke:"black",markerEnd:"association-marker"})}function xa(t,e){return Sa(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function _a(t,e){return Sa(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function wa(t,e){return Sa(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function ba(t,e){return Sa(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function Ea(t,e){return Sa(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function Sa(t,e,n){return pa(t,e.waypoints,n)}ua.prototype.canRender=function(){},ua.prototype.drawShape=function(){},ua.prototype.drawConnection=function(){},ua.prototype.getShapePath=function(){},ua.prototype.getConnectionPath=function(){};var ka=[{name:"association-marker",element:da("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:da("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:da("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:da("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:da("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:da("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function Ca(t,e,n,o){var i,r=jt("marker");ht(r,n),vt(r,{id:e,viewBox:"0 0 10 10",refX:(i=o,i?0:10),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),ht(t,r)}function ja(t,e,n){var o,i;ua.call(this,t),this.textRenderer=n,this.drawShapeHandlers={class:ya,label:ga},this.drawConnectionHandlers={association:ma,inheritance:xa,realization:_a,dependency:wa,aggregation:ba,composition:Ea},(i=et("defs",(o=e)._svg))||(i=jt("defs"),ht(o._svg,i)),ka.forEach(function(t){var e=t.element.cloneNode(!0);Ca(i,t.name,t.element,!1),Ca(i,t.name+"-reversed",e,!0)})}function Ma(){this._style={fontFamily:"DroidSansMono",fontSize:12}}Co(ja,ua),ja.$inject=["eventBus","canvas","textRenderer"],ja.prototype.canRender=function(t){return!0},ja.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},ja.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},ja.prototype.getShapePath=function(t){return n=(e=t).x,o=e.y,i=e.width,$t([["M",n,o],["l",i,0],["l",0,e.height],["l",-i,0],["z"]]);var e,n,o,i},Ma.prototype.createText=function(t,e){var n=jt("text");return vt(n,e=R(e,this._style)),Dt(n,t),n},Ma.prototype.getDimensions=function(t,e){var n,o=jt("text");vt(o,this._style),ht(document.getElementById("helper-svg")||(vt(n=jt("svg"),{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(n),n),o),o.textContent=t;var i=o.getBBox();return bt(o),i},Ma.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},Ma.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var Ra={__init__:["umlRenderer"],umlRenderer:["type",ja],textRenderer:["type",Ma]};function za(t,e,n,o,i,r){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=o,this.layouter=i,this.commandStack=r}function Ba(t,e,n){t in e&&(n[t]=e[t])}function Pa(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}za.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],za.prototype.import=function(t){this.textRenderer;var e=this.elementFactory,n=this.canvas,o=this.modeling,i=(this.layouter,this.commandStack,e.createRoot());n.setRootElement(i);var r,a,c,s,u,l,h,p=(r=t.graph.nodes,a=i,c=o,new Map(r.map(function(t){t.businessObject;var e,n,o,i=t.id;return[i,(e=a,n=t,o=c,delete n.id,o.createClass(n,e))]})));s=t.graph.edges,u=p,l=i,h=o,s.forEach(function(t){var e,n,o,i,r,a,c={connectionType:t.type,waypoints:(o=t,i=u,r="waypoints"in o?qi(o.waypoints):$i(Pa(i.get(o.source)),Pa(i.get(o.target))),(a=r).forEach(function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)}),a)};R(c,(Ba("sourceName",e=t,n={}),Ba("targetName",e,n),Ba("sourceCardinality",e,n),Ba("targetCardinality",e,n),n)),h.createConnection(u.get(t.source),u.get(t.target),c,l)})};var Oa={__depends__:[Ra,{umlImporter:["type",za]}]},Aa=/^class /;function Ta(t){return"[object Array]"===Object.prototype.toString.call(t)}function La(){var t=Array.prototype.slice.call(arguments);1===t.length&&Ta(t[0])&&(t=t[0]);var e=t.pop();return e.$inject=t,e}var Da=/constructor\s*[^(]*\(\s*([^)]*)\)/m,Ia=/^function\s*[^(]*\(\s*([^)]*)\)/m,$a=/\/\*([^*]*)\*\//m;function Na(t){if("function"!=typeof t)throw new Error('Cannot annotate "'+t+'". Expected a function!');var e,n=t.toString().match((e=t,Aa.test(e.toString())?Da:Ia));return n&&n[1]&&n[1].split(",").map(function(t){return(n=t.match($a))?n[1].trim():t.trim()})||[]}var Ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function Fa(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function Ga(t,r){r=r||{get:function(t,e){if(a.push(t),!1===e)return null;throw s('No provider for "'+t+'"!')}};var a=[],p=this._providers=Object.create(r._providers||null),c=this._instances=Object.create(null),d=c.injector=this,s=function(t){var e=a.join(" -> ");return a.length=0,new Error(e?t+" (Resolving: "+e+")":t)},n=function t(e,n){if(!p[e]&&-1!==e.indexOf(".")){for(var o=e.split("."),i=t(o.shift());o.length;)i=i[o.shift()];return i}if(Wa(c,e))return c[e];if(Wa(p,e)){if(-1!==a.indexOf(e))throw a.push(e),s("Cannot resolve circular dependency!");return a.push(e),c[e]=p[e][0](p[e][1]),a.pop(),c[e]}return r.get(e,n)},u=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("function"!=typeof t){if(!Ta(t))throw new Error('Cannot invoke "'+t+'". Expected a function!');t=La(t.slice())}return{fn:t,dependencies:(t.$inject||Na(t)).map(function(t){return Wa(e,t)?e[t]:n(t)})}},e=function(t){var e=u(t),n=e.dependencies,o=e.fn;return new(Function.prototype.bind.apply(o,[null].concat(Fa(n))))},o=function(t,e,n){var o=u(t,n),i=o.dependencies,r=o.fn;return r.call.apply(r,[e].concat(Fa(i)))},f=function(e){return La(function(t){return e.get(t)})},l={factory:o,type:e,value:function(t){return t}};t.forEach(function(o){function i(t,e){return"value"!==t&&Ta(e)&&(e=La(e.slice())),e}if(o instanceof function(){var n=[];this.factory=function(t,e){return n.push([t,"factory",e]),this},this.value=function(t,e){return n.push([t,"value",e]),this},this.type=function(t,e){return n.push([t,"type",e]),this},this.forEach=function(t){n.forEach(t)}})o.forEach(function(t){var e=t[0],n=t[1],o=t[2];p[e]=[l[n],i(n,o),n]});else if("object"===(void 0===o?"undefined":Ha(o)))if(o.__exports__){var t=Object.keys(o).reduce(function(t,e){return"__"!==e.substring(0,2)&&(t[e]=o[e]),t},Object.create(null)),e=new Ga((o.__modules__||[]).concat([t]),d),n=La(function(t){return e.get(t)});o.__exports__.forEach(function(t){p[t]=[n,t,"private",e]})}else Object.keys(o).forEach(function(t){if("private"!==o[t][2]){var e=o[t][0],n=o[t][1];p[t]=[l[e],i(e,n),e]}else p[t]=o[t]})}),this.get=n,this.invoke=o,this.instantiate=e,this.createChild=function(t,e){if(e&&e.length){var n,o,i,r,a=Object.create(null),c=Object.create(null),s=[],u=[],l=[];for(var h in p)n=p[h],-1!==e.indexOf(h)&&("private"===n[2]?(o=s.indexOf(n[3]),a[h]=-1===o?(i=n[3].createChild([],e),r=f(i),s.push(n[3]),u.push(i),l.push(r),[r,h,"private",i]):[l[o],h,"private",u[o]]):a[h]=[n[2],n[1]],c[h]=!0),"factory"!==n[2]&&"type"!==n[2]||!n[1].$scope||e.forEach(function(t){-1!==n[1].$scope.indexOf(t)&&(a[h]=[n[2],n[1]],c[t]=!0)});e.forEach(function(t){if(!c[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')}),t.unshift(a)}return new Ga(t,d)}}function Wa(t,e){return Object.hasOwnProperty.call(t,e)}function Va(t,e){ua.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2})}Co(Va,ua),Va.prototype.canRender=function(){return!0},Va.prototype.drawShape=function(t,e){var n=jt("rect");return vt(n,{x:0,y:0,width:e.width||0,height:e.height||0}),vt(n,this.SHAPE_STYLE),ht(t,n),n},Va.prototype.drawConnection=function(t,e){var n=Ht(e.waypoints,this.CONNECTION_STYLE);return ht(t,n),n},Va.prototype.getShapePath=function(t){var e=t.x,n=t.y,o=t.width;return $t([["M",e,n],["l",o,0],["l",0,t.height],["l",-o,0],["z"]])},Va.prototype.getConnectionPath=function(t){var e,n,o=t.waypoints,i=[];for(e=0;n=o[e];e++)n=n.original||n,i.push([0===e?"M":"L",n.x,n.y]);return $t(i)},Va.$inject=["eventBus","styles"];var qa={__init__:["defaultRenderer"],defaultRenderer:["type",Va],styles:["type",function(){var o={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},i=this;this.cls=function(t,e,n){return R(this.style(e,n),{class:t})},this.style=function(t,e){h(t)||e||(e=t,t=[]);var n=r(t,function(t,e){return R(t,o[e]||{})},{});return e?R(n,e):n},this.computeStyle=function(t,e,n){return h(e)||(n=e,e=[]),i.style(e||[],R({},n,t||{}))}}]};function Ua(t,e){return Math.round(t*e)/e}function Ya(t){return d(t)?t+"px":t}function Xa(t,e,n){var o=jt("g");_t(o).add(e);var i=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(o,t.childNodes[i]||null),o}var Ka={shape:["x","y","width","height"],connection:["waypoints"]};function Za(t,e,n,o){this._eventBus=e,this._elementRegistry=o,this._graphicsFactory=n,this._init(t||{})}function Qa(t,e){var n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}Za.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Za.prototype._init=function(t){var e,n,o,i=this._eventBus,r=this._container=(n=(e=R({},{width:"100%",height:"100%"},e=t)).container||document.body,(o=document.createElement("div")).setAttribute("class","djs-container"),R(o.style,{position:"relative",overflow:"hidden",width:Ya(e.width),height:Ya(e.height)}),n.appendChild(o),o),a=this._svg=jt("svg");vt(a,{width:"100%",height:"100%"}),ht(r,a);var c=this._viewport=Xa(a,"viewport");!(this._layers={})!==t.deferUpdate&&(this._viewboxChanged=function(n,o){var i,r,a,c;function e(){var t=Date.now(),e=c+o-t;if(0<e)return s(e);n.apply(a,r),i=c=r=a=void 0}function s(t){i=setTimeout(e,t)}return function(){c=Date.now();for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];r=e,a=this,i||s(o)}}(j(this._viewboxChanged,this),300)),i.on("diagram.init",function(){i.fire("canvas.init",{svg:a,viewport:c})},this),i.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed"],function(){delete this._cachedViewbox},this),i.on("diagram.destroy",500,this._destroy,this),i.on("diagram.clear",500,this._clear,this)},Za.prototype._destroy=function(t){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var e=this._container.parentNode;e&&e.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._rootElement,delete this._viewport},Za.prototype._clear=function(){var n=this;this._elementRegistry.getAll().forEach(function(t){var e=Xt(t);"root"===e?n.setRootElement(null,!0):n._removeElement(t,e)}),delete this._cachedViewbox},Za.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Za.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");var n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},Za.prototype._createLayer=function(t,n){n||(n=0);var e=r(this._layers,function(t,e){return n>=e.index&&t++,t},0);return{group:Xa(this._viewport,"layer-"+t,e),index:n}},Za.prototype.getContainer=function(){return this._container},Za.prototype._updateMarker=function(t,e,n){var o;t.id||(t=this._elementRegistry.get(t)),(o=this._elementRegistry._elements[t.id])&&(m([o.gfx,o.secondaryGfx],function(t){t&&(n?_t(t).add(e):_t(t).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:o.gfx,marker:e,add:!!n}))},Za.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},Za.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},Za.prototype.hasMarker=function(t,e){return t.id||(t=this._elementRegistry.get(t)),_t(this.getGraphics(t)).has(e)},Za.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},Za.prototype.getRootElement=function(){return this._rootElement||this.setRootElement({id:"__implicitroot",children:[]}),this._rootElement},Za.prototype.setRootElement=function(t,e){t&&this._ensureValid("root",t);var n=this._rootElement,o=this._elementRegistry,i=this._eventBus;if(n){if(!e)throw new Error("rootElement already set, need to specify override");i.fire("root.remove",{element:n}),i.fire("root.removed",{element:n}),o.remove(n)}if(t){var r=this.getDefaultLayer();i.fire("root.add",{element:t}),o.add(t,r,this._svg),i.fire("root.added",{element:t,gfx:r})}return this._rootElement=t},Za.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element with id "+e.id+" already exists");var n=Ka[t];if(!o(n,function(t){return void 0!==e[t]}))throw new Error("must supply { "+n.join(", ")+" } with "+t)},Za.prototype._setParent=function(t,e,n){Mo(e.children,t,n),t.parent=e},Za.prototype._addElement=function(t,e,n,o){n=n||this.getRootElement();var i=this._eventBus,r=this._graphicsFactory;this._ensureValid(t,e),i.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,o);var a=r.create(t,e,o);return this._elementRegistry.add(e,a),r.update(t,e,a),i.fire(t+".added",{element:e,gfx:a}),e},Za.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},Za.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},Za.prototype._removeElement=function(t,e){var n=this._elementRegistry,o=this._graphicsFactory,i=this._eventBus;if(t=n.get(t.id||t))return i.fire(e+".remove",{element:t}),o.remove(t),jo(t.parent&&t.parent.children,t),t.parent=null,i.fire(e+".removed",{element:t}),n.remove(t),t},Za.prototype.removeShape=function(t){return this._removeElement(t,"shape")},Za.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},Za.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},Za.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Za.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Za.prototype.viewbox=function(e){if(void 0===e&&this._cachedViewbox)return this._cachedViewbox;var t,n,o,i,r,a,c=this._viewport,s=this.getSize();return e?(this._changeViewbox(function(){i=Math.min(s.width/e.width,s.height/e.height);var t=this._svg.createSVGMatrix().scale(i).translate(-e.x,-e.y);It(c,t)}),e):(t=this.getDefaultLayer().getBBox(),n=(o=It(c))?o.matrix:function(t,e,n,o,i,r){var a=Mt.createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return Rt(a,t);case 6:return Rt(a,{a:t,b:e,c:n,d:o,e:i,f:r})}}(),i=Ua(n.a,1e3),r=Ua(-n.e||0,1e3),a=Ua(-n.f||0,1e3),e=this._cachedViewbox={x:r?r/i:0,y:a?a/i:0,width:s.width/i,height:s.height/i,scale:i,inner:{width:t.width,height:t.height,x:t.x,y:t.y},outer:s})},Za.prototype.scroll=function(t){var e=this._viewport,n=e.getCTM();return t&&this._changeViewbox(function(){t=R({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),Qa(e,n)}),{x:n.e,y:n.f}},Za.prototype.zoom=function(t,e){return t?"fit-viewport"===t?this._fitViewport(e):(this._changeViewbox(function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),o=this._setZoom(t,e)}),Ua(o.a,1e3)):this.viewbox(t).scale;var n,o},Za.prototype._fitViewport=function(t){var e,n,o=this.viewbox(),i=o.outer,r=o.inner;return n=0<=r.x&&0<=r.y&&r.x+r.width<=i.width&&r.y+r.height<=i.height&&!t?{x:0,y:0,width:Math.max(r.width+r.x,i.width),height:Math.max(r.height+r.y,i.height)}:(e=Math.min(1,i.width/r.width,i.height/r.height),{x:r.x+(t?r.width/2-i.width/e/2:0),y:r.y+(t?r.height/2-i.height/e/2:0),width:i.width/e,height:i.height/e}),this.viewbox(n),this.viewbox(!1).scale},Za.prototype._setZoom=function(t,e){var n,o,i,r,a=this._svg,c=this._viewport,s=a.createSVGMatrix(),u=a.createSVGPoint(),l=(o=c.getCTM()).a;return r=e?(n=R(u,e).matrixTransform(o.inverse()),i=s.translate(n.x,n.y).scale(1/l*t).translate(-n.x,-n.y),o.multiply(i)):s.scale(t),Qa(this._viewport,r),r},Za.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Za.prototype.getAbsoluteBBox=function(t){var e,n=this.viewbox();t.waypoints?e=this.getGraphics(t).getBBox():e=t;return{x:e.x*n.scale-n.x*n.scale,y:e.y*n.scale-n.y*n.scale,width:e.width*n.scale,height:e.height*n.scale}},Za.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Ja="data-element-id";function tc(t){this._elements={},this._eventBus=t}tc.$inject=["eventBus"],tc.prototype.add=function(t,e,n){var o=t.id;this._validateId(o),vt(e,Ja,o),n&&vt(n,Ja,o),this._elements[o]={element:t,gfx:e,secondaryGfx:n}},tc.prototype.remove=function(t){var e=this._elements,n=t.id||t,o=n&&e[n];o&&(vt(o.gfx,Ja,""),o.secondaryGfx&&vt(o.secondaryGfx,Ja,""),delete e[n])},tc.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),o=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,o)},tc.prototype.get=function(t){var e;e="string"==typeof t?t:t&&vt(t,Ja);var n=this._elements[e];return n&&n.element},tc.prototype.filter=function(n){var o=[];return this.forEach(function(t,e){n(t,e)&&o.push(t)}),o},tc.prototype.getAll=function(){return this.filter(function(t){return t})},tc.prototype.forEach=function(i){var r=this._elements;Object.keys(r).forEach(function(t){var e=r[t],n=e.element,o=e.gfx;return i(n,o)})},tc.prototype.getGraphics=function(t,e){var n=t.id||t,o=this._elements[n];return o&&(e?o.secondaryGfx:o.gfx)},tc.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var ec="__fn",nc=Array.prototype.slice;function oc(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function ic(){}function rc(t,e){this._eventBus=t,this._elementRegistry=e}function ac(t,e,n){e.insertBefore(t,n||e.firstChild)}oc.prototype.on=function(t,e,n,o){if(t=h(t)?t:[t],f(e)&&(o=n,n=e,e=1e3),!d(e))throw new Error("priority must be a number");var i=n;o&&((i=j(n,o))[ec]=n[ec]||n);var r=this;t.forEach(function(t){r._addListener(t,{priority:e,callback:i,next:null})})},oc.prototype.once=function(e,t,n,o){var i=this;if(f(t)&&(o=n,n=t,t=1e3),!d(t))throw new Error("priority must be a number");function r(){var t=n.apply(o,arguments);return i.off(e,r),t}r[ec]=n,this.on(e,t,r)},oc.prototype.off=function(t,e){t=h(t)?t:[t];var n=this;t.forEach(function(t){n._removeListener(t,e)})},oc.prototype.createEvent=function(t){var e=new ic;return e.init(t),e},oc.prototype.fire=function(t,e){var n,o,i,r;if(r=nc.call(arguments),"object"==typeof t&&(t=(n=t).type),!t)throw new Error("no event type specified");if(o=this._listeners[t]){n=e instanceof ic?e:this.createEvent(e);var a=(r[0]=n).type;t!==a&&(n.type=t);try{i=this._invokeListeners(n,r,o)}finally{t!==a&&(n.type=a)}return void 0===i&&n.defaultPrevented&&(i=!1),i}},oc.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},oc.prototype._destroy=function(){this._listeners={}},oc.prototype._invokeListeners=function(t,e,n){for(var o;n&&!t.cancelBubble;)o=this._invokeListener(t,e,n),n=n.next;return o},oc.prototype._invokeListener=function(t,e,n){var o,i,r;try{i=n.callback,r=e,void 0!==(o=i.apply(null,r))&&(t.returnValue=o,t.stopPropagation()),!1===o&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener"),console.error(t.stack),t}return o},oc.prototype._addListener=function(t,e){var n,o=this._getListeners(t);if(o){for(;o;){if(o.priority<e.priority)return e.next=o,void(n?n.next=e:this._setListeners(t,e));o=(n=o).next}n.next=e}else this._setListeners(t,e)},oc.prototype._getListeners=function(t){return this._listeners[t]},oc.prototype._setListeners=function(t,e){this._listeners[t]=e},oc.prototype._removeListener=function(t,e){var n,o,i,r=this._getListeners(t);if(e)for(;r;)n=r.next,(i=r.callback)!==e&&i[ec]!==e||(o?o.next=n:this._setListeners(t,n)),o=r,r=n;else this._setListeners(t,null)},ic.prototype.stopPropagation=function(){this.cancelBubble=!0},ic.prototype.preventDefault=function(){this.defaultPrevented=!0},ic.prototype.init=function(t){R(this,t||{})},rc.$inject=["eventBus","elementRegistry"],rc.prototype._getChildren=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=n.parentNode.childNodes[1])||(_t(e=jt("g")).add("djs-children"),ht(n.parentNode,e)):e=n,e},rc.prototype._clear=function(t){var e=et(".djs-visual",t);return D(e),e},rc.prototype._createContainer=function(t,e,n){var o=jt("g");_t(o).add("djs-group"),void 0!==n?ac(o,e,e.childNodes[n]):ht(e,o);var i=jt("g");_t(i).add("djs-element"),_t(i).add("djs-"+t),ht(o,i);var r=jt("g");return _t(r).add("djs-visual"),ht(i,r),i},rc.prototype.create=function(t,e,n){var o=this._getChildren(e.parent);return this._createContainer(t,o,n)},rc.prototype.updateContainments=function(t){var o=this,i=this._elementRegistry;m(r(t,function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t},{}),function(t){var e=t.children;if(e){var n=o._getChildren(t);m(e.slice().reverse(),function(t){ac(i.getGraphics(t).parentNode,n)})}})},rc.prototype.drawShape=function(t,e){return this._eventBus.fire("render.shape",{gfx:t,element:e})},rc.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},rc.prototype.drawConnection=function(t,e){return this._eventBus.fire("render.connection",{gfx:t,element:e})},rc.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},rc.prototype.update=function(t,e,n){if(e.parent){var o=this._clear(n);if("shape"===t)this.drawShape(o,e),Ee(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(o,e)}e.hidden?vt(n,"display","none"):vt(n,"display","block")}},rc.prototype.remove=function(t){bt(this._elementRegistry.getGraphics(t).parentNode)};var cc={__depends__:[qa],__init__:["canvas"],canvas:["type",Za],elementRegistry:["type",tc],elementFactory:["type",Mi],eventBus:["type",oc],graphicsFactory:["type",rc]};function sc(t){var o=[],i=[];function r(t){return 0<=o.indexOf(t)}t.forEach(function t(e){var n;r(e)||((e.__depends__||[]).forEach(t),r(e)||(n=e,o.push(n),(e.__init__||[]).forEach(function(t){i.push(t)})))});var e=new Ga(o);return i.forEach(function(t){try{e["string"==typeof t?"get":"invoke"](t)}catch(t){throw console.error("Failed to instantiate component"),console.error(t.stack),t}}),e}function uc(t,e){var n;this.injector=e=e||sc([{config:["value",n=(n=t)||{}]},cc].concat(n.modules||[])),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function lc(t){this._container=this._createContainer(t),this._init(this._container,t)}function hc(t){lc.call(this,t)}return uc.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},uc.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},Co(lc,uc),lc.prototype._modules=[].concat(lc.prototype._coreModules=[Oa],lc.prototype._viewModules=[ra,ca]),lc.prototype.importJSON=function(t){this.get("umlImporter").import(t)},lc.prototype._createContainer=function(t){var e;return R((e=X("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},lc.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};uc.call(this,n),e&&e.parent&&this.attachTo(e.parent)},lc.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=et(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},lc.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},lc.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},Co(hc,lc),hc.prototype._modules=[].concat(hc.prototype._modules,hc.prototype._modelingModules=[oe,ze,Qt,Le,$e,Ve,tn,ci,re,Ur,Kr,Jr,$r,Ao,Lo,Ko,oi,ko]),hc});
