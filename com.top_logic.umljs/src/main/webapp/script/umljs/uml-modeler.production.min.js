!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).UmlJS=e()}(this,(function(){"use strict";function t(t){return Array.prototype.concat.apply([],t)}const e=Object.prototype.toString,n=Object.prototype.hasOwnProperty;function o(t){return void 0===t}function r(t){return void 0!==t}function i(t){return"[object Array]"===e.call(t)}function a(t){return"[object Object]"===e.call(t)}function c(t){return"[object Number]"===e.call(t)}function s(t){const n=e.call(t);return"[object Function]"===n||"[object AsyncFunction]"===n||"[object GeneratorFunction]"===n||"[object AsyncGeneratorFunction]"===n||"[object Proxy]"===n}function u(t){return"[object String]"===e.call(t)}function l(t,e){return n.call(t,e)}function h(t,e){const n=C(e);let o;return p(t,(function(t,e){if(n(t,e))return o=t,!1})),o}function d(t,e){const n=C(e);let o=[];return p(t,(function(t,e){n(t,e)&&o.push(t)})),o}function p(t,e){let n,r;if(o(t))return;const a=i(t)?M:j;for(let o in t)if(l(t,o)&&(n=t[o],r=e(n,a(o)),!1===r))return n}function f(t,e){if(o(t))return[];!function(t){if(!i(t))throw new Error("must supply array")}(t);const n=C(e);return t.filter((function(t,e){return!n(t,e)}))}function v(t,e,n){return p(t,(function(t,o){n=e(n,t,o)})),n}function y(t,e){return!!v(t,(function(t,n,o){return t&&e(n,o)}),!0)}function g(t,e){return!!h(t,e)}function m(t,e){let n=[];return p(t,(function(t,o){n.push(e(t,o))})),n}function x(t){return function(t){return t&&Object.keys(t)||[]}(t).length}function _(t){return m(t,(t=>t))}function w(t,e,n={}){return e=S(e),p(t,(function(t){let o=e(t)||"_",r=n[o];r||(r=n[o]=[]),r.push(t)})),n}function b(t,...e){t=S(t);let n={};return p(e,(e=>w(e,t,n))),m(n,(function(t,e){return t[0]}))}function E(t,e){e=S(e);let n=[];return p(t,(function(t,o){let r=e(t,o),i={d:r,v:t};for(var a=0;a<n.length;a++){let{d:t}=n[a];if(r<t)return void n.splice(a,0,i)}n.push(i)})),m(n,(t=>t.v))}function k(t){return function(e){return y(t,(function(t,n){return e[n]===t}))}}function S(t){return s(t)?t:e=>e[t]}function C(t){return s(t)?t:e=>e===t}function j(t){return t}function M(t){return Number(t)}function R(t,e){return t.bind(e)}function O(t,...e){return Object.assign(t,...e)}function P(t,e){let n={},o=Object(t);return p(e,(function(e){e in o&&(n[e]=t[e])})),n}function B(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}const z=Object.prototype.toString,T=Object.prototype.hasOwnProperty;function A(t,e){return T.call(t,e)}function L(t,e){let n,o;if(void 0===t)return;const r=function(t){return"[object Array]"===z.call(t)}(t)?I:D;for(let i in t)if(A(t,i)&&(n=t[i],o=e(n,r(i)),!1===o))return n}function D(t){return t}function I(t){return Number(t)}function $(t,...e){const n=t.style;return L(e,(function(t){t&&L(t,(function(t,e){n[e]=t}))})),t}function H(t,e,n){return 2==arguments.length?t.getAttribute(e):null===n?t.removeAttribute(e):(t.setAttribute(e,n),t)}const N=Object.prototype.toString;function F(t){return new G(t)}function G(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function W(t){for(var e;t.childNodes.length;)e=t.childNodes[0],t.removeChild(e);return t}function V(t,e){return t&&"function"==typeof t.matches&&t.matches(e)}function q(t,e,n){for(var o=n?t:t.parentNode;o&&o.nodeType!==document.DOCUMENT_NODE&&o.nodeType!==document.DOCUMENT_FRAGMENT_NODE;){if(V(o,e))return o;o=o.parentNode}return V(o,e)?o:null}G.prototype.add=function(t){return this.list.add(t),this},G.prototype.remove=function(t){return"[object RegExp]"==N.call(t)?this.removeMatching(t):(this.list.remove(t),this)},G.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},G.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},G.prototype.array=function(){return Array.from(this.list)},G.prototype.has=G.prototype.contains=function(t){return this.list.contains(t)};var U,Y,K,X={};function Z(){U=window.addEventListener?"addEventListener":"attachEvent",Y=window.removeEventListener?"removeEventListener":"detachEvent",K="addEventListener"!==U?"on":""}var Q=B({__proto__:null,bind:X.bind=function(t,e,n,o){return U||Z(),t[U](K+e,n,o||!1),n},unbind:X.unbind=function(t,e,n,o){return Y||Z(),t[Y](K+e,n,o||!1),n},default:X},[X]),J=["focus","blur"];var tt,et={bind:function(t,e,n,o,r){return-1!==J.indexOf(n)&&(r=!0),Q.bind(t,n,(function(n){var r=n.target||n.srcElement;n.delegateTarget=q(r,e,!0),n.delegateTarget&&o.call(t,n)}),r)},unbind:function(t,e,n,o){return-1!==J.indexOf(e)&&(o=!0),Q.unbind(t,e,n,o)}},nt=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var o=n[1];if("body"==o){return(r=e.createElement("html")).innerHTML=t,r.removeChild(r.lastChild)}var r,i=Object.prototype.hasOwnProperty.call(rt,o)?rt[o]:rt._default,a=i[0],c=i[1],s=i[2];(r=e.createElement("div")).innerHTML=c+t+s;for(;a--;)r=r.lastChild;if(r.firstChild==r.lastChild)return r.removeChild(r.firstChild);var u=e.createDocumentFragment();for(;r.firstChild;)u.appendChild(r.removeChild(r.firstChild));return u},ot=!1;"undefined"!=typeof document&&((tt=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',ot=!tt.getElementsByTagName("link").length,tt=void 0);var rt={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:ot?[1,"X<div>","</div>"]:[0,"",""]};rt.td=rt.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],rt.option=rt.optgroup=[1,'<select multiple="multiple">',"</select>"],rt.thead=rt.tbody=rt.colgroup=rt.caption=rt.tfoot=[1,"<table>","</table>"],rt.polyline=rt.ellipse=rt.polygon=rt.circle=rt.text=rt.line=rt.path=rt.rect=rt.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var it=nt;function at(t,e){return(e=e||document).querySelector(t)}function ct(t,e){return(e=e||document).querySelectorAll(t)}function st(t){t.parentNode&&t.parentNode.removeChild(t)}function ut(t){t&&"function"==typeof t.stopPropagation&&t.stopPropagation()}function lt(t){return t.originalEvent||t.srcEvent}function ht(t){ut(t),ut(lt(t))}function dt(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function pt(t,e){return(lt(t)||t).button===e}function ft(t){return pt(t,0)}function vt(t){var e=lt(t)||t;return!!ft(t)&&(/mac/i.test(navigator.platform)?e.metaKey:e.ctrlKey)}function yt(t){var e=lt(t)||t;return ft(t)&&e.shiftKey}function gt(t,e){return e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}function mt(t,e){return gt(e,t),t}var xt=2,_t={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":xt,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":xt,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function wt(t,e,n){var o=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=_t[o];r?(r===xt&&"number"==typeof n&&(n=String(n)+"px"),t.style[o]=n):t.setAttributeNS(null,e,n)}function bt(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return _t[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);wt(t,e,n)}else!function(t,e){var n,o,r=Object.keys(e);for(n=0;o=r[n];n++)wt(t,o,e[o])}(t,e);return t}const Et=Object.prototype.toString;function kt(t){return new St(t)}function St(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function Ct(t){var e=t.parentNode;return e&&e.removeChild(t),t}function jt(t){for(var e;e=t.firstChild;)Ct(e);return t}function Mt(t){return t.cloneNode(!0)}St.prototype.add=function(t){return this.list.add(t),this},St.prototype.remove=function(t){return"[object RegExp]"==Et.call(t)?this.removeMatching(t):(this.list.remove(t),this)},St.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},St.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},St.prototype.array=function(){return Array.from(this.list)},St.prototype.has=St.prototype.contains=function(t){return this.list.contains(t)};var Rt={svg:"http://www.w3.org/2000/svg"},Ot='<svg xmlns="'+Rt.svg+'"';function Pt(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(Rt.svg)&&(t=Ot+t.substring(4)):(t=Ot+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var o=document.createDocumentFragment(),r=n.firstChild;r.firstChild;)o.appendChild(r.firstChild);return o}function Bt(t,e){var n;return"<"===t.charAt(0)?(n=Pt(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(Rt.svg,t),e&&bt(n,e),n}var zt=null;function Tt(){return null===zt&&(zt=Bt("svg")),zt}function At(t,e){var n,o,r=Object.keys(e);for(n=0;o=r[n];n++)t[o]=e[o];return t}function Lt(t){return t?Tt().createSVGTransformFromMatrix(t):Tt().createSVGTransform()}var Dt=/([&<>]{1})/g,It=/([\n\r"]{1})/g,$t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function Ht(t,e){return t.replace(e,(function(t,e){return $t[e]||e}))}function Nt(t,e){var n,o,r,i,a;switch(t.nodeType){case 3:e.push(Ht(t.textContent,Dt));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(n=0,o=(r=t.attributes).length;n<o;++n)i=r.item(n),e.push(" ",i.name,'="',Ht(i.value,It),'"');if(t.hasChildNodes()){for(e.push(">"),n=0,o=(a=t.childNodes).length;n<o;++n)Nt(a.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("\x3c!--",Ht(t.nodeValue,Dt),"--\x3e");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function Ft(t,e){var n=Pt(e);if(jt(t),e){(function(t){return"#document-fragment"===t.nodeName})(n)||(n=n.documentElement);for(var o,r=(o=n.childNodes,Array.prototype.slice.call(o)),i=0;i<r.length;i++)gt(r[i],t)}}function Gt(t,e){if(void 0!==e){try{Ft(t,e)}catch(t){throw new Error("error parsing SVG: "+t.message)}return t}return function(t){for(var e=t.firstChild,n=[];e;)Nt(e,n),e=e.nextSibling;return n.join("")}(t)}function Wt(t,e){return e instanceof SVGMatrix?t.createSVGTransformFromMatrix(e):e}function Vt(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,o;for(t.clear(),n=0;o=e[n];n++)t.appendItem(Wt(t,o))}(n,e)),n.consolidate()}function qt(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function Ut(t){return["L",t.x,t.y]}function Yt(t,e){const n=t.length,o=[(r=t[0],["M",r.x,r.y])];var r,i,a,c;for(let r=1;r<n;r++){const n=t[r-1],s=t[r],u=t[r+1];if(!u||!e){o.push(Ut(s));continue}const l=Math.min(e,Xt(s.x-n.x,s.y-n.y),Xt(u.x-s.x,u.y-s.y));if(!l){o.push(Ut(s));continue}const h=Kt(s,n,l),d=Kt(s,n,.5*l),p=Kt(s,u,l),f=Kt(s,u,.5*l);o.push(Ut(h)),o.push((a=f,c=p,["C",(i=d).x,i.y,a.x,a.y,c.x,c.y]))}return o}function Kt(t,e,n){const o=e.x-t.x,r=e.y-t.y,i=n/Xt(o,r);return{x:t.x+o*i,y:t.y+r*i}}function Xt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Zt(t,e,n){c(e)&&(n=e,e=null),e||(e={});const o=Bt("path",e);return c(n)&&(o.dataset.cornerRadius=String(n)),Qt(o,t)}function Qt(t,e){return bt(t,{d:qt(Yt(e,parseInt(t.dataset.cornerRadius,10)||0))}),t}function Jt(t){return!0}function te(t){return ft(t)||function(t){return pt(t,1)}(t)}function ee(t,e,n){var o=this;function r(n,o,r){var i,a;(function(t,e){var n=s[t]||ft;return!n(e)})(n,o)||(r?a=e.getGraphics(r):(i=o.delegateTarget||o.target)&&(a=i,r=e.get(a)),a&&r&&!1===t.fire(n,{element:r,gfx:a,originalEvent:o})&&(o.stopPropagation(),o.preventDefault()))}var i={};function a(t){return i[t]}var c={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},s={"element.contextmenu":Jt,"element.mousedown":te,"element.mouseup":te,"element.click":te,"element.dblclick":te};var u="svg, .djs-element";function l(t,e,n,o){var a=i[n]=function(t){r(n,t)};o&&(s[n]=o),a.$delegate=et.bind(t,u,e,a)}function h(t,e,n){var o=a(n);o&&et.unbind(t,e,o.$delegate)}t.on("canvas.destroy",(function(t){var e;e=t.svg,p(c,(function(t,n){h(e,n,t)}))})),t.on("canvas.init",(function(t){var e;e=t.svg,p(c,(function(t,n){l(e,n,t)}))})),t.on(["shape.added","connection.added"],(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.createHit",{element:n,gfx:o})})),t.on(["shape.changed","connection.changed"],500,(function(e){var n=e.element,o=e.gfx;t.fire("interactionEvents.updateHit",{element:n,gfx:o})})),t.on("interactionEvents.createHit",500,(function(t){var e=t.element,n=t.gfx;o.createDefaultHit(e,n)})),t.on("interactionEvents.updateHit",(function(t){var e=t.element,n=t.gfx;o.updateDefaultHit(e,n)}));var d=y("djs-hit djs-hit-stroke"),f=y("djs-hit djs-hit-click-stroke"),v={all:y("djs-hit djs-hit-all"),"click-stroke":f,stroke:d,"no-move":y("djs-hit djs-hit-no-move")};function y(t,e){return e=O({stroke:"white",strokeWidth:15},e||{}),n.cls(t,["no-fill","no-border"],e)}function g(t,e){var n=v[e];if(!n)throw new Error("invalid hit type <"+e+">");return bt(t,n),t}function m(t,e){mt(t,e)}this.removeHits=function(t){p(ct(".djs-hit",t),Ct)},this.createDefaultHit=function(t,e){var n,o=t.waypoints,r=t.isFrame;return o?this.createWaypointsHit(e,o):(n=r?"stroke":"all",this.createBoxHit(e,n,{width:t.width,height:t.height}))},this.createWaypointsHit=function(t,e){var n=Zt(e);return g(n,"stroke"),m(t,n),n},this.createBoxHit=function(t,e,n){n=O({x:0,y:0},n);var o=Bt("rect");return g(o,e),bt(o,n),m(t,o),o},this.updateDefaultHit=function(t,e){var n=at(".djs-hit",e);if(n)return t.waypoints?Qt(n,t.waypoints):bt(n,{width:t.width,height:t.height}),n},this.fire=r,this.triggerMouseEvent=function(t,e,n){var o=c[t];if(!o)throw new Error("unmapped DOM event name <"+t+">");return r(o,e,n)},this.mouseHandler=a,this.registerEvent=l,this.unregisterEvent=h}ee.$inject=["eventBus","elementRegistry","styles"];var ne={__init__:["interactionEvents"],interactionEvents:["type",ee]};function oe(t){return d(t,(function(e){return!h(t,(function(t){return t!==e&&re(e,t)}))}))}function re(t,e){if(e){if(t===e)return e;if(t.parent)return re(t.parent,e)}}function ie(t,e,n){var o=!n||-1===t.indexOf(e);return o&&t.push(e),o}function ae(t,e,n){n=n||0,i(t)||(t=[t]),p(t,(function(t,o){var r=e(t,o,n);i(r)&&r.length&&ae(r,e,n+1)}))}function ce(t,e){return function(t,e,n){var o=[],r=[];return ae(t,(function(t,i,a){ie(o,t,e);var c=t.children;if((-1===n||a<n)&&c&&ie(r,c,e))return c})),o}(t,!e,-1)}function se(t,e){var n,o,r,a;return e=!!e,i(t)||(t=[t]),p(t,(function(t){var i=t;t.waypoints&&!e&&(i=se(t.waypoints,!0));var c=i.x,s=i.y,u=i.height||0,l=i.width||0;(c<n||void 0===n)&&(n=c),(s<o||void 0===o)&&(o=s),(c+l>r||void 0===r)&&(r=c+l),(s+u>a||void 0===a)&&(a=s+u)})),{x:n,y:o,height:a-o,width:r-n}}function ue(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function le(t){return!(!t||!t.isFrame)}function he(t,e){return O({},t||{},e||{})}function de(t,e){this.offset=6;var n=e.cls("djs-outline",["no-fill"]),o=this;function r(t,e){var o=Bt("rect");return bt(o,O({x:10,y:10,rx:4,width:100,height:100},n)),mt(t,o),o}t.on(["shape.added","shape.changed"],500,(function(t){var e=t.element,n=t.gfx,i=at(".djs-outline",n);i||(i=r(n)),o.updateShapeOutline(i,e)})),t.on(["connection.added","connection.changed"],(function(t){var e=t.element,n=t.gfx,i=at(".djs-outline",n);i||(i=r(n)),o.updateConnectionOutline(i,e)}))}de.prototype.updateShapeOutline=function(t,e){bt(t,{x:-this.offset,y:-this.offset,width:e.width+2*this.offset,height:e.height+2*this.offset})},de.prototype.updateConnectionOutline=function(t,e){var n=se(e);bt(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},de.$inject=["eventBus","styles","elementRegistry"];var pe={__init__:["outline"],outline:["type",de]};function fe(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],(function(t){var e=t.element;n.deselect(e)})),t.on(["diagram.clear","root.set"],(function(t){n.select(null)}))}fe.$inject=["eventBus","canvas"],fe.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(-1!==n){var o=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:e})}},fe.prototype.get=function(){return this._selectedElements},fe.prototype.isSelected=function(t){return-1!==this._selectedElements.indexOf(t)},fe.prototype.select=function(t,e){var n=this._selectedElements,o=n.slice();i(t)||(t=t?[t]:[]);var r=this._canvas,a=r.getRootElement();t=t.filter((function(t){var e=r.findRoot(t);return a===e})),e?p(t,(function(t){-1===n.indexOf(t)&&n.push(t)})):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:o,newSelection:n})};var ve="hover",ye="selected";function ge(t,e,n){this._canvas=t;var o=this;function r(e,n){t.addMarker(e,n)}function i(e,n){t.removeMarker(e,n)}this._multiSelectionBox=null,e.on("element.hover",(function(t){r(t.element,ve)})),e.on("element.out",(function(t){i(t.element,ve)})),e.on("selection.changed",(function(t){var e=t.oldSelection,n=t.newSelection;p(e,(function(t){-1===n.indexOf(t)&&i(t,ye)})),p(n,(function(t){-1===e.indexOf(t)&&r(t,ye)})),o._updateSelectionOutline(n)})),e.on("element.changed",(function(t){n.isSelected(t.element)&&o._updateSelectionOutline(n.get())}))}function me(t,e,n,o){t.on("create.end",500,(function(t){var n=t.context,o=n.canExecute,r=n.elements,a=(n.hints||{}).autoSelect;if(o){if(!1===a)return;i(a)?e.select(a):e.select(r.filter(xe))}})),t.on("connect.end",500,(function(t){var n=t.context.connection;n&&e.select(n)})),t.on("shape.move.end",500,(function(t){var n=t.previousSelection||[],r=o.get(t.context.shape.id);h(n,(function(t){return r.id===t.id}))||e.select(r)})),t.on("element.click",(function(t){if(ft(t)){var o=t.element;o===n.getRootElement()&&(o=null);var r=e.isSelected(o),i=e.get().length>1,a=vt(t)||yt(t);if(r&&i)return a?e.deselect(o):e.select(o);r?e.deselect(o):e.select(o,a)}}))}function xe(t){return!t.hidden}ge.$inject=["canvas","eventBus","selection"],ge.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");jt(e);var n=t.length>1;if(kt(this._canvas.getContainer())[n?"add":"remove"]("djs-multi-select"),n){var o=function(t){return{x:t.x-6,y:t.y-6,width:t.width+12,height:t.height+12}}(se(t)),r=Bt("rect");bt(r,O({rx:3},o)),kt(r).add("djs-selection-outline"),mt(e,r)}},me.$inject=["eventBus","selection","canvas","elementRegistry"];var _e={__init__:["selectionVisuals","selectionBehavior"],__depends__:[ne,pe],selection:["type",fe],selectionVisuals:["type",ge],selectionBehavior:["type",me]};function we(t){this._commandStack=t.get("commandStack",!1)}we.$inject=["injector"],we.prototype.allowed=function(t,e){var n=!0,o=this._commandStack;return o&&(n=o.canExecute(t,e)),void 0===n||n};var be={__init__:["rules"],rules:["type",we]};function Ee(t,e,n){var o,r,i=this,a=n.get("dragging",!1);a&&e.on("drag.start",(function(n){e.once("drag.move",1500,(function(e){!function(e){if(!e.hover){var n=e.originalEvent,o=i._findTargetGfx(n),r=o&&t.get(o);o&&r&&(e.stopPropagation(),a.hover({element:r,gfx:o}),a.move(n))}}(e)}))})),e.on("element.hover",(function(t){o=t.gfx,r=t.element})),e.on("element.hover",1500,(function(t){r&&e.fire("element.out",{element:r,gfx:o})})),e.on("element.out",(function(){o=null,r=null})),this._findTargetGfx=function(t){var e;if(t instanceof MouseEvent)return e=dt(t),function(t){return q(t,"svg, .djs-element",!0)}(document.elementFromPoint(e.x,e.y))}}Ee.$inject=["elementRegistry","eventBus","injector"];var ke={__init__:["hoverFix"],hoverFix:["type",Ee]},Se=/^djs-cursor-.*$/;function Ce(t){var e=F(document.body);e.removeMatching(Se),t&&e.add("djs-cursor-"+t)}function je(){Ce(null)}var Me=5e3;function Re(t,e){function n(){return!1}return e=e||"element.click",t.once(e,Me,n),function(){t.off(e,n)}}function Oe(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Pe(t,e){return{x:t.x-e.x,y:t.y-e.y}}var Be=Math.round,ze="djs-drag-active";function Te(t){t.preventDefault()}function Ae(t,e,n,o){var r,a={threshold:5,trapClick:!0};function c(t){var n=e.viewbox(),o=e._container.getBoundingClientRect();return{x:n.x+(t.x-o.left)/n.scale,y:n.y+(t.y-o.top)/n.scale}}function s(e,n){n=n||r;var o=t.createEvent(O({},n.payload,n.data,{isTouch:n.isTouch}));return!1!==t.fire("drag."+e,o)&&t.fire(n.prefix+"."+e,o)}function u(t,o){var i,a=r.payload,u=r.displacement,l=r.globalStart,h=dt(t),d=Pe(h,l),p=r.localStart,f=c(h),v=Pe(f,p);if(!r.active&&(o||(i=d,Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))>r.threshold))){if(O(a,{x:Be(p.x+u.x),y:Be(p.y+u.y),dx:0,dy:0},{originalEvent:t}),!1===s("start"))return y();r.active=!0,r.keepSelection||(a.previousSelection=n.get(),n.select(null)),r.cursor&&Ce(r.cursor),e.addMarker(e.getRootElement(),ze)}ht(t),r.active&&(O(a,{x:Be(f.x+u.x),y:Be(f.y+u.y),dx:Be(v.x),dy:Be(v.y)},{originalEvent:t}),s("move"))}function l(t){var e=!0;r.active&&(t&&(r.payload.originalEvent=t,ht(t)),e=s("end")),!1===e&&s("rejected"),s("ended",g(!0!==e))}function h(t){(function(t,e){return-1!==(t=i(t)?t:[t]).indexOf(e.key)||-1!==t.indexOf(e.code)})("Escape",t)&&(Te(t),y())}function d(e){var n;r.active&&(n=Re(t),setTimeout(n,400),Te(e)),l(e)}function p(t){u(t)}function f(t){var e=r.payload;e.hoverGfx=t.gfx,e.hover=t.element,s("hover")}function v(t){s("out");var e=r.payload;e.hoverGfx=null,e.hover=null}function y(t){var e;if(r){var n=r.active;n&&s("cancel"),e=g(t),n&&s("canceled",e)}}function g(i){var a,c;s("cleanup"),je(),c=r.trapClick?d:l,Q.unbind(document,"mousemove",u),Q.unbind(document,"dragstart",Te),Q.unbind(document,"selectstart",Te),Q.unbind(document,"mousedown",c,!0),Q.unbind(document,"mouseup",c,!0),Q.unbind(document,"keyup",h),Q.unbind(document,"touchstart",p,!0),Q.unbind(document,"touchcancel",y,!0),Q.unbind(document,"touchmove",u,!0),Q.unbind(document,"touchend",l,!0),t.off("element.hover",f),t.off("element.out",v),e.removeMarker(e.getRootElement(),ze);var g=r.payload.previousSelection;return!1!==i&&g&&!n.get().length&&function(t){var e=t.filter((function(t){return o.get(t.id)}));e.length&&n.select(e)}(g),a=r,r=null,a}t.on("diagram.destroy",y),this.init=function(e,n,o,i){r&&y(!1),"string"==typeof n&&(i=o,o=n,n=null);var g,m,x,_,w,b=(i=O({},a,i||{})).data||{};_=i.trapClick?d:l,e?(g=lt(e)||e,m=dt(e),ht(e),"dragstart"===g.type&&Te(g)):(g=null,m={x:0,y:0}),x=c(m),n||(n=x),w=function(t){return"undefined"!=typeof TouchEvent&&t instanceof TouchEvent}(g),r=O({prefix:o,data:b,payload:{},globalStart:m,displacement:Pe(n,x),localStart:x,isTouch:w},i),i.manual||(w?(Q.bind(document,"touchstart",p,!0),Q.bind(document,"touchcancel",y,!0),Q.bind(document,"touchmove",u,!0),Q.bind(document,"touchend",l,!0)):(Q.bind(document,"mousemove",u),Q.bind(document,"dragstart",Te),Q.bind(document,"selectstart",Te),Q.bind(document,"mousedown",_,!0),Q.bind(document,"mouseup",_,!0)),Q.bind(document,"keyup",h),t.on("element.hover",f),t.on("element.out",v)),s("init"),i.autoActivate&&u(e,!0)},this.move=u,this.hover=f,this.out=v,this.end=l,this.cancel=y,this.context=function(){return r},this.setOptions=function(t){O(a,t)}}Ae.$inject=["eventBus","canvas","selection","elementRegistry"];var Le={__depends__:[ke,_e],dragging:["type",Ae]};function De(t){return t.childNodes[0]}var Ie=["marker-start","marker-mid","marker-end"],$e=["circle","ellipse","line","path","polygon","polyline","path","rect"];function He(t,e,n,o){this._elementRegistry=t,this._canvas=n,this._styles=o,this._clonedMarkers={};var r=this;e.on("drag.cleanup",(function(){p(r._clonedMarkers,(function(t){Ct(t)})),r._clonedMarkers={}}))}He.$inject=["elementRegistry","eventBus","canvas","styles"],He.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)},He.prototype.addDragger=function(t,e,n){var o=Mt(n=n||this.getGfx(t)),r=n.getBoundingClientRect();return this._cloneMarkers(De(o)),bt(o,this._styles.cls("djs-dragger",[],{x:r.top,y:r.left})),mt(e,o),o},He.prototype.addFrame=function(t,e){var n=Bt("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return mt(e,n),n},He.prototype._cloneMarkers=function(t){var e=this;if(t.childNodes)for(var n=0;n<t.childNodes.length;n++)e._cloneMarkers(t.childNodes[n]);(function(t){return-1!==$e.indexOf(t.nodeName)})(t)&&Ie.forEach((function(n){if(bt(t,n)){var o=function(t,e,n){var o=(r=bt(t,e),r.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]);var r;return at("marker#"+o,n||document)}(t,n,e._canvas.getContainer());e._cloneMarker(t,o,n)}}))},He.prototype._cloneMarker=function(t,e,n){var o=e.id,r=this._clonedMarkers[o];if(!r){var i=o+"-clone";(r=Mt(e)).id=i,kt(r).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[o]=r;var a=at("defs",this._canvas._svg);a||(a=Bt("defs"),mt(this._canvas._svg,a)),mt(a,r)}bt(t,n,"url(#"+this._clonedMarkers[o].id+")")};var Ne={__init__:["previewSupport"],previewSupport:["type",He]},Fe=Math.round;function Ge(t,e,n,o,r){function i(t,e,n,o){return r.allowed("elements.move",{shapes:t,delta:e,position:n,target:o})}function c(t,n,o,r){if(a(o)&&(r=o,o=!1),!n.waypoints&&n.parent&&!kt(t.target).has("djs-hit-no-move")){var i=function(t){return{x:t.x+Fe(t.width/2),y:t.y+Fe(t.height/2)}}(n);return e.init(t,i,"shape.move",{cursor:"grabbing",autoActivate:o,data:{shape:n,context:r||{}}}),!0}}t.on("shape.move.start",1500,(function(t){var e=t.context,n=t.shape,r=o.get().slice();-1===r.indexOf(n)&&(r=[n]),r=function(t){var e=w(t,"id");return d(t,(function(t){for(;t=t.parent;)if(e[t.id])return!1;return!0}))}(r),O(e,{shapes:r,validatedShapes:r,shape:n})})),t.on("shape.move.start",1250,(function(t){var e=t.context,n=e.validatedShapes;if(!(e.canExecute=i(n)))return!1})),t.on("shape.move.move",500,(function(t){var e,n=t.context,o=n.validatedShapes,r=t.hover,a={x:t.dx,y:t.dy};e=i(o,a,{x:t.x,y:t.y},r),n.delta=a,n.canExecute=e,n.target=null!==e?r:null})),t.on("shape.move.end",(function(t){var e=t.context,o=e.delta,r=e.canExecute,i="attach"===r,a=e.shapes;if(!1===r)return!1;o.x=Fe(o.x),o.y=Fe(o.y),0===o.x&&0===o.y||n.moveElements(a,o,e.target,{primaryShape:e.shape,attach:i})})),t.on("element.mousedown",(function(t){if(ft(t)){var e=lt(t);if(!e)throw new Error("must supply DOM mousedown event");return c(e,t.element)}})),this.start=c}function We(t,e,n){var o=Lt();o.setTranslate(e,n),Vt(t,o)}function Ve(t){return a(t)&&l(t,"waypoints")}function qe(t){return a(t)&&l(t,"labelTarget")}Ge.$inject=["eventBus","dragging","modeling","selection","rules"];var Ue="djs-dragging",Ye="drop-ok",Ke="drop-not-ok",Xe="new-parent",Ze="attach-ok";function Qe(e,n,o,r){function i(t){var e=function(t){var e=d(t,(function(e){return!Ve(e)||h(t,k({id:e.source.id}))&&h(t,k({id:e.target.id}))}));return e}(a(t));return e}function a(e){var n=ce(e,!0),o=m(n,(function(t){return(t.incoming||[]).concat(t.outgoing||[])}));return t(n.concat(o))}function c(t,e){[Ze,Ye,Ke,Xe].forEach((function(o){o===e?n.addMarker(t,o):n.removeMarker(t,o)}))}e.on("shape.move.start",499,(function(e){var c=e.context,s=c.shapes,u=c.allDraggedElements,l=i(s);if(!c.dragGroup){var h=Bt("g");bt(h,o.cls("djs-drag-group",["no-events"])),mt(n.getActiveLayer(),h),c.dragGroup=h}l.forEach((function(t){r.addDragger(t,c.dragGroup)})),p(u=u?t([u,a(s)]):a(s),(function(t){n.addMarker(t,Ue)})),c.allDraggedElements=u,c.differentParents=1!==x(w(s,(function(t){return t.parent&&t.parent.id})))})),e.on("shape.move.move",499,(function(t){var e=t.context,n=e.dragGroup,o=e.target,r=e.shape.parent,i=e.canExecute;o&&("attach"===i?c(o,Ze):e.canExecute&&o&&o.id!==r.id?c(o,Xe):c(o,e.canExecute?Ye:Ke)),We(n,t.dx,t.dy)})),e.on(["shape.move.out","shape.move.cleanup"],(function(t){var e=t.context.target;e&&c(e,null)})),e.on("shape.move.cleanup",(function(t){var e=t.context,o=e.allDraggedElements,r=e.dragGroup;p(o,(function(t){n.removeMarker(t,Ue)})),r&&Ct(r)})),this.makeDraggable=function(t,e,o){r.addDragger(e,t.dragGroup),o&&n.addMarker(e,Ue),t.allDraggedElements?t.allDraggedElements.push(e):t.allDraggedElements=[e]}}Qe.$inject=["eventBus","canvas","styles","previewSupport"];var Je={__depends__:[ne,_e,pe,be,Le,Ne],__init__:["move","movePreview"],move:["type",Ge],movePreview:["type",Qe]};function tn(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}tn.$inject=["eventBus","dragging"],tn.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error('A tool has to be registered with it\'s "events"');n.push(t),this.bindEvents(t,e)},tn.prototype.isActive=function(t){return t&&this._active===t},tn.prototype.length=function(t){return this._tools.length},tn.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))},tn.prototype.bindEvents=function(t,e){var n=this._eventBus,o=this._dragging,r=[];n.on(e.tool+".init",(function(e){if(!e.context.reactivate&&this.isActive(t))return this.setActive(null),void o.cancel();this.setActive(t)}),this),p(e,(function(t){r.push(t+".ended"),r.push(t+".canceled")})),n.on(r,250,(function(t){this._active&&(function(t){var e=t.originalEvent&&t.originalEvent.target;return e&&q(e,'.group[data-group="tools"]')}(t)||this.setActive(null))}),this)};var en={__depends__:[Le],__init__:["toolManager"],toolManager:["type",tn]};function nn(t){var e=this;function n(t){e._lastMoveEvent=t}this._lastMoveEvent=null,t.on("canvas.init",(function(t){(e._svg=t.svg).addEventListener("mousemove",n)})),t.on("canvas.destroy",(function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)}))}nn.$inject=["eventBus"],nn.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||function(t,e){var n=document.createEvent("MouseEvent"),o=t,r=e,i=t,a=e;n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,o,r,i,a,!1,!1,!1,!1,0,null);return n}(0,0)};var on={__init__:["mouse"],mouse:["type",nn]},rn="crosshair";function an(t,e,n,o,r,i,a){this._selection=r,this._dragging=n,this._mouse=a;var c=this,s=function(t){var n,o=e.getActiveLayer();bt(n=t.frame=Bt("rect"),{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),mt(o,n)},u=function(t){var e=t.frame,n=t.bbox;bt(e,{x:n.x,y:n.y,width:n.width,height:n.height})},l=function(t){t.frame&&Ct(t.frame)};i.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",(function(e){var n=e.originalEvent.target;(e.hover||n instanceof SVGElement)&&t.once("lasso.selection.ended",(function(){c.activateLasso(e.originalEvent,!0)}))})),t.on("lasso.end",(function(t){var e=cn(t),n=o.filter((function(t){return t}));c.select(n,e)})),t.on("lasso.start",(function(t){var e=t.context;e.bbox=cn(t),s(e)})),t.on("lasso.move",(function(t){var e=t.context;e.bbox=cn(t),u(e)})),t.on("lasso.cleanup",(function(t){var e=t.context;l(e)})),t.on("element.mousedown",1500,(function(t){if(yt(t))return c.activateLasso(t.originalEvent),!0}))}function cn(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y};return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?{x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?{x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?{x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?{x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:{x:n.x,y:n.y,width:0,height:0}}an.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"],an.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:rn,data:{context:{}}})},an.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:rn,data:{context:{}}})},an.prototype.select=function(t,e){var n=function(t,e){var n={};return p(t,(function(t){var o=t;o.waypoints&&(o=se(o)),!c(e.y)&&o.x>e.x&&(n[t.id]=t),!c(e.x)&&o.y>e.y&&(n[t.id]=t),o.x>e.x&&o.y>e.y&&(c(e.width)&&c(e.height)&&o.width+o.x<e.width+e.x&&o.height+o.y<e.height+e.y?n[t.id]=t:c(e.width)&&c(e.height)||(n[t.id]=t))})),n}(t,e);this._selection.select(_(n))},an.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)},an.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};var sn={__depends__:[en,on],__init__:["lassoTool"],lassoTool:["type",an]};function un(t){return CSS.escape(t)}var ln=".djs-palette-toggle",hn=".entry",dn=ln+", "+hn,pn="djs-palette-",fn="open",vn="two-column";function yn(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",(function(t){var e=t.tool;n.updateToolHighlight(e)})),t.on("i18n.changed",(function(){n._update()})),t.on("diagram.init",(function(){n._diagramInitialized=!0,n._rebuild()}))}function gn(t,e){var n=e.getPaletteEntries();return s(n)?n(t):(p(n,(function(e,n){t[n]=e})),t)}yn.$inject=["eventBus","canvas"],yn.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("palette.getProviders",t,(function(t){t.providers.push(e)})),this._rebuild()},yn.prototype.getEntries=function(){return this._getProviders().reduce(gn,{})},yn.prototype._rebuild=function(){this._diagramInitialized&&(this._getProviders().length&&(this._container||this._init(),this._update()))},yn.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),o=this._container=it(yn.HTML_MARKUP);n.appendChild(o),F(n).add(pn+"shown"),et.bind(o,dn,"click",(function(e){if(V(e.delegateTarget,ln))return t.toggle();t.trigger("click",e)})),Q.bind(o,"mousedown",(function(t){t.stopPropagation()})),et.bind(o,hn,"dragstart",(function(e){t.trigger("dragstart",e)})),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:o})},yn.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},yn.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),o=this._container,r=this._eventBus,i=F(o),a=F(n);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),i.toggle(vn,e),a.toggle(pn+vn,e),"open"in t&&(i.toggle(fn,t.open),a.toggle(pn+fn,t.open)),r.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},yn.prototype._update=function(){var t=at(".djs-palette-entries",this._container),e=this._entries=this.getEntries();W(t),p(e,(function(e,n){var o=e.group||"default",r=at("[data-group="+un(o)+"]",t);r||(H(r=it('<div class="group"></div>'),"data-group",o),t.appendChild(r));var a=e.html||(e.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),c=it(a);if(r.appendChild(c),!e.separator&&(H(c,"data-action",n),e.title&&H(c,"title",e.title),e.className&&function(t,e){var n=F(t);(i(e)?e:e.split(/\s+/g)).forEach((function(t){n.add(t)}))}(c,e.className),e.imageUrl)){var s=it("<img>");H(s,"src",e.imageUrl),c.appendChild(s)}})),this.open()},yn.prototype.trigger=function(t,e,n){var o,r,i=e.delegateTarget||e.target;return i?(o=H(i,"data-action"),r=e.originalEvent||e,this.triggerEntry(o,t,r,n)):e.preventDefault()},yn.prototype.triggerEntry=function(t,e,n,o){var r,i;if((r=this._entries[t])&&(i=r.action,!1!==this._eventBus.fire("palette.trigger",{entry:r,event:n}))){if(s(i)){if("click"===e)return i(n,o)}else if(i[e])return i[e](n,o);n.preventDefault()}},yn.prototype._layoutChanged=function(){this._toggleState({})},yn.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},yn.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},yn.prototype.open=function(){this._toggleState({open:!0})},yn.prototype.toggle=function(){this.isOpen()?this.close():this.open()},yn.prototype.isActiveTool=function(t){return t&&this._activeTool===t},yn.prototype.updateToolHighlight=function(t){var e;this._toolsContainer||(e=at(".djs-palette-entries",this._container),this._toolsContainer=at("[data-group=tools]",e)),p(this._toolsContainer.children,(function(e){var n=e.getAttribute("data-action");if(n){var o=F(e);n=n.replace("-tool",""),o.contains("entry")&&n===t?o.add("highlighted-entry"):o.remove("highlighted-entry")}}))},yn.prototype.isOpen=function(){return F(this._container).has(fn)},yn.prototype._getParentContainer=function(){return this._canvas.getContainer()},yn.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';var mn={__init__:["palette"],palette:["type",yn]},xn="drop-ok",_n="drop-not-ok",wn="attach-ok",bn="new-parent",En="create";function kn(t,e,n,o,r){function a(e,n){[wn,xn,_n,bn].forEach((function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)}))}function s(){var t=e.context();t&&t.prefix===En&&e.cancel()}n.on(["create.move","create.hover"],(function(t){var e=t.context,n=e.elements,o=t.hover,i=e.source,c=e.hints||{};if(!o)return e.canExecute=!1,void(e.target=null);Sn(t);var s={x:t.x,y:t.y},u=e.canExecute=o&&function(t,e,n,o,i){if(!e)return!1;var a=h(t=d(t,(function(e){var n=e.labelTarget;return!(e.parent||qe(e)&&-1!==t.indexOf(n))})),(function(t){return!Ve(t)})),c=!1,s=!1,u=!1;Cn(t)&&(c=r.allowed("shape.attach",{position:n,shape:a,target:e})),c||(u=Cn(t)?r.allowed("shape.create",{position:n,shape:a,source:o,target:e}):r.allowed("elements.create",{elements:t,position:n,target:e}));var l=i.connectionTarget;return u||c?(a&&o&&(s=r.allowed("connection.create",{source:l===o?a:o,target:l===o?o:a,hints:{targetParent:e,targetAttach:c}})),{attach:c,connect:s}):(null===u||null===c)&&null}(n,o,s,i,c);o&&null!==u&&(e.target=o,u&&u.attach?a(o,wn):a(o,u?bn:_n))})),n.on(["create.end","create.out","create.cleanup"],(function(t){var e=t.hover;e&&a(e,null)})),n.on("create.end",(function(t){var e=t.context,n=e.source,r=e.shape,i=e.elements,a=e.target,c=e.canExecute,s=c&&c.attach,u=c&&c.connect,l=e.hints||{};if(!1===c||!a)return!1;Sn(t);var d={x:t.x,y:t.y};r=u?o.appendShape(n,r,d,a,{attach:s,connection:!0===u?{}:u,connectionTarget:l.connectionTarget}):h(i=o.createElements(i,d,a,O({},l,{attach:s})),(function(t){return!Ve(t)})),O(e,{elements:i,shape:r}),O(t,{elements:i,shape:r})})),n.on("create.init",(function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],2e3,(function(){n.off("elements.changed",s)}))})),this.start=function(t,n,o){i(n)||(n=[n]);var r=h(n,(function(t){return!Ve(t)}));if(r){o=O({elements:n,hints:{},shape:r},o||{}),p(n,(function(t){c(t.x)||(t.x=0),c(t.y)||(t.y=0)}));var a=se(d(n,(function(t){return!t.hidden})));p(n,(function(t){Ve(t)&&(t.waypoints=m(t.waypoints,(function(t){return{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2}}))),O(t,{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2})})),e.init(t,En,{cursor:"grabbing",autoActivate:!0,data:{shape:r,elements:n,context:o}})}}}function Sn(t){var e=t.context.createConstraints;e&&(e.left&&(t.x=Math.max(t.x,e.left)),e.right&&(t.x=Math.min(t.x,e.right)),e.top&&(t.y=Math.max(t.y,e.top)),e.bottom&&(t.y=Math.min(t.y,e.bottom)))}function Cn(t){return t&&1===t.length&&!Ve(t[0])}kn.$inject=["canvas","dragging","eventBus","modeling","rules"];function jn(t,e,n,o,r){e.on("create.move",750,(function(e){var i=e.hover,a=e.context,c=a.elements,s=a.dragGroup;s||(s=a.dragGroup=function(t){var e=Bt("g");bt(e,r.cls("djs-drag-group",["no-events"]));var i=Bt("g");return t.forEach((function(t){var r;t.hidden||(t.waypoints?(r=n._createContainer("connection",i),n.drawConnection(De(r),t)):(r=n._createContainer("shape",i),n.drawShape(De(r),t),We(r,t.x,t.y)),o.addDragger(t,e,r))})),e}(c)),i?(s.parentNode||mt(t.getActiveLayer(),s),We(s,e.x,e.y)):Ct(s)})),e.on("create.cleanup",(function(t){var e=t.context.dragGroup;e&&Ct(e)}))}jn.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];var Mn={__depends__:[Le,Ne,be,_e],__init__:["create","createPreview"],create:["type",kn],createPreview:["type",jn]};function Rn(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(1e9*Math.random())+"-"}Rn.prototype.next=function(){return this._prefix+ ++this._counter};var On=new Rn("ov");function Pn(t,e,n,o){var r,i;this._eventBus=e,this._canvas=n,this._elementRegistry=o,this._ids=On,this._overlayDefaults=O({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(r=n.getContainer(),$(i=it('<div class="djs-overlay-container" />'),{position:"absolute",width:0,height:0}),r.insertBefore(i,r.firstChild),i),this._init()}function Bn(t,e,n){$(t,{left:e+"px",top:n+"px"})}function zn(t,e){t.style.display=!1===e?"none":""}function Tn(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(n){t.style[n+"transform"]=e}))}Pn.$inject=["config.overlays","eventBus","canvas","elementRegistry"],Pn.prototype.get=function(t){if(u(t)&&(t={id:t}),u(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?d(e.overlays,k({type:t.type})):e.overlays.slice():[]}return t.type?d(this._overlays,k({type:t.type})):t.id?this._overlays[t.id]:null},Pn.prototype.add=function(t,e,n){if(a(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var o=this._ids.next();return n=O({},this._overlayDefaults,n,{id:o,type:e,element:t,html:n.html}),this._addOverlay(n),o},Pn.prototype.remove=function(t){var e=this.get(t)||[];i(e)||(e=[e]);var n=this;p(e,(function(t){var e=n._getOverlayContainer(t.element,!0);if(t&&(st(t.html),st(t.htmlContainer),delete t.htmlContainer,delete t.element,delete n._overlays[t.id]),e){var o=e.overlays.indexOf(t);-1!==o&&e.overlays.splice(o,1)}}))},Pn.prototype.isShown=function(){return"none"!==this._overlayRoot.style.display},Pn.prototype.show=function(){zn(this._overlayRoot)},Pn.prototype.hide=function(){zn(this._overlayRoot,!1)},Pn.prototype.clear=function(){this._overlays={},this._overlayContainers=[],W(this._overlayRoot)},Pn.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,o=e.x,r=e.y;if(e.waypoints){var i=se(e);o=i.x,r=i.y}Bn(n,o,r),H(t.html,"data-container-id",e.id)},Pn.prototype._updateOverlay=function(t){var e,n,o=t.position,r=t.htmlContainer,i=t.element,a=o.left,c=o.top;void 0!==o.right&&(e=i.waypoints?se(i).width:i.width,a=-1*o.right+e);void 0!==o.bottom&&(n=i.waypoints?se(i).height:i.height,c=-1*o.bottom+n);Bn(r,a||0,c||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())},Pn.prototype._createOverlayContainer=function(t){var e=it('<div class="djs-overlays" />');$(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},Pn.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";Tn(this._overlayRoot,n)},Pn.prototype._getOverlayContainer=function(t,e){var n=h(this._overlayContainers,(function(e){return e.element===t}));return n||e?n:this._createOverlayContainer(t)},Pn.prototype._addOverlay=function(t){var e,n,o=t.id,r=t.element,i=t.html;i.get&&i.constructor.prototype.jquery&&(i=i.get(0)),u(i)&&(i=it(i)),n=this._getOverlayContainer(r),$(e=it('<div class="djs-overlay" data-overlay-id="'+o+'">'),{position:"absolute"}),e.appendChild(i),t.type&&F(e).add("djs-overlay-"+t.type),zn(e,this._canvas.findRoot(r)===this._canvas.getRootElement()),t.htmlContainer=e,n.overlays.push(t),n.html.appendChild(e),this._overlays[o]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())},Pn.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,o=this._canvas.findRoot(t.element),i=n&&n.minZoom,a=n&&n.maxZoom,c=t.htmlContainer,s=!0;(o!==this._canvas.getRootElement()||n&&(r(i)&&i>e.scale||r(a)&&a<e.scale))&&(s=!1),zn(c,s),this._updateOverlayScale(t,e)},Pn.prototype._updateOverlayScale=function(t,e){var n,o,i,a=t.scale,c=t.htmlContainer,s="";!0!==a&&(!1===a?(n=1,o=1):(n=a.min,o=a.max),r(n)&&e.scale<n&&(i=(1/e.scale||1)*n),r(o)&&e.scale>o&&(i=(1/e.scale||1)*o)),r(i)&&(s="scale("+i+","+i+")"),Tn(c,s)},Pn.prototype._updateOverlaysVisibilty=function(t){var e=this;p(this._overlays,(function(n){e._updateOverlayVisibilty(n,t)}))},Pn.prototype._init=function(){var t=this._eventBus,e=this;t.on("canvas.viewbox.changing",(function(t){e.hide()})),t.on("canvas.viewbox.changed",(function(t){var n;n=t.viewbox,e._updateRoot(n),e._updateOverlaysVisibilty(n),e.show()})),t.on(["shape.remove","connection.remove"],(function(t){var n=t.element;p(e.get({element:n}),(function(t){e.remove(t.id)}));var o=e._getOverlayContainer(n);if(o){st(o.html);var r=e._overlayContainers.indexOf(o);-1!==r&&e._overlayContainers.splice(r,1)}})),t.on("element.changed",500,(function(t){var n=t.element,o=e._getOverlayContainer(n,!0);o&&(p(o.overlays,(function(t){e._updateOverlay(t)})),e._updateOverlayContainer(o))})),t.on("element.marker.update",(function(t){var n=e._getOverlayContainer(t.element,!0);n&&F(n.html)[t.add?"add":"remove"](t.marker)})),t.on("root.set",(function(){e._updateOverlaysVisibilty(e._canvas.viewbox())})),t.on("diagram.clear",this.clear,this)};var An={__init__:["overlays"],overlays:["type",Pn]},Ln=".entry";function Dn(t,e,n,o){this._canvas=t,this._eventBus=n,this._overlays=o;var i=r(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:i},this._current=null,this._init()}function In(t,e){return-1!==t.indexOf(e)}Dn.$inject=["canvas","config.contextPad","eventBus","overlays"],Dn.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",(function(e){var n=e.newSelection,o=n.length?1===n.length?n[0]:n:null;o?t.open(o,!0):t.close()})),this._eventBus.on("elements.changed",(function(e){var n=e.elements,o=t._current;if(o){var r=o.target;g(i(r)?r:[r],(function(t){return In(n,t)}))&&t.open(r,!0)}}))},Dn.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("contextPad.getProviders",t,(function(t){t.providers.push(e)}))},Dn.prototype.getEntries=function(t){var e=this._getProviders(),n=i(t)?"getMultiElementContextPadEntries":"getContextPadEntries",o={};return p(e,(function(e){if(s(e[n])){var r=e[n](t);s(r)?o=r(o):p(r,(function(t,e){o[e]=t}))}})),o},Dn.prototype.trigger=function(t,e,n){var o,r,i=e.delegateTarget||e.target;return i?(o=H(i,"data-action"),r=e.originalEvent||e,this.triggerEntry(o,t,r,n)):e.preventDefault()},Dn.prototype.triggerEntry=function(t,e,n,o){if(this.isShown()){var r=this._current.target,i=this._current.entries[t];if(i){var a=i.action;if(!1!==this._eventBus.fire("contextPad.trigger",{entry:i,event:n})){if(s(a)){if("click"===e)return a(n,r,o)}else if(a[e])return a[e](n,r,o);n.preventDefault()}}}},Dn.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))},Dn.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers},Dn.prototype._updateAndOpen=function(t){var e,n=this.getEntries(t),o=this.getPad(t),r=o.html;p(n,(function(t,n){var o,a=t.group||"default",c=it(t.html||'<div class="entry" draggable="true"></div>');H(c,"data-action",n),(o=at("[data-group="+un(a)+"]",r))||(H(o=it('<div class="group"></div>'),"data-group",a),r.appendChild(o)),o.appendChild(c),t.className&&function(t,e){var n=F(t);(e=i(e)?e:e.split(/\s+/g)).forEach((function(t){n.add(t)}))}(c,t.className),t.title&&H(c,"title",t.title),t.imageUrl&&(H(e=it("<img>"),"src",t.imageUrl),e.style.width="100%",e.style.height="100%",c.appendChild(e))})),F(r).add("open"),this._current={target:t,entries:n,pad:o},this._eventBus.fire("contextPad.open",{current:this._current})},Dn.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,o=it('<div class="djs-context-pad"></div>'),r=this._getPosition(t),i=O({html:o},this._overlaysConfig,r);et.bind(o,Ln,"click",(function(t){e.trigger("click",t)})),et.bind(o,Ln,"dragstart",(function(t){e.trigger("dragstart",t)})),Q.bind(o,"mousedown",(function(t){t.stopPropagation()}));var a=this._canvas.getRootElement();this._overlayId=n.add(a,"context-pad",i);var c=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:c}),c},Dn.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},Dn.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return i(t)===i(n)&&(i(t)?t.length===n.length&&y(t,(function(t){return In(n,t)})):n===t)},Dn.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()},Dn.prototype._getPosition=function(t){var e=se(i(t)?t:[t]);return{position:{left:e.x+e.width+12,top:e.y-6}}};var $n={__depends__:[ne,An],contextPad:["type",Dn]};function Hn(t,e){return t&&e?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):-1}function Nn(t,e,n,o){if(void 0===o&&(o=5),!t||!e||!n)return!1;var r=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),i=Hn(t,e);return Math.abs(r/i)<=o}var Fn=2;function Gn(t,e){var n=Array.from(arguments).flat();const o={x:"v",y:"h"};for(const[t,e]of Object.entries(o))if(Wn(t,n))return e;return!1}function Wn(t,e){const n=e[0];return y(e,(function(e){return Math.abs(n[t]-e[t])<=Fn}))}function Vn(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function qn(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function Un(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/**
   * This file contains source code adapted from Snap.svg (licensed Apache-2.0).
   *
   * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js
   */var Yn=/,?([a-z]),?/gi,Kn=parseFloat,Xn=Math,Zn=Xn.PI,Qn=Xn.min,Jn=Xn.max,to=Xn.pow,eo=Xn.abs,no=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,oo=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi,ro=Array.isArray||function(t){return t instanceof Array};function io(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ao(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)io(t,n)&&(e[n]=ao(t[n]));return e}function co(t){var e=co.ps=co.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var n in e)io(e,n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])})),e[t]}function so(t,e,n,o){return 1===arguments.length&&(e=t.y,n=t.width,o=t.height,t=t.x),{x:t,y:e,width:n,height:o,x2:t+n,y2:e+o}}function uo(){return this.join(",").replace(Yn,"$1")}function lo(t){var e=ao(t);return e.toString=uo,e}function ho(t,e,n,o,r,i,a,c,s){var u=1-s,l=to(u,3),h=to(u,2),d=s*s*s,p=l*e+3*h*s*o+3*u*s*s*i+d*c;return{x:mo(l*t+3*h*s*n+3*u*s*s*r+d*a),y:mo(p)}}function po(t){var e=So.apply(null,t);return so(e.x0,e.y0,e.x1-e.x0,e.y1-e.y0)}function fo(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function vo(t,e,n,o,r){return t*(t*(-3*e+9*n-9*o+3*r)+6*e-12*n+6*o)-3*e+3*n}function yo(t,e,n,o,r,i,a,c,s){null==s&&(s=1);for(var u=(s=s>1?1:s<0?0:s)/2,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,p=0;p<12;p++){var f=u*l[p]+u,v=vo(f,t,n,r,a),y=vo(f,e,o,i,c),g=v*v+y*y;d+=h[p]*Xn.sqrt(g)}return u*d}function go(t,e,n,o,r,i,a,c){if(!(Jn(t,n)<Qn(r,a)||Qn(t,n)>Jn(r,a)||Jn(e,o)<Qn(i,c)||Qn(e,o)>Jn(i,c))){var s=(t*o-e*n)*(i-c)-(e-o)*(r*c-i*a),u=(t-n)*(i-c)-(e-o)*(r-a);if(u){var l=mo(((t*o-e*n)*(r-a)-(t-n)*(r*c-i*a))/u),h=mo(s/u),d=+l.toFixed(2),p=+h.toFixed(2);if(!(d<+Qn(t,n).toFixed(2)||d>+Jn(t,n).toFixed(2)||d<+Qn(r,a).toFixed(2)||d>+Jn(r,a).toFixed(2)||p<+Qn(e,o).toFixed(2)||p>+Jn(e,o).toFixed(2)||p<+Qn(i,c).toFixed(2)||p>+Jn(i,c).toFixed(2)))return{x:l,y:h}}}}function mo(t){return Math.round(1e11*t)/1e11}function xo(t,e,n){if(!function(t,e){return t=so(t),fo(e=so(e),t.x,t.y)||fo(e,t.x2,t.y)||fo(e,t.x,t.y2)||fo(e,t.x2,t.y2)||fo(t,e.x,e.y)||fo(t,e.x2,e.y)||fo(t,e.x,e.y2)||fo(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}(po(t),po(e)))return n?0:[];for(var o=yo.apply(0,t),r=yo.apply(0,e),i=wo(t)?1:~~(o/5)||1,a=wo(e)?1:~~(r/5)||1,c=[],s=[],u={},l=n?0:[],h=0;h<i+1;h++){var d=ho.apply(0,t.concat(h/i));c.push({x:d.x,y:d.y,t:h/i})}for(h=0;h<a+1;h++)d=ho.apply(0,e.concat(h/a)),s.push({x:d.x,y:d.y,t:h/a});for(h=0;h<i;h++)for(var p=0;p<a;p++){var f,v=c[h],y=c[h+1],g=s[p],m=s[p+1],x=eo(y.x-v.x)<.01?"y":"x",_=eo(m.x-g.x)<.01?"y":"x",w=go(v.x,v.y,y.x,y.y,g.x,g.y,m.x,m.y);if(w){if(u[f=w.x.toFixed(9)+"#"+w.y.toFixed(9)])continue;u[f]=!0;var b=v.t+eo((w[x]-v[x])/(y[x]-v[x]))*(y.t-v.t),E=g.t+eo((w[_]-g[_])/(m[_]-g[_]))*(m.t-g.t);b>=0&&b<=1&&E>=0&&E<=1&&(n?l++:l.push({x:w.x,y:w.y,t1:b,t2:E}))}}return l}function _o(t){var e=co(t);if(e.abs)return lo(e.abs);if(ro(t)&&ro(t&&t[0])||(t=function(t){if(!t)return null;var e=co(t);if(e.arr)return ao(e.arr);var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},o=[];return ro(t)&&ro(t[0])&&(o=ao(t)),o.length||String(t).replace(no,(function(t,e,r){var i=[],a=e.toLowerCase();for(r.replace(oo,(function(t,e){e&&i.push(+e)})),"m"==a&&i.length>2&&(o.push([e].concat(i.splice(0,2))),a="l",e="m"==e?"l":"L");i.length>=n[a]&&(o.push([e].concat(i.splice(0,n[a]))),n[a]););})),o.toString=co.toString,e.arr=ao(o),o}(t)),!t||!t.length)return[["M",0,0]];var n,o=[],r=0,i=0,a=0,c=0,s=0;"M"==t[0][0]&&(a=r=+t[0][1],c=i=+t[0][2],s++,o[0]=["M",r,i]);for(var u,l,h=s,d=t.length;h<d;h++){if(o.push(u=[]),(n=(l=t[h])[0])!=n.toUpperCase())switch(u[0]=n.toUpperCase(),u[0]){case"A":u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=+l[6]+r,u[7]=+l[7]+i;break;case"V":u[1]=+l[1]+i;break;case"H":u[1]=+l[1]+r;break;case"M":a=+l[1]+r,c=+l[2]+i;default:for(var p=1,f=l.length;p<f;p++)u[p]=+l[p]+(p%2?r:i)}else for(var v=0,y=l.length;v<y;v++)u[v]=l[v];switch(n=n.toUpperCase(),u[0]){case"Z":r=+a,i=+c;break;case"H":r=u[1];break;case"V":i=u[1];break;case"M":a=u[u.length-2],c=u[u.length-1];default:r=u[u.length-2],i=u[u.length-1]}}return o.toString=uo,e.abs=lo(o),o}function wo(t){return t[0]===t[2]&&t[1]===t[3]&&t[4]===t[6]&&t[5]===t[7]}function bo(t,e,n,o){return[t,e,n,o,n,o]}function Eo(t,e,n,o,r,i){var a=1/3,c=2/3;return[a*t+c*n,a*e+c*o,a*r+c*n,a*i+c*o,r,i]}function ko(t,e,n,o,r,i,a,c,s,u){var l,h,d=120*Zn/180,p=Zn/180*(+r||0),f=[],v=(h=function(t,e,n){return{x:t*Xn.cos(n)-e*Xn.sin(n),y:t*Xn.sin(n)+e*Xn.cos(n)}},function t(){var e=Array.prototype.slice.call(arguments,0),n=e.join(""),o=t.cache=t.cache||{},r=t.count=t.count||[];return io(o,n)?(function(t,e){for(var n=0,o=t.length;n<o;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}(r,n),o[n]):(r.length>=1e3&&delete o[r.shift()],r.push(n),o[n]=h.apply(0,e),o[n])});if(u)k=u[0],S=u[1],b=u[2],E=u[3];else{t=(l=v(t,e,-p)).x,e=l.y;var y=(t-(c=(l=v(c,s,-p)).x))/2,g=(e-(s=l.y))/2,m=y*y/(n*n)+g*g/(o*o);m>1&&(n*=m=Xn.sqrt(m),o*=m);var x=n*n,_=o*o,w=(i==a?-1:1)*Xn.sqrt(eo((x*_-x*g*g-_*y*y)/(x*g*g+_*y*y))),b=w*n*g/o+(t+c)/2,E=w*-o*y/n+(e+s)/2,k=Xn.asin(((e-E)/o).toFixed(9)),S=Xn.asin(((s-E)/o).toFixed(9));(k=t<b?Zn-k:k)<0&&(k=2*Zn+k),(S=c<b?Zn-S:S)<0&&(S=2*Zn+S),a&&k>S&&(k-=2*Zn),!a&&S>k&&(S-=2*Zn)}var C=S-k;if(eo(C)>d){var j=S,M=c,R=s;S=k+d*(a&&S>k?1:-1),f=ko(c=b+n*Xn.cos(S),s=E+o*Xn.sin(S),n,o,r,0,a,M,R,[S,j,b,E])}C=S-k;var O=Xn.cos(k),P=Xn.sin(k),B=Xn.cos(S),z=Xn.sin(S),T=Xn.tan(C/4),A=4/3*n*T,L=4/3*o*T,D=[t,e],I=[t+A*P,e-L*O],$=[c+A*z,s-L*B],H=[c,s];if(I[0]=2*D[0]-I[0],I[1]=2*D[1]-I[1],u)return[I,$,H].concat(f);for(var N=[],F=0,G=(f=[I,$,H].concat(f).join().split(",")).length;F<G;F++)N[F]=F%2?v(f[F-1],f[F],p).y:v(f[F],f[F+1],p).x;return N}function So(t,e,n,o,r,i,a,c){for(var s,u,l,h,d,p,f,v,y=[],g=[[],[]],m=0;m<2;++m)if(0==m?(u=6*t-12*n+6*r,s=-3*t+9*n-9*r+3*a,l=3*n-3*t):(u=6*e-12*o+6*i,s=-3*e+9*o-9*i+3*c,l=3*o-3*e),eo(s)<1e-12){if(eo(u)<1e-12)continue;0<(h=-l/u)&&h<1&&y.push(h)}else f=u*u-4*l*s,v=Xn.sqrt(f),f<0||(0<(d=(-u+v)/(2*s))&&d<1&&y.push(d),0<(p=(-u-v)/(2*s))&&p<1&&y.push(p));for(var x,_=y.length,w=_;_--;)x=1-(h=y[_]),g[0][_]=x*x*x*t+3*x*x*h*n+3*x*h*h*r+h*h*h*a,g[1][_]=x*x*x*e+3*x*x*h*o+3*x*h*h*i+h*h*h*c;return g[0][w]=t,g[1][w]=e,g[0][w+1]=a,g[1][w+1]=c,g[0].length=g[1].length=w+2,{x0:Qn.apply(0,g[0]),y0:Qn.apply(0,g[1]),x1:Jn.apply(0,g[0]),y1:Jn.apply(0,g[1])}}function Co(t){var e=co(t);if(e.curve)return lo(e.curve);for(var n=_o(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r=function(t,e,n){var o,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(ko.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==n||"S"==n?(o=2*e.x-e.bx,r=2*e.y-e.by):(o=e.x,r=e.y),t=["C",o,r].concat(t.slice(1));break;case"T":"Q"==n||"T"==n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(Eo(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(Eo(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(bo(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(bo(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(bo(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(bo(e.x,e.y,e.X,e.Y))}return t},i=function(t,e){if(t[e].length>7){t[e].shift();for(var o=t[e];o.length;)a[e]="A",t.splice(e++,0,["C"].concat(o.splice(0,6)));t.splice(e,1),l=n.length}},a=[],c="",s="",u=0,l=n.length;u<l;u++){n[u]&&(c=n[u][0]),"C"!=c&&(a[u]=c,u&&(s=a[u-1])),n[u]=r(n[u],o,s),"A"!=a[u]&&"C"==c&&(a[u]="C"),i(n,u);var h=n[u],d=h.length;o.x=h[d-2],o.y=h[d-1],o.bx=Kn(h[d-4])||o.x,o.by=Kn(h[d-3])||o.y}return e.curve=lo(n),n}var jo=Un((function(t,e,n){t=Co(t),e=Co(e);for(var o,r,i,a,c,s,u,l,h,d,p=n?0:[],f=0,v=t.length;f<v;f++){var y=t[f];if("M"==y[0])o=c=y[1],r=s=y[2];else{"C"==y[0]?(h=[o,r].concat(y.slice(1)),o=h[6],r=h[7]):(h=[o,r,o,r,c,s,c,s],o=c,r=s);for(var g=0,m=e.length;g<m;g++){var x=e[g];if("M"==x[0])i=u=x[1],a=l=x[2];else{"C"==x[0]?(d=[i,a].concat(x.slice(1)),i=d[6],a=d[7]):(d=[i,a,i,a,u,l,u,l],i=u,a=l);var _=xo(h,d,n);if(n)p+=_;else{for(var w=0,b=_.length;w<b;w++)_[w].segment1=f,_[w].segment2=g,_[w].bez1=h,_[w].bez2=d;p=p.concat(_)}}}}}return p})),Mo=Math.round,Ro=Math.max;var Oo=10;function Po(t,e){return function(t,e){var n,o;for(n=0;o=t[n];n++)if(Hn(o,e)<=Oo)return{point:t[n],bendpoint:!0,index:n};return null}(t,e)||function(t,e){var n,o,r=jo(function(t,e){return[["M",t.x,t.y],["m",0,-e],["a",e,e,0,1,1,0,2*e],["a",e,e,0,1,1,0,-2*e],["z"]]}(e,Oo),(n=[],t.forEach((function(t,e){n.push([0===e?"M":"L",t.x,t.y])})),n)),i=r[0],a=r[r.length-1];return i?i!==a?i.segment2!==a.segment2?{point:t[o=Ro(i.segment2,a.segment2)-1],bendpoint:!0,index:o}:{point:{x:Mo(i.x+a.x)/2,y:Mo(i.y+a.y)/2},index:i.segment2}:{point:{x:Mo(i.x),y:Mo(i.y)},index:i.segment2}:null}(t,e)}function Bo(t,e){var n=e[0],o=e[1],r={x:o.x-n.x,y:o.y-n.y},i=function(t,e,n){var o=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}];return-(o[0].n*e[0]+o[1].n*e[1])/(o[0].lambda*e[0]+o[1].lambda*e[1])}([n.x,n.y],[r.x,r.y],[t.x,t.y]);return{x:n.x+i*r.x,y:n.y+i*r.y}}function zo(t,e){var n,o=Bo(t,e),r={x:o.x-t.x,y:o.y-t.y};return n=r,Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))}var To="djs-bendpoint",Ao="djs-segment-dragger";function Lo(t,e,n){var o=function(t,e){var n,o=dt(e),r=t._container.getBoundingClientRect();n={x:r.left,y:r.top};var i=t.viewbox();return{x:i.x+(o.x-n.x)/i.scale,y:i.y+(o.y-n.y)/i.scale}}(t,n);return Po(e,o)}function Do(t,e){var n=Bt("g");kt(n).add(To),mt(t,n);var o=Bt("circle");bt(o,{cx:0,cy:0,r:4}),kt(o).add("djs-visual"),mt(n,o);var r=Bt("circle");return bt(r,{cx:0,cy:0,r:10}),kt(r).add("djs-hit"),mt(n,r),e&&kt(n).add(e),n}function Io(t,e,n,o){var r=Bt("g");mt(t,r);var i=function(t,e,n){var o=e.x-t.x,r=e.y-t.y;return Ho("h"===n?o:r)}(e,n,o),a=Bt("rect");bt(a,{x:-9,y:-3,width:18,height:6}),kt(a).add("djs-visual"),mt(r,a);var c=Bt("rect");return bt(c,{x:-i/2,y:-8.5,width:i,height:17}),kt(c).add("djs-hit"),mt(r,c),function(t,e){var n=Lt();n.setRotate(e,0,0),Vt(t,n)}(r,"v"===o?90:0),r}function $o(t,e,n){var o=Bt("g"),r=qn(e,n),i=Gn(e,n);return mt(t,o),Io(o,e,n,i),kt(o).add(Ao),kt(o).add("h"===i?"horizontal":"vertical"),We(o,r.x,r.y),o}function Ho(t){return Math.abs(Math.round(2*t/3))}function No(t,e){var n=function(t,e){for(var n,o=e.waypoints,r=1/0,i=0;i<o.length-1;i++){var a=zo(t,[o[i],o[i+1]]);a<r&&(r=a,n=i)}return[o[n],o[n+1]]}(t,e);return Bo(t,n)}function Fo(t,e,n,o,r){function i(t,n){var i,a=n.waypoints,c=Lo(e,a,t);if(c)return i=function(t,e){var n,o,r=t.waypoints;return e.index<=0||e.bendpoint?null:(o=Gn((n={start:r[e.index-1],end:r[e.index]}).start,n.end))?Ho("h"===o?n.end.x-n.start.x:n.end.y-n.start.y)/2:null}(n,c),!function(t,e,n){var o,r,i,a,c,s,u=t.index,l=t.point;return!(u<=0||t.bendpoint)&&(i=qn(o=e[u-1],r=e[u]),a=Gn(o,r),c=Math.abs(l.x-i.x),s=Math.abs(l.y-i.y),a&&c<=n&&s<=n)}(c,a,i)?o.start(t,n,c.index,!c.bendpoint):r.start(t,n,c.index),!0}function a(t,e,o){Q.bind(t,e,(function(t){n.triggerMouseEvent(e,t,o),t.stopPropagation()}))}function c(t,n){var o=e.getLayer("overlays"),r=at('.djs-bendpoints[data-element-id="'+un(t.id)+'"]',o);return!r&&n&&(bt(r=Bt("g"),{"data-element-id":t.id}),kt(r).add("djs-bendpoints"),mt(o,r),a(r,"mousedown",t),a(r,"click",t),a(r,"dblclick",t)),r}function s(t,e){return at('.djs-segment-dragger[data-segment-idx="'+t+'"]',e)}function u(t,e){e.waypoints.forEach((function(e,n){var o=Do(t);mt(t,o),We(o,e.x,e.y)})),Do(t,"floating")}function l(t,e){for(var n,o,r,i=e.waypoints,c=1;c<i.length;c++)Gn(n=i[c-1],o=i[c])&&(bt(r=$o(t,n,o),{"data-segment-idx":c}),a(r,"mousemove",e))}function h(t){var e=c(t);return e||(u(e=c(t,!0),t),l(e,t)),e}function d(t){var e=c(t);e&&(!function(t){p(ct("."+Ao,t),(function(t){Ct(t)}))}(e),function(t){p(ct("."+To,t),(function(t){Ct(t)}))}(e),l(e,t),u(e,t))}function f(t,e,n){var o,r,i=s(e.index,t),a=n[e.index-1],c=n[e.index],u=e.point,l=qn(a,c),h=Gn(a,c);i&&(o=function(t){return at(".djs-visual",t)}(i),r={x:u.x-l.x,y:u.y-l.y},"v"===h&&(r={x:r.y,y:r.x}),We(o,r.x,r.y))}t.on("connection.changed",(function(t){d(t.element)})),t.on("connection.remove",(function(t){var e=c(t.element);e&&Ct(e)})),t.on("element.marker.update",(function(t){var e,n=t.element;n.waypoints&&(e=h(n),t.add?kt(e).add(t.marker):kt(e).remove(t.marker))})),t.on("element.mousemove",(function(t){var n,o,r=t.element,i=r.waypoints;if(i){if(n=c(r,!0),!(o=Lo(e,i,t.originalEvent)))return;!function(t,e){var n=at(".floating",t),o=e.point;n&&We(n,o.x,o.y)}(n,o),o.bendpoint||f(n,o,i)}})),t.on("element.mousedown",(function(t){if(ft(t)){var e=t.originalEvent,n=t.element;if(n.waypoints)return i(e,n)}})),t.on("selection.changed",(function(t){var e=t.newSelection[0];e&&e.waypoints&&h(e)})),t.on("element.hover",(function(t){var e=t.element;e.waypoints&&(h(e),n.registerEvent(t.gfx,"mousemove","element.mousemove"))})),t.on("element.out",(function(t){n.unregisterEvent(t.gfx,"mousemove","element.mousemove")})),t.on("element.updateId",(function(t){var e=t.element,n=t.newId;if(e.waypoints){var o=c(e);o&&bt(o,{"data-element-id":n})}})),this.addHandles=h,this.updateHandles=d,this.getBendpointsContainer=c,this.getSegmentDragger=s}function Go(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function Wo(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Vo(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function qo(t){for(var e=t.waypoints,n=e.reduce((function(t,n,o){var r,i,a=e[o-1];if(a){var c=t[t.length-1],s=c&&c.endLength||0,u=(r=a,i=n,Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)));t.push({start:a,end:n,startLength:s,endLength:s+u,length:u})}return t}),[]),o=n.reduce((function(t,e){return t+e.length}),0),r=o/2,i=0,a=n[i];a.endLength<r;)a=n[++i];var c=(r-a.startLength)/a.length;return{x:a.start.x+(a.end.x-a.start.x)*c,y:a.start.y+(a.end.y-a.start.y)*c}}function Uo(t){return Ve(t)?qo(t):Go({x:(e=t).x+(e.width||0)/2,y:e.y+(e.height||0)/2});var e}function Yo(t,e,n){a(n=n||0)||(n={x:n,y:n});var o=Wo(t),r=Wo(e),i=o.bottom+n.y<=r.top,c=o.left-n.x>=r.right,s=o.top-n.y>=r.bottom,u=i?"top":s?"bottom":null,l=o.right+n.x<=r.left?"left":c?"right":null;return l&&u?u+"-"+l:l||u||"intersect"}function Ko(t,e,n){var o=jo(t,e);return 1===o.length||2===o.length&&Hn(o[0],o[1])<1?Go(o[0]):o.length>1?(o=E(o,(function(t){var e=Math.floor(100*t.t2)||1;return e=((e=100-e)<10?"0":"")+e,t.segment2+"#"+e})),Go(o[n?0:o.length-1])):null}Fo.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];var Xo=Math.round,Zo="reconnectStart",Qo="reconnectEnd",Jo="updateWaypoints";function tr(t,e,n,o,r,i){this._injector=t,this.start=function(t,e,i,a){var c,s=n.getGraphics(e),u=e.source,l=e.target,h=e.waypoints,d=(c=a||0!==i?a||i!==h.length-1?Jo:Qo:Zo)===Jo?"connection.updateWaypoints":"connection.reconnect",p=r.allowed(d,{connection:e,source:u,target:l});!1===p&&(p=r.allowed(d,{connection:e,source:l,target:u})),!1!==p&&o.init(t,"bendpoint.move",{data:{connection:e,connectionGfx:s,context:{allowed:p,bendpointIndex:i,connection:e,source:u,target:l,insert:a,type:c}}})},e.on("bendpoint.move.hover",(function(t){var e,n=t.context,o=n.connection,i=o.source,a=o.target,c=t.hover,s=n.type;if(n.hover=c,c){var u=s===Jo?"connection.updateWaypoints":"connection.reconnect";if(e=n.allowed=r.allowed(u,{connection:o,source:s===Zo?c:i,target:s===Qo?c:a}))return n.source=s===Zo?c:i,void(n.target=s===Qo?c:a);!1===e&&(e=n.allowed=r.allowed(u,{connection:o,source:s===Qo?c:a,target:s===Zo?c:i})),e&&(n.source=s===Qo?c:a,n.target=s===Zo?c:i)}})),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],(function(t){var e=t.context,n=e.type;e.hover=null,e.source=null,e.target=null,n!==Jo&&(e.allowed=!1)})),e.on("bendpoint.move.end",(function(t){var e=t.context,n=e.allowed,o=e.bendpointIndex,r=e.connection,a=e.insert,c=r.waypoints.slice(),s=e.source,u=e.target,l=e.type,h=e.hints||{},d={x:Xo(t.x),y:Xo(t.y)};if(!n)return!1;l===Jo?(a?c.splice(o,0,d):c[o]=d,h.bendpointMove={insert:a,bendpointIndex:o},c=this.cropWaypoints(r,c),i.updateWaypoints(r,function(t){t=t.slice();for(var e,n,o,r=0;t[r];)e=t[r],n=t[r-1],0===Hn(e,o=t[r+1])||Nn(n,o,e)?t.splice(r,1):r++;return t}(c),h)):(l===Zo?(h.docking="source",er(e)&&(h.docking="target",h.newWaypoints=c.reverse())):l===Qo&&(h.docking="target",er(e)&&(h.docking="source",h.newWaypoints=c.reverse())),i.reconnect(r,s,u,d,h))}),this)}function er(t){var e=t.hover,n=t.source,o=t.target,r=t.type;return r===Zo?e&&o&&e===o&&n!==o:r===Qo?e&&n&&e===n&&n!==o:void 0}tr.$inject=["injector","eventBus","canvas","dragging","rules","modeling"],tr.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var o=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=o,e};var nr="updateWaypoints",or="connect-ok",rr="connect-not-ok",ir="connect-hover",ar="djs-updating",cr="djs-element-hidden";function sr(t,e,n,o){this._injector=e;var r=e.get("connectionPreview",!1);n.on("bendpoint.move.start",(function(t){var e=t.context,n=e.bendpointIndex,r=e.connection,i=e.insert,a=r.waypoints,c=a.slice();e.waypoints=a,i&&c.splice(n,0,{x:t.x,y:t.y}),r.waypoints=c,kt(e.draggerGfx=Do(o.getLayer("overlays"))).add("djs-dragging"),o.addMarker(r,cr),o.addMarker(r,ar)})),n.on("bendpoint.move.hover",(function(t){var e=t.context,n=e.allowed,r=e.hover,i=e.type;if(r){if(o.addMarker(r,ir),i===nr)return;n?(o.removeMarker(r,rr),o.addMarker(r,or)):!1===n&&(o.removeMarker(r,or),o.addMarker(r,rr))}})),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],1100,(function(t){var e=t.context,n=e.hover,r=e.target;n&&(o.removeMarker(n,ir),o.removeMarker(n,r?or:rr))})),n.on("bendpoint.move.move",(function(e){var n=e.context,o=n.allowed,i=n.bendpointIndex,a=n.draggerGfx,c=n.hover,s=n.type,u=n.connection,l=u.source,h=u.target,d=u.waypoints.slice(),p={x:e.x,y:e.y},f=n.hints||{},v={};r&&(f.connectionStart&&(v.connectionStart=f.connectionStart),f.connectionEnd&&(v.connectionEnd=f.connectionEnd),"reconnectStart"===s?er(n)?(v.connectionEnd=v.connectionEnd||p,v.source=h,v.target=c||l,d=d.reverse()):(v.connectionStart=v.connectionStart||p,v.source=c||l,v.target=h):"reconnectEnd"===s?er(n)?(v.connectionStart=v.connectionStart||p,v.source=c||h,v.target=l,d=d.reverse()):(v.connectionEnd=v.connectionEnd||p,v.source=l,v.target=c||h):(v.noCropping=!0,v.noLayout=!0,d[i]=p),s===nr&&(d=t.cropWaypoints(u,d)),v.waypoints=d,r.drawPreview(n,o,v)),We(a,e.x,e.y)}),this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],1100,(function(t){var e=t.context,n=e.connection,i=e.draggerGfx,a=e.hover,c=e.target,s=e.waypoints;n.waypoints=s,Ct(i),o.removeMarker(n,ar),o.removeMarker(n,cr),a&&(o.removeMarker(a,or),o.removeMarker(a,c?or:rr)),r&&r.cleanUp(e)}))}sr.$inject=["bendpointMove","injector","eventBus","canvas"];var ur="connect-hover",lr="djs-updating";function hr(t,e,n){return dr(t,e,t[e]+n)}function dr(t,e,n){return{x:"x"===e?n:t.x,y:"y"===e?n:t.y}}function pr(t){return"x"===t?"y":"x"}function fr(t,e,n){var o,r;return t.original?t.original:(o=Uo(e),dr(t,r=pr(n),o[r]))}function vr(t,e,n,o,r,i){var a=t.get("connectionDocking",!1);function c(t,e){if(!a)return e;var n,o=t.waypoints;return t.waypoints=e,n=a.getCroppedWaypoints(t),t.waypoints=o,n}function s(t){r.update("connection",t.connection,t.connectionGfx)}function u(t,e,n){var o=t.newWaypoints,r=function(t,e,n,o){var r=Math.max(e[o],n[o]),i=Math.min(e[o],n[o]);return dr(e,o,Math.min(Math.max(i+20,t[o]),r-20))}(n,o[t.segmentStartIndex+e],o[t.segmentEndIndex+e],pr(t.axis));We(t.draggerGfx,r.x,r.y)}this.start=function(t,e,r){var i,a,c,s,u=n.getGraphics(e),l=r-1,h=r,d=e.waypoints,p=d[l],f=d[h],v=Lo(n,d,t);(a=Gn(p,f))&&(c="v"===a?"x":"y",0===l&&(p=fr(p,e.source,c)),h===d.length-1&&(f=fr(f,e.target,c)),i={connection:e,segmentStartIndex:l,segmentEndIndex:h,segmentStart:p,segmentEnd:f,axis:c,dragPosition:s=v?v.point:{x:(p.x+f.x)/2,y:(p.y+f.y)/2}},o.init(t,s,"connectionSegment.move",{cursor:"x"===c?"resize-ew":"resize-ns",data:{connection:e,connectionGfx:u,context:i}}))},e.on("connectionSegment.move.start",(function(t){var e=t.context,o=t.connection,r=n.getLayer("overlays");e.originalWaypoints=o.waypoints.slice(),e.draggerGfx=$o(r,e.segmentStart,e.segmentEnd),kt(e.draggerGfx).add("djs-dragging"),n.addMarker(o,lr)})),e.on("connectionSegment.move.move",(function(t){var e,n,o=t.context,r=o.connection,i=o.segmentStartIndex,a=o.segmentEndIndex,l=o.segmentStart,h=o.segmentEnd,d=o.axis,p=o.originalWaypoints.slice(),f=hr(l,d,t["d"+d]),v=hr(h,d,t["d"+d]),y=p.length,g=0;p[i]=f,p[a]=v,i<2&&(e=Yo(r.source,f),1===i?"intersect"===e&&(p.shift(),p[0]=f,g--):"intersect"!==e&&(p.unshift(l),g++)),a>y-3&&(n=Yo(r.target,v),a===y-2?"intersect"===n&&(p.pop(),p[p.length-1]=v):"intersect"!==n&&p.push(h)),o.newWaypoints=r.waypoints=c(r,p),u(o,g,t),o.newSegmentStartIndex=i+g,s(t)})),e.on("connectionSegment.move.hover",(function(t){t.context.hover=t.hover,n.addMarker(t.hover,ur)})),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],(function(t){var e=t.context.hover;e&&n.removeMarker(e,ur)})),e.on("connectionSegment.move.cleanup",(function(t){var e=t.context,o=e.connection;e.draggerGfx&&Ct(e.draggerGfx),n.removeMarker(o,lr)})),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],(function(t){var e=t.context;e.connection.waypoints=e.originalWaypoints,s(t)})),e.on("connectionSegment.move.end",(function(t){var e=t.context,n=e.connection,o=e.newWaypoints,r=e.newSegmentStartIndex,a=function(t,e){var n=0;return{waypoints:t.filter((function(o,r){return!Nn(t[r-1],t[r+1],o)||(n=r<=e?n-1:n,!1)})),segmentOffset:n}}(o=o.map((function(t){return{original:t.original,x:Math.round(t.x),y:Math.round(t.y)}})),r),s=c(n,a.waypoints),u=a.segmentOffset,l={segmentMove:{segmentStartIndex:e.segmentStartIndex,newSegmentStartIndex:r+u}};i.updateWaypoints(n,s,l)}))}function yr(t,e,n){if("string"!=typeof e)throw new Error("axis must be in [x, y]");if("number"!=typeof n&&!1!==n)throw new Error("value must be Number or false");var o,r=t[e],i=t.snapped=t.snapped||{};return!1===n?i[e]=!1:(i[e]=!0,o=n-r,t[e]+=o,t["d"+e]+=o),r}vr.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var gr=Math.abs,mr=Math.round;function xr(t){function e(t,e){if(i(t)){for(var n=t.length;n--;)if(gr(t[n]-e)<=10)return t[n]}else{var o=e%(t=+t);if(o<10)return e-o;if(o>t-10)return e-o+t}return e}function n(t,e){return t.waypoints?No(e,t):t.width?{x:mr(t.width/2+t.x),y:mr(t.height/2+t.y)}:void 0}t.on("connectionSegment.move.move",1500,(function(t){var o,r,i=function(t){var e=t.context,o=e.snapPoints,r=e.connection,i=r.waypoints,a=e.segmentStart,c=e.segmentStartIndex,s=e.segmentEnd,u=e.segmentEndIndex,l=e.axis;if(o)return o;var h=[i[c-1],a,s,i[u+1]];return c<2&&h.unshift(n(r.source,t)),u>i.length-3&&h.unshift(n(r.target,t)),e.snapPoints=o={horizontal:[],vertical:[]},p(h,(function(t){t&&(t=t.original||t,"y"===l&&o.horizontal.push(t.y),"x"===l&&o.vertical.push(t.x))})),o}(t),a=t.x,c=t.y;if(i){var s=a-(o=e(i.vertical,a)),u=c-(r=e(i.horizontal,c));O(t,{dx:t.dx-s,dy:t.dy-u,x:o,y:r}),(s||-1!==i.vertical.indexOf(a))&&yr(t,"x",o),(u||-1!==i.horizontal.indexOf(c))&&yr(t,"y",r)}})),t.on(["connect.hover","connect.move","connect.end"],1500,(function(t){var e=t.context.hover,o=e&&n(e,t);Ve(e)&&o&&o.x&&o.y&&(yr(t,"x",o.x),yr(t,"y",o.y))})),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,(function(t){var o,r,i=t.context,a=function(t){var e=t.snapPoints,n=t.connection.waypoints,o=t.bendpointIndex;if(e)return e;var r=[n[o-1],n[o+1]];return t.snapPoints=e={horizontal:[],vertical:[]},p(r,(function(t){t&&(t=t.original||t,e.horizontal.push(t.y),e.vertical.push(t.x))})),e}(i),c=i.hover,s=c&&n(c,t),u=t.x,l=t.y;if(a){var h=u-(o=e(s?a.vertical.concat([s.x]):a.vertical,u)),d=l-(r=e(s?a.horizontal.concat([s.y]):a.horizontal,l));O(t,{dx:t.dx-h,dy:t.dy-d,x:t.x-h,y:t.y-d}),(h||-1!==a.vertical.indexOf(u))&&yr(t,"x",o),(d||-1!==a.horizontal.indexOf(l))&&yr(t,"y",r)}}))}xr.$inject=["eventBus"];var _r={__depends__:[Le,be],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",Fo],bendpointMove:["type",tr],bendpointMovePreview:["type",sr],connectionSegmentMove:["type",vr],bendpointSnapping:["type",xr]};function wr(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}function br(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n}function Er(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var o=t.indexOf(e);if(-1!==o){if(o===n)return;if(-1===n)return;t.splice(o,1)}-1!==n?t.splice(n,0,e):t.push(e)}}function kr(t,e){return t&&e?t.indexOf(e):-1}function Sr(t,e){if("function"!=typeof e)throw new Error("removeFn iterator must be a function");if(t){for(var n;n=t[0];)e(n);return t}}function Cr(t){this._eventBus=t}function jr(t){return function(e,n,o,r,i){(s(e)||c(e))&&(i=r,r=o,o=n,n=e,e=null),this.on(e,t,n,o,r,i)}}Cr.$inject=["eventBus"],Cr.prototype.on=function(t,e,n,o,r,u){if((s(e)||c(e))&&(u=r,r=o,o=n,n=e,e=null),s(n)&&(u=r,r=o,o=n,n=1e3),a(r)&&(u=r,r=!1),!s(o))throw new Error("handlerFn must be a function");i(t)||(t=[t]);var l=this._eventBus;p(t,(function(t){var i=["commandStack",t,e].filter((function(t){return t})).join(".");l.on(i,n,r?function(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}(o,u):o,u)}))},Cr.prototype.canExecute=jr("canExecute"),Cr.prototype.preExecute=jr("preExecute"),Cr.prototype.preExecuted=jr("preExecuted"),Cr.prototype.execute=jr("execute"),Cr.prototype.executed=jr("executed"),Cr.prototype.postExecute=jr("postExecute"),Cr.prototype.postExecuted=jr("postExecuted"),Cr.prototype.revert=jr("revert"),Cr.prototype.reverted=jr("reverted");function Mr(t,e,n){Cr.call(this,e);var o=t.get("movePreview",!1);e.on("shape.move.start",1400,(function(t){var e=t.context,n=e.shapes,o=e.validatedShapes;e.shapes=Rr(n),e.validatedShapes=Rr(o)})),o&&e.on("shape.move.start",250,(function(t){var e=t.context,n=e.shapes,r=[];p(n,(function(t){p(t.labels,(function(n){n.hidden||-1!==e.shapes.indexOf(n)||r.push(n),t.labelTarget&&r.push(t)}))})),p(r,(function(t){o.makeDraggable(e,t,!0)}))})),this.preExecuted("elements.move",1400,(function(t){var e=t.context.closure,n=e.enclosedElements,o=[];p(n,(function(t){p(t.labels,(function(t){n[t.id]||o.push(t)}))})),e.addAll(o)})),this.preExecute(["connection.delete","shape.delete"],(function(t){var e=t.context;Sr((e.connection||e.shape).labels,(function(t){n.removeShape(t,{nested:!0})}))})),this.execute("shape.delete",(function(t){var e=t.context,n=e.shape,o=n.labelTarget;o&&(e.labelTargetIndex=kr(o.labels,n),e.labelTarget=o,n.labelTarget=null)})),this.revert("shape.delete",(function(t){var e=t.context,n=e.shape,o=e.labelTarget,r=e.labelTargetIndex;o&&(Er(o.labels,n,r),n.labelTarget=o)}))}function Rr(t){return d(t,(function(e){return-1===t.indexOf(e.labelTarget)}))}wr(Mr,Cr),Mr.$inject=["injector","eventBus","modeling"];var Or={__init__:["labelSupport"],labelSupport:["type",Mr]};function Pr(t,e,n,o){t.on("element.changed",(function(o){var r=o.element;(r.parent||r===e.getRootElement())&&(o.gfx=n.getGraphics(r)),o.gfx&&t.fire(ue(r)+".changed",o)})),t.on("elements.changed",(function(e){var n=e.elements;n.forEach((function(e){t.fire("element.changed",{element:e})})),o.updateContainments(n)})),t.on("shape.changed",(function(t){o.update("shape",t.element,t.gfx)})),t.on("connection.changed",(function(t){o.update("connection",t.element,t.gfx)}))}Pr.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];var Br={__init__:["changeSupport"],changeSupport:["type",Pr]},zr=Math.max,Tr=Math.min,Ar=20;function Lr(t,e,n){var o=e[t],r=n.min&&n.min[t],i=n.max&&n.max[t];return c(r)&&(o=(/top|left/.test(t)?Tr:zr)(o,r)),c(i)&&(o=(/top|left/.test(t)?zr:Tr)(o,i)),o}function Dr(t,e){return void 0!==t?t:Ar}function Ir(t){return!t.waypoints&&"label"!==t.type}function $r(t,e){var n;if((n=void 0===t.length?d(t.children,Ir):t).length)return function(t,e){var n,o,r,i;return"object"==typeof e?(n=Dr(e.left),o=Dr(e.right),r=Dr(e.top),i=Dr(e.bottom)):n=o=r=i=Dr(e),{x:t.x-n,y:t.y-r,width:t.width+n+o,height:t.height+r+i}}(se(n),e)}function Hr(t,e,n,o){this._dragging=o,this._rules=e;var r=this;function i(t,e){var n,o=t.shape,i=t.direction,a=t.resizeConstraints;t.delta=e,n=function(t,e,n){var o=n.x,r=n.y,i={x:t.x,y:t.y,width:t.width,height:t.height};return-1!==e.indexOf("n")?(i.y=t.y+r,i.height=t.height-r):-1!==e.indexOf("s")&&(i.height=t.height+r),-1!==e.indexOf("e")?i.width=t.width+o:-1!==e.indexOf("w")&&(i.x=t.x+o,i.width=t.width-o),i}(o,i,e),t.newBounds=function(t,e){if(!e)return t;var n=Wo(t);return Vo({top:Lr("top",n,e),right:Lr("right",n,e),bottom:Lr("bottom",n,e),left:Lr("left",n,e)})}(n,a),t.canExecute=r.canResize(t)}function a(t){var e,o=t.shape,r=t.canExecute,i=t.newBounds;if(r){if(e=i,!function(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}(o,i={x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}))return;n.resizeShape(o,i)}}t.on("resize.start",(function(t){var e,n,o;e=t.context,n=e.resizeConstraints,o=e.minBounds,void 0===n&&(void 0===o&&(o=r.computeMinResizeBox(e)),e.resizeConstraints={min:Wo(o)})})),t.on("resize.move",(function(t){var e={x:t.dx,y:t.dy};i(t.context,e)})),t.on("resize.end",(function(t){a(t.context)}))}function Nr(t,e){var n=Uo(t),o=Wo(t),r={x:n.x,y:n.y};return-1!==e.indexOf("n")?r.y=o.top:-1!==e.indexOf("s")&&(r.y=o.bottom),-1!==e.indexOf("e")?r.x=o.right:-1!==e.indexOf("w")&&(r.x=o.left),r}function Fr(t){var e="resize-";return"n"===t||"s"===t?e+"ns":"e"===t||"w"===t?e+"ew":"nw"===t||"se"===t?e+"nwse":e+"nesw"}Hr.prototype.canResize=function(t){var e=this._rules,n=P(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)},Hr.prototype.activate=function(t,e,n){var o,r,i=this._dragging;if("string"==typeof n&&(n={direction:n}),!(r=(o=O({shape:e},n)).direction))throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");i.init(t,Nr(e,r),"resize",{autoActivate:!0,cursor:Fr(r),data:{shape:e,context:o}})},Hr.prototype.computeMinResizeBox=function(t){var e=t.shape;return function(t,e,n,o){var r=Wo(e),i={top:/n/.test(t)?r.bottom-n.height:r.top,left:/w/.test(t)?r.right-n.width:r.left,bottom:/s/.test(t)?r.top+n.height:r.bottom,right:/e/.test(t)?r.left+n.width:r.right},a=o?Wo(o):i;return Vo({top:Tr(i.top,a.top),left:Tr(i.left,a.left),bottom:zr(i.bottom,a.bottom),right:zr(i.right,a.right)})}(t.direction,e,t.minDimensions||{width:10,height:10},$r(e,t.childrenBoxPadding))},Hr.$inject=["eventBus","rules","modeling","dragging"];var Gr="djs-resizing",Wr="resize-not-ok";function Vr(t,e,n){t.on("resize.move",500,(function(t){var o,r,i,a;o=t.context,r=o.shape,i=o.newBounds,(a=o.frame)||(a=o.frame=n.addFrame(r,e.getActiveLayer()),e.addMarker(r,Gr)),i.width>5&&bt(a,{x:i.x,width:i.width}),i.height>5&&bt(a,{y:i.y,height:i.height}),o.canExecute?kt(a).remove(Wr):kt(a).add(Wr)})),t.on("resize.cleanup",(function(t){var n,o;n=t.context,o=n.shape,n.frame&&Ct(n.frame),e.removeMarker(o,Gr)}))}Vr.$inject=["eventBus","canvas","previewSupport"];var qr=-6,Ur="djs-resizer",Yr=["n","w","s","e","nw","ne","se","sw"];function Kr(t,e,n,o){this._resize=o,this._canvas=e;var r=this;t.on("selection.changed",(function(t){var e=t.newSelection;r.removeResizers(),1===e.length&&p(e,R(r.addResizer,r))})),t.on("shape.changed",(function(t){var e=t.element;n.isSelected(e)&&(r.removeResizers(),r.addResizer(e))}))}Kr.prototype.makeDraggable=function(t,e,n){var o=this._resize;function r(e){ft(e)&&o.activate(e,t,n)}Q.bind(e,"mousedown",r),Q.bind(e,"touchstart",r)},Kr.prototype._createResizer=function(t,e,n,o){var r=this._getResizersParent(),i=function(t){var e={x:0,y:0};-1!==t.indexOf("e")?e.x=6:-1!==t.indexOf("w")&&(e.x=qr);-1!==t.indexOf("s")?e.y=6:-1!==t.indexOf("n")&&(e.y=qr);return e}(o),a=Bt("g");kt(a).add(Ur),kt(a).add(Ur+"-"+t.id),kt(a).add(Ur+"-"+o),mt(r,a);var c=Bt("rect");bt(c,{x:-4+i.x,y:-4+i.y,width:8,height:8}),kt(c).add(Ur+"-visual"),mt(a,c);var s=Bt("rect");return bt(s,{x:-10+i.x,y:-10+i.y,width:20,height:20}),kt(s).add(Ur+"-hit"),mt(a,s),function(t,e,n,o,r){var i=Lt();i.setTranslate(e,n);var a=Lt();a.setRotate(o||0,0,0);var c=Lt();c.setScale(r||1,r||1),Vt(t,[i,a,c])}(a,e,n),a},Kr.prototype.createResizer=function(t,e){var n=Nr(t,e),o=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,o,e)},Kr.prototype.addResizer=function(t){var e=this;!Ve(t)&&this._resize.canResize({shape:t})&&p(Yr,(function(n){e.createResizer(t,n)}))},Kr.prototype.removeResizers=function(){jt(this._getResizersParent())},Kr.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},Kr.$inject=["eventBus","canvas","selection","resize"];var Xr={__depends__:[be,Le,Ne],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Hr],resizePreview:["type",Vr],resizeHandles:["type",Kr]},Zr=Math.min,Qr=Math.max;function Jr(t){t.preventDefault()}function ti(t){t.stopPropagation()}function ei(t){this.container=t.container,this.parent=it('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=at("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=R(this.autoResize,this),this.handlePaste=R(this.handlePaste,this)}function ni(t,e){this._eventBus=t,this._providers=[],this._textbox=new ei({container:e.getContainer(),keyHandler:R(this._handleKey,this),resizeHandler:R(this._handleResize,this)})}ei.prototype.create=function(t,e,n,o){var r=this.parent,i=this.content,a=this.container;o=this.options=o||{};var c=P(e=this.style=e||{},["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);O(r.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var s=P(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return O(i.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},s),o.centerVertically&&O(i.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},s),i.innerText=n,Q.bind(i,"keydown",this.keyHandler),Q.bind(i,"mousedown",ti),Q.bind(i,"paste",this.handlePaste),o.autoResize&&Q.bind(i,"input",this.autoResize),o.resizable&&this.resizable(e),a.appendChild(r),this.setSelection(i.lastChild,i.lastChild&&i.lastChild.length),r},ei.prototype.handlePaste=function(t){var e,n=this.options,o=this.style;if(t.preventDefault(),e=t.clipboardData?t.clipboardData.getData("text/plain"):window.clipboardData.getData("Text"),this.insertText(e),n.autoResize){var r=this.autoResize(o);r&&this.resizeHandler(r)}},ei.prototype.insertText=function(t){t=t.replace(/\r\n|\r|\n/g,"\n"),document.execCommand("insertText",!1,t)||this._insertTextIE(t)},ei.prototype._insertTextIE=function(t){var e,n,o,r=this.getSelection(),i=r.startContainer,a=r.endContainer,c=r.startOffset,s=r.endOffset,u=r.commonAncestorContainer,l=(e=u.childNodes,[].slice.call(e));if(function(t){return t.nodeType===Node.TEXT_NODE}(u)){var h=i.textContent;i.textContent=h.substring(0,c)+t+h.substring(s),n=i,o=c+t.length}else if(i===this.content&&a===this.content){var d=document.createTextNode(t);this.content.insertBefore(d,l[c]),n=d,o=d.textContent.length}else{var p=l.indexOf(i),f=l.indexOf(a);l.forEach((function(e,n){n===p?e.textContent=i.textContent.substring(0,c)+t+a.textContent.substring(s):n>p&&n<=f&&st(e)})),n=i,o=c+t.length}n&&void 0!==o&&setTimeout((function(){self.setSelection(n,o)}))},ei.prototype.autoResize=function(){var t=this.parent,e=this.content,n=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-n){var o=t.getBoundingClientRect(),r=e.scrollHeight;t.style.height=r+"px",this.resizeHandler({width:o.width,height:o.height,dx:0,dy:r-o.height})}},ei.prototype.resizable=function(){var t=this,e=this.parent,n=this.resizeHandle,o=parseInt(this.style.minWidth)||0,r=parseInt(this.style.minHeight)||0,i=parseInt(this.style.maxWidth)||1/0,a=parseInt(this.style.maxHeight)||1/0;if(!n){var c,s,u,l;n=this.resizeHandle=it('<div class="djs-direct-editing-resize-handle"></div>');var h=function(n){Jr(n),ti(n);var h=Zr(Qr(u+n.clientX-c,o),i),d=Zr(Qr(l+n.clientY-s,r),a);e.style.width=h+"px",e.style.height=d+"px",t.resizeHandler({width:u,height:l,dx:n.clientX-c,dy:n.clientY-s})},d=function(t){Jr(t),ti(t),Q.unbind(document,"mousemove",h,!1),Q.unbind(document,"mouseup",d,!1)};Q.bind(n,"mousedown",(function(t){Jr(t),ti(t),c=t.clientX,s=t.clientY;var n=e.getBoundingClientRect();u=n.width,l=n.height,Q.bind(document,"mousemove",h),Q.bind(document,"mouseup",d)}))}O(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),e.appendChild(n)},ei.prototype.destroy=function(){var t=this.parent,e=this.content,n=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),Q.unbind(e,"keydown",this.keyHandler),Q.unbind(e,"mousedown",ti),Q.unbind(e,"input",this.autoResize),Q.unbind(e,"paste",this.handlePaste),n&&(n.removeAttribute("style"),st(n)),st(t)},ei.prototype.getValue=function(){return this.content.innerText.trim()},ei.prototype.getSelection=function(){return window.getSelection().getRangeAt(0)},ei.prototype.setSelection=function(t,e){var n=document.createRange();null===t?n.selectNodeContents(this.content):(n.setStart(t,e),n.setEnd(t,e));var o=window.getSelection();o.removeAllRanges(),o.addRange(n)},ni.$inject=["eventBus","canvas"],ni.prototype.registerProvider=function(t){this._providers.push(t)},ni.prototype.isActive=function(t){return!(!this._active||t&&this._active.element!==t)},ni.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},ni.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})},ni.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0},ni.prototype.complete=function(){var t=this._active;if(t){var e,n=t.context.bounds,o=this.$textbox.getBoundingClientRect(),r=this.getValue();r===t.context.text&&o.height===n.height&&o.width===n.width||(e=this._textbox.container.getBoundingClientRect(),t.provider.update(t.element,r,t.context.text,{x:o.left-e.left,y:o.top-e.top,width:o.width,height:o.height})),this._fire("complete"),this.close()}},ni.prototype.getValue=function(){return this._textbox.getValue()},ni.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;return 27===e?(t.preventDefault(),this.cancel()):13!==e||t.shiftKey?void 0:(t.preventDefault(),this.complete())},ni.prototype._handleResize=function(t){this._fire("resize",t)},ni.prototype.activate=function(t){var e;this.isActive()&&this.cancel();var n=h(this._providers,(function(n){return(e=n.activate(t))?n:null}));return e&&(this.$textbox=this._textbox.create(e.bounds,e.style,e.text,e.options),this._active={element:t,context:e,provider:n},e.options&&e.options.resizable&&(this.resizable=!0),this._fire("activate")),!!e};var oi={__depends__:[ne],__init__:["directEditing"],directEditing:["type",ni]},ri="connect-ok",ii="connect-not-ok";function ai(t,e,n,o,r,i){t.on("connect.move",(function(t){var e,n=t.context,o=n.source,r=n.target,a=n.visual;e=function(t,e,n,o){var r=i.getShapePath(n),a=o&&i.getShapePath(o),c=i.getConnectionPath({waypoints:[t,e]});return[t=Ko(r,c,!0)||t,e=o&&Ko(a,c,!1)||e]}(n.sourcePosition,{x:t.x,y:t.y},o,r),bt(a,{points:[e[0].x,e[0].y,e[1].x,e[1].y]})})),t.on("connect.hover",(function(t){var e=t.context;e.source;var n,o=t.hover;null!==(n=e.canExecute=!0)&&(e.target=o,r.addMarker(o,n?ri:ii))})),t.on(["connect.out","connect.cleanup"],(function(t){var e=t.context;e.target&&r.removeMarker(e.target,e.canExecute?ri:ii),e.target=null,e.canExecute=!1})),t.on("connect.cleanup",(function(t){var e=t.context;e.visual&&Ct(e.visual)})),t.on("connect.start",(function(t){var e,n=t.context;bt(e=Bt("polyline"),{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),mt(r.getDefaultLayer(),e),n.visual=e})),t.on("connect.end",(function(t){var e=t.context;if(e.source,e.type,e.sourcePosition,e.target,t.x,t.y,!(e.canExecute||!0))return!1})),this.start=function(t,n,o,r,i){"object"!=typeof r&&(i=r,r=Uo(n)),e.init(t,"connect",{autoActivate:i,data:{shape:n,context:{type:o,source:n,sourcePosition:r}}})}}ai.$inject=["eventBus","dragging","modeling","rules","canvas","graphicsFactory"];var ci={__depends__:[_e,be,Le],connect:["type",ai]};function si(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}si.$inject=["eventBus","injector"],si.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction()},si.prototype.canExecute=function(t,e){const n={command:t,context:e},o=this._getHandler(t);let r=this._fire(t,"canExecute",n);if(void 0===r){if(!o)return!1;o.canExecute&&(r=o.canExecute(e))}return r},si.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,!1!==t&&this._fire("changed",{trigger:"clear"})},si.prototype.undo=function(){let t,e=this._getUndoAction();if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),t&&t.id===e.id);)e=t;this._popAction()}},si.prototype.redo=function(){let t,e=this._getRedoAction();if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),t&&t.id===e.id);)e=t;this._popAction()}},si.prototype.register=function(t,e){this._setHandler(t,e)},si.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)},si.prototype.canUndo=function(){return!!this._getUndoAction()},si.prototype.canRedo=function(){return!!this._getRedoAction()},si.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},si.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},si.prototype._internalUndo=function(t){const e=t.command,n=t.context,o=this._getHandler(e);this._atomicDo((()=>{this._fire(e,"revert",t),o.revert&&this._markDirty(o.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)}))},si.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const o=e?[t+"."+e,e]:[t];let r;n=this._eventBus.createEvent(n);for(const t of o)if(r=this._eventBus.fire("commandStack."+t,n),n.cancelBubble)break;return r},si.prototype._createId=function(){return this._uid++},si.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}},si.prototype._internalExecute=function(t,e){const n=t.command,o=t.context,r=this._getHandler(n);if(!r)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),r.preExecute&&r.preExecute(o),this._fire(n,"preExecuted",t)),this._atomicDo((()=>{this._fire(n,"execute",t),r.execute&&this._markDirty(r.execute(o)),this._executedAction(t,e),this._fire(n,"executed",t)})),e||(this._fire(n,"postExecute",t),r.postExecute&&r.postExecute(o),this._fire(n,"postExecuted",t)),this._popAction()},si.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,o=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=o&&o.id||this._createId()),n.push(t)},si.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,o=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:b("id",o.reverse())}),o.length=0,this._fire("changed",{trigger:e}),t.trigger=null)},si.prototype._markDirty=function(t){const e=this._currentExecution;t&&(t=i(t)?t:[t],e.dirty=e.dirty.concat(t))},si.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)},si.prototype._revertedAction=function(t){this._stackIdx--},si.prototype._getHandler=function(t){return this._handlerMap[t]},si.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};var ui={commandStack:["type",si]};function li(t){return O({original:t.point.original||t.point},t.actual)}function hi(t,e){this._elementRegistry=t,this._graphicsFactory=e}hi.$inject=["elementRegistry","graphicsFactory"],hi.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var o=this.getDockingPoint(t,e,!0),r=this.getDockingPoint(t,n),i=t.waypoints.slice(o.idx+1,r.idx);return i.unshift(li(o)),i.push(li(r)),i},hi.prototype.getDockingPoint=function(t,e,n){var o,r,i=t.waypoints;return{point:r=i[o=n?0:i.length-1],actual:this._getIntersection(e,t,n)||r,idx:o}},hi.prototype._getIntersection=function(t,e,n){return Ko(this._getShapePath(t),this._getConnectionPath(e),n)},hi.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)},hi.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)},hi.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var di={exports:{}},pi={};pi.extend=function(t,e,n,o){var r=n.inverse;return Object.defineProperty(t,"remove",{value:function(t){var n=this.indexOf(t);return-1!==n&&(this.splice(n,1),e.unset(t,r,o)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,n){var i=this.indexOf(t);if(void 0===n){if(-1!==i)return;n=this.length}-1!==i&&this.splice(i,1),this.splice(n,0,t),-1===i&&e.set(t,r,o)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},pi.isExtended=function(t){return!0===t.__refs_collection};var fi=pi;function vi(t,e,n){var o=fi.extend(n[e.name]||[],t,e,n);Object.defineProperty(n,e.name,{enumerable:e.enumerable,value:o}),o.length&&o.forEach((function(o){t.set(o,e.inverse,n)}))}function yi(t,e){if(!(this instanceof yi))return new yi(t,e);t.inverse=e,e.inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}yi.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}e.collection?vi(this,e,t):function(t,e,n){var o=e.inverse,r=n[e.name];Object.defineProperty(n,e.name,{configurable:e.configurable,enumerable:e.enumerable,get:function(){return r},set:function(e){if(e!==r){var i=r;r=null,i&&t.unset(i,o,n),r=e,t.set(r,o,n)}}})}(this,e,t)},yi.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return fi.isExtended(n)||vi(this,e,t),n},yi.prototype.ensureBound=function(t,e){(function(t,e){return Object.prototype.hasOwnProperty.call(t,e.name||e)})(t,e)||this.bind(t,e)},yi.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},yi.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var gi=yi;di.exports=gi,di.exports.Collection=pi;var mi=Un(di.exports),xi=new mi({name:"children",enumerable:!0,collection:!0},{name:"parent"}),_i=new mi({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),wi=new mi({name:"attachers",collection:!0},{name:"host"}),bi=new mi({name:"outgoing",collection:!0},{name:"source"}),Ei=new mi({name:"incoming",collection:!0},{name:"target"});function ki(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),xi.bind(this,"parent"),_i.bind(this,"labels"),bi.bind(this,"outgoing"),Ei.bind(this,"incoming")}function Si(){ki.call(this),xi.bind(this,"children"),wi.bind(this,"host"),wi.bind(this,"attachers")}function Ci(){ki.call(this),xi.bind(this,"children")}function ji(){Si.call(this),_i.bind(this,"labelTarget")}function Mi(){ki.call(this),bi.bind(this,"source"),Ei.bind(this,"target")}wr(Si,ki),wr(Ci,Si),wr(ji,Si),wr(Mi,ki);var Ri={connection:Mi,shape:Si,label:ji,root:Ci};function Oi(){this._uid=12}Oi.prototype.createRoot=function(t){return this.create("root",t)},Oi.prototype.createLabel=function(t){return this.create("label",t)},Oi.prototype.createShape=function(t){return this.create("shape",t)},Oi.prototype.createConnection=function(t){return this.create("connection",t)},Oi.prototype.create=function(t,e){return(e=O({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=Ri[t];if(!n)throw new Error("unknown type: <"+t+">");return O(new n,e)}(t,e)};var Pi,Bi={exports:{}},zi={exports:{}};try{var Ti=require("util");if("function"!=typeof Ti.inherits)throw"";Bi.exports=Ti.inherits}catch(wr){Bi.exports=(Pi||(Pi=1,"function"==typeof Object.create?zi.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:zi.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),zi.exports)}var Ai=Un(Bi.exports);function Li(){Oi.call(this)}function Di(){}Ai(Li,Oi),Li.prototype.createEnumeration=function(t){var e={shapeType:"enumeration",businessObject:{}};return O(e,t),this.createShape(e)},Li.prototype.createClass=function(t){var e={shapeType:"class",businessObject:{}};return O(e,t),this.createShape(e)},Li.prototype.createUmlLabel=function(t){var e={shapeType:"label"};return O(e,t),this.createLabel(e)},Li.prototype.createInheritance=function(t){var e={connectionType:"inheritance"};return O(e,t),this.createConnection(e)},Li.prototype.createAssociation=function(t){var e={connectionType:"association"};return O(e,t),this.createConnection(e)},Li.prototype.createAggregation=function(t){var e={connectionType:"aggregation"};return O(e,t),this.createConnection(e)},Li.prototype.createComposition=function(t){var e={connectionType:"composition"};return O(e,t),this.createConnection(e)},Li.prototype.createDependency=function(t){var e={connectionType:"dependency"};return O(e,t),this.createConnection(e)},Li.prototype.createRealization=function(t){var e={connectionType:"realization"};return O(e,t),this.createConnection(e)},Di.prototype.layoutConnection=function(t,e){return[(e=e||{}).connectionStart||Uo(e.source||t.source),e.connectionEnd||Uo(e.target||t.target)]};var Ii=20,$i=5,Hi=Math.round,Ni=20,Fi={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Gi(t,e,n){var o,r,i,a=Yo(e,t,$i),c=n.split(":")[0],s=Hi((e.x-t.x)/2+t.x),u=Hi((e.y-t.y)/2+t.y),l=(i=a,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[c].test(i)),h=/h|r|l/.test(c),d=!1,p=!1;return l?(o=h?{x:s,y:t.y}:{x:t.x,y:u},r=h?"h:h":"v:v"):(d=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(a,c),r=h?"h:v":"v:h",d?h?(p=u===t.y,o={x:t.x+Ii*(/l/.test(c)?-1:1),y:p?u+Ii:u}):o={x:(p=s===t.x)?s+Ii:s,y:t.y+Ii*(/t/.test(c)?-1:1)}:o={x:s,y:u}),{waypoints:Vi(t,o,r).concat(o),directions:r,turnNextDirections:p}}function Wi(t){return t.split(":").reverse().join(":")}function Vi(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(Zi(n)){var o=function(t,e,n){return Gi(t,e,n)}(t,e,n),r=function(t,e,n){var o=Gi(e,t,Wi(n));return{waypoints:o.waypoints.slice().reverse(),directions:Wi(o.directions),turnNextDirections:o.turnNextDirections}}(t,e,n),i=function(t,e){var n=t.directions.split(":")[1],o=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(o="h"==o?"v":"h");var r=n+":"+o;return{waypoints:Vi(t.waypoints[t.waypoints.length-1],e.waypoints[0],r),directions:r}}(o,r);return[].concat(o.waypoints,i.waypoints,r.waypoints)}return function(t,e,n){var o=Hi((e.x-t.x)/2+t.x),r=Hi((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:o,y:t.y},{x:o,y:e.y}];if("v:v"===n)return[{x:t.x,y:r},{x:e.x,y:r}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function qi(t,e,n){var o=Vi(t,e,n);return o.unshift(t),o.push(e),Ji(o)}function Ui(t,e,n,o,r){var i=f(r&&r.preferredLayouts||[],"straight")[0]||"h:h",a=Yo(t,e,Fi[i]||0),c=function(t,e){if(Zi(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}(a,i);n=n||Uo(t),o=o||Uo(e);var s=c.split(":"),u=Qi(n,t,s[0],function(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}(a));return qi(u,Qi(o,e,s[1],a),c)}function Yi(t,e,n,o,r,a){var c;return i(n)&&(r=n,a=o,n=Uo(t),o=Uo(e)),r=r||[],c=-1!==(a=O({preferredLayouts:[]},a)).preferredLayouts.indexOf("straight")&&function(t,e,n,o,r){var i,a,c={};if(a=Yo(t,e),!/^(top|bottom|left|right)$/.test(a))return null;/top|bottom/.test(a)&&(i="x");/left|right/.test(a)&&(i="y");return"target"===r.preserveDocking?Ki(i,o,t)?(c[i]=o[i],[{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y,original:{x:void 0!==c.x?c.x:n.x,y:void 0!==c.y?c.y:n.y}},{x:o.x,y:o.y}]):null:Ki(i,n,e)?(c[i]=n[i],[{x:n.x,y:n.y},{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y,original:{x:void 0!==c.x?c.x:o.x,y:void 0!==c.y?c.y:o.y}}]):null}(t,e,n,o,a),c||(c=a.connectionEnd&&function(t,e,n,o){var r=o.slice().reverse();return r=Xi(t,e,n,r),r?r.reverse():null}(e,t,o,r),c||((c=a.connectionStart&&Xi(t,e,n,r))||(!a.connectionStart&&!a.connectionEnd&&r&&r.length?r:Ui(t,e,n,o,a))))}function Ki(t,e,n){return function(t,e,n){return t>=e&&t<=n}(e[t],n[t],n[t]+n[{x:"width",y:"height"}[t]])}function Xi(t,e,n,o){if(function(t){return t.length<3||!(t.length>4)&&!!h(t,(function(e,n){var o=t[n-1];return o&&Hn(e,o)<3}))}(o))return null;var r,i=o[0],a=o.slice();return a[0]=n,a[1]=function(t,e,n){switch(Gn(e,t)){case"v":return{x:n.x,y:t.y};case"h":return{x:t.x,y:n.y}}return{x:t.x,y:t.y}}(a[1],i,n),r=function(t,e,n){var o;for(o=t.length-2;0!==o;o--)if(Vn(t[o],e,Ni)||Vn(t[o],n,Ni))return t.slice(o);return t}(a,t,e),r!==a&&(a=Xi(t,e,n,r)),a&&Gn(a)?null:a}function Zi(t){return t&&/t|r|b|l/.test(t)}function Qi(t,e,n,o){if("h"===n&&(n=/left/.test(o)?"l":"r"),"v"===n&&(n=/top/.test(o)?"t":"b"),"t"===n)return{original:t,x:t.x,y:e.y};if("r"===n)return{original:t,x:e.x+e.width,y:t.y};if("b"===n)return{original:t,x:t.x,y:e.y+e.height};if("l"===n)return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function Ji(t){return t.reduce((function(e,n,o){return Nn(e[e.length-1],t[o+1],n,0)||e.push(n),e}),[])}function ta(){}function ea(t){return a(t)&&l(t,"children")}function na(t,e,n){Cr.call(this,t),this.executed(["connection.layout","connection.create","connection.reconnectEnd","connection.reconnectStart"],(function(t){var n,o=t.context;o.cropped||((n=o.connection).waypoints=e.getCroppedWaypoints(n),o.cropped=!0)})),this.postExecuted(["connection.layout","connection.reconnectEnd","connection.reconnectStart","connection.updateWaypoints","connection.move"],(function(t){n.execute("layout.connection.labels",t.context)})),this.reverted(["connection.layout"],(function(t){delete t.context.cropped})),t.on("element.hover",1500,(function(t){if(qe(t.element)&&"classifier"===t.element.labelType)return!1}));t.on(["element.click","element.mousedown","element.mouseup","element.contextmenu","element.dblclick"],1500,(function(e){qe(e.element)&&"classifier"===e.element.labelType&&(e.stopPropagation(),t.fire(e.type,{element:e.element.parent,originalEvent:e.originalEvent,srcEvent:e.srcEvent}))}))}function oa(t,e){this._modeling=t,this._textRenderer=e}function ra(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function ia(t,e,n){var o=function(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}(t,e);return ra(t,e,n/o)}function aa(t){this._modeling=t}function ca(t,e,n){this._graphicsFactory=t,this._elementRegistry=e,this._selection=n}function sa(t,e){this._modeling=t,this._canvas=e}function ua(t){this._modeling=t}function la(t,e){this._canvas=t,this._layouter=e}Ai(ta,Di),ta.prototype.layoutConnection=function(t,e){e=e||{};var n=t.source,o=t.target,r=t.waypoints,i=e.connectionStart,a=e.connectionEnd,c=e;return O(c,{preferredLayouts:["v:v"]}),Ji(Yi(n,o,i,a,r,c))},Ai(na,Cr),na.$inject=["eventBus","connectionDocking","commandStack"],oa.$inject=["modeling","textRenderer"],oa.prototype.postExecute=function(t){var e=t.newLabel,n=t.element,o=this._textRenderer.getDimensions(e,{});"class"==n.type?n.businessObject.name=e:(n.businessObject=e,n.width=o.width,n.height=o.height),this._modeling.resizeShape(n,{x:n.x,y:n.y,width:Math.max(n.width,10),height:Math.max(n.height,10)})},aa.$inject=["modeling"],aa.prototype.preExecute=function(t){var e,n=this._modeling;function o(t,e,n){t.moveShape(e,{x:n.x-e.x,y:n.y-e.y})}function r(t,e,n){"left"===t?e.x-=n.width:"top"===t&&(e.y-=n.height)}function i(t,e,n){"left"===t?e.x-=5:"right"===t?e.x+=n.width+5:"top"===t?e.y-=5:"bottom"===t&&(e.y+=n.height+5)}function a(t,e,n,o){var r=ia(t,e,function(t){return t?15:5}(o));return!function(t){return"right"===t||"left"===t}(n)?r.x+=5:r.y+=5,r}function c(t,e){var n=t.connectionType;return"source"===e?"aggregation"===n||"composition"===n:"association"===n||"inheritance"===n}function s(t,e){return t.y===e.y?function(t,e){return t.x<e.x?"right":"left"}(t,e):function(t,e){return t.y<e.y?"bottom":"top"}(t,e)}e=t.connection,function(t,e){for(var n=function(t){var e=t.labels.filter((function(t){return"sourceCard"===t.labelType||"sourceName"===t.labelType}));return e.sort((function(t,e){return t.labelType.localeCompare(e.labelType)}))}(e),u=c(e,"source"),l=e.waypoints[0],h=e.waypoints[1],d=s(l,h),p=a(l,h,d,u),f=0;f<n.length;f++){var v=n[f];r(d,p,v),o(t,v,p),i(d,p,v)}}(n,e),function(t,e){for(var n=function(t){var e=t.labels.filter((function(t){return"targetCard"===t.labelType||"targetName"===t.labelType}));return e.sort((function(t,e){return t.labelType.localeCompare(e.labelType)}))}(e),u=c(e,"target"),l=e.waypoints[e.waypoints.length-1],h=e.waypoints[e.waypoints.length-2],d=s(l,h),p=a(l,h,d,u),f=0;f<n.length;f++){var v=n[f];r(d,p,v),o(t,v,p),i(d,p,v)}}(n,e)},ca.$inject=["graphicsFactory","elementRegistry","selection"],ca.prototype.execute=function(t){var e=t.element;this.hide(e),this._selection.deselect(e)},ca.prototype.hide=function(t){t.hidden=!0,ea(t)?qe(t)?this.hideLabel(t):this.hideShape(t):this.hideConnection(t)},ca.prototype.hideLabel=function(t){this.hideChildren(t),this.updateGfx(t,"shape")},ca.prototype.hideConnection=function(t){this.hideChildren(t),this.updateGfx(t,"connection")},ca.prototype.hideShape=function(t){this.hideAttachedEdges(t),this.hideChildren(t),this.updateGfx(t,"shape")},ca.prototype.hideAttachedEdges=function(t){this.hideIncomingAttachedEdges(t),this.hideOutgoingAttachedEdges(t)},ca.prototype.hideIncomingAttachedEdges=function(t){var e=this;"incoming"in t&&t.incoming.forEach((function(t){e.hide(t)}))},ca.prototype.hideOutgoingAttachedEdges=function(t){var e=this;"outgoing"in t&&t.outgoing.forEach((function(t){e.hide(t)}))},ca.prototype.hideChildren=function(t){var e=this;"children"in t&&t.children.forEach((function(t){e.hide(t)}))},ca.prototype.updateGfx=function(t,e){var n=this._elementRegistry.getGraphics(t,!1);this._graphicsFactory.update(e,t,n)},sa.$inject=["modeling","canvas"],sa.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,o=t.alignment;p(n,(function(t){var n={x:0,y:0};r(o.left)?n.x=o.left-t.x:r(o.right)?n.x=o.right-t.width-t.x:r(o.center)?n.x=o.center-Math.round(t.width/2)-t.x:r(o.top)?n.y=o.top-t.y:r(o.bottom)?n.y=o.bottom-t.height-t.y:r(o.middle)&&(n.y=o.middle-Math.round(t.height/2)-t.y),e.moveElements([t],n,t.parent)}))},sa.prototype.postExecute=function(t){},ua.$inject=["modeling"],ua.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,o=t.shape,r=t.hints||{};o=t.shape=this._modeling.createShape(o,t.position,n,{attach:r.attach}),t.shape=o},ua.prototype.postExecute=function(t){var e,n,o=t.hints||{};e=t.source,n=t.shape,g(e.outgoing,(function(t){return t.target===n}))||(o.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))},la.$inject=["canvas","layouter"],la.prototype.execute=function(t){var e=t.connection,n=t.source,o=t.target,r=t.parent,i=t.parentIndex,a=t.hints;if(!n||!o)throw new Error("source and target required");if(!r)throw new Error("parent required");return e.source=n,e.target=o,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,r,i),e},la.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var ha=Math.round;function da(t){this._modeling=t}da.$inject=["modeling"],da.prototype.preExecute=function(t){var e=t.elements,n=t.parent,o=t.parentIndex,r=t.position,i=t.hints,a=this._modeling;p(e,(function(t){c(t.x)||(t.x=0),c(t.y)||(t.y=0)}));var s=se(d(e,(function(t){return!t.hidden})));p(e,(function(t){Ve(t)&&(t.waypoints=m(t.waypoints,(function(t){return{x:ha(t.x-s.x-s.width/2+r.x),y:ha(t.y-s.y-s.height/2+r.y)}}))),O(t,{x:ha(t.x-s.x-s.width/2+r.x),y:ha(t.y-s.y-s.height/2+r.y)})}));var u=oe(e),l={};p(e,(function(t){if(Ve(t))l[t.id]=c(o)?a.createConnection(l[t.source.id],l[t.target.id],o,t,t.parent||n,i):a.createConnection(l[t.source.id],l[t.target.id],t,t.parent||n,i);else{var e=O({},i);-1===u.indexOf(t)&&(e.autoResize=!1),qe(t)&&(e=function(t,e){let n={};return p(Object(t),(function(t,o){-1===e.indexOf(o)&&(n[o]=t)})),n}(e,["attach"])),l[t.id]=c(o)?a.createShape(t,P(t,["x","y","width","height"]),t.parent||n,o,e):a.createShape(t,P(t,["x","y","width","height"]),t.parent||n,e)}})),t.elements=_(l)};var pa=Math.round;function fa(t){this._canvas=t}function va(t){fa.call(this,t)}fa.$inject=["canvas"],fa.prototype.execute=function(t){var e=t.shape,n=t.position,o=t.parent,r=t.parentIndex;if(!o)throw new Error("parent required");if(!n)throw new Error("position required");return void 0!==n.width?O(e,n):O(e,{x:n.x-pa(e.width/2),y:n.y-pa(e.height/2)}),this._canvas.addShape(e,o,r),e},fa.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e},wr(va,fa),va.$inject=["canvas"];var ya=fa.prototype.execute;va.prototype.execute=function(t){var e=t.shape;return function(t){["width","height"].forEach((function(e){void 0===t[e]&&(t[e]=0)}))}(e),e.labelTarget=t.labelTarget,ya.call(this,t)};var ga=fa.prototype.revert;function ma(t,e){this._canvas=t,this._modeling=e}function xa(t,e){this._modeling=t,this._elementRegistry=e}function _a(t,e){this._canvas=t,this._modeling=e}function wa(t){this._modeling=t}va.prototype.revert=function(t){return t.shape.labelTarget=null,ga.call(this,t)},ma.$inject=["canvas","modeling"],ma.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;Sr(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),Sr(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})}))},ma.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=kr(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e},ma.prototype.revert=function(t){var e=t.connection,n=t.parent,o=t.parentIndex;return e.source=t.source,e.target=t.target,Er(n.children,e,o),this._canvas.addConnection(e,n),e},xa.$inject=["modeling","elementRegistry"],xa.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry;p(t.elements,(function(t){n.get(t.id)&&(t.waypoints?e.removeConnection(t):e.removeShape(t))}))},_a.$inject=["canvas","modeling"],_a.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;Sr(n.incoming,(function(t){e.removeConnection(t,{nested:!0})})),Sr(n.outgoing,(function(t){e.removeConnection(t,{nested:!0})})),Sr(n.children,(function(t){Ve(t)?e.removeConnection(t,{nested:!0}):e.removeShape(t,{nested:!0})}))},_a.prototype.execute=function(t){var e=this._canvas,n=t.shape,o=n.parent;return t.oldParent=o,t.oldParentIndex=kr(o.children,n),e.removeShape(n),n},_a.prototype.revert=function(t){var e=this._canvas,n=t.shape,o=t.oldParent,r=t.oldParentIndex;return Er(o.children,n,r),e.addShape(n,o),n},wa.$inject=["modeling"];var ba={x:"y",y:"x"};function Ea(t,e){this._layouter=t,this._canvas=e}function ka(){}function Sa(t,e,n){var o=Oe(e),r=Oe(n),i=Pe(t,o),a=i.x*(n.width/e.width),c=i.y*(n.height/e.height);return Go({x:r.x+a,y:r.y+c})}function Ca(t,e,n){var o=Pa(t),r=Ba(o,e),i=o[0];return r.length?r[r.length-1]:Sa(i.original||i,n,e)}function ja(t,e,n){var o=Pa(t),r=Ba(o,e),i=o[o.length-1];return r.length?r[0]:Sa(i.original||i,n,e)}function Ma(t,e,n){var o=Pa(t),r=Oa(e,n),i=o[0];return Sa(i.original||i,r,e)}function Ra(t,e,n){var o=Pa(t),r=Oa(e,n),i=o[o.length-1];return Sa(i.original||i,r,e)}function Oa(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function Pa(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function Ba(t,e){return d(m(t,za),(function(t){return function(t,e){return"intersect"===Yo(e,t,1)}(t,e)}))}function za(t){return t.original||t}function Ta(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}function Aa(t){this._modeling=t}function La(t){this._helper=new Aa(t)}function Da(t){this._modeling=t,this._helper=new Aa(t)}function Ia(t){this._modeling=t}function $a(t){return t.original||t}function Ha(t,e){this._modeling=t,this._rules=e}function Na(t){this._modeling=t}function Fa(t,e){return-1!==t.indexOf(e)}function Ga(t){this._modeling=t}function Wa(t){return O({},t)}function Va(t){switch(t){case"n":case"s":return"y";case"w":case"e":return"x"}}function qa(t,e,n){var o=Va(n);return/e|s/.test(n)?t[o]>e:/n|w/.test(n)?t[o]<e:void 0}function Ua(t,e){return-1!==t.indexOf(e)}function Ya(t){this._modeling=t}function Ka(t){var e={};return p(t,(function(t){e[t.id]=t.hidden,t.children&&(e=O({},e,Ka(t.children)))})),e}function Xa(t,e){var n=[];return p(t,(function(t){t.hidden=e,n=n.concat(t),t.children&&(n=n.concat(Xa(t.children,t.collapsed||e)))})),n}function Za(t,e){var n=[];return p(t,(function(t){t.hidden=e[t.id],n=n.concat(t),t.children&&(n=n.concat(Za(t.children,e)))})),n}function Qa(t){this._modeling=t}function Ja(t,e){return br(t&&t.attachers,e)}function tc(t,e,n){if(t){var o=t.attachers;o||(t.attachers=o=[]),Er(o,e,n)}}function ec(){}function nc(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var o=this;t.on("diagram.init",(function(){o.registerHandlers(n)}))}function oc(t,e,n,o,r){this.canvas=r,this._textRenderer=o,nc.call(this,t,e,n)}wa.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,o=t.axis,r=t.dimension;function i(t,e){t.range.min=Math.min(e[o],t.range.min),t.range.max=Math.max(e[o]+e[r],t.range.max)}function a(t){return t[o]+t[r]/2}function c(t){return t.length-1}function s(t){return t.max-t.min}var u,l,h=n[0],d=c(n),f=n[d],v=0;p(n,(function(t,u){var l,h,f;t.elements.length<2?u&&u!==n.length-1&&(i(t,t.elements[0]),v+=s(t.range)):(h=(l=E(t.elements,o))[0],u===d&&(h=l[c(l)]),f=a(h),t.range=null,p(l,(function(n){!function(t,n){var r={y:0};r[o]=t-a(n),r[o]&&(r[ba[o]]=0,e.moveElements([n],r,n.parent))}(f,n),null!==t.range?i(t,n):t.range={min:n[o],max:n[o]+n[r]}})),u&&u!==n.length-1&&(v+=s(t.range)))})),l=Math.abs(f.range.min-h.range.max),(u=Math.round((l-v)/(n.length-1)))<n.length-1||p(n,(function(t,i){var a,c={};t!==h&&t!==f&&(a=n[i-1],t.range.max=0,p(t.elements,(function(n,i){c[ba[o]]=0,c[o]=a.range.max-n[o]+u,t.range.min!==n[o]&&(c[o]+=n[o]-t.range.min),c[o]&&e.moveElements([n],c,n.parent),t.range.max=Math.max(n[o]+n[r],i?t.range.max:0)})))}))},wa.prototype.postExecute=function(t){},Ea.$inject=["layouter","canvas"],Ea.prototype.execute=function(t){var e=t.connection;return O(t,{oldWaypoints:e.waypoints}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e},Ea.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e},ka.prototype.execute=function(t){var e=t.connection,n=t.delta,o=t.newParent||e.parent,r=t.newParentIndex,i=e.parent;return t.oldParent=i,t.oldParentIndex=br(i.children,e),Er(o.children,e,r),e.parent=o,p(e.waypoints,(function(t){t.x+=n.x,t.y+=n.y,t.original&&(t.original.x+=n.x,t.original.y+=n.y)})),e},ka.prototype.revert=function(t){var e=t.connection,n=e.parent,o=t.oldParent,r=t.oldParentIndex,i=t.delta;return br(n.children,e),Er(o.children,e,r),e.parent=o,p(e.waypoints,(function(t){t.x-=i.x,t.y-=i.y,t.original&&(t.original.x-=i.x,t.original.y-=i.y)})),e},Ta.prototype.add=function(t,e){return this.addAll([t],e)},Ta.prototype.addAll=function(t,e){var n=function(t,e,n){o(e)&&(e=!0),a(e)&&(n=e,e=!0);var r=he((n=n||{}).allShapes),i=he(n.allConnections),c=he(n.enclosedElements),s=he(n.enclosedConnections),u=he(n.topLevel,e&&w(t,(function(t){return t.id})));function l(t){u[t.source.id]&&u[t.target.id]&&(u[t.id]=[t]),r[t.source.id]&&r[t.target.id]&&(s[t.id]=c[t.id]=t),i[t.id]=t}return ae(t,(function(t){if(c[t.id]=t,!t.waypoints)return r[t.id]=t,p(t.incoming,l),p(t.outgoing,l),t.children;s[t.id]=i[t.id]=t})),{allShapes:r,allConnections:i,topLevel:u,enclosedConnections:s,enclosedElements:c}}(t,!!e,this);return O(this,n),this},Aa.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]},Aa.prototype.moveClosure=function(t,e,n,o,r){var i=this._modeling,a=t.allShapes,c=t.allConnections,s=t.enclosedConnections,u=t.topLevel,l=!1;r&&r.parent===n&&(l=!0),p(a,(function(t){i.moveShape(t,e,u[t.id]&&!l&&n,{recurse:!1,layout:!1})})),p(c,(function(t){var o=!!a[t.source.id],r=!!a[t.target.id];s[t.id]&&o&&r?i.moveConnection(t,e,u[t.id]&&!l&&n):i.layoutConnection(t,{connectionStart:o&&Ma(t,t.source,e),connectionEnd:r&&Ra(t,t.target,e)})}))},Aa.prototype.getClosure=function(t){return(new Ta).addAll(t,!0)},La.$inject=["modeling"],La.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)},La.prototype.postExecute=function(t){var e,n=t.hints;n&&n.primaryShape&&(e=n.primaryShape,n.oldParent=e.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,e)},Da.$inject=["modeling"],Da.prototype.execute=function(t){var e=t.shape,n=t.delta,o=t.newParent||e.parent,r=t.newParentIndex,i=e.parent;return t.oldBounds=P(e,["x","y","width","height"]),t.oldParent=i,t.oldParentIndex=br(i.children,e),Er(o.children,e,r),O(e,{parent:o,x:e.x+n.x,y:e.y+n.y}),e},Da.prototype.postExecute=function(t){var e=t.shape,n=t.delta,o=t.hints,r=this._modeling;!1!==o.layout&&(p(e.incoming,(function(t){r.layoutConnection(t,{connectionEnd:Ra(t,e,n)})})),p(e.outgoing,(function(t){r.layoutConnection(t,{connectionStart:Ma(t,e,n)})}))),!1!==o.recurse&&this.moveChildren(t)},Da.prototype.revert=function(t){var e=t.shape,n=t.oldParent,o=t.oldParentIndex,r=t.delta;return Er(n.children,e,o),O(e,{parent:n,x:e.x-r.x,y:e.y-r.y}),e},Da.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)},Da.prototype.getNewParent=function(t){return t.newParent||t.shape.parent},Ia.$inject=["modeling"],Ia.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,o=t.connection,r=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return i(r)&&(t.oldWaypoints=o.waypoints,o.waypoints=r),e&&(t.oldSource=o.source,o.source=e),n&&(t.oldTarget=o.target,o.target=n),o},Ia.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,o=t.newTarget,r=t.dockingOrPoints,a=t.hints||{},c={};a.connectionStart&&(c.connectionStart=a.connectionStart),a.connectionEnd&&(c.connectionEnd=a.connectionEnd),!1!==a.layoutConnection&&(!n||o&&"source"!==a.docking||(c.connectionStart=c.connectionStart||$a(i(r)?r[0]:r)),!o||n&&"target"!==a.docking||(c.connectionEnd=c.connectionEnd||$a(i(r)?r[r.length-1]:r)),a.newWaypoints&&(c.waypoints=a.newWaypoints),this._modeling.layoutConnection(e,c))},Ia.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,o=t.oldWaypoints,r=t.connection;return e&&(r.source=e),n&&(r.target=n),o&&(r.waypoints=o),r},Ha.$inject=["modeling","rules"],Ha.prototype.preExecute=function(t){var e,n=this,o=this._modeling,r=this._rules,i=t.oldShape,a=t.newData,c=t.hints||{};function s(t,e,n){return r.allowed("connection.reconnect",{connection:n,source:t,target:e})}var u,l={x:a.x,y:a.y},h={x:i.x,y:i.y,width:i.width,height:i.height};e=t.newShape=t.newShape||n.createShape(a,l,i.parent,c),i.host&&o.updateAttachment(e,i.host),!1!==c.moveChildren&&(u=i.children.slice(),o.moveElements(u,{x:0,y:0},e,c));var d=i.incoming.slice(),f=i.outgoing.slice();p(d,(function(t){s(t.source,e,t)&&n.reconnectEnd(t,e,ja(t,e,h),c)})),p(f,(function(t){var o=t.target;s(e,o,t)&&n.reconnectStart(t,e,Ca(t,e,h),c)}))},Ha.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)},Ha.prototype.execute=function(t){},Ha.prototype.revert=function(t){},Ha.prototype.createShape=function(t,e,n,o){return this._modeling.createShape(t,e,n,o)},Ha.prototype.reconnectStart=function(t,e,n,o){this._modeling.reconnectStart(t,e,n,o)},Ha.prototype.reconnectEnd=function(t,e,n,o){this._modeling.reconnectEnd(t,e,n,o)},Na.$inject=["modeling"],Na.prototype.execute=function(t){var e=t.shape,n=t.newBounds,o=t.minBounds;if(void 0===n.x||void 0===n.y||void 0===n.width||void 0===n.height)throw new Error("newBounds must have {x, y, width, height} properties");if(o&&(n.width<o.width||n.height<o.height))throw new Error("width and height cannot be less than minimum height and width");if(!o&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},O(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Na.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,o=t.oldBounds;!1!==(t.hints||{}).layout&&(p(n.incoming,(function(t){e.layoutConnection(t,{connectionEnd:ja(t,n,o)})})),p(n.outgoing,(function(t){e.layoutConnection(t,{connectionStart:Ca(t,n,o)})})))},Na.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return O(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e},Ga.$inject=["modeling"],Ga.prototype.preExecute=function(t){var e=t.delta,n=t.direction,o=t.movingShapes,r=t.resizingShapes,i=t.start,a={};this.moveShapes(o,e),p(r,(function(t){a[t.id]=function(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}(t)})),this.resizeShapes(r,e,n),this.updateConnectionWaypoints(function(t,e){var n=[];return p(t.concat(e),(function(o){var r=o.incoming,i=o.outgoing;p(r.concat(i),(function(o){var r=o.source,i=o.target;(Fa(t,r)||Fa(t,i)||Fa(e,r)||Fa(e,i))&&(Fa(n,o)||n.push(o))}))})),n}(o,r),e,n,i,o,r,a)},Ga.prototype.execute=function(){},Ga.prototype.revert=function(){},Ga.prototype.moveShapes=function(t,e){var n=this;p(t,(function(t){n._modeling.moveShape(t,e,null,{autoResize:!1,layout:!1,recurse:!1})}))},Ga.prototype.resizeShapes=function(t,e,n){var o=this;p(t,(function(t){var r=function(t,e,n){var o=t.x,r=t.y,i=t.width,a=t.height,c=n.x,s=n.y;switch(e){case"n":return{x:o,y:r+s,width:i,height:a-s};case"s":return{x:o,y:r,width:i,height:a+s};case"w":return{x:o+c,y:r,width:i-c,height:a};case"e":return{x:o,y:r,width:i+c,height:a};default:throw new Error("unknown direction: "+e)}}(t,n,e);o._modeling.resizeShape(t,r,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},Ga.prototype.updateConnectionWaypoints=function(t,e,n,o,r,i,a){var c=this,s=r.concat(i);p(t,(function(t){var u=t.source,l=t.target,h=function(t){return m(t.waypoints,(function(t){return(t=Wa(t)).original&&(t.original=Wa(t.original)),t}))}(t),d=Va(n),p={};Ua(s,u)&&Ua(s,l)?(h=m(h,(function(t){return qa(t,o,n)&&(t[d]=t[d]+e[d]),t.original&&qa(t.original,o,n)&&(t.original[d]=t.original[d]+e[d]),t})),c._modeling.updateWaypoints(t,h,{labelBehavior:!1})):(Ua(s,u)||Ua(s,l))&&(Ua(r,u)?p.connectionStart=Ma(t,u,e):Ua(r,l)?p.connectionEnd=Ra(t,l,e):Ua(i,u)?p.connectionStart=Ca(t,u,a[u.id]):Ua(i,l)&&(p.connectionEnd=ja(t,l,a[l.id])),c._modeling.layoutConnection(t,p))}))},Ya.$inject=["modeling"],Ya.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=Ka(n),e.collapsed=!e.collapsed;var o=Xa(n,e.collapsed);return[e].concat(o)},Ya.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,o=Za(e.children,n);return e.collapsed=!e.collapsed,[e].concat(o)},Qa.$inject=["modeling"],Qa.prototype.execute=function(t){var e=t.shape,n=t.newHost,o=e.host;return t.oldHost=o,t.attacherIdx=Ja(o,e),tc(n,e),e.host=n,e},Qa.prototype.revert=function(t){var e=t.shape,n=t.newHost,o=t.oldHost,r=t.attacherIdx;return e.host=o,Ja(n,e),tc(o,e,r),e},ec.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e},ec.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e},nc.$inject=["eventBus","elementFactory","commandStack"],nc.prototype.getHandlers=function(){return{"shape.append":ua,"shape.create":fa,"shape.delete":_a,"shape.move":Da,"shape.resize":Na,"shape.replace":Ha,"shape.toggleCollapse":Ya,spaceTool:Ga,"label.create":va,"connection.create":la,"connection.delete":ma,"connection.move":ka,"connection.layout":Ea,"connection.updateWaypoints":ec,"connection.reconnect":Ia,"elements.create":da,"elements.move":La,"elements.delete":xa,"elements.distribute":wa,"elements.align":sa,"element.updateAttachment":Qa}},nc.prototype.registerHandlers=function(t){p(this.getHandlers(),(function(e,n){t.registerHandler(n,e)}))},nc.prototype.moveShape=function(t,e,n,o,r){"object"==typeof o&&(r=o,o=null);var i={shape:t,delta:e,newParent:n,newParentIndex:o,hints:r||{}};this._commandStack.execute("shape.move",i)},nc.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)},nc.prototype.moveElements=function(t,e,n,o){var r,i=(o=o||{}).attach,a=n;!0===i?(r=n,a=n.parent):!1===i&&(r=null);var c={shapes:t,delta:e,newParent:a,newHost:r,hints:o};this._commandStack.execute("elements.move",c)},nc.prototype.moveConnection=function(t,e,n,o,r){"object"==typeof o&&(r=o,o=void 0);var i={connection:t,delta:e,newParent:n,newParentIndex:o,hints:r||{}};this._commandStack.execute("connection.move",i)},nc.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)},nc.prototype.createConnection=function(t,e,n,o,r,i){"object"==typeof n&&(i=r,r=o,o=n,n=void 0);var a={source:t,target:e,parent:r,parentIndex:n,connection:o=this._create("connection",o),hints:i};return this._commandStack.execute("connection.create",a),a.connection},nc.prototype.createShape=function(t,e,n,o,r){"number"!=typeof o&&(r=o,o=void 0);var i,a,c=(r=r||{}).attach;t=this._create("shape",t),c?(i=n.parent,a=n):i=n;var s={position:e,shape:t,parent:i,parentIndex:o,host:a,hints:r};return this._commandStack.execute("shape.create",s),s.shape},nc.prototype.createElements=function(t,e,n,o,r){i(t)||(t=[t]),"number"!=typeof o&&(r=o,o=void 0);var a={position:e,elements:t,parent:n,parentIndex:o,hints:r=r||{}};return this._commandStack.execute("elements.create",a),a.elements},nc.prototype.createLabel=function(t,e,n,o){n=this._create("label",n);var r={labelTarget:t,position:e,parent:o||t.parent,shape:n};return this._commandStack.execute("label.create",r),r.shape},nc.prototype.appendShape=function(t,e,n,o,r){r=r||{};var i={source:t,position:n,target:o,shape:e=this._create("shape",e),connection:r.connection,connectionParent:r.connectionParent,hints:r};return this._commandStack.execute("shape.append",i),i.shape},nc.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)},nc.prototype.distributeElements=function(t,e,n){var o={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",o)},nc.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)},nc.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)},nc.prototype.replaceShape=function(t,e,n){var o={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",o),o.newShape},nc.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)},nc.prototype.resizeShape=function(t,e,n,o){var r={shape:t,newBounds:e,minBounds:n,hints:o};this._commandStack.execute("shape.resize",r)},nc.prototype.createSpace=function(t,e,n,o,r){var i={delta:n,direction:o,movingShapes:t,resizingShapes:e,start:r};this._commandStack.execute("spaceTool",i)},nc.prototype.updateWaypoints=function(t,e,n){var o={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",o)},nc.prototype.reconnect=function(t,e,n,o,r){var i={connection:t,newSource:e,newTarget:n,dockingOrPoints:o,hints:r||{}};this._commandStack.execute("connection.reconnect",i)},nc.prototype.reconnectStart=function(t,e,n,o){o||(o={}),this.reconnect(t,e,t.target,n,O(o,{docking:"source"}))},nc.prototype.reconnectEnd=function(t,e,n,o){o||(o={}),this.reconnect(t,t.source,e,n,O(o,{docking:"target"}))},nc.prototype.connect=function(t,e,n,o){return this.createConnection(t,e,n||{},t.parent,o)},nc.prototype._create=function(t,e){return e instanceof ki?e:this._elementFactory.create(t,e)},nc.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)},Ai(oc,nc),oc.$inject=["eventBus","elementFactory","commandStack","textRenderer","canvas"],oc.prototype.getHandlers=function(){var t=nc.prototype.getHandlers.call(this);return t["element.updateLabel"]=oa,t["layout.connection.labels"]=aa,t["element.hide"]=ca,t},oc.prototype.updateLabel=function(t,e){this._commandStack.execute("element.updateLabel",{element:t,newLabel:e})},oc.prototype.connect=function(t,e,n,o,r){return this.createConnection(t,e,O({connectionType:n},o),t.parent)},oc.prototype.hide=function(t){var e={element:t};this._commandStack.execute("element.hide",e)};var rc={__init__:["umlUpdater","modeling"],__depends__:[ui],connectionDocking:["type",hi],elementFactory:["type",Li],modeling:["type",oc],umlUpdater:["type",na],layouter:["type",ta]},ic="drop-ok",ac="drop-not-ok",cc="attach-ok",sc="new-parent",uc="create";function lc(t,e,n,o,r){function a(e,n){[cc,ic,ac,sc].forEach((function(o){o===n?t.addMarker(e,o):t.removeMarker(e,o)}))}function s(){var t=e.context();t&&t.prefix===uc&&e.cancel()}n.on(["create.move","create.hover"],(function(t){var e=t.context;e.elements;var n=t.hover;if(e.source,e.hints,!n)return e.canExecute=!1,void(e.target=null);!function(t){var e=t.context,n=e.createConstraints;if(!n)return;n.left&&(t.x=Math.max(t.x,n.left));n.right&&(t.x=Math.min(t.x,n.right));n.top&&(t.y=Math.max(t.y,n.top));n.bottom&&(t.y=Math.min(t.y,n.bottom))}(t),t.x,t.y;var o=e.canExecute=n;n&&null!==o&&(e.target=n,o&&o.attach?a(n,cc):a(n,o?sc:ac))})),n.on(["create.end","create.out","create.cleanup"],(function(t){var e=t.hover;e&&a(e,null)})),n.on("create.ended",(function(t){n.fire("create."+t.context.type,{context:{bounds:{x:t.x,y:t.y,width:t.shape.width,height:t.shape.height}}})})),n.on("create.end",(function(t){return!0})),n.on("create.init",(function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],2e3,(function(){n.off("elements.changed",s)}))})),this.start=function(t,n,o){i(n)||(n=[n]);var r=h(n,(function(t){return!Ve(t)}));if(r){o=O({elements:n,hints:{},shape:r},o||{}),p(n,(function(t){c(t.x)||(t.x=0),c(t.y)||(t.y=0)}));var a=se(d(n,(function(t){return!t.hidden})));p(n,(function(t){Ve(t)&&(t.waypoints=m(t.waypoints,(function(t){return{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2}}))),O(t,{x:t.x-a.x-a.width/2,y:t.y-a.y-a.height/2})})),e.init(t,uc,{cursor:"grabbing",autoActivate:!0,data:{shape:r,elements:n,context:o}})}}}lc.$inject=["canvas","dragging","eventBus","modeling","rules"];var hc={__depends__:[Le],create:["type",lc]};function dc(t,e,n,o,r,i){this._create=t,this._elementFactory=e,this._lassoTool=n,this._palette=o,this._textRenderer=r,this._eventBus=i,o.registerProvider(this)}dc.$inject=["create","elementFactory","lassoTool","palette","textRenderer","eventBus"],dc.prototype.getPaletteEntries=function(){var t=this._create,e=this._elementFactory,n=this._lassoTool;function o(n,o,r,i){function a(o){var r=e.createClass({width:200,height:100,name:"Name"}),i={type:n};t.start(o,r,i)}return{group:o,className:r,title:i,action:{dragstart:a,click:a}}}return this._textRenderer,this._eventBus,{"lasso-tool":{group:"tools",className:"palette-icon-lasso-tool",title:"Activate Lasso Tool",action:{click:function(t){n.activateSelection(t)}}},"tool-separator":{group:"tools",separator:!0},"create-class":o("class","create","palette-icon-create-class","Create Class"),"create-enumeration":o("enumeration","create","palette-icon-create-enumeration","Create Enumeration")}};var pc={__depends__:[hc,mn,sn],__init__:["paletteProvider"],paletteProvider:["type",dc]},fc={__depends__:[ui,Br,_e,be],__init__:["modeling"],modeling:["type",nc],layouter:["type",Di]};function vc(t,e,n,o){this._connect=t,this._modeling=n,this._eventBus=o,this._contextPad=e,e.registerProvider(this)}vc.$inject=["connect","contextPad","modeling","eventBus"],vc.prototype.getContextPadEntries=function(t){var e=this._modeling,n=this._connect,o=this._eventBus,r=this._contextPad;function i(t,e){o.fire("delete.element",{context:{element:e}})}function a(t,e,o){n.start(t,e,o)}function c(t,e){O(t,{context:{shape:e}}),o.fire("create.class.property",t)}function s(t,n){e.hide(n),r.close()}function u(t,e){return{group:"add",className:"context-pad-icon-"+t,title:e,action:{click:function(e,n){a(e,n,t)},dragstart:function(e,n){a(e,n,t)}}}}var l={delete:{group:"admin",className:"context-pad-icon-delete",title:"Remove",action:{click:i,dragstart:i}},hide:{group:"admin",className:"context-pad-icon-hide",title:"Hide Part",action:{click:s}}};return ea(t)&&!qe(t)&&("stereotypes"in t&&-1!=t.stereotypes.indexOf("enumeration")||O(l,{"inheritance-connection":u("inheritance","Inheritance Connection"),"composition-connection":u("composition","Composition Connection"),"association-connection":u("association","Association Connection"),"create-property":{group:"add",className:"context-pad-icon-create-property",title:"Create Property",action:{click:c}}}),t.isImported&&O(l,{goto:{group:"admin",className:"context-pad-icon-goto",title:"Go to",action:{click:function(t,e){o.fire("element.goto",{context:{element:e}})}}}})),l};var yc={__depends__:[$n,ci,fc],__init__:["contextPadProvider"],contextPadProvider:["type",vc]};function gc(t){Cr.call(this,t),this.init()}function mc(t){gc.call(this,t)}gc.$inject=["eventBus"],wr(gc,Cr),gc.prototype.addRule=function(t,e,n){var o=this;"string"==typeof t&&(t=[t]),t.forEach((function(t){o.canExecute(t,e,(function(t,e,o){return n(t)}),!0)}))},gc.prototype.init=function(){},Ai(mc,gc),mc.$inject=["eventBus"],mc.prototype.init=function(){this.addRule("shape.resize",(function(t){var e=t.shape;return ea(e)&&!qe(e)})),this.addRule("elements.move",(function(t){var e;return!t.shapes.some((function(t){return qe(t)}))&&!(qe(t.target)||ea(t.target)&&(e=t.target,!a(e)||null!=e.parent))}))};var xc={__depends__:[be],__init__:["umlRulesProvider"],umlRulesProvider:["type",mc]};function _c(t){return Math.log(t)/Math.log(10)}function wc(t,e){var n=_c(t.min),o=_c(t.max);return(Math.abs(n)+Math.abs(o))/e}var bc=Math.sign||function(t){return t>=0?1:-1},Ec={min:.2,max:4};function kc(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=R(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var o=this;e.on("canvas.init",(function(e){o._init(!1!==t.enabled)}))}kc.$inject=["config.zoomScroll","eventBus","canvas"],kc.prototype.scroll=function(t){this._canvas.scroll(t)},kc.prototype.reset=function(){this._canvas.zoom("fit-viewport")},kc.prototype.zoom=function(t,e){var n=wc(Ec,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},kc.prototype._handleWheel=function(t){if(!q(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,o=t.ctrlKey,r=t.shiftKey,i=-1*this._scale;if(i*=o?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,o){var a=e.getBoundingClientRect(),c={x:t.clientX-a.left,y:t.clientY-a.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*bc(t.deltaY)*i,this.zoom(n,c)}else n=r?{dx:i*t.deltaY,dy:0}:{dx:i*t.deltaX,dy:i*t.deltaY},this.scroll(n)}},kc.prototype.stepZoom=function(t,e){var n=wc(Ec,10);this._zoom(t,e,n)},kc.prototype._zoom=function(t,e,n){var o=this._canvas,r=t>0?1:-1,i=_c(o.zoom()),a=Math.round(i/n)*n;a+=n*r;var c,s,u=Math.pow(10,a);o.zoom((c=Ec,s=u,Math.max(c.min,Math.min(c.max,s))),e)},kc.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,o=this._enabled;return void 0===t&&(t=!o),o!==t&&Q[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},kc.prototype._init=function(t){this.toggle(t)};var Sc={__init__:["zoomScroll"],zoomScroll:["type",kc]};function Cc(t,e){var n;function o(o){var r,i=n.start,a=n.button,c=dt(o),s=Pe(c,i);(!n.dragging&&(r=s,Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))>15)&&(n.dragging=!0,0===a&&Re(t),Ce("grab")),n.dragging)&&(s=Pe(c,n.last||n.start),e.scroll({dx:s.x,dy:s.y}),n.last=c);o.preventDefault()}function r(t){Q.unbind(document,"mousemove",o),Q.unbind(document,"mouseup",r),n=null,je()}t.on("element.mousedown",500,(function(t){return function(t){if(q(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:dt(t)},Q.bind(document,"mousemove",o),Q.bind(document,"mouseup",r),!0}(t.originalEvent)})),this.isActive=function(){return!!n}}Cc.$inject=["eventBus","canvas"];var jc={__init__:["moveCanvas"],moveCanvas:["type",Cc]},Mc=1e3;function Rc(t,e){var n=this;e=e||Mc,t.on(["render.shape","render.connection"],e,(function(t,e){var o=t.type,r=e.element,i=e.gfx,a=e.attrs;if(n.canRender(r))return"render.shape"===o?n.drawShape(i,r,a):n.drawConnection(i,r,a)})),t.on(["render.getShapePath","render.getConnectionPath"],e,(function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)}))}function Oc(t,e,n,o){var r=o.createText(e,n);return kt(r).add("djs-label"),mt(t,r),r}function Pc(t,e,n,o){var r=function(t,e,n){var o=Bt("rect");return function(t,e,n){bt(t,{width:e,height:n})}(o,t,e),Ac(o,n),o}(e,n,o);return mt(t,r),r}function Bc(t,e,n){var o=Tc(e),r=function(t){var e=Tc(t);return zc(e,{stroke:"white","stroke-width":10})}(function(t){var e=t.length,n=t.slice();e>=2&&(n[0]=ra(t[0],t[1],.1),n[e-1]=ra(t[e-2],t[e-1],.9));return n}(e)),i=function(t){var e=Bt("g");return t.forEach((function(t){mt(e,t)})),e}([r,zc(o,n)]);return mt(t,i),i}function zc(t,e){var n=Bt("path");return function(t,e){bt(t,{d:e})}(n,t),function(t,e){"markerEnd"in e&&bt(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&bt(t,{"marker-start":"url(#"+e.markerStart+")"})}(n,e),function(t,e){"transform"in e&&bt(t,{transform:e.transform})}(n,e),Ac(n,e),n}function Tc(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function Ac(t,e){"stroke"in e&&bt(t,{stroke:e.stroke}),"stroke-width"in e&&bt(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&bt(t,{fill:e.fill}),"stroke-dasharray"in e&&bt(t,{"stroke-dasharray":e["stroke-dasharray"]})}function Lc(t,e,n){e.businessObject;var o=Pc(t,e.width,e.height,{fill:"none",stroke:"black"}),r=function(t){return O({dy:".75em"},{x:t.width/2,"text-anchor":"middle"})}(e);if(r.y=5,"stereotypes"in e&&e.stereotypes.forEach((function(e){var o=Oc(t,"&lt;&lt;"+e+"&gt;&gt;",r,n);r.y+=o.getBBox().height})),"name"in e){var i=Oc(t,e.name,r,n);r.y+=i.getBBox().height}return e.labels.some((function(t){return"property"===t.labelType||"classifier"===t.labelType}))&&"name"in e&&function(t,e,n){!function(t,e,n){var o=Bt("line");bt(o,{x1:e.x,y1:e.y,x2:n.x,y2:n.y,stroke:"black"}),mt(t,o)}(t,{x:0,y:n},{x:e,y:n})}(t,e.width,r.y),o}function Dc(t,e,n){return Oc(t,e.businessObject+"",{dy:".75em"},n)}function Ic(t,e){return Wc(t,e,{stroke:"black",markerEnd:"association-marker"})}function $c(t,e){return Wc(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function Hc(t,e){return Wc(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function Nc(t,e){return Wc(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function Fc(t,e){return Wc(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function Gc(t,e){return Wc(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function Wc(t,e,n){return Bc(t,e.waypoints,n)}Rc.prototype.canRender=function(t){},Rc.prototype.drawShape=function(t,e){},Rc.prototype.drawConnection=function(t,e){},Rc.prototype.getShapePath=function(t){},Rc.prototype.getConnectionPath=function(t){};var Vc=[{name:"association-marker",element:zc("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:zc("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:zc("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:zc("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:zc("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:zc("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function qc(t,e,n,o){var r=Bt("marker");mt(r,n),bt(r,{id:e,viewBox:"0 0 10 10",refX:Uc(o),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),mt(t,r)}function Uc(t){return t?0:10}function Yc(t,e,n){Rc.call(this,t),this.textRenderer=n,this.drawShapeHandlers={class:Lc,label:Dc},this.drawConnectionHandlers={association:Ic,inheritance:$c,realization:Hc,dependency:Nc,aggregation:Fc,composition:Gc},function(t){var e=at("defs",t._svg);e||(e=Bt("defs"),mt(t._svg,e)),Vc.forEach((function(t){var n=t.element.cloneNode(!0);qc(e,t.name,t.element,!1),qc(e,t.name+"-reversed",n,!0)}))}(e)}function Kc(){this._style={fontFamily:"DroidSansMono",fontSize:12}}Ai(Yc,Rc),Yc.$inject=["eventBus","canvas","textRenderer"],Yc.prototype.canRender=function(t){return!0},Yc.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},Yc.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},Yc.prototype.getShapePath=function(t){return n=(e=t).x,o=e.y,r=e.width,qt([["M",n,o],["l",r,0],["l",0,e.height],["l",-r,0],["z"]]);var e,n,o,r},Kc.prototype.createText=function(t,e){var n=Bt("text");return bt(n,e=O(e,this._style)),Gt(n,t),n},Kc.prototype.getDimensions=function(t,e){var n=Bt("text");bt(n,this._style),mt(function(){var t=document.getElementById("helper-svg");if(!t)return function(){var t=Bt("svg");return bt(t,{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(t),t}();return t}(),n),n.textContent=t;var o=n.getBBox();return Ct(n),o},Kc.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},Kc.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var Xc={__init__:["umlRenderer"],umlRenderer:["type",Yc],textRenderer:["type",Kc]};function Zc(t,e,n,o,r,i){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=o,this.layouter=r,this.commandStack=i}function Qc(t,e,n,o,r,i,a){return delete o.id,a.createClass(o,e)}function Jc(t,e,n){t in e&&(n[t]=e[t])}function ts(t,e){var n,o;return n="waypoints"in t?Ji(t.waypoints):qi(es(e.get(t.source)),es(e.get(t.target))),(o=n).forEach((function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)})),o}function es(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}Zc.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],Zc.prototype.import=function(t){var e=this.textRenderer,n=this.elementFactory,o=this.canvas,r=this.modeling;this.layouter;this.commandStack;var i=n.createRoot();o.setRootElement(i);var a=function(t,e,n,o,r,i){return new Map(t.map((function(t){var a=t.businessObject||{};return[t.id,Qc(n,r,e,t,a,o,i)]})))}(t.graph.nodes,n,o,e,i,r);!function(t,e,n,o,r,i,a,c){t.forEach((function(t){var n={connectionType:t.type,waypoints:ts(t,e)};O(n,function(t){var e={};return Jc("sourceName",t,e),Jc("targetName",t,e),Jc("sourceCardinality",t,e),Jc("targetCardinality",t,e),e}(t)),c.createConnection(e.get(t.source),e.get(t.target),n,i)}))}(t.graph.edges,a,0,0,0,i,0,r)};var ns={__depends__:[Xc,{umlImporter:["type",Zc]}]};const os=/^class[ {]/;function rs(t){return Array.isArray(t)}function is(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function as(...t){1===t.length&&rs(t[0])&&(t=t[0]);const e=(t=[...t]).pop();return e.$inject=t,e}const cs=/constructor\s*[^(]*\(\s*([^)]*)\)/m,ss=/^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m,us=/\/\*([^*]*)\*\//m;function ls(t){if("function"!=typeof t)throw new Error(`Cannot annotate "${t}". Expected a function!`);const e=t.toString().match(function(t){return os.test(t.toString())}(t)?cs:ss);if(!e)return[];const n=e[1]||e[2];return n&&n.split(",").map((t=>{const e=t.match(us);return(e&&e[1]||t).trim()}))||[]}function hs(t,e){e=e||{get:function(t,e){if(n.push(t),!1===e)return null;throw a(`No provider for "${t}"!`)}};const n=[],o=this._providers=Object.create(e._providers||null),r=this._instances=Object.create(null),i=r.injector=this,a=function(t){const e=n.join(" -> ");return n.length=0,new Error(e?`${t} (Resolving: ${e})`:t)};function c(t,i){if(!o[t]&&-1!==t.indexOf(".")){const e=t.split(".");let n=c(e.shift());for(;e.length;)n=n[e.shift()];return n}if(is(r,t))return r[t];if(is(o,t)){if(-1!==n.indexOf(t))throw n.push(t),a("Cannot resolve circular dependency!");return n.push(t),r[t]=o[t][0](o[t][1]),n.pop(),r[t]}return e.get(t,i)}function s(t,e){if(void 0===e&&(e={}),"function"!=typeof t){if(!rs(t))throw a(`Cannot invoke "${t}". Expected a function!`);t=as(t.slice())}return{fn:t,dependencies:(t.$inject||ls(t)).map((t=>is(e,t)?e[t]:c(t)))}}function u(t){const{fn:e,dependencies:n}=s(t);return new(Function.prototype.bind.apply(e,[null].concat(n)))}function l(t,e,n){const{fn:o,dependencies:r}=s(t,n);return o.apply(e,r)}function h(t){return as((e=>t.get(e)))}function d(t,e){if(e&&e.length){const n=Object.create(null),r=Object.create(null),i=[],a=[],c=[];let s,u,l,d;for(let t in o)s=o[t],-1!==e.indexOf(t)&&("private"===s[2]?(u=i.indexOf(s[3]),-1===u?(l=s[3].createChild([],e),d=h(l),i.push(s[3]),a.push(l),c.push(d),n[t]=[d,t,"private",l]):n[t]=[c[u],t,"private",a[u]]):n[t]=[s[2],s[1]],r[t]=!0),"factory"!==s[2]&&"type"!==s[2]||!s[1].$scope||e.forEach((e=>{-1!==s[1].$scope.indexOf(e)&&(n[t]=[s[2],s[1]],r[e]=!0)}));e.forEach((t=>{if(!r[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')})),t.unshift(n)}return new hs(t,i)}const p={factory:l,type:u,value:function(t){return t}};function f(t,e){const n=t.__init__||[];return function(){n.forEach((t=>{"string"==typeof t?e.get(t):e.invoke(t)}))}}function v(t){const e=t.__exports__;if(e){const n=t.__modules__,r=Object.keys(t).reduce(((e,n)=>("__exports__"!==n&&"__modules__"!==n&&"__init__"!==n&&"__depends__"!==n&&(e[n]=t[n]),e)),Object.create(null)),i=d((n||[]).concat(r)),a=as((function(t){return i.get(t)}));e.forEach((function(t){o[t]=[a,t,"private",i]}));const c=(t.__init__||[]).slice();return c.unshift((function(){i.init()})),f(t=Object.assign({},t,{__init__:c}),i)}return Object.keys(t).forEach((function(e){if("__init__"===e||"__depends__"===e)return;if("private"===t[e][2])return void(o[e]=t[e]);const n=t[e][0],r=t[e][1];o[e]=[p[n],ds(n,r),n]})),f(t,i)}function y(t,e){return-1!==t.indexOf(e)||-1!==(t=(e.__depends__||[]).reduce(y,t)).indexOf(e)?t:t.concat(e)}this.get=c,this.invoke=l,this.instantiate=u,this.createChild=d,this.init=function(t){const e=t.reduce(y,[]).map(v);let n=!1;return function(){n||(n=!0,e.forEach((t=>t())))}}(t)}function ds(t,e){return"value"!==t&&rs(e)&&(e=as(e.slice())),e}function ps(t,e){Rc.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}wr(ps,Rc),ps.prototype.canRender=function(){return!0},ps.prototype.drawShape=function(t,e,n){var o=Bt("rect");return bt(o,{x:0,y:0,width:e.width||0,height:e.height||0}),le(e)?bt(o,O({},this.FRAME_STYLE,n||{})):bt(o,O({},this.SHAPE_STYLE,n||{})),mt(t,o),o},ps.prototype.drawConnection=function(t,e,n){var o=Zt(e.waypoints,O({},this.CONNECTION_STYLE,n||{}));return mt(t,o),o},ps.prototype.getShapePath=function(t){var e=t.x,n=t.y,o=t.width;return qt([["M",e,n],["l",o,0],["l",0,t.height],["l",-o,0],["z"]])},ps.prototype.getConnectionPath=function(t){var e,n,o=t.waypoints,r=[];for(e=0;n=o[e];e++)n=n.original||n,r.push([0===e?"M":"L",n.x,n.y]);return qt(r)},ps.$inject=["eventBus","styles"];var fs={__init__:["defaultRenderer"],defaultRenderer:["type",ps],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){return O(this.style(e,n),{class:t})},this.style=function(e,n){i(e)||n||(n=e,e=[]);var o=v(e,(function(e,n){return O(e,t[n]||{})}),{});return n?O(o,n):o},this.computeStyle=function(t,n,o){return i(n)||(o=n,n=[]),e.style(n||[],O({},o,t||{}))}}]};function vs(t,e){return Math.round(t*e)/e}function ys(t){return c(t)?t+"px":t}function gs(t,e,n){const o=Bt("g");kt(o).add(e);const r=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(o,t.childNodes[r]||null),o}const ms={shape:["x","y","width","height"],connection:["waypoints"]};function xs(t,e,n,o){this._eventBus=e,this._elementRegistry=o,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function _s(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}xs.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],xs.prototype._init=function(t){const e=this._eventBus,n=this._container=function(t){const e=(t=O({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),$(n,{position:"relative",overflow:"hidden",width:ys(t.width),height:ys(t.height)}),e.appendChild(n),n}(t),o=this._svg=Bt("svg");bt(o,{width:"100%",height:"100%"}),mt(n,o);const r=this._viewport=gs(o,"viewport");t.deferUpdate&&(this._viewboxChanged=function(t,e){let n,o,r,i;function a(n){let a=Date.now(),u=n?0:i+e-a;if(u>0)return c(u);t.apply(r,o),s()}function c(t){n=setTimeout(a,t)}function s(){n&&clearTimeout(n),n=i=o=r=void 0}function u(...t){i=Date.now(),o=t,r=this,n||c(e)}return u.flush=function(){n&&a(!0),s()},u.cancel=s,u}(R(this._viewboxChanged,this),300)),e.on("diagram.init",(()=>{e.fire("canvas.init",{svg:o,viewport:r})})),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],(()=>{delete this._cachedViewbox})),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},xs.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},xs.prototype._clear=function(){this._elementRegistry.getAll().forEach((t=>{const e=ue(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},xs.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},xs.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},xs.prototype._getChildIndex=function(t){return v(this._layers,(function(e,n){return n.visible&&t>=n.index&&e++,e}),0)},xs.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:gs(this._viewport,"layer-"+t,n),index:e,visible:!0}},xs.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,o=e.group,r=e.index;if(e.visible)return o;const i=this._getChildIndex(r);return n.insertBefore(o,n.childNodes[i]||null),e.visible=!0,o},xs.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(Ct(n),e.visible=!1,n):n},xs.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],Ct(e.group))},xs.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},xs.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},xs.prototype.getRootElements=function(){return this._planes.map((function(t){return t.rootElement}))},xs.prototype._findPlaneForRoot=function(t){return h(this._planes,(function(e){return e.rootElement===t}))},xs.prototype.getContainer=function(){return this._container},xs.prototype._updateMarker=function(t,e,n){let o;t.id||(t=this._elementRegistry.get(t)),o=this._elementRegistry._elements[t.id],o&&(p([o.gfx,o.secondaryGfx],(function(t){t&&(n?kt(t).add(e):kt(t).remove(e))})),this._eventBus.fire("element.marker.update",{element:t,gfx:o.gfx,marker:e,add:!!n}))},xs.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},xs.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},xs.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));return kt(this.getGraphics(t)).has(e)},xs.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},xs.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},xs.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const o=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,o),this._planes.push({rootElement:t,layer:o}),t},xs.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter((function(e){return e.rootElement!==t})),this._rootElement===t&&(this._rootElement=null),t},xs.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},xs.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},xs.prototype._addRoot=function(t,e){const n=this._elementRegistry,o=this._eventBus;o.fire("root.add",{element:t}),n.add(t,e),o.fire("root.added",{element:t,gfx:e})},xs.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},xs.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=ms[t],o=y(n,(function(t){return void 0!==e[t]}));if(!o)throw new Error("must supply { "+n.join(", ")+" } with "+t)},xs.prototype._setParent=function(t,e,n){Er(e.children,t,n),t.parent=e},xs.prototype._addElement=function(t,e,n,o){n=n||this.getRootElement();const r=this._eventBus,i=this._graphicsFactory;this._ensureValid(t,e),r.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,o);const a=i.create(t,e,o);return this._elementRegistry.add(e,a),i.update(t,e,a),r.fire(t+".added",{element:e,gfx:a}),e},xs.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},xs.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},xs.prototype._removeElement=function(t,e){const n=this._elementRegistry,o=this._graphicsFactory,r=this._eventBus;if(t=n.get(t.id||t))return r.fire(e+".remove",{element:t}),o.remove(t),br(t.parent&&t.parent.children,t),t.parent=null,r.fire(e+".removed",{element:t}),n.remove(t),t},xs.prototype.removeShape=function(t){return this._removeElement(t,"shape")},xs.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},xs.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},xs.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},xs.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},xs.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let o,r,i,a,c,s,u;return t?(this._changeViewbox((function(){c=Math.min(n.width/t.width,n.height/t.height);const o=this._svg.createSVGMatrix().scale(c).translate(-t.x,-t.y);Vt(e,o)})),t):(i=this._rootElement?this.getActiveLayer():null,o=i&&i.getBBox()||{},a=Vt(e),r=a?a.matrix:function(t,e,n,o,r,i){var a=Tt().createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return At(a,t);case 6:return At(a,{a:t,b:e,c:n,d:o,e:r,f:i})}}(),c=vs(r.a,1e3),s=vs(-r.e||0,1e3),u=vs(-r.f||0,1e3),t=this._cachedViewbox={x:s?s/c:0,y:u?u/c:0,width:n.width/c,height:n.height/c,scale:c,inner:{width:o.width||0,height:o.height||0,x:o.x||0,y:o.y||0},outer:n})},xs.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox((function(){t=O({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),_s(e,n)})),{x:n.e,y:n.f}},xs.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const o=this.findRoot(t);if(o!==this.getRootElement()&&this.setRootElement(o),o===t)return;e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const r=se(t),i=Wo(r),a=this.viewbox(),c=this.zoom();let s,u;a.y+=e.top/c,a.x+=e.left/c,a.width-=(e.right+e.left)/c,a.height-=(e.bottom+e.top)/c;const l=Wo(a);if(r.width<a.width&&r.height<a.height){const t=Math.max(0,i.right-l.right),e=Math.min(0,i.left-l.left),n=Math.max(0,i.bottom-l.bottom),o=Math.min(0,i.top-l.top);s=t||e,u=n||o}else s=r.x-a.x,u=r.y-a.y;this.scroll({dx:-s*c,dy:-u*c})},xs.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,o;return this._changeViewbox((function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),o=this._setZoom(t,e)})),vs(o.a,1e3)},xs.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,o=e.inner;let r,i;return o.x>=0&&o.y>=0&&o.x+o.width<=n.width&&o.y+o.height<=n.height&&!t?i={x:0,y:0,width:Math.max(o.width+o.x,n.width),height:Math.max(o.height+o.y,n.height)}:(r=Math.min(1,n.width/o.width,n.height/o.height),i={x:o.x+(t?o.width/2-n.width/r/2:0),y:o.y+(t?o.height/2-n.height/r/2:0),width:n.width/r,height:n.height/r}),this.viewbox(i),this.viewbox(!1).scale},xs.prototype._setZoom=function(t,e){const n=this._svg,o=this._viewport,r=n.createSVGMatrix(),i=n.createSVGPoint();let a,c,s,u,l;s=o.getCTM();const h=s.a;return e?(a=O(i,e),c=a.matrixTransform(s.inverse()),u=r.translate(c.x,c.y).scale(1/h*t).translate(-c.x,-c.y),l=s.multiply(u)):l=r.scale(t),_s(this._viewport,l),l},xs.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},xs.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},xs.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var ws="data-element-id";function bs(t){this._elements={},this._eventBus=t}bs.$inject=["eventBus"],bs.prototype.add=function(t,e,n){var o=t.id;this._validateId(o),bt(e,ws,o),n&&bt(n,ws,o),this._elements[o]={element:t,gfx:e,secondaryGfx:n}},bs.prototype.remove=function(t){var e=this._elements,n=t.id||t,o=n&&e[n];o&&(bt(o.gfx,ws,""),o.secondaryGfx&&bt(o.secondaryGfx,ws,""),delete e[n])},bs.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),o=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,o)},bs.prototype.updateGraphics=function(t,e,n){var o=t.id||t,r=this._elements[o];return n?r.secondaryGfx=e:r.gfx=e,e&&bt(e,ws,o),e},bs.prototype.get=function(t){var e;e="string"==typeof t?t:t&&bt(t,ws);var n=this._elements[e];return n&&n.element},bs.prototype.filter=function(t){var e=[];return this.forEach((function(n,o){t(n,o)&&e.push(n)})),e},bs.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),o=0;o<n.length;o++){var r=e[n[o]],i=r.element;if(t(i,r.gfx))return i}},bs.prototype.getAll=function(){return this.filter((function(t){return t}))},bs.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach((function(n){var o=e[n],r=o.element,i=o.gfx;return t(r,i)}))},bs.prototype.getGraphics=function(t,e){var n=t.id||t,o=this._elements[n];return o&&(e?o.secondaryGfx:o.gfx)},bs.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var Es="__fn",ks=Array.prototype.slice;function Ss(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function Cs(){}function js(t,e){this._eventBus=t,this._elementRegistry=e}function Ms(t,e,n){var o=n||e.firstChild;t!==o&&e.insertBefore(t,o)}Ss.prototype.on=function(t,e,n,o){if(t=i(t)?t:[t],s(e)&&(o=n,n=e,e=1e3),!c(e))throw new Error("priority must be a number");var r=n;o&&((r=R(n,o))[Es]=n[Es]||n);var a=this;t.forEach((function(t){a._addListener(t,{priority:e,callback:r,next:null})}))},Ss.prototype.once=function(t,e,n,o){var r=this;if(s(e)&&(o=n,n=e,e=1e3),!c(e))throw new Error("priority must be a number");function i(){i.__isTomb=!0;var e=n.apply(o,arguments);return r.off(t,i),e}i[Es]=n,this.on(t,e,i)},Ss.prototype.off=function(t,e){t=i(t)?t:[t];var n=this;t.forEach((function(t){n._removeListener(t,e)}))},Ss.prototype.createEvent=function(t){var e=new Cs;return e.init(t),e},Ss.prototype.fire=function(t,e){var n,o,r,i;if(i=ks.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(o=this._listeners[t]){n=e instanceof Cs?e:this.createEvent(e),i[0]=n;var a=n.type;t!==a&&(n.type=t);try{r=this._invokeListeners(n,i,o)}finally{t!==a&&(n.type=a)}return void 0===r&&n.defaultPrevented&&(r=!1),r}},Ss.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},Ss.prototype._destroy=function(){this._listeners={}},Ss.prototype._invokeListeners=function(t,e,n){for(var o;n&&!t.cancelBubble;)o=this._invokeListener(t,e,n),n=n.next;return o},Ss.prototype._invokeListener=function(t,e,n){var o;if(n.callback.__isTomb)return o;try{o=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==o&&(t.returnValue=o,t.stopPropagation()),!1===o&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener",t),t}return o},Ss.prototype._addListener=function(t,e){var n,o=this._getListeners(t);if(o){for(;o;){if(o.priority<e.priority)return e.next=o,void(n?n.next=e:this._setListeners(t,e));n=o,o=o.next}n.next=e}else this._setListeners(t,e)},Ss.prototype._getListeners=function(t){return this._listeners[t]},Ss.prototype._setListeners=function(t,e){this._listeners[t]=e},Ss.prototype._removeListener=function(t,e){var n,o,r,i=this._getListeners(t);if(e)for(;i;)n=i.next,(r=i.callback)!==e&&r[Es]!==e||(o?o.next=n:this._setListeners(t,n)),o=i,i=n;else this._setListeners(t,null)},Cs.prototype.stopPropagation=function(){this.cancelBubble=!0},Cs.prototype.preventDefault=function(){this.defaultPrevented=!0},Cs.prototype.init=function(t){O(this,t||{})},js.$inject=["eventBus","elementRegistry"],js.prototype._getChildrenContainer=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(n),e||(kt(e=Bt("g")).add("djs-children"),mt(n.parentNode,e))):e=n,e},js.prototype._clear=function(t){var e=De(t);return W(e),e},js.prototype._createContainer=function(t,e,n,o){var r=Bt("g");kt(r).add("djs-group"),void 0!==n?Ms(r,e,e.childNodes[n]):mt(e,r);var i=Bt("g");kt(i).add("djs-element"),kt(i).add("djs-"+t),o&&kt(i).add("djs-frame"),mt(r,i);var a=Bt("g");return kt(a).add("djs-visual"),mt(i,a),i},js.prototype.create=function(t,e,n){var o=this._getChildrenContainer(e.parent);return this._createContainer(t,o,n,le(e))},js.prototype.updateContainments=function(t){var e,n=this,o=this._elementRegistry;e=v(t,(function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t}),{}),p(e,(function(t){var e=t.children;if(e){var r=n._getChildrenContainer(t);p(e.slice().reverse(),(function(t){Ms(o.getGraphics(t).parentNode,r)}))}}))},js.prototype.drawShape=function(t,e){return this._eventBus.fire("render.shape",{gfx:t,element:e})},js.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},js.prototype.drawConnection=function(t,e){return this._eventBus.fire("render.connection",{gfx:t,element:e})},js.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},js.prototype.update=function(t,e,n){if(e.parent){var o=this._clear(n);if("shape"===t)this.drawShape(o,e),We(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(o,e)}e.hidden?bt(n,"display","none"):bt(n,"display","block")}},js.prototype.remove=function(t){Ct(this._elementRegistry.getGraphics(t).parentNode)};var Rs={__depends__:[fs],__init__:["canvas"],canvas:["type",xs],elementRegistry:["type",bs],elementFactory:["type",Oi],eventBus:["type",Ss],graphicsFactory:["type",js]};function Os(t){return function(t){var e=new hs(t);return e.init(),e}([{config:["value",t=t||{}]},Rs].concat(t.modules||[]))}function Ps(t,e){this._injector=e=e||Os(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function Bs(t){this._container=this._createContainer(t),this._init(this._container,t)}function zs(t){Bs.call(this,t)}return Ps.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},Ps.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},Ai(Bs,Ps),Bs.prototype._coreModules=[ns],Bs.prototype._viewModules=[Sc,jc],Bs.prototype._modules=[].concat(Bs.prototype._coreModules,Bs.prototype._viewModules),Bs.prototype.importJSON=function(t){this.get("umlImporter").import(t)},Bs.prototype._createContainer=function(t){var e;return O((e=it("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},Bs.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};Ps.call(this,n),e&&e.parent&&this.attachTo(e.parent)},Bs.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=at(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},Bs.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},Bs.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},Ai(zs,Bs),zs.prototype._modelingModules=[_e,Je,pe,sn,mn,Mn,$n,ci,be,pc,yc,xc,rc,Or,Br,Xr,oi,_r],zs.prototype._modules=[].concat(zs.prototype._modules,zs.prototype._modelingModules),zs}));
