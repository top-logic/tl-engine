!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).UmlJS=e()}(this,function(){"use strict";function t(t,e){return e.forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})}),Object.freeze(t)}const e=Object.prototype.toString,n=Object.prototype.hasOwnProperty;function r(t,e){return n.call(t,e)}function o(t,n){let o,a;if(void 0===t)return;const c=function(t){return"[object Array]"===e.call(t)}(t)?s:i;for(let e in t)if(r(t,e)&&(o=t[e],a=n(o,c(e)),!1===a))return o}function i(t){return t}function s(t){return Number(t)}const a=Object.prototype.toString;function c(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}function u(t,e,n){var r=n?t:t.parentNode;return r&&"function"==typeof r.closest&&r.closest(e)||null}c.prototype.add=function(t){return this.list.add(t),this},c.prototype.remove=function(t){return"[object RegExp]"==a.call(t)?this.removeMatching(t):(this.list.remove(t),this)},c.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},c.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},c.prototype.array=function(){return Array.from(this.list)},c.prototype.has=c.prototype.contains=function(t){return this.list.contains(t)};var l,h,f,p={};function d(){l=window.addEventListener?"addEventListener":"attachEvent",h=window.removeEventListener?"removeEventListener":"detachEvent",f="addEventListener"!==l?"on":""}var y,v=t({__proto__:null,bind:p.bind=function(t,e,n,r){return l||d(),t[l](f+e,n,r||!1),n},unbind:p.unbind=function(t,e,n,r){return h||d(),t[h](f+e,n,r||!1),n},default:p},[p]),m=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r){return(o=e.createElement("html")).innerHTML=t,o.removeChild(o.lastChild)}var o,i=Object.prototype.hasOwnProperty.call(_,r)?_[r]:_._default,s=i[0],a=i[1],c=i[2];(o=e.createElement("div")).innerHTML=a+t+c;for(;s--;)o=o.lastChild;if(o.firstChild==o.lastChild)return o.removeChild(o.firstChild);var u=e.createDocumentFragment();for(;o.firstChild;)u.appendChild(o.removeChild(o.firstChild));return u},g=!1;"undefined"!=typeof document&&((y=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',g=!y.getElementsByTagName("link").length,y=void 0);var _={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:g?[1,"X<div>","</div>"]:[0,"",""]};_.td=_.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],_.option=_.optgroup=[1,'<select multiple="multiple">',"</select>"],_.thead=_.tbody=_.colgroup=_.caption=_.tfoot=[1,"<table>","</table>"],_.polyline=_.ellipse=_.polygon=_.circle=_.text=_.line=_.path=_.rect=_.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];var x=m;function b(t,e){return(e=e||document).querySelector(t)}function w(t,e){return{x:t.x-e.x,y:t.y-e.y}}function k(t){return Math.log(t)/Math.log(10)}function E(t,e){var n=k(t.min),r=k(t.max);return(Math.abs(n)+Math.abs(r))/e}const j=Object.prototype.toString,C=Object.prototype.hasOwnProperty;function M(t){return"[object Array]"===j.call(t)}function R(t){return"[object Number]"===j.call(t)}function O(t){const e=j.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e||"[object GeneratorFunction]"===e||"[object AsyncGeneratorFunction]"===e||"[object Proxy]"===e}function S(t,e){return!(null==t)&&C.call(t,e)}function L(t,e){const n=function(t){return O(t)?t:e=>e===t}(e);let r;return B(t,function(t,e){if(n(t,e))return r=t,!1}),r}function B(t,e){let n,r;if(void 0===t)return;const o=M(t)?T:N;for(let i in t)if(S(t,i)&&(n=t[i],r=e(n,o(i)),!1===r))return n}function P(t,e,n){return B(t,function(t,r){n=e(n,t,r)}),n}function N(t){return t}function T(t){return Number(t)}function A(t,e){return t.bind(e)}function D(t,...e){return Object.assign(t,...e)}var V=Math.sign||function(t){return t>=0?1:-1},G={min:.2,max:4};function z(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=A(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||.75;var r=this;e.on("canvas.init",function(e){r._init(!1!==t.enabled)})}z.$inject=["config.zoomScroll","eventBus","canvas"],z.prototype.scroll=function(t){this._canvas.scroll(t)},z.prototype.reset=function(){this._canvas.zoom("fit-viewport")},z.prototype.zoom=function(t,e){var n=E(G,20);this._totalDelta+=t,Math.abs(this._totalDelta)>.1&&(this._zoom(t,e,n),this._totalDelta=0)},z.prototype._handleWheel=function(t){if(!u(t.target,".djs-scrollable",!0)){var e=this._container;t.preventDefault();var n,r=t.ctrlKey||/mac/i.test(navigator.platform)&&t.metaKey,o=t.shiftKey,i=-1*this._scale;if(i*=r?0===t.deltaMode?.02:.32:0===t.deltaMode?1:16,r){var s=e.getBoundingClientRect(),a={x:t.clientX-s.left,y:t.clientY-s.top};n=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*V(t.deltaY)*i,this.zoom(n,a)}else n=o?{dx:i*t.deltaY,dy:0}:{dx:i*t.deltaX,dy:i*t.deltaY},this.scroll(n)}},z.prototype.stepZoom=function(t,e){var n=E(G,10);this._zoom(t,e,n)},z.prototype._zoom=function(t,e,n){var r=this._canvas,o=t>0?1:-1,i=k(r.zoom()),s=Math.round(i/n)*n;s+=n*o;var a,c,u=Math.pow(10,s);r.zoom((a=G,c=u,Math.max(a.min,Math.min(a.max,c))),e)},z.prototype.toggle=function(t){var e=this._container,n=this._handleWheel,r=this._enabled;return void 0===t&&(t=!r),r!==t&&v[t?"bind":"unbind"](e,"wheel",n,!1),this._enabled=t,t},z.prototype._init=function(t){this.toggle(t)};var F={__init__:["zoomScroll"],zoomScroll:["type",z]},$=/^djs-cursor-.*$/;function I(t){var e=new c(document.body);e.removeMatching($),t&&e.add("djs-cursor-"+t)}function Y(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function H(t,e){var n;function r(r){var o,i=n.start,s=n.button,a=Y(r),c=w(a,i);(!n.dragging&&(o=c,Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))>15)&&(n.dragging=!0,0===s&&function(t,e){function n(){return!1}e=e||"element.click",t.once(e,5e3,n)}(t),I("grab")),n.dragging)&&(c=w(a,n.last||n.start),e.scroll({dx:c.x,dy:c.y}),n.last=a);r.preventDefault()}function o(t){v.unbind(document,"mousemove",r),v.unbind(document,"mouseup",o),n=null,I(null)}t.on("element.mousedown",500,function(t){return function(t){if(u(t.target,".djs-draggable"))return;var e=t.button;if(e>=2||t.ctrlKey||t.shiftKey||t.altKey)return;return n={button:e,start:Y(t)},v.bind(document,"mousemove",r),v.bind(document,"mouseup",o),!0}(t.originalEvent)}),this.isActive=function(){return!!n}}H.$inject=["eventBus","canvas"];var q={__init__:["moveCanvas"],moveCanvas:["type",H]};function W(t,e){var n=this;e=e||1e3,t.on(["render.shape","render.connection"],e,function(t,e){var r=t.type,o=e.element,i=e.gfx,s=e.attrs;if(n.canRender(o))return"render.shape"===r?n.drawShape(i,o,s):n.drawConnection(i,o,s)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(t,e){if(n.canRender(e))return"render.getShapePath"===t.type?n.getShapePath(e):n.getConnectionPath(e)})}function Z(t,e){return e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}function K(t,e){return Z(e,t),t}W.prototype.canRender=function(t){},W.prototype.drawShape=function(t,e){},W.prototype.drawConnection=function(t,e){},W.prototype.getShapePath=function(t){},W.prototype.getConnectionPath=function(t){};var X={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function J(t,e,n){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=X[r];o?(2===o&&"number"==typeof n&&(n=String(n)+"px"),t.style[r]=n):t.setAttributeNS(null,e,n)}function U(t,e,n){if("string"==typeof e){if(void 0===n)return function(t,e){return X[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);J(t,e,n)}else!function(t,e){var n,r,o=Object.keys(e);for(n=0;r=o[n];n++)J(t,r,e[r])}(t,e);return t}const Q=Object.prototype.toString;function tt(t){return new et(t)}function et(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}et.prototype.add=function(t){return this.list.add(t),this},et.prototype.remove=function(t){return"[object RegExp]"==Q.call(t)?this.removeMatching(t):(this.list.remove(t),this)},et.prototype.removeMatching=function(t){const e=this.array();for(let n=0;n<e.length;n++)t.test(e[n])&&this.remove(e[n]);return this},et.prototype.toggle=function(t,e){return void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this},et.prototype.array=function(){return Array.from(this.list)},et.prototype.has=et.prototype.contains=function(t){return this.list.contains(t)};var nt="http://www.w3.org/2000/svg",rt='<svg xmlns="'+nt+'"';function ot(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(nt)&&(t=rt+t.substring(4)):(t=rt+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var r=document.createDocumentFragment(),o=n.firstChild;o.firstChild;)r.appendChild(o.firstChild);return r}function it(t,e){var n;return"<"===(t=t.trim()).charAt(0)?(n=ot(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(nt,t),e&&U(n,e),n}var st=null;function at(){return null===st&&(st=it("svg")),st}function ct(t,e){var n,r,o=Object.keys(e);for(n=0;r=o[n];n++)t[r]=e[r];return t}var ut=/([&<>]{1})/g,lt=/([&<>\n\r"]{1})/g,ht={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function ft(t,e){return t.replace(e,function(t,e){return ht[e]||e})}function pt(t,e){var n,r,o,i,s;switch(t.nodeType){case 3:e.push(ft(t.textContent,ut));break;case 1:if(e.push("<",t.tagName),t.hasAttributes())for(n=0,r=(o=t.attributes).length;n<r;++n)i=o.item(n),e.push(" ",i.name,'="',ft(i.value,lt),'"');if(t.hasChildNodes()){for(e.push(">"),n=0,r=(s=t.childNodes).length;n<r;++n)pt(s.item(n),e);e.push("</",t.tagName,">")}else e.push("/>");break;case 8:e.push("\x3c!--",ft(t.nodeValue,ut),"--\x3e");break;case 4:e.push("<![CDATA[",t.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+t.nodeType)}return e}function dt(t,e){var n=ot(e);if(function(t){for(var e;e=t.firstChild;)t.removeChild(e)}(t),e){(function(t){return"#document-fragment"===t.nodeName})(n)||(n=n.documentElement);for(var r,o=(r=n.childNodes,Array.prototype.slice.call(r)),i=0;i<o.length;i++)Z(o[i],t)}}function yt(t,e){if(void 0!==e){try{dt(t,e)}catch(t){throw new Error("error parsing SVG: "+t.message)}return t}return function(t){for(var e=t.firstChild,n=[];e;)pt(e,n),e=e.nextSibling;return n.join("")}(t)}function vt(t){var e=t.parentNode;return e&&e.removeChild(t),t}function mt(t,e){return e instanceof SVGMatrix?t.createSVGTransformFromMatrix(e):e}function gt(t,e){var n=t.transform.baseVal;return e&&(Array.isArray(e)||(e=[e]),function(t,e){var n,r;for(t.clear(),n=0;r=e[n];n++)t.appendItem(mt(t,r))}(n,e)),n.consolidate()}function _t(t,e,n){return{x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y}}function xt(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function bt(t){return["L",t.x,t.y]}function wt(t,e,n){return["C",t.x,t.y,e.x,e.y,n.x,n.y]}function kt(t,e){const n=t.length,r=[(o=t[0],["M",o.x,o.y])];var o;for(let o=1;o<n;o++){const n=t[o-1],i=t[o],s=t[o+1];if(!s||!e){r.push(bt(i));continue}const a=Math.min(e,jt(i.x-n.x,i.y-n.y),jt(s.x-i.x,s.y-i.y));if(!a){r.push(bt(i));continue}const c=Et(i,n,a),u=Et(i,n,.5*a),l=Et(i,s,a),h=Et(i,s,.5*a);r.push(bt(c)),r.push(wt(u,h,l))}return r}function Et(t,e,n){const r=e.x-t.x,o=e.y-t.y,i=n/jt(r,o);return{x:t.x+r*i,y:t.y+o*i}}function jt(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Ct(t,e,n){R(e)&&(n=e,e=null),e||(e={});const r=it("path",e);return R(n)&&(r.dataset.cornerRadius=String(n)),function(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return U(t,{d:xt(kt(e,n))}),t}(r,t)}function Mt(t,e,n,r){var o=r.createText(e,n);return tt(o).add("djs-label"),K(t,o),o}function Rt(t,e,n,r){var o=function(t,e,n){var r=it("rect");return function(t,e,n){U(t,{width:e,height:n})}(r,t,e),Bt(r,n),r}(e,n,r);return K(t,o),o}function Ot(t,e,n){var r=Lt(e),o=function(t){var e=Lt(t);return St(e,{stroke:"white","stroke-width":10})}(function(t){var e=t.length,n=t.slice();e>=2&&(n[0]=_t(t[0],t[1],.1),n[e-1]=_t(t[e-2],t[e-1],.9));return n}(e)),i=function(t){var e=it("g");return tt(e).add("djs-visual"),t.forEach(function(t){K(e,t)}),e}([o,St(r,n)]);return K(t,i),i}function St(t,e){var n=it("path");return function(t,e){U(t,{d:e})}(n,t),function(t,e){"markerEnd"in e&&U(t,{"marker-end":"url(#"+e.markerEnd+")"});"markerStart"in e&&U(t,{"marker-start":"url(#"+e.markerStart+")"})}(n,e),function(t,e){"transform"in e&&U(t,{transform:e.transform})}(n,e),Bt(n,e),n}function Lt(t){for(var e="M "+t[0].x+","+t[0].y+" ",n=1;n<t.length;n++)e+="L "+t[n].x+","+t[n].y+" ";return e}function Bt(t,e){"stroke"in e&&U(t,{stroke:e.stroke}),"stroke-width"in e&&U(t,{"stroke-width":e["stroke-width"]}),"fill"in e&&U(t,{fill:e.fill}),"stroke-dasharray"in e&&U(t,{"stroke-dasharray":e["stroke-dasharray"]})}function Pt(t){t.style.removeProperty("opacity")}function Nt(t,e){var n=t.closest(".djs-group");e.parent&&e.parent.isVisible?e.isVisible?Pt(n):function(t){t.style.setProperty("opacity",.3)}(n):Pt(n)}function Tt(t,e,n){e.businessObject;var r=Rt(t,e.width,e.height,{fill:"none",stroke:"black"}),o=function(t){return D({dy:".75em"},{x:t.width/2,"text-anchor":"middle"})}(e);if(o.y=5,"stereotypes"in e&&e.stereotypes.forEach(function(e){var r=Mt(t,"&lt;&lt;"+e+"&gt;&gt;",o,n);o.y+=r.getBBox().height}),"name"in e){var i=Mt(t,e.name,o,n);o.y+=i.getBBox().height}return e.labels.some(function(t){return"property"===t.labelType||"classifier"===t.labelType})&&"name"in e&&function(t,e,n){(function(t,e,n){var r=it("line");U(r,{x1:e.x,y1:e.y,x2:n.x,y2:n.y,stroke:"black"}),K(t,r)})(t,{x:0,y:n},{x:e,y:n})}(t,e.width,o.y),Nt(t,e),r}function At(t,e,n){var r=Mt(t,e.businessObject+"",{dy:".75em"},n);return Nt(t,e),r}function Dt(t,e){return It(t,e,{stroke:"black",markerEnd:"association-marker"})}function Vt(t,e){return It(t,e,{stroke:"gray",markerEnd:"inheritance-marker"})}function Gt(t,e){return It(t,e,{stroke:"black",markerEnd:"realization-marker","stroke-dasharray":"5,10,5"})}function zt(t,e){return It(t,e,{stroke:"black",markerEnd:"dependency-marker","stroke-dasharray":"5,10,5"})}function Ft(t,e){return It(t,e,{stroke:"black",markerStart:"aggregation-marker-reversed"})}function $t(t,e){return It(t,e,{stroke:"black",markerStart:"composition-marker-reversed"})}function It(t,e,n){var r=Ot(t,e.waypoints,n);return Nt(t,e),r}var Yt=[{name:"association-marker",element:St("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"inheritance-marker",element:St("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"realization-marker",element:St("M 0,0 L 10,5 L 0,10 Z",{stroke:"black",fill:"white"})},{name:"dependency-marker",element:St("M 0,0 L 10,5 L 0,10",{stroke:"black",fill:"none"})},{name:"aggregation-marker",element:St("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"white",transform:"rotate(180,5,5)"})},{name:"composition-marker",element:St("M 0,5 L 5,0 L 10,5 L 5,10 Z",{stroke:"black",fill:"black",transform:"rotate(180,5,5)"})}];function Ht(t,e,n,r){var o=it("marker");K(o,n),U(o,{id:e,viewBox:"0 0 10 10",refX:qt(r),refY:5,markerWidth:5,markerHeight:5,orient:"auto"}),K(t,o)}function qt(t){return t?0:10}function Wt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zt,Kt={exports:{}},Xt={exports:{}};try{var Jt=require("util");if("function"!=typeof Jt.inherits)throw"";Kt.exports=Jt.inherits}catch(Ce){Kt.exports=(Zt||(Zt=1,"function"==typeof Object.create?Xt.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Xt.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),Xt.exports)}var Ut=Wt(Kt.exports);function Qt(t,e,n,r){W.call(this,t),this.textRenderer=n,this._layouter=r,this.drawShapeHandlers={class:Tt,label:At},this.drawConnectionHandlers={association:Dt,inheritance:Vt,realization:Gt,dependency:zt,aggregation:Ft,composition:$t},function(t){var e=b("defs",t._svg);e||(e=it("defs"),K(t._svg,e)),Yt.forEach(function(t){var n=t.element.cloneNode(!0);Ht(e,t.name,t.element,!1),Ht(e,t.name+"-reversed",n,!0)})}(e)}function te(){this._style={fontFamily:"DroidSansMono",fontSize:12}}Ut(Qt,W),Qt.$inject=["eventBus","canvas","textRenderer","layouter"],Qt.prototype.canRender=function(t){return!0},Qt.prototype.drawShape=function(t,e){var n=e.shapeType;return(0,this.drawShapeHandlers[n])(t,e,this.textRenderer)},Qt.prototype.drawConnection=function(t,e){var n=e.connectionType;return(0,this.drawConnectionHandlers[n])(t,e)},Qt.prototype.getShapePath=function(t){return n=(e=t).x,r=e.y,o=e.width,xt([["M",n,r],["l",o,0],["l",0,e.height],["l",-o,0],["z"]]);var e,n,r,o},te.prototype.createText=function(t,e){var n=it("text");return U(n,e=D(e,this._style)),yt(n,t),n},te.prototype.getDimensions=function(t,e){var n=it("text");U(n,this._style),K(function(){var t=document.getElementById("helper-svg");if(!t)return function(){var t=it("svg");return U(t,{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(t),t}();return t}(),n),n.textContent=t;var r=n.getBBox();return vt(n),r},te.prototype.getWidth=function(t,e){return this.getDimensions(t,e).width},te.prototype.getHeight=function(t,e){return this.getDimensions(t,e).height};var ee={__init__:["umlRenderer"],umlRenderer:["type",Qt],textRenderer:["type",te]};function ne(t,e,n,r){if(void 0===r&&(r=5),!t||!e||!n)return!1;var o,i,s=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),a=(i=e,(o=t)&&i?Math.sqrt(Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)):-1);return Math.abs(s/a)<=r}function re(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function oe(t,e,n){var r;r=n=n||0,"[object Object]"!==j.call(r)&&(n={x:n,y:n});var o=re(t),i=re(e),s=o.bottom+n.y<=i.top,a=o.left-n.x>=i.right,c=o.top-n.y>=i.bottom,u=s?"top":c?"bottom":null,l=o.right+n.x<=i.left?"left":a?"right":null;return l&&u?u+"-"+l:l||u||"intersect"}var ie=Math.round;function se(t,e,n){var r,o,i,s=oe(e,t,5),a=n.split(":")[0],c=ie((e.x-t.x)/2+t.x),u=ie((e.y-t.y)/2+t.y),l=(i=s,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[a].test(i)),h=/h|r|l/.test(a),f=!1,p=!1;return l?(r=h?{x:c,y:t.y}:{x:t.x,y:u},o=h?"h:h":"v:v"):(f=function(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}(s,a),o=h?"h:v":"v:h",f?h?(p=u===t.y,r={x:t.x+20*(/l/.test(a)?-1:1),y:p?u+20:u}):r={x:(p=c===t.x)?c+20:c,y:t.y+20*(/t/.test(a)?-1:1)}:r={x:c,y:u}),{waypoints:ce(t,r,o).concat(r),directions:o,turnNextDirections:p}}function ae(t){return t.split(":").reverse().join(":")}function ce(t,e,n){if(!function(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}(n=n||"h:h"))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(function(t){return t&&/t|r|b|l/.test(t)}(n)){var r=function(t,e,n){return se(t,e,n)}(t,e,n),o=function(t,e,n){var r=se(e,t,ae(n));return{waypoints:r.waypoints.slice().reverse(),directions:ae(r.directions),turnNextDirections:r.turnNextDirections}}(t,e,n),i=function(t,e){var n=t.directions.split(":")[1],r=e.directions.split(":")[0];t.turnNextDirections&&(n="h"==n?"v":"h"),e.turnNextDirections&&(r="h"==r?"v":"h");var o=n+":"+r;return{waypoints:ce(t.waypoints[t.waypoints.length-1],e.waypoints[0],o),directions:o}}(r,o);return[].concat(r.waypoints,i.waypoints,o.waypoints)}return function(t,e,n){var r=ie((e.x-t.x)/2+t.x),o=ie((e.y-t.y)/2+t.y);if("h:v"===n)return[{x:e.x,y:t.y}];if("v:h"===n)return[{x:t.x,y:e.y}];if("h:h"===n)return[{x:r,y:t.y},{x:r,y:e.y}];if("v:v"===n)return[{x:t.x,y:o},{x:e.x,y:o}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(t,e,n)}function ue(t){return t.reduce(function(e,n,r){return ne(e[e.length-1],t[r+1],n,0)||e.push(n),e},[])}function le(t,e,n,r,o,i){this.textRenderer=n,this.elementFactory=t,this.canvas=e,this.modeling=r,this.layouter=o,this.commandStack=i}function he(t,e,n,r,o,i,s){return delete r.id,s.createClass(r,e)}function fe(t,e,n){t in e&&(n[t]=e[t])}function pe(t,e){var n,r,o,i,s;return"waypoints"in t?n=ue(t.waypoints):(r=de(e.get(t.source)),o=de(e.get(t.target)),(s=ce(r,o,i)).unshift(r),s.push(o),n=ue(s)),function(t){return t.forEach(function(t){t.x=Math.round(t.x),t.y=Math.round(t.y)}),t}(n)}function de(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}le.$inject=["elementFactory","canvas","textRenderer","modeling","layouter","commandStack"],le.prototype.import=function(t){var e=this.textRenderer,n=this.elementFactory,r=this.canvas,o=this.modeling;this.layouter;this.commandStack;var i=n.createRoot();r.setRootElement(i);var s=function(t,e,n,r,o,i){return new Map(t.map(function(t){var s=t.businessObject||{};return[t.id,he(n,o,e,t,s,r,i)]}))}(t.graph.nodes,n,r,e,i,o);!function(t,e,n,r,o,i,s,a){t.forEach(function(t){var n={connectionType:t.type,waypoints:pe(t,e)};D(n,function(t){var e={};return fe("sourceName",t,e),fe("targetName",t,e),fe("sourceCardinality",t,e),fe("targetCardinality",t,e),e}(t)),a.createConnection(e.get(t.source),e.get(t.target),n,i)})}(t.graph.edges,s,0,0,0,i,0,o)};var ye={__depends__:[ee,{umlImporter:["type",le]}]};const ve=/^class[ {]/;function me(t){return Array.isArray(t)}function ge(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _e(...t){1===t.length&&me(t[0])&&(t=t[0]);const e=(t=[...t]).pop();return e.$inject=t,e}const xe=/constructor\s*[^(]*\(\s*([^)]*)\)/m,be=/^(?:async\s+)?(?:function\s*[^(]*)?(?:\(\s*([^)]*)\)|(\w+))/m,we=/\/\*([^*]*)\*\//m;function ke(t){if("function"!=typeof t)throw new Error(`Cannot annotate "${t}". Expected a function!`);const e=t.toString().match(function(t){return ve.test(t.toString())}(t)?xe:be);if(!e)return[];const n=e[1]||e[2];return n&&n.split(",").map(t=>{const e=t.match(we);return(e&&e[1]||t).trim()})||[]}function Ee(t,e){e=e||{get:function(t,e){if(n.push(t),!1===e)return null;throw s(`No provider for "${t}"!`)}};const n=[],r=this._providers=Object.create(e._providers||null),o=this._instances=Object.create(null),i=o.injector=this,s=function(t){const e=n.join(" -> ");return n.length=0,new Error(e?`${t} (Resolving: ${e})`:t)};function a(t,i){if(!r[t]&&-1!==t.indexOf(".")){const e=t.split(".");let n=a(e.shift());for(;e.length;)n=n[e.shift()];return n}if(ge(o,t))return o[t];if(ge(r,t)){if(-1!==n.indexOf(t))throw n.push(t),s("Cannot resolve circular dependency!");return n.push(t),o[t]=r[t][0](r[t][1]),n.pop(),o[t]}return e.get(t,i)}function c(t,e){if(void 0===e&&(e={}),"function"!=typeof t){if(!me(t))throw s(`Cannot invoke "${t}". Expected a function!`);t=_e(t.slice())}return{fn:t,dependencies:(t.$inject||ke(t)).map(t=>ge(e,t)?e[t]:a(t))}}function u(t){const{fn:e,dependencies:n}=c(t);return new(Function.prototype.bind.apply(e,[null].concat(n)))}function l(t,e,n){const{fn:r,dependencies:o}=c(t,n);return r.apply(e,o)}function h(t){return _e(e=>t.get(e))}function f(t,e){if(e&&e.length){const n=Object.create(null),o=Object.create(null),i=[],s=[],a=[];let c,u,l,f;for(let t in r)c=r[t],-1!==e.indexOf(t)&&("private"===c[2]?(u=i.indexOf(c[3]),-1===u?(l=c[3].createChild([],e),f=h(l),i.push(c[3]),s.push(l),a.push(f),n[t]=[f,t,"private",l]):n[t]=[a[u],t,"private",s[u]]):n[t]=[c[2],c[1]],o[t]=!0),"factory"!==c[2]&&"type"!==c[2]||!c[1].$scope||e.forEach(e=>{-1!==c[1].$scope.indexOf(e)&&(n[t]=[c[2],c[1]],o[e]=!0)});e.forEach(t=>{if(!o[t])throw new Error('No provider for "'+t+'". Cannot use provider from the parent!')}),t.unshift(n)}return new Ee(t,i)}const p={factory:l,type:u,value:function(t){return t}};function d(t,e){const n=t.__init__||[];return function(){n.forEach(t=>{"string"==typeof t?e.get(t):e.invoke(t)})}}function y(t){const e=t.__exports__;if(e){const n=t.__modules__,o=Object.keys(t).reduce((e,n)=>("__exports__"!==n&&"__modules__"!==n&&"__init__"!==n&&"__depends__"!==n&&(e[n]=t[n]),e),Object.create(null)),i=f((n||[]).concat(o)),s=_e(function(t){return i.get(t)});e.forEach(function(t){r[t]=[s,t,"private",i]});const a=(t.__init__||[]).slice();return a.unshift(function(){i.init()}),d(t=Object.assign({},t,{__init__:a}),i)}return Object.keys(t).forEach(function(e){if("__init__"===e||"__depends__"===e)return;if("private"===t[e][2])return void(r[e]=t[e]);const n=t[e][0],o=t[e][1];r[e]=[p[n],je(n,o),n]}),d(t,i)}function v(t,e){return-1!==t.indexOf(e)||-1!==(t=(e.__depends__||[]).reduce(v,t)).indexOf(e)?t:t.concat(e)}this.get=a,this.invoke=l,this.instantiate=u,this.createChild=f,this.init=function(t){const e=t.reduce(v,[]).map(y);let n=!1;return function(){n||(n=!0,e.forEach(t=>t()))}}(t)}function je(t,e){return"value"!==t&&me(e)&&(e=_e(e.slice())),e}function Ce(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}function Me(t,e){var n,r,o,i;return e=!!e,M(t)||(t=[t]),B(t,function(t){var s=t;t.waypoints&&!e&&(s=Me(t.waypoints,!0));var a=s.x,c=s.y,u=s.height||0,l=s.width||0;(a<n||void 0===n)&&(n=a),(c<r||void 0===r)&&(r=c),(a+l>o||void 0===o)&&(o=a+l),(c+u>i||void 0===i)&&(i=c+u)}),{x:n,y:r,height:i-r,width:o-n}}function Re(t){return!(!t||!t.isFrame)}function Oe(t,e){W.call(this,t,1),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}Ce(Oe,W),Oe.prototype.canRender=function(){return!0},Oe.prototype.drawShape=function(t,e,n){var r=it("rect");return U(r,{x:0,y:0,width:e.width||0,height:e.height||0}),Re(e)?U(r,D({},this.FRAME_STYLE,n||{})):U(r,D({},this.SHAPE_STYLE,n||{})),K(t,r),r},Oe.prototype.drawConnection=function(t,e,n){var r=Ct(e.waypoints,D({},this.CONNECTION_STYLE,n||{}));return K(t,r),r},Oe.prototype.getShapePath=function(t){var e=t.x,n=t.y,r=t.width;return xt([["M",e,n],["l",r,0],["l",0,t.height],["l",-r,0],["z"]])},Oe.prototype.getConnectionPath=function(t){var e,n,r=t.waypoints,o=[];for(e=0;n=r[e];e++)n=n.original||n,o.push([0===e?"M":"L",n.x,n.y]);return xt(o)},Oe.$inject=["eventBus","styles"];var Se={__init__:["defaultRenderer"],defaultRenderer:["type",Oe],styles:["type",function(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(t,e,n){return D(this.style(e,n),{class:t})},this.style=function(e,n){M(e)||n||(n=e,e=[]);var r=P(e,function(e,n){return D(e,t[n]||{})},{});return n?D(r,n):r},this.computeStyle=function(t,n,r){return M(n)||(r=n,n=[]),e.style(n||[],D({},r,t||{}))}}]};function Le(t,e){return Math.round(t*e)/e}function Be(t){return R(t)?t+"px":t}function Pe(t){const e=(t=D({},{width:"100%",height:"100%"},t)).container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),function(t,...e){const n=t.style;o(e,function(t){t&&o(t,function(t,e){n[e]=t})})}(n,{position:"relative",overflow:"hidden",width:Be(t.width),height:Be(t.height)}),e.appendChild(n),n}function Ne(t,e,n){const r=it("g");tt(r).add(e);const o=void 0!==n?n:t.childNodes.length-1;return t.insertBefore(r,t.childNodes[o]||null),r}const Te={shape:["x","y","width","height"],connection:["waypoints"]};function Ae(t,e,n,r){this._eventBus=e,this._elementRegistry=r,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}function De(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}Ae.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Ae.prototype._init=function(t){const e=this._eventBus,n=this._container=Pe(t),r=this._svg=it("svg");U(r,{width:"100%",height:"100%"}),K(n,r);const o=this._viewport=Ne(r,"viewport");t.deferUpdate&&(this._viewboxChanged=function(t,e){let n,r,o,i;function s(n){let s=Date.now(),u=n?0:i+e-s;if(u>0)return a(u);t.apply(o,r),c()}function a(t){n=setTimeout(s,t)}function c(){n&&clearTimeout(n),n=i=r=o=void 0}function u(...t){i=Date.now(),r=t,o=this,n||a(e)}return u.flush=function(){n&&s(!0),c()},u.cancel=c,u}(A(this._viewboxChanged,this),300)),e.on("diagram.init",()=>{e.fire("canvas.init",{svg:r,viewport:o})}),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],()=>{delete this._cachedViewbox}),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)},Ae.prototype._destroy=function(){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const t=this._container.parentNode;t&&t.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},Ae.prototype._clear=function(){this._elementRegistry.getAll().forEach(t=>{const e=function(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}(t);"root"===e?this.removeRootElement(t):this._removeElement(t,e)}),this._planes=[],this._rootElement=null,delete this._cachedViewbox},Ae.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Ae.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),void 0!==e&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group},Ae.prototype._getChildIndex=function(t){return P(this._layers,function(e,n){return n.visible&&t>=n.index&&e++,e},0)},Ae.prototype._createLayer=function(t,e){void 0===e&&(e=1);const n=this._getChildIndex(e);return{group:Ne(this._viewport,"layer-"+t,n),index:e,visible:!0}},Ae.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,r=e.group,o=e.index;if(e.visible)return r;const i=this._getChildIndex(o);return n.insertBefore(r,n.childNodes[i]||null),e.visible=!0,r},Ae.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible?(vt(n),e.visible=!1,n):n},Ae.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],vt(e.group))},Ae.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null},Ae.prototype.findRoot=function(t){if("string"==typeof t&&(t=this._elementRegistry.get(t)),!t)return;const e=this._findPlaneForRoot(function(t){for(;t.parent;)t=t.parent;return t}(t))||{};return e.rootElement},Ae.prototype.getRootElements=function(){return this._planes.map(function(t){return t.rootElement})},Ae.prototype._findPlaneForRoot=function(t){return L(this._planes,function(e){return e.rootElement===t})},Ae.prototype.getContainer=function(){return this._container},Ae.prototype._updateMarker=function(t,e,n){let r;t.id||(t=this._elementRegistry.get(t)),r=this._elementRegistry._elements[t.id],r&&(B([r.gfx,r.secondaryGfx],function(t){t&&(n?tt(t).add(e):tt(t).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:r.gfx,marker:e,add:!!n}))},Ae.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)},Ae.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)},Ae.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));return tt(this.getGraphics(t)).has(e)},Ae.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)},Ae.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))},Ae.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const r=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(t,r),this._planes.push({rootElement:t,layer:r}),t},Ae.prototype.removeRootElement=function(t){"string"==typeof t&&(t=this._elementRegistry.get(t));if(this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter(function(e){return e.rootElement!==t}),this._rootElement===t&&(this._rootElement=null),t},Ae.prototype.setRootElement=function(t){if(t===this._rootElement)return;let e;if(!t)throw new Error("rootElement required");return e=this._findPlaneForRoot(t),e||(t=this.addRootElement(t)),this._setRoot(t),t},Ae.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)},Ae.prototype._addRoot=function(t,e){const n=this._elementRegistry,r=this._eventBus;r.fire("root.add",{element:t}),n.add(t,e),r.fire("root.added",{element:t,gfx:e})},Ae.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})},Ae.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=Te[t],r=function(t,e){return!!P(t,function(t,n,r){return t&&e(n,r)},!0)}(n,function(t){return void 0!==e[t]});if(!r)throw new Error("must supply { "+n.join(", ")+" } with "+t)},Ae.prototype._setParent=function(t,e,n){!function(t,e,n){if(t&&e){"number"!=typeof n&&(n=-1);var r=t.indexOf(e);if(-1!==r){if(r===n)return;if(-1===n)return;t.splice(r,1)}-1!==n?t.splice(n,0,e):t.push(e)}}(e.children,t,n),t.parent=e},Ae.prototype._addElement=function(t,e,n,r){n=n||this.getRootElement();const o=this._eventBus,i=this._graphicsFactory;this._ensureValid(t,e),o.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,r);const s=i.create(t,e,r);return this._elementRegistry.add(e,s),i.update(t,e,s),o.fire(t+".added",{element:e,gfx:s}),e},Ae.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)},Ae.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)},Ae.prototype._removeElement=function(t,e){const n=this._elementRegistry,r=this._graphicsFactory,o=this._eventBus;if(t=n.get(t.id||t))return o.fire(e+".remove",{element:t}),r.remove(t),function(t,e){if(!t||!e)return-1;var n=t.indexOf(e);-1!==n&&t.splice(n,1)}(t.parent&&t.parent.children,t),t.parent=null,o.fire(e+".removed",{element:t}),n.remove(t),t},Ae.prototype.removeShape=function(t){return this._removeElement(t,"shape")},Ae.prototype.removeConnection=function(t){return this._removeElement(t,"connection")},Ae.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)},Ae.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Ae.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Ae.prototype.viewbox=function(t){if(void 0===t&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let r,o,i,s,a,c,u;return t?(this._changeViewbox(function(){a=Math.min(n.width/t.width,n.height/t.height);const r=this._svg.createSVGMatrix().scale(a).translate(-t.x,-t.y);gt(e,r)}),t):(i=this._rootElement?this.getActiveLayer():null,r=i&&i.getBBox()||{},s=gt(e),o=s?s.matrix:function(t,e,n,r,o,i){var s=at().createSVGMatrix();switch(arguments.length){case 0:return s;case 1:return ct(s,t);case 6:return ct(s,{a:t,b:e,c:n,d:r,e:o,f:i})}}(),a=Le(o.a,1e3),c=Le(-o.e||0,1e3),u=Le(-o.f||0,1e3),t=this._cachedViewbox={x:c?c/a:0,y:u?u/a:0,width:n.width/a,height:n.height/a,scale:a,inner:{width:r.width||0,height:r.height||0,x:r.x||0,y:r.y||0},outer:n})},Ae.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox(function(){t=D({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),De(e,n)}),{x:n.e,y:n.f}},Ae.prototype.scrollToElement=function(t,e){let n=100;"string"==typeof t&&(t=this._elementRegistry.get(t));const r=this.findRoot(t);if(r!==this.getRootElement()&&this.setRootElement(r),r===t)return;e||(e={}),"number"==typeof e&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const o=Me(t),i=re(o),s=this.viewbox(),a=this.zoom();let c,u;s.y+=e.top/a,s.x+=e.left/a,s.width-=(e.right+e.left)/a,s.height-=(e.bottom+e.top)/a;const l=re(s);if(o.width<s.width&&o.height<s.height){const t=Math.max(0,i.right-l.right),e=Math.min(0,i.left-l.left),n=Math.max(0,i.bottom-l.bottom),r=Math.min(0,i.top-l.top);c=t||e,u=n||r}else c=o.x-s.x,u=o.y-s.y;this.scroll({dx:-c*a,dy:-u*a})},Ae.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if("fit-viewport"===t)return this._fitViewport(e);let n,r;return this._changeViewbox(function(){"object"!=typeof e&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),r=this._setZoom(t,e)}),Le(r.a,1e3)},Ae.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,r=e.inner;let o,i;return r.x>=0&&r.y>=0&&r.x+r.width<=n.width&&r.y+r.height<=n.height&&!t?i={x:0,y:0,width:Math.max(r.width+r.x,n.width),height:Math.max(r.height+r.y,n.height)}:(o=Math.min(1,n.width/r.width,n.height/r.height),i={x:r.x+(t?r.width/2-n.width/o/2:0),y:r.y+(t?r.height/2-n.height/o/2:0),width:n.width/o,height:n.height/o}),this.viewbox(i),this.viewbox(!1).scale},Ae.prototype._setZoom=function(t,e){const n=this._svg,r=this._viewport,o=n.createSVGMatrix(),i=n.createSVGPoint();let s,a,c,u,l;c=r.getCTM();const h=c.a;return e?(s=D(i,e),a=s.matrixTransform(c.inverse()),u=o.translate(a.x,a.y).scale(1/h*t).translate(-a.x,-a.y),l=c.multiply(u)):l=o.scale(t),De(this._viewport,l),l},Ae.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Ae.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;if(t.waypoints){n=this.getGraphics(t).getBBox()}else n=t;return{x:n.x*e.scale-e.x*e.scale,y:n.y*e.scale-e.y*e.scale,width:n.width*e.scale,height:n.height*e.scale}},Ae.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var Ve="data-element-id";function Ge(t){this._elements={},this._eventBus=t}Ge.$inject=["eventBus"],Ge.prototype.add=function(t,e,n){var r=t.id;this._validateId(r),U(e,Ve,r),n&&U(n,Ve,r),this._elements[r]={element:t,gfx:e,secondaryGfx:n}},Ge.prototype.remove=function(t){var e=this._elements,n=t.id||t,r=n&&e[n];r&&(U(r.gfx,Ve,""),r.secondaryGfx&&U(r.secondaryGfx,Ve,""),delete e[n])},Ge.prototype.updateId=function(t,e){this._validateId(e),"string"==typeof t&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),r=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,r)},Ge.prototype.updateGraphics=function(t,e,n){var r=t.id||t,o=this._elements[r];return n?o.secondaryGfx=e:o.gfx=e,e&&U(e,Ve,r),e},Ge.prototype.get=function(t){var e;e="string"==typeof t?t:t&&U(t,Ve);var n=this._elements[e];return n&&n.element},Ge.prototype.filter=function(t){var e=[];return this.forEach(function(n,r){t(n,r)&&e.push(n)}),e},Ge.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),r=0;r<n.length;r++){var o=e[n[r]],i=o.element;if(t(i,o.gfx))return i}},Ge.prototype.getAll=function(){return this.filter(function(t){return t})},Ge.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach(function(n){var r=e[n],o=r.element,i=r.gfx;return t(o,i)})},Ge.prototype.getGraphics=function(t,e){var n=t.id||t,r=this._elements[n];return r&&(e?r.secondaryGfx:r.gfx)},Ge.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var ze={exports:{}},Fe={};Fe.extend=function(t,e,n,r){var o=n.inverse;return Object.defineProperty(t,"remove",{value:function(t){var n=this.indexOf(t);return-1!==n&&(this.splice(n,1),e.unset(t,o,r)),t}}),Object.defineProperty(t,"contains",{value:function(t){return-1!==this.indexOf(t)}}),Object.defineProperty(t,"add",{value:function(t,n){var i=this.indexOf(t);if(void 0===n){if(-1!==i)return;n=this.length}-1!==i&&this.splice(i,1),this.splice(n,0,t),-1===i&&e.set(t,o,r)}}),Object.defineProperty(t,"__refs_collection",{value:!0}),t},Fe.isExtended=function(t){return!0===t.__refs_collection};var $e=Fe;function Ie(t,e,n){var r=$e.extend(n[e.name]||[],t,e,n);Object.defineProperty(n,e.name,{enumerable:e.enumerable,value:r}),r.length&&r.forEach(function(r){t.set(r,e.inverse,n)})}function Ye(t,e){if(!(this instanceof Ye))return new Ye(t,e);t.inverse=e,e.inverse=t,this.props={},this.props[t.name]=t,this.props[e.name]=e}Ye.prototype.bind=function(t,e){if("string"==typeof e){if(!this.props[e])throw new Error("no property <"+e+"> in ref");e=this.props[e]}e.collection?Ie(this,e,t):function(t,e,n){var r=e.inverse,o=n[e.name];Object.defineProperty(n,e.name,{configurable:e.configurable,enumerable:e.enumerable,get:function(){return o},set:function(e){if(e!==o){var i=o;o=null,i&&t.unset(i,r,n),o=e,t.set(o,r,n)}}})}(this,e,t)},Ye.prototype.ensureRefsCollection=function(t,e){var n=t[e.name];return $e.isExtended(n)||Ie(this,e,t),n},Ye.prototype.ensureBound=function(t,e){(function(t,e){return Object.prototype.hasOwnProperty.call(t,e.name||e)})(t,e)||this.bind(t,e)},Ye.prototype.unset=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).remove(n):t[e.name]=void 0)},Ye.prototype.set=function(t,e,n){t&&(this.ensureBound(t,e),e.collection?this.ensureRefsCollection(t,e).add(n):t[e.name]=n)};var He=Ye;ze.exports=He,ze.exports.Collection=Fe;var qe=Wt(ze.exports),We=new qe({name:"children",enumerable:!0,collection:!0},{name:"parent"}),Ze=new qe({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),Ke=new qe({name:"attachers",collection:!0},{name:"host"}),Xe=new qe({name:"outgoing",collection:!0},{name:"source"}),Je=new qe({name:"incoming",collection:!0},{name:"target"});function Ue(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),We.bind(this,"parent"),Ze.bind(this,"labels"),Xe.bind(this,"outgoing"),Je.bind(this,"incoming")}function Qe(){Ue.call(this),We.bind(this,"children"),Ke.bind(this,"host"),Ke.bind(this,"attachers")}function tn(){Ue.call(this),We.bind(this,"children")}function en(){Qe.call(this),Ze.bind(this,"labelTarget")}function nn(){Ue.call(this),Xe.bind(this,"source"),Je.bind(this,"target")}Ce(Qe,Ue),Ce(tn,Qe),Ce(en,Qe),Ce(nn,Ue);var rn={connection:nn,shape:Qe,label:en,root:tn};function on(){this._uid=12}on.prototype.createRoot=function(t){return this.create("root",t)},on.prototype.createLabel=function(t){return this.create("label",t)},on.prototype.createShape=function(t){return this.create("shape",t)},on.prototype.createConnection=function(t){return this.create("connection",t)},on.prototype.create=function(t,e){return(e=D({},e||{})).id||(e.id=t+"_"+this._uid++),function(t,e){var n=rn[t];if(!n)throw new Error("unknown type: <"+t+">");return D(new n,e)}(t,e)};var sn="__fn",an=Array.prototype.slice;function cn(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function un(){}function ln(t,e,n){var r,o=r?at().createSVGTransformFromMatrix(r):at().createSVGTransform();o.setTranslate(e,n),gt(t,o)}function hn(t,e){this._eventBus=t,this._elementRegistry=e}function fn(t,e,n){var r=n||e.firstChild;t!==r&&e.insertBefore(t,r)}cn.prototype.on=function(t,e,n,r){if(t=M(t)?t:[t],O(e)&&(r=n,n=e,e=1e3),!R(e))throw new Error("priority must be a number");var o=n;r&&((o=A(n,r))[sn]=n[sn]||n);var i=this;t.forEach(function(t){i._addListener(t,{priority:e,callback:o,next:null})})},cn.prototype.once=function(t,e,n,r){var o=this;if(O(e)&&(r=n,n=e,e=1e3),!R(e))throw new Error("priority must be a number");function i(){i.__isTomb=!0;var e=n.apply(r,arguments);return o.off(t,i),e}i[sn]=n,this.on(t,e,i)},cn.prototype.off=function(t,e){t=M(t)?t:[t];var n=this;t.forEach(function(t){n._removeListener(t,e)})},cn.prototype.createEvent=function(t){var e=new un;return e.init(t),e},cn.prototype.fire=function(t,e){var n,r,o,i;if(i=an.call(arguments),"object"==typeof t&&(t=(e=t).type),!t)throw new Error("no event type specified");if(r=this._listeners[t]){n=e instanceof un?e:this.createEvent(e),i[0]=n;var s=n.type;t!==s&&(n.type=t);try{o=this._invokeListeners(n,i,r)}finally{t!==s&&(n.type=s)}return void 0===o&&n.defaultPrevented&&(o=!1),o}},cn.prototype.handleError=function(t){return!1===this.fire("error",{error:t})},cn.prototype._destroy=function(){this._listeners={}},cn.prototype._invokeListeners=function(t,e,n){for(var r;n&&!t.cancelBubble;)r=this._invokeListener(t,e,n),n=n.next;return r},cn.prototype._invokeListener=function(t,e,n){var r;if(n.callback.__isTomb)return r;try{r=function(t,e){return t.apply(null,e)}(n.callback,e),void 0!==r&&(t.returnValue=r,t.stopPropagation()),!1===r&&t.preventDefault()}catch(t){if(!this.handleError(t))throw console.error("unhandled error in event listener",t),t}return r},cn.prototype._addListener=function(t,e){var n,r=this._getListeners(t);if(r){for(;r;){if(r.priority<e.priority)return e.next=r,void(n?n.next=e:this._setListeners(t,e));n=r,r=r.next}n.next=e}else this._setListeners(t,e)},cn.prototype._getListeners=function(t){return this._listeners[t]},cn.prototype._setListeners=function(t,e){this._listeners[t]=e},cn.prototype._removeListener=function(t,e){var n,r,o,i=this._getListeners(t);if(e)for(;i;)n=i.next,(o=i.callback)!==e&&o[sn]!==e||(r?r.next=n:this._setListeners(t,n)),r=i,i=n;else this._setListeners(t,null)},un.prototype.stopPropagation=function(){this.cancelBubble=!0},un.prototype.preventDefault=function(){this.defaultPrevented=!0},un.prototype.init=function(t){D(this,t||{})},hn.$inject=["eventBus","elementRegistry"],hn.prototype._getChildrenContainer=function(t){var e,n=this._elementRegistry.getGraphics(t);return t.parent?(e=function(t){return t.parentNode.childNodes[1]}(n),e||(tt(e=it("g")).add("djs-children"),K(n.parentNode,e))):e=n,e},hn.prototype._clear=function(t){var e=function(t){return t.childNodes[0]}(t);return function(t){for(var e;e=t.firstChild;)t.removeChild(e)}(e),e},hn.prototype._createContainer=function(t,e,n,r){var o=it("g");tt(o).add("djs-group"),void 0!==n?fn(o,e,e.childNodes[n]):K(e,o);var i=it("g");tt(i).add("djs-element"),tt(i).add("djs-"+t),r&&tt(i).add("djs-frame"),K(o,i);var s=it("g");return tt(s).add("djs-visual"),K(i,s),i},hn.prototype.create=function(t,e,n){var r=this._getChildrenContainer(e.parent);return this._createContainer(t,r,n,Re(e))},hn.prototype.updateContainments=function(t){var e,n=this,r=this._elementRegistry;e=P(t,function(t,e){return e.parent&&(t[e.parent.id]=e.parent),t},{}),B(e,function(t){var e=t.children;if(e){var o=n._getChildrenContainer(t);B(e.slice().reverse(),function(t){fn(r.getGraphics(t).parentNode,o)})}})},hn.prototype.drawShape=function(t,e,n={}){return this._eventBus.fire("render.shape",{gfx:t,element:e,attrs:n})},hn.prototype.getShapePath=function(t){return this._eventBus.fire("render.getShapePath",t)},hn.prototype.drawConnection=function(t,e,n={}){return this._eventBus.fire("render.connection",{gfx:t,element:e,attrs:n})},hn.prototype.getConnectionPath=function(t){return this._eventBus.fire("render.getConnectionPath",t)},hn.prototype.update=function(t,e,n){if(e.parent){var r=this._clear(n);if("shape"===t)this.drawShape(r,e),ln(n,e.x,e.y);else{if("connection"!==t)throw new Error("unknown type: "+t);this.drawConnection(r,e)}e.hidden?U(n,"display","none"):U(n,"display","block")}},hn.prototype.remove=function(t){vt(this._elementRegistry.getGraphics(t).parentNode)};var pn={__depends__:[Se],__init__:["canvas"],canvas:["type",Ae],elementRegistry:["type",Ge],elementFactory:["type",on],eventBus:["type",cn],graphicsFactory:["type",hn]};function dn(t){return function(t){var e=new Ee(t);return e.init(),e}([{config:["value",t=t||{}]},pn].concat(t.modules||[]))}function yn(t,e){this._injector=e=e||dn(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}function vn(t){this._container=this._createContainer(t),this._init(this._container,t)}return yn.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},yn.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")},Ut(vn,yn),vn.prototype._coreModules=[ye],vn.prototype._viewModules=[F,q],vn.prototype._modules=[].concat(vn.prototype._coreModules,vn.prototype._viewModules),vn.prototype.importJSON=function(t){this.get("umlImporter").import(t)},vn.prototype._createContainer=function(t){var e;return D((e=x("containerID"in t?'<div id="'+t.containerID+'"class="umljs-container"></div>':'<div class="umljs-container"></div>')).style,{width:"100%",height:"100%",position:"relative"}),e},vn.prototype._init=function(t,e){var n={canvas:{container:t},modules:this._modules};yn.call(this,n),e&&e.parent&&this.attachTo(e.parent)},vn.prototype.attachTo=function(t){if(!t)throw new Error("parentNode required");this.detach(),t.get&&t.constructor.prototype.jquery&&(t=t.get(0)),"string"==typeof t&&(t=b(t)),t.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},vn.prototype.detach=function(){var t=this._container,e=t.parentNode;e&&(this._emit("detach",{}),e.removeChild(t))},vn.prototype._emit=function(t,e){return this.get("eventBus").fire(t,e)},vn});
